(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();/*!
 * @pixi/constants - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var st;(function(r){r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2"})(st||(st={}));var ti;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS"})(ti||(ti={}));var en;(function(r){r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL"})(en||(en={}));var S;(function(r){r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR"})(S||(S={}));var ri;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(ri||(ri={}));var E;(function(r){r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(E||(E={}));var qt;(function(r){r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(qt||(qt={}));var F;(function(r){r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT"})(F||(F={}));var tn;(function(r){r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT"})(tn||(tn={}));var Xe;(function(r){r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR"})(Xe||(Xe={}));var rn;(function(r){r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(rn||(rn={}));var Tt;(function(r){r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL"})(Tt||(Tt={}));var wt;(function(r){r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(wt||(wt={}));var pt;(function(r){r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT"})(pt||(pt={}));var nn;(function(r){r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL"})(nn||(nn={}));var Te;(function(r){r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp"})(Te||(Te={}));var J;(function(r){r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR"})(J||(J={}));var da;(function(r){r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA"})(da||(da={}));var q;(function(r){r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH"})(q||(q={}));var We;(function(r){r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(We||(We={}));/*!
 * @pixi/settings - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var od={createCanvas:function(r,e){var t=document.createElement("canvas");return t.width=r,t.height=e,t},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var r;return(r=document.baseURI)!==null&&r!==void 0?r:window.location.href},fetch:function(r,e){return fetch(r,e)}},Bn=/iPhone/i,fa=/iPod/i,pa=/iPad/i,ma=/\biOS-universal(?:.+)Mac\b/i,Un=/\bAndroid(?:.+)Mobile\b/i,ga=/Android/i,ar=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,xi=/Silk/i,Ze=/Windows Phone/i,va=/\bWindows(?:.+)ARM\b/i,ya=/BlackBerry/i,_a=/BB10/i,ba=/Opera Mini/i,Ea=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ia=/Mobile(?:.+)Firefox\b/i,Ta=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function ad(r){return function(e){return e.test(r)}}function ud(r){var e={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?e.userAgent=r:r&&r.userAgent&&(e={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var t=e.userAgent,i=t.split("[FBAN");typeof i[1]<"u"&&(t=i[0]),i=t.split("Twitter"),typeof i[1]<"u"&&(t=i[0]);var n=ad(t),s={apple:{phone:n(Bn)&&!n(Ze),ipod:n(fa),tablet:!n(Bn)&&(n(pa)||Ta(e))&&!n(Ze),universal:n(ma),device:(n(Bn)||n(fa)||n(pa)||n(ma)||Ta(e))&&!n(Ze)},amazon:{phone:n(ar),tablet:!n(ar)&&n(xi),device:n(ar)||n(xi)},android:{phone:!n(Ze)&&n(ar)||!n(Ze)&&n(Un),tablet:!n(Ze)&&!n(ar)&&!n(Un)&&(n(xi)||n(ga)),device:!n(Ze)&&(n(ar)||n(xi)||n(Un)||n(ga))||n(/\bokhttp\b/i)},windows:{phone:n(Ze),tablet:n(va),device:n(Ze)||n(va)},other:{blackberry:n(ya),blackberry10:n(_a),opera:n(ba),firefox:n(Ia),chrome:n(Ea),device:n(ya)||n(_a)||n(ba)||n(Ia)||n(Ea)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}var Xt=ud(globalThis.navigator);function ld(){return!Xt.apple.device}function hd(r){var e=!0;if(Xt.tablet||Xt.phone){if(Xt.apple.device){var t=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(t){var i=parseInt(t[1],10);i<11&&(e=!1)}}if(Xt.android.device){var t=navigator.userAgent.match(/Android\s([0-9.]*)/);if(t){var i=parseInt(t[1],10);i<7&&(e=!1)}}}return e?r:4}var x={ADAPTER:od,MIPMAP_TEXTURES:Tt.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:q.NONE,SPRITE_MAX_TEXTURES:hd(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,antialias:!1,preserveDrawingBuffer:!1},GC_MODE:nn.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:rn.CLAMP,SCALE_MODE:Xe.LINEAR,PRECISION_VERTEX:Te.HIGH,PRECISION_FRAGMENT:Xt.apple.device?Te.HIGH:Te.MEDIUM,CAN_UPLOAD_SAME_BUFFER:ld(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},Wr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cd(r){var e=r.default;if(typeof e=="function"){var t=function(){return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),t}var Ll={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function n(u,l,h){this.fn=u,this.context=l,this.once=h||!1}function s(u,l,h,c,d){if(typeof h!="function")throw new TypeError("The listener must be a function");var f=new n(h,c||u,d),p=t?t+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],f]:u._events[p].push(f):(u._events[p]=f,u._eventsCount++),u}function o(u,l){--u._eventsCount===0?u._events=new i:delete u._events[l]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],h,c;if(this._eventsCount===0)return l;for(c in h=this._events)e.call(h,c)&&l.push(t?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},a.prototype.listeners=function(l){var h=t?t+l:l,c=this._events[h];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,p=new Array(f);d<f;d++)p[d]=c[d].fn;return p},a.prototype.listenerCount=function(l){var h=t?t+l:l,c=this._events[h];return c?c.fn?1:c.length:0},a.prototype.emit=function(l,h,c,d,f,p){var v=t?t+l:l;if(!this._events[v])return!1;var m=this._events[v],y=arguments.length,_,g;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,c),!0;case 4:return m.fn.call(m.context,h,c,d),!0;case 5:return m.fn.call(m.context,h,c,d,f),!0;case 6:return m.fn.call(m.context,h,c,d,f,p),!0}for(g=1,_=new Array(y-1);g<y;g++)_[g-1]=arguments[g];m.fn.apply(m.context,_)}else{var b=m.length,I;for(g=0;g<b;g++)switch(m[g].once&&this.removeListener(l,m[g].fn,void 0,!0),y){case 1:m[g].fn.call(m[g].context);break;case 2:m[g].fn.call(m[g].context,h);break;case 3:m[g].fn.call(m[g].context,h,c);break;case 4:m[g].fn.call(m[g].context,h,c,d);break;default:if(!_)for(I=1,_=new Array(y-1);I<y;I++)_[I-1]=arguments[I];m[g].fn.apply(m[g].context,_)}}return!0},a.prototype.on=function(l,h,c){return s(this,l,h,c,!1)},a.prototype.once=function(l,h,c){return s(this,l,h,c,!0)},a.prototype.removeListener=function(l,h,c,d){var f=t?t+l:l;if(!this._events[f])return this;if(!h)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===h&&(!d||p.once)&&(!c||p.context===c)&&o(this,f);else{for(var v=0,m=[],y=p.length;v<y;v++)(p[v].fn!==h||d&&!p[v].once||c&&p[v].context!==c)&&m.push(p[v]);m.length?this._events[f]=m.length===1?m[0]:m:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(Ll);const Ct=Ll.exports;var Dl={exports:{}};Dl.exports=In;Dl.exports.default=In;function In(r,e,t){t=t||2;var i=e&&e.length,n=i?e[0]*t:r.length,s=Nl(r,0,n,t,!0),o=[];if(!s||s.next===s.prev)return o;var a,u,l,h,c,d,f;if(i&&(s=gd(r,e,s,t)),r.length>80*t){a=l=r[0],u=h=r[1];for(var p=t;p<n;p+=t)c=r[p],d=r[p+1],c<a&&(a=c),d<u&&(u=d),c>l&&(l=c),d>h&&(h=d);f=Math.max(l-a,h-u),f=f!==0?32767/f:0}return ii(s,o,t,a,u,f,0),o}function Nl(r,e,t,i,n){var s,o;if(n===Rs(r,e,t,i)>0)for(s=e;s<t;s+=i)o=wa(s,r[s],r[s+1],o);else for(s=t-i;s>=e;s-=i)o=wa(s,r[s],r[s+1],o);return o&&Tn(o,o.next)&&(si(o),o=o.next),o}function er(r,e){if(!r)return r;e||(e=r);var t=r,i;do if(i=!1,!t.steiner&&(Tn(t,t.next)||X(t.prev,t,t.next)===0)){if(si(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function ii(r,e,t,i,n,s,o){if(!!r){!o&&s&&Ed(r,i,n,s);for(var a=r,u,l;r.prev!==r.next;){if(u=r.prev,l=r.next,s?fd(r,i,n,s):dd(r)){e.push(u.i/t|0),e.push(r.i/t|0),e.push(l.i/t|0),si(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=pd(er(r),e,t),ii(r,e,t,i,n,s,2)):o===2&&md(r,e,t,i,n,s):ii(er(r),e,t,i,n,s,1);break}}}}function dd(r){var e=r.prev,t=r,i=r.next;if(X(e,t,i)>=0)return!1;for(var n=e.x,s=t.x,o=i.x,a=e.y,u=t.y,l=i.y,h=n<s?n<o?n:o:s<o?s:o,c=a<u?a<l?a:l:u<l?u:l,d=n>s?n>o?n:o:s>o?s:o,f=a>u?a>l?a:l:u>l?u:l,p=i.next;p!==e;){if(p.x>=h&&p.x<=d&&p.y>=c&&p.y<=f&&mr(n,a,s,u,o,l,p.x,p.y)&&X(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function fd(r,e,t,i){var n=r.prev,s=r,o=r.next;if(X(n,s,o)>=0)return!1;for(var a=n.x,u=s.x,l=o.x,h=n.y,c=s.y,d=o.y,f=a<u?a<l?a:l:u<l?u:l,p=h<c?h<d?h:d:c<d?c:d,v=a>u?a>l?a:l:u>l?u:l,m=h>c?h>d?h:d:c>d?c:d,y=As(f,p,e,t,i),_=As(v,m,e,t,i),g=r.prevZ,b=r.nextZ;g&&g.z>=y&&b&&b.z<=_;){if(g.x>=f&&g.x<=v&&g.y>=p&&g.y<=m&&g!==n&&g!==o&&mr(a,h,u,c,l,d,g.x,g.y)&&X(g.prev,g,g.next)>=0||(g=g.prevZ,b.x>=f&&b.x<=v&&b.y>=p&&b.y<=m&&b!==n&&b!==o&&mr(a,h,u,c,l,d,b.x,b.y)&&X(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;g&&g.z>=y;){if(g.x>=f&&g.x<=v&&g.y>=p&&g.y<=m&&g!==n&&g!==o&&mr(a,h,u,c,l,d,g.x,g.y)&&X(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;b&&b.z<=_;){if(b.x>=f&&b.x<=v&&b.y>=p&&b.y<=m&&b!==n&&b!==o&&mr(a,h,u,c,l,d,b.x,b.y)&&X(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function pd(r,e,t){var i=r;do{var n=i.prev,s=i.next.next;!Tn(n,s)&&kl(n,i,i.next,s)&&ni(n,s)&&ni(s,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),si(i),si(i.next),i=r=s),i=i.next}while(i!==r);return er(i)}function md(r,e,t,i,n,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&wd(o,a)){var u=Bl(o,a);o=er(o,o.next),u=er(u,u.next),ii(o,e,t,i,n,s,0),ii(u,e,t,i,n,s,0);return}a=a.next}o=o.next}while(o!==r)}function gd(r,e,t,i){var n=[],s,o,a,u,l;for(s=0,o=e.length;s<o;s++)a=e[s]*i,u=s<o-1?e[s+1]*i:r.length,l=Nl(r,a,u,i,!1),l===l.next&&(l.steiner=!0),n.push(Td(l));for(n.sort(vd),s=0;s<n.length;s++)t=yd(n[s],t);return t}function vd(r,e){return r.x-e.x}function yd(r,e){var t=_d(r,e);if(!t)return e;var i=Bl(t,r);return er(i,i.next),er(t,t.next)}function _d(r,e){var t=e,i=r.x,n=r.y,s=-1/0,o;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){var a=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=i&&a>s&&(s=a,o=t.x<t.next.x?t:t.next,a===i))return o}t=t.next}while(t!==e);if(!o)return null;var u=o,l=o.x,h=o.y,c=1/0,d;t=o;do i>=t.x&&t.x>=l&&i!==t.x&&mr(n<h?i:s,n,l,h,n<h?s:i,n,t.x,t.y)&&(d=Math.abs(n-t.y)/(i-t.x),ni(t,r)&&(d<c||d===c&&(t.x>o.x||t.x===o.x&&bd(o,t)))&&(o=t,c=d)),t=t.next;while(t!==u);return o}function bd(r,e){return X(r.prev,r,e.prev)<0&&X(e.next,r,r.next)<0}function Ed(r,e,t,i){var n=r;do n.z===0&&(n.z=As(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,Id(n)}function Id(r){var e,t,i,n,s,o,a,u,l=1;do{for(t=r,r=null,s=null,o=0;t;){for(o++,i=t,a=0,e=0;e<l&&(a++,i=i.nextZ,!!i);e++);for(u=l;a>0||u>0&&i;)a!==0&&(u===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,a--):(n=i,i=i.nextZ,u--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;t=i}s.nextZ=null,l*=2}while(o>1);return r}function As(r,e,t,i,n){return r=(r-t)*n|0,e=(e-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function Td(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function mr(r,e,t,i,n,s,o,a){return(n-o)*(e-a)>=(r-o)*(s-a)&&(r-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(n-o)*(i-a)}function wd(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!xd(r,e)&&(ni(r,e)&&ni(e,r)&&Sd(r,e)&&(X(r.prev,r,e.prev)||X(r,e.prev,e))||Tn(r,e)&&X(r.prev,r,r.next)>0&&X(e.prev,e,e.next)>0)}function X(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Tn(r,e){return r.x===e.x&&r.y===e.y}function kl(r,e,t,i){var n=Ci(X(r,e,t)),s=Ci(X(r,e,i)),o=Ci(X(t,i,r)),a=Ci(X(t,i,e));return!!(n!==s&&o!==a||n===0&&Si(r,t,e)||s===0&&Si(r,i,e)||o===0&&Si(t,r,i)||a===0&&Si(t,e,i))}function Si(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Ci(r){return r>0?1:r<0?-1:0}function xd(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&kl(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function ni(r,e){return X(r.prev,r,r.next)<0?X(r,e,r.next)>=0&&X(r,r.prev,e)>=0:X(r,e,r.prev)<0||X(r,r.next,e)<0}function Sd(r,e){var t=r,i=!1,n=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&n<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==r);return i}function Bl(r,e){var t=new Ps(r.i,r.x,r.y),i=new Ps(e.i,e.x,e.y),n=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=n,n.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function wa(r,e,t,i){var n=new Ps(r,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function si(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ps(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}In.deviation=function(r,e,t,i){var n=e&&e.length,s=n?e[0]*t:r.length,o=Math.abs(Rs(r,0,s,t));if(n)for(var a=0,u=e.length;a<u;a++){var l=e[a]*t,h=a<u-1?e[a+1]*t:r.length;o-=Math.abs(Rs(r,l,h,t))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*t,f=i[a+1]*t,p=i[a+2]*t;c+=Math.abs((r[d]-r[p])*(r[f+1]-r[d+1])-(r[d]-r[f])*(r[p+1]-r[d+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function Rs(r,e,t,i){for(var n=0,s=e,o=t-i;s<t;s+=i)n+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return n}In.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var o=0;o<e;o++)t.vertices.push(r[n][s][o]);n>0&&(i+=r[n-1].length,t.holes.push(i))}return t};var Ms={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */(function(r,e){(function(t){var i=e&&!e.nodeType&&e,n=r&&!r.nodeType&&r,s=typeof Wr=="object"&&Wr;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,u=36,l=1,h=26,c=38,d=700,f=72,p=128,v="-",m=/^xn--/,y=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=u-l,I=Math.floor,T=String.fromCharCode,R;function D(w){throw new RangeError(g[w])}function M(w,P){for(var L=w.length,H=[];L--;)H[L]=P(w[L]);return H}function B(w,P){var L=w.split("@"),H="";L.length>1&&(H=L[0]+"@",w=L[1]),w=w.replace(_,".");var Y=w.split("."),fe=M(Y,P).join(".");return H+fe}function re(w){for(var P=[],L=0,H=w.length,Y,fe;L<H;)Y=w.charCodeAt(L++),Y>=55296&&Y<=56319&&L<H?(fe=w.charCodeAt(L++),(fe&64512)==56320?P.push(((Y&1023)<<10)+(fe&1023)+65536):(P.push(Y),L--)):P.push(Y);return P}function _e(w){return M(w,function(P){var L="";return P>65535&&(P-=65536,L+=T(P>>>10&1023|55296),P=56320|P&1023),L+=T(P),L}).join("")}function Z(w){return w-48<10?w-22:w-65<26?w-65:w-97<26?w-97:u}function ce(w,P){return w+22+75*(w<26)-((P!=0)<<5)}function de(w,P,L){var H=0;for(w=L?I(w/d):w>>1,w+=I(w/P);w>b*h>>1;H+=u)w=I(w/b);return I(H+(b+1)*w/(w+c))}function be(w){var P=[],L=w.length,H,Y=0,fe=p,ie=f,Ee,Oe,Ue,Je,le,xe,Fe,ht,Pt;for(Ee=w.lastIndexOf(v),Ee<0&&(Ee=0),Oe=0;Oe<Ee;++Oe)w.charCodeAt(Oe)>=128&&D("not-basic"),P.push(w.charCodeAt(Oe));for(Ue=Ee>0?Ee+1:0;Ue<L;){for(Je=Y,le=1,xe=u;Ue>=L&&D("invalid-input"),Fe=Z(w.charCodeAt(Ue++)),(Fe>=u||Fe>I((a-Y)/le))&&D("overflow"),Y+=Fe*le,ht=xe<=ie?l:xe>=ie+h?h:xe-ie,!(Fe<ht);xe+=u)Pt=u-ht,le>I(a/Pt)&&D("overflow"),le*=Pt;H=P.length+1,ie=de(Y-Je,H,Je==0),I(Y/H)>a-fe&&D("overflow"),fe+=I(Y/H),Y%=H,P.splice(Y++,0,fe)}return _e(P)}function lt(w){var P,L,H,Y,fe,ie,Ee,Oe,Ue,Je,le,xe=[],Fe,ht,Pt,kn;for(w=re(w),Fe=w.length,P=p,L=0,fe=f,ie=0;ie<Fe;++ie)le=w[ie],le<128&&xe.push(T(le));for(H=Y=xe.length,Y&&xe.push(v);H<Fe;){for(Ee=a,ie=0;ie<Fe;++ie)le=w[ie],le>=P&&le<Ee&&(Ee=le);for(ht=H+1,Ee-P>I((a-L)/ht)&&D("overflow"),L+=(Ee-P)*ht,P=Ee,ie=0;ie<Fe;++ie)if(le=w[ie],le<P&&++L>a&&D("overflow"),le==P){for(Oe=L,Ue=u;Je=Ue<=fe?l:Ue>=fe+h?h:Ue-fe,!(Oe<Je);Ue+=u)kn=Oe-Je,Pt=u-Je,xe.push(T(ce(Je+kn%Pt,0))),Oe=I(kn/Pt);xe.push(T(ce(Oe,0))),fe=de(L,ht,H==Y),L=0,++H}++L,++P}return xe.join("")}function Nn(w){return B(w,function(P){return m.test(P)?be(P.slice(4).toLowerCase()):P})}function wi(w){return B(w,function(P){return y.test(P)?"xn--"+lt(P):P})}if(o={version:"1.4.1",ucs2:{decode:re,encode:_e},decode:be,encode:lt,toASCII:wi,toUnicode:Nn},i&&n)if(r.exports==i)n.exports=o;else for(R in o)o.hasOwnProperty(R)&&(i[R]=o[R]);else t.punycode=o})(Wr)})(Ms,Ms.exports);var Cd=Error,Ad=EvalError,Pd=RangeError,Rd=ReferenceError,Ul=SyntaxError,gi=TypeError,Md=URIError,Od=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),i=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;e[t]=n;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var s=Object.getOwnPropertySymbols(e);if(s.length!==1||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==n||o.enumerable!==!0)return!1}return!0},xa=typeof Symbol<"u"&&Symbol,Fd=Od,Ld=function(){return typeof xa!="function"||typeof Symbol!="function"||typeof xa("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Fd()},Gn={__proto__:null,foo:{}},Dd=Object,Nd=function(){return{__proto__:Gn}.foo===Gn.foo&&!(Gn instanceof Dd)},kd="Function.prototype.bind called on incompatible ",Bd=Object.prototype.toString,Ud=Math.max,Gd="[object Function]",Sa=function(e,t){for(var i=[],n=0;n<e.length;n+=1)i[n]=e[n];for(var s=0;s<t.length;s+=1)i[s+e.length]=t[s];return i},Vd=function(e,t){for(var i=[],n=t||0,s=0;n<e.length;n+=1,s+=1)i[s]=e[n];return i},Hd=function(r,e){for(var t="",i=0;i<r.length;i+=1)t+=r[i],i+1<r.length&&(t+=e);return t},jd=function(e){var t=this;if(typeof t!="function"||Bd.apply(t)!==Gd)throw new TypeError(kd+t);for(var i=Vd(arguments,1),n,s=function(){if(this instanceof n){var h=t.apply(this,Sa(i,arguments));return Object(h)===h?h:this}return t.apply(e,Sa(i,arguments))},o=Ud(0,t.length-i.length),a=[],u=0;u<o;u++)a[u]="$"+u;if(n=Function("binder","return function ("+Hd(a,",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var l=function(){};l.prototype=t.prototype,n.prototype=new l,l.prototype=null}return n},$d=jd,po=Function.prototype.bind||$d,zd=Function.prototype.call,Xd=Object.prototype.hasOwnProperty,Wd=po,Yd=Wd.call(zd,Xd),O,qd=Cd,Kd=Ad,Jd=Pd,Zd=Rd,Sr=Ul,vr=gi,Qd=Md,Gl=Function,Vn=function(r){try{return Gl('"use strict"; return ('+r+").constructor;")()}catch{}},Kt=Object.getOwnPropertyDescriptor;if(Kt)try{Kt({},"")}catch{Kt=null}var Hn=function(){throw new vr},ef=Kt?function(){try{return arguments.callee,Hn}catch{try{return Kt(arguments,"callee").get}catch{return Hn}}}():Hn,ur=Ld(),tf=Nd(),te=Object.getPrototypeOf||(tf?function(r){return r.__proto__}:null),dr={},rf=typeof Uint8Array>"u"||!te?O:te(Uint8Array),Jt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?O:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?O:ArrayBuffer,"%ArrayIteratorPrototype%":ur&&te?te([][Symbol.iterator]()):O,"%AsyncFromSyncIteratorPrototype%":O,"%AsyncFunction%":dr,"%AsyncGenerator%":dr,"%AsyncGeneratorFunction%":dr,"%AsyncIteratorPrototype%":dr,"%Atomics%":typeof Atomics>"u"?O:Atomics,"%BigInt%":typeof BigInt>"u"?O:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?O:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?O:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?O:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":qd,"%eval%":eval,"%EvalError%":Kd,"%Float32Array%":typeof Float32Array>"u"?O:Float32Array,"%Float64Array%":typeof Float64Array>"u"?O:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?O:FinalizationRegistry,"%Function%":Gl,"%GeneratorFunction%":dr,"%Int8Array%":typeof Int8Array>"u"?O:Int8Array,"%Int16Array%":typeof Int16Array>"u"?O:Int16Array,"%Int32Array%":typeof Int32Array>"u"?O:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ur&&te?te(te([][Symbol.iterator]())):O,"%JSON%":typeof JSON=="object"?JSON:O,"%Map%":typeof Map>"u"?O:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ur||!te?O:te(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?O:Promise,"%Proxy%":typeof Proxy>"u"?O:Proxy,"%RangeError%":Jd,"%ReferenceError%":Zd,"%Reflect%":typeof Reflect>"u"?O:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?O:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ur||!te?O:te(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?O:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ur&&te?te(""[Symbol.iterator]()):O,"%Symbol%":ur?Symbol:O,"%SyntaxError%":Sr,"%ThrowTypeError%":ef,"%TypedArray%":rf,"%TypeError%":vr,"%Uint8Array%":typeof Uint8Array>"u"?O:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?O:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?O:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?O:Uint32Array,"%URIError%":Qd,"%WeakMap%":typeof WeakMap>"u"?O:WeakMap,"%WeakRef%":typeof WeakRef>"u"?O:WeakRef,"%WeakSet%":typeof WeakSet>"u"?O:WeakSet};if(te)try{null.error}catch(r){var nf=te(te(r));Jt["%Error.prototype%"]=nf}var sf=function r(e){var t;if(e==="%AsyncFunction%")t=Vn("async function () {}");else if(e==="%GeneratorFunction%")t=Vn("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Vn("async function* () {}");else if(e==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(t=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var n=r("%AsyncGenerator%");n&&te&&(t=te(n.prototype))}return Jt[e]=t,t},Ca={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},vi=po,sn=Yd,of=vi.call(Function.call,Array.prototype.concat),af=vi.call(Function.apply,Array.prototype.splice),Aa=vi.call(Function.call,String.prototype.replace),on=vi.call(Function.call,String.prototype.slice),uf=vi.call(Function.call,RegExp.prototype.exec),lf=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,hf=/\\(\\)?/g,cf=function(e){var t=on(e,0,1),i=on(e,-1);if(t==="%"&&i!=="%")throw new Sr("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&t!=="%")throw new Sr("invalid intrinsic syntax, expected opening `%`");var n=[];return Aa(e,lf,function(s,o,a,u){n[n.length]=a?Aa(u,hf,"$1"):o||s}),n},df=function(e,t){var i=e,n;if(sn(Ca,i)&&(n=Ca[i],i="%"+n[0]+"%"),sn(Jt,i)){var s=Jt[i];if(s===dr&&(s=sf(i)),typeof s>"u"&&!t)throw new vr("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:s}}throw new Sr("intrinsic "+e+" does not exist!")},Mr=function(e,t){if(typeof e!="string"||e.length===0)throw new vr("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new vr('"allowMissing" argument must be a boolean');if(uf(/^%?[^%]*%?$/,e)===null)throw new Sr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=cf(e),n=i.length>0?i[0]:"",s=df("%"+n+"%",t),o=s.name,a=s.value,u=!1,l=s.alias;l&&(n=l[0],af(i,of([0,1],l)));for(var h=1,c=!0;h<i.length;h+=1){var d=i[h],f=on(d,0,1),p=on(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new Sr("property names with quotes must have matching quotes");if((d==="constructor"||!c)&&(u=!0),n+="."+d,o="%"+n+"%",sn(Jt,o))a=Jt[o];else if(a!=null){if(!(d in a)){if(!t)throw new vr("base intrinsic for "+e+" exists, but the property is not available.");return}if(Kt&&h+1>=i.length){var v=Kt(a,d);c=!!v,c&&"get"in v&&!("originalValue"in v.get)?a=v.get:a=a[d]}else c=sn(a,d),a=a[d];c&&!u&&(Jt[o]=a)}}return a},Vl={exports:{}},jn,Pa;function mo(){if(Pa)return jn;Pa=1;var r=Mr,e=r("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return jn=e,jn}var ff=Mr,zi=ff("%Object.getOwnPropertyDescriptor%",!0);if(zi)try{zi([],"length")}catch{zi=null}var Hl=zi,Ra=mo(),pf=Ul,lr=gi,Ma=Hl,mf=function(e,t,i){if(!e||typeof e!="object"&&typeof e!="function")throw new lr("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new lr("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new lr("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new lr("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new lr("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new lr("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,u=!!Ma&&Ma(e,t);if(Ra)Ra(e,t,{configurable:o===null&&u?u.configurable:!o,enumerable:n===null&&u?u.enumerable:!n,value:i,writable:s===null&&u?u.writable:!s});else if(a||!n&&!s&&!o)e[t]=i;else throw new pf("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Os=mo(),jl=function(){return!!Os};jl.hasArrayLengthDefineBug=function(){if(!Os)return null;try{return Os([],"length",{value:1}).length!==1}catch{return!0}};var gf=jl,vf=Mr,Oa=mf,yf=gf(),Fa=Hl,La=gi,_f=vf("%Math.floor%"),bf=function(e,t){if(typeof e!="function")throw new La("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||_f(t)!==t)throw new La("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,s=!0;if("length"in e&&Fa){var o=Fa(e,"length");o&&!o.configurable&&(n=!1),o&&!o.writable&&(s=!1)}return(n||s||!i)&&(yf?Oa(e,"length",t,!0,!0):Oa(e,"length",t)),e};(function(r){var e=po,t=Mr,i=bf,n=gi,s=t("%Function.prototype.apply%"),o=t("%Function.prototype.call%"),a=t("%Reflect.apply%",!0)||e.call(o,s),u=mo(),l=t("%Math.max%");r.exports=function(d){if(typeof d!="function")throw new n("a function is required");var f=a(e,o,arguments);return i(f,1+l(0,d.length-(arguments.length-1)),!0)};var h=function(){return a(e,s,arguments)};u?u(r.exports,"apply",{value:h}):r.exports.apply=h})(Vl);var $l=Mr,zl=Vl.exports,Ef=zl($l("String.prototype.indexOf")),If=function(e,t){var i=$l(e,!!t);return typeof i=="function"&&Ef(e,".prototype.")>-1?zl(i):i};const Tf={},wf=Object.freeze(Object.defineProperty({__proto__:null,default:Tf},Symbol.toStringTag,{value:"Module"})),xf=cd(wf);var go=typeof Map=="function"&&Map.prototype,$n=Object.getOwnPropertyDescriptor&&go?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,an=go&&$n&&typeof $n.get=="function"?$n.get:null,Da=go&&Map.prototype.forEach,vo=typeof Set=="function"&&Set.prototype,zn=Object.getOwnPropertyDescriptor&&vo?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,un=vo&&zn&&typeof zn.get=="function"?zn.get:null,Na=vo&&Set.prototype.forEach,Sf=typeof WeakMap=="function"&&WeakMap.prototype,Yr=Sf?WeakMap.prototype.has:null,Cf=typeof WeakSet=="function"&&WeakSet.prototype,qr=Cf?WeakSet.prototype.has:null,Af=typeof WeakRef=="function"&&WeakRef.prototype,ka=Af?WeakRef.prototype.deref:null,Pf=Boolean.prototype.valueOf,Rf=Object.prototype.toString,Mf=Function.prototype.toString,Of=String.prototype.match,yo=String.prototype.slice,_t=String.prototype.replace,Ff=String.prototype.toUpperCase,Ba=String.prototype.toLowerCase,Xl=RegExp.prototype.test,Ua=Array.prototype.concat,$e=Array.prototype.join,Lf=Array.prototype.slice,Ga=Math.floor,Fs=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Xn=Object.getOwnPropertySymbols,Ls=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Cr=typeof Symbol=="function"&&typeof Symbol.iterator=="object",he=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Cr?"object":"symbol")?Symbol.toStringTag:null,Wl=Object.prototype.propertyIsEnumerable,Va=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Ha(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Xl.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-Ga(-r):Ga(r);if(i!==r){var n=String(i),s=yo.call(e,n.length+1);return _t.call(n,t,"$&_")+"."+_t.call(_t.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _t.call(e,t,"$&_")}var Ds=xf,ja=Ds.custom,$a=ql(ja)?ja:null,Df=function r(e,t,i,n){var s=t||{};if(mt(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(mt(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=mt(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(mt(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(mt(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Jl(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var u=String(e);return a?Ha(e,u):u}if(typeof e=="bigint"){var l=String(e)+"n";return a?Ha(e,l):l}var h=typeof s.depth>"u"?5:s.depth;if(typeof i>"u"&&(i=0),i>=h&&h>0&&typeof e=="object")return Ns(e)?"[Array]":"[Object]";var c=Qf(s,i);if(typeof n>"u")n=[];else if(Kl(n,e)>=0)return"[Circular]";function d(Z,ce,de){if(ce&&(n=Lf.call(n),n.push(ce)),de){var be={depth:s.depth};return mt(s,"quoteStyle")&&(be.quoteStyle=s.quoteStyle),r(Z,be,i+1,n)}return r(Z,s,i+1,n)}if(typeof e=="function"&&!za(e)){var f=$f(e),p=Ai(e,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+$e.call(p,", ")+" }":"")}if(ql(e)){var v=Cr?_t.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ls.call(e);return typeof e=="object"&&!Cr?Lr(v):v}if(Kf(e)){for(var m="<"+Ba.call(String(e.nodeName)),y=e.attributes||[],_=0;_<y.length;_++)m+=" "+y[_].name+"="+Yl(Nf(y[_].value),"double",s);return m+=">",e.childNodes&&e.childNodes.length&&(m+="..."),m+="</"+Ba.call(String(e.nodeName))+">",m}if(Ns(e)){if(e.length===0)return"[]";var g=Ai(e,d);return c&&!Zf(g)?"["+ks(g,c)+"]":"[ "+$e.call(g,", ")+" ]"}if(Bf(e)){var b=Ai(e,d);return!("cause"in Error.prototype)&&"cause"in e&&!Wl.call(e,"cause")?"{ ["+String(e)+"] "+$e.call(Ua.call("[cause]: "+d(e.cause),b),", ")+" }":b.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+$e.call(b,", ")+" }"}if(typeof e=="object"&&o){if($a&&typeof e[$a]=="function"&&Ds)return Ds(e,{depth:h-i});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(zf(e)){var I=[];return Da&&Da.call(e,function(Z,ce){I.push(d(ce,e,!0)+" => "+d(Z,e))}),Xa("Map",an.call(e),I,c)}if(Yf(e)){var T=[];return Na&&Na.call(e,function(Z){T.push(d(Z,e))}),Xa("Set",un.call(e),T,c)}if(Xf(e))return Wn("WeakMap");if(qf(e))return Wn("WeakSet");if(Wf(e))return Wn("WeakRef");if(Gf(e))return Lr(d(Number(e)));if(Hf(e))return Lr(d(Fs.call(e)));if(Vf(e))return Lr(Pf.call(e));if(Uf(e))return Lr(d(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof Wr<"u"&&e===Wr)return"{ [object globalThis] }";if(!kf(e)&&!za(e)){var R=Ai(e,d),D=Va?Va(e)===Object.prototype:e instanceof Object||e.constructor===Object,M=e instanceof Object?"":"null prototype",B=!D&&he&&Object(e)===e&&he in e?yo.call(At(e),8,-1):M?"Object":"",re=D||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",_e=re+(B||M?"["+$e.call(Ua.call([],B||[],M||[]),": ")+"] ":"");return R.length===0?_e+"{}":c?_e+"{"+ks(R,c)+"}":_e+"{ "+$e.call(R,", ")+" }"}return String(e)};function Yl(r,e,t){var i=(t.quoteStyle||e)==="double"?'"':"'";return i+r+i}function Nf(r){return _t.call(String(r),/"/g,"&quot;")}function Ns(r){return At(r)==="[object Array]"&&(!he||!(typeof r=="object"&&he in r))}function kf(r){return At(r)==="[object Date]"&&(!he||!(typeof r=="object"&&he in r))}function za(r){return At(r)==="[object RegExp]"&&(!he||!(typeof r=="object"&&he in r))}function Bf(r){return At(r)==="[object Error]"&&(!he||!(typeof r=="object"&&he in r))}function Uf(r){return At(r)==="[object String]"&&(!he||!(typeof r=="object"&&he in r))}function Gf(r){return At(r)==="[object Number]"&&(!he||!(typeof r=="object"&&he in r))}function Vf(r){return At(r)==="[object Boolean]"&&(!he||!(typeof r=="object"&&he in r))}function ql(r){if(Cr)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Ls)return!1;try{return Ls.call(r),!0}catch{}return!1}function Hf(r){if(!r||typeof r!="object"||!Fs)return!1;try{return Fs.call(r),!0}catch{}return!1}var jf=Object.prototype.hasOwnProperty||function(r){return r in this};function mt(r,e){return jf.call(r,e)}function At(r){return Rf.call(r)}function $f(r){if(r.name)return r.name;var e=Of.call(Mf.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function Kl(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,i=r.length;t<i;t++)if(r[t]===e)return t;return-1}function zf(r){if(!an||!r||typeof r!="object")return!1;try{an.call(r);try{un.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Xf(r){if(!Yr||!r||typeof r!="object")return!1;try{Yr.call(r,Yr);try{qr.call(r,qr)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Wf(r){if(!ka||!r||typeof r!="object")return!1;try{return ka.call(r),!0}catch{}return!1}function Yf(r){if(!un||!r||typeof r!="object")return!1;try{un.call(r);try{an.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function qf(r){if(!qr||!r||typeof r!="object")return!1;try{qr.call(r,qr);try{Yr.call(r,Yr)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function Kf(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Jl(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,i="... "+t+" more character"+(t>1?"s":"");return Jl(yo.call(r,0,e.maxStringLength),e)+i}var n=_t.call(_t.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Jf);return Yl(n,"single",e)}function Jf(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+Ff.call(e.toString(16))}function Lr(r){return"Object("+r+")"}function Wn(r){return r+" { ? }"}function Xa(r,e,t,i){var n=i?ks(t,i):$e.call(t,", ");return r+" ("+e+") {"+n+"}"}function Zf(r){for(var e=0;e<r.length;e++)if(Kl(r[e],`
`)>=0)return!1;return!0}function Qf(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=$e.call(Array(r.indent+1)," ");else return null;return{base:t,prev:$e.call(Array(e+1),t)}}function ks(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+$e.call(r,","+t)+`
`+e.prev}function Ai(r,e){var t=Ns(r),i=[];if(t){i.length=r.length;for(var n=0;n<r.length;n++)i[n]=mt(r,n)?e(r[n],r):""}var s=typeof Xn=="function"?Xn(r):[],o;if(Cr){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var u in r)!mt(r,u)||t&&String(Number(u))===u&&u<r.length||Cr&&o["$"+u]instanceof Symbol||(Xl.call(/[^\w$]/,u)?i.push(e(u,r)+": "+e(r[u],r)):i.push(u+": "+e(r[u],r)));if(typeof Xn=="function")for(var l=0;l<s.length;l++)Wl.call(r,s[l])&&i.push("["+e(s[l])+"]: "+e(r[s[l]],r));return i}var Zl=Mr,Or=If,ep=Df,tp=gi,Pi=Zl("%WeakMap%",!0),Ri=Zl("%Map%",!0),rp=Or("WeakMap.prototype.get",!0),ip=Or("WeakMap.prototype.set",!0),np=Or("WeakMap.prototype.has",!0),sp=Or("Map.prototype.get",!0),op=Or("Map.prototype.set",!0),ap=Or("Map.prototype.has",!0),_o=function(r,e){for(var t=r,i;(i=t.next)!==null;t=i)if(i.key===e)return t.next=i.next,i.next=r.next,r.next=i,i},up=function(r,e){var t=_o(r,e);return t&&t.value},lp=function(r,e,t){var i=_o(r,e);i?i.value=t:r.next={key:e,next:r.next,value:t}},hp=function(r,e){return!!_o(r,e)},cp=function(){var e,t,i,n={assert:function(s){if(!n.has(s))throw new tp("Side channel does not contain "+ep(s))},get:function(s){if(Pi&&s&&(typeof s=="object"||typeof s=="function")){if(e)return rp(e,s)}else if(Ri){if(t)return sp(t,s)}else if(i)return up(i,s)},has:function(s){if(Pi&&s&&(typeof s=="object"||typeof s=="function")){if(e)return np(e,s)}else if(Ri){if(t)return ap(t,s)}else if(i)return hp(i,s);return!1},set:function(s,o){Pi&&s&&(typeof s=="object"||typeof s=="function")?(e||(e=new Pi),ip(e,s,o)):Ri?(t||(t=new Ri),op(t,s,o)):(i||(i={key:{},next:null}),lp(i,s,o))}};return n},dp=String.prototype.replace,fp=/%20/g,Yn={RFC1738:"RFC1738",RFC3986:"RFC3986"},bo={default:Yn.RFC3986,formatters:{RFC1738:function(r){return dp.call(r,fp,"+")},RFC3986:function(r){return String(r)}},RFC1738:Yn.RFC1738,RFC3986:Yn.RFC3986},pp=bo,qn=Object.prototype.hasOwnProperty,$t=Array.isArray,Ge=function(){for(var r=[],e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r}(),mp=function(e){for(;e.length>1;){var t=e.pop(),i=t.obj[t.prop];if($t(i)){for(var n=[],s=0;s<i.length;++s)typeof i[s]<"u"&&n.push(i[s]);t.obj[t.prop]=n}}},Ql=function(e,t){for(var i=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)typeof e[n]<"u"&&(i[n]=e[n]);return i},gp=function r(e,t,i){if(!t)return e;if(typeof t!="object"){if($t(e))e.push(t);else if(e&&typeof e=="object")(i&&(i.plainObjects||i.allowPrototypes)||!qn.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var n=e;return $t(e)&&!$t(t)&&(n=Ql(e,i)),$t(e)&&$t(t)?(t.forEach(function(s,o){if(qn.call(e,o)){var a=e[o];a&&typeof a=="object"&&s&&typeof s=="object"?e[o]=r(a,s,i):e.push(s)}else e[o]=s}),e):Object.keys(t).reduce(function(s,o){var a=t[o];return qn.call(s,o)?s[o]=r(s[o],a,i):s[o]=a,s},n)},vp=function(e,t){return Object.keys(t).reduce(function(i,n){return i[n]=t[n],i},e)},yp=function(r,e,t){var i=r.replace(/\+/g," ");if(t==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Kn=1024,_p=function(e,t,i,n,s){if(e.length===0)return e;var o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),i==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(f){return"%26%23"+parseInt(f.slice(2),16)+"%3B"});for(var a="",u=0;u<o.length;u+=Kn){for(var l=o.length>=Kn?o.slice(u,u+Kn):o,h=[],c=0;c<l.length;++c){var d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===pp.RFC1738&&(d===40||d===41)){h[h.length]=l.charAt(c);continue}if(d<128){h[h.length]=Ge[d];continue}if(d<2048){h[h.length]=Ge[192|d>>6]+Ge[128|d&63];continue}if(d<55296||d>=57344){h[h.length]=Ge[224|d>>12]+Ge[128|d>>6&63]+Ge[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),h[h.length]=Ge[240|d>>18]+Ge[128|d>>12&63]+Ge[128|d>>6&63]+Ge[128|d&63]}a+=h.join("")}return a},bp=function(e){for(var t=[{obj:{o:e},prop:"o"}],i=[],n=0;n<t.length;++n)for(var s=t[n],o=s.obj[s.prop],a=Object.keys(o),u=0;u<a.length;++u){var l=a[u],h=o[l];typeof h=="object"&&h!==null&&i.indexOf(h)===-1&&(t.push({obj:o,prop:l}),i.push(h))}return mp(t),e},Ep=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},Ip=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},Tp=function(e,t){return[].concat(e,t)},wp=function(e,t){if($t(e)){for(var i=[],n=0;n<e.length;n+=1)i.push(t(e[n]));return i}return t(e)},eh={arrayToObject:Ql,assign:vp,combine:Tp,compact:bp,decode:yp,encode:_p,isBuffer:Ip,isRegExp:Ep,maybeMap:wp,merge:gp},th=cp,Xi=eh,Kr=bo,xp=Object.prototype.hasOwnProperty,rh={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},je=Array.isArray,Sp=Array.prototype.push,ih=function(r,e){Sp.apply(r,je(e)?e:[e])},Cp=Date.prototype.toISOString,Wa=Kr.default,Q={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Xi.encode,encodeValuesOnly:!1,format:Wa,formatter:Kr.formatters[Wa],indices:!1,serializeDate:function(e){return Cp.call(e)},skipNulls:!1,strictNullHandling:!1},Ap=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Jn={},Pp=function r(e,t,i,n,s,o,a,u,l,h,c,d,f,p,v,m,y,_){for(var g=e,b=_,I=0,T=!1;(b=b.get(Jn))!==void 0&&!T;){var R=b.get(e);if(I+=1,typeof R<"u"){if(R===I)throw new RangeError("Cyclic object value");T=!0}typeof b.get(Jn)>"u"&&(I=0)}if(typeof h=="function"?g=h(t,g):g instanceof Date?g=f(g):i==="comma"&&je(g)&&(g=Xi.maybeMap(g,function(w){return w instanceof Date?f(w):w})),g===null){if(o)return l&&!m?l(t,Q.encoder,y,"key",p):t;g=""}if(Ap(g)||Xi.isBuffer(g)){if(l){var D=m?t:l(t,Q.encoder,y,"key",p);return[v(D)+"="+v(l(g,Q.encoder,y,"value",p))]}return[v(t)+"="+v(String(g))]}var M=[];if(typeof g>"u")return M;var B;if(i==="comma"&&je(g))m&&l&&(g=Xi.maybeMap(g,l)),B=[{value:g.length>0?g.join(",")||null:void 0}];else if(je(h))B=h;else{var re=Object.keys(g);B=c?re.sort(c):re}var _e=u?t.replace(/\./g,"%2E"):t,Z=n&&je(g)&&g.length===1?_e+"[]":_e;if(s&&je(g)&&g.length===0)return Z+"[]";for(var ce=0;ce<B.length;++ce){var de=B[ce],be=typeof de=="object"&&typeof de.value<"u"?de.value:g[de];if(!(a&&be===null)){var lt=d&&u?de.replace(/\./g,"%2E"):de,Nn=je(g)?typeof i=="function"?i(Z,lt):Z:Z+(d?"."+lt:"["+lt+"]");_.set(e,I);var wi=th();wi.set(Jn,_),ih(M,r(be,Nn,i,n,s,o,a,u,i==="comma"&&m&&je(g)?null:l,h,c,d,f,p,v,m,y,wi))}}return M},Rp=function(e){if(!e)return Q;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||Q.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=Kr.default;if(typeof e.format<"u"){if(!xp.call(Kr.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var n=Kr.formatters[i],s=Q.filter;(typeof e.filter=="function"||je(e.filter))&&(s=e.filter);var o;if(e.arrayFormat in rh?o=e.arrayFormat:"indices"in e?o=e.indices?"indices":"repeat":o=Q.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof e.allowDots>"u"?e.encodeDotInKeys===!0?!0:Q.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:Q.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:Q.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Q.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?Q.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:Q.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:Q.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:Q.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:Q.encodeValuesOnly,filter:s,format:i,formatter:n,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:Q.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:Q.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Q.strictNullHandling}},Mp=function(r,e){var t=r,i=Rp(e),n,s;typeof i.filter=="function"?(s=i.filter,t=s("",t)):je(i.filter)&&(s=i.filter,n=s);var o=[];if(typeof t!="object"||t===null)return"";var a=rh[i.arrayFormat],u=a==="comma"&&i.commaRoundTrip;n||(n=Object.keys(t)),i.sort&&n.sort(i.sort);for(var l=th(),h=0;h<n.length;++h){var c=n[h];i.skipNulls&&t[c]===null||ih(o,Pp(t[c],c,a,u,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,l))}var d=o.join(i.delimiter),f=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),d.length>0?f+d:""},Ar=eh,Bs=Object.prototype.hasOwnProperty,Op=Array.isArray,W={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Ar.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},Fp=function(r){return r.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},nh=function(r,e){return r&&typeof r=="string"&&e.comma&&r.indexOf(",")>-1?r.split(","):r},Lp="utf8=%26%2310003%3B",Dp="utf8=%E2%9C%93",Np=function(e,t){var i={__proto__:null},n=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;n=n.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=t.parameterLimit===1/0?void 0:t.parameterLimit,o=n.split(t.delimiter,s),a=-1,u,l=t.charset;if(t.charsetSentinel)for(u=0;u<o.length;++u)o[u].indexOf("utf8=")===0&&(o[u]===Dp?l="utf-8":o[u]===Lp&&(l="iso-8859-1"),a=u,u=o.length);for(u=0;u<o.length;++u)if(u!==a){var h=o[u],c=h.indexOf("]="),d=c===-1?h.indexOf("="):c+1,f,p;d===-1?(f=t.decoder(h,W.decoder,l,"key"),p=t.strictNullHandling?null:""):(f=t.decoder(h.slice(0,d),W.decoder,l,"key"),p=Ar.maybeMap(nh(h.slice(d+1),t),function(m){return t.decoder(m,W.decoder,l,"value")})),p&&t.interpretNumericEntities&&l==="iso-8859-1"&&(p=Fp(p)),h.indexOf("[]=")>-1&&(p=Op(p)?[p]:p);var v=Bs.call(i,f);v&&t.duplicates==="combine"?i[f]=Ar.combine(i[f],p):(!v||t.duplicates==="last")&&(i[f]=p)}return i},kp=function(r,e,t,i){for(var n=i?e:nh(e,t),s=r.length-1;s>=0;--s){var o,a=r[s];if(a==="[]"&&t.parseArrays)o=t.allowEmptyArrays&&(n===""||t.strictNullHandling&&n===null)?[]:[].concat(n);else{o=t.plainObjects?Object.create(null):{};var u=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=t.decodeDotInKeys?u.replace(/%2E/g,"."):u,h=parseInt(l,10);!t.parseArrays&&l===""?o={0:n}:!isNaN(h)&&a!==l&&String(h)===l&&h>=0&&t.parseArrays&&h<=t.arrayLimit?(o=[],o[h]=n):l!=="__proto__"&&(o[l]=n)}n=o}return n},Bp=function(e,t,i,n){if(!!e){var s=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,u=i.depth>0&&o.exec(s),l=u?s.slice(0,u.index):s,h=[];if(l){if(!i.plainObjects&&Bs.call(Object.prototype,l)&&!i.allowPrototypes)return;h.push(l)}for(var c=0;i.depth>0&&(u=a.exec(s))!==null&&c<i.depth;){if(c+=1,!i.plainObjects&&Bs.call(Object.prototype,u[1].slice(1,-1))&&!i.allowPrototypes)return;h.push(u[1])}if(u){if(i.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+i.depth+" and strictDepth is true");h.push("["+s.slice(u.index)+"]")}return kp(h,t,i,n)}},Up=function(e){if(!e)return W;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=typeof e.charset>"u"?W.charset:e.charset,i=typeof e.duplicates>"u"?W.duplicates:e.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof e.allowDots>"u"?e.decodeDotInKeys===!0?!0:W.allowDots:!!e.allowDots;return{allowDots:n,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:W.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:W.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:W.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:W.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:W.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:W.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:W.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:W.decoder,delimiter:typeof e.delimiter=="string"||Ar.isRegExp(e.delimiter)?e.delimiter:W.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:W.depth,duplicates:i,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:W.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:W.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:W.plainObjects,strictDepth:typeof e.strictDepth=="boolean"?!!e.strictDepth:W.strictDepth,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:W.strictNullHandling}},Gp=function(r,e){var t=Up(e);if(r===""||r===null||typeof r>"u")return t.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?Np(r,t):r,n=t.plainObjects?Object.create(null):{},s=Object.keys(i),o=0;o<s.length;++o){var a=s[o],u=Bp(a,i[a],t,typeof r=="string");n=Ar.merge(n,u,t)}return t.allowSparse===!0?n:Ar.compact(n)},Vp=Mp,Hp=Gp,jp=bo,$p={formats:jp,parse:Hp,stringify:Vp},zp=Ms.exports;function De(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Xp=/^([a-z0-9.+-]+:)/i,Wp=/:[0-9]*$/,Yp=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,qp=["<",">",'"',"`"," ","\r",`
`,"	"],Kp=["{","}","|","\\","^","`"].concat(qp),Us=["'"].concat(Kp),Ya=["%","/","?",";","#"].concat(Us),qa=["/","?","#"],Jp=255,Ka=/^[+a-z0-9A-Z_-]{0,63}$/,Zp=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Qp={javascript:!0,"javascript:":!0},Gs={javascript:!0,"javascript:":!0},yr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Vs=$p;function wn(r,e,t){if(r&&typeof r=="object"&&r instanceof De)return r;var i=new De;return i.parse(r,e,t),i}De.prototype.parse=function(r,e,t){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),n=i!==-1&&i<r.indexOf("#")?"?":"#",s=r.split(n),o=/\\/g;s[0]=s[0].replace(o,"/"),r=s.join(n);var a=r;if(a=a.trim(),!t&&r.split("#").length===1){var u=Yp.exec(a);if(u)return this.path=a,this.href=a,this.pathname=u[1],u[2]?(this.search=u[2],e?this.query=Vs.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=Xp.exec(a);if(l){l=l[0];var h=l.toLowerCase();this.protocol=h,a=a.substr(l.length)}if(t||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var c=a.substr(0,2)==="//";c&&!(l&&Gs[l])&&(a=a.substr(2),this.slashes=!0)}if(!Gs[l]&&(c||l&&!yr[l])){for(var d=-1,f=0;f<qa.length;f++){var p=a.indexOf(qa[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var v,m;d===-1?m=a.lastIndexOf("@"):m=a.lastIndexOf("@",d),m!==-1&&(v=a.slice(0,m),a=a.slice(m+1),this.auth=decodeURIComponent(v)),d=-1;for(var f=0;f<Ya.length;f++){var p=a.indexOf(Ya[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var _=this.hostname.split(/\./),f=0,g=_.length;f<g;f++){var b=_[f];if(!!b&&!b.match(Ka)){for(var I="",T=0,R=b.length;T<R;T++)b.charCodeAt(T)>127?I+="x":I+=b[T];if(!I.match(Ka)){var D=_.slice(0,f),M=_.slice(f+1),B=b.match(Zp);B&&(D.push(B[1]),M.unshift(B[2])),M.length&&(a="/"+M.join(".")+a),this.hostname=D.join(".");break}}}this.hostname.length>Jp?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=zp.toASCII(this.hostname));var re=this.port?":"+this.port:"",_e=this.hostname||"";this.host=_e+re,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!Qp[h])for(var f=0,g=Us.length;f<g;f++){var Z=Us[f];if(a.indexOf(Z)!==-1){var ce=encodeURIComponent(Z);ce===Z&&(ce=escape(Z)),a=a.split(Z).join(ce)}}var de=a.indexOf("#");de!==-1&&(this.hash=a.substr(de),a=a.slice(0,de));var be=a.indexOf("?");if(be!==-1?(this.search=a.substr(be),this.query=a.substr(be+1),e&&(this.query=Vs.parse(this.query)),a=a.slice(0,be)):e&&(this.search="",this.query={}),a&&(this.pathname=a),yr[h]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var re=this.pathname||"",lt=this.search||"";this.path=re+lt}return this.href=this.format(),this};function em(r){return typeof r=="string"&&(r=wn(r)),r instanceof De?r.format():De.prototype.format.call(r)}De.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var e=this.protocol||"",t=this.pathname||"",i=this.hash||"",n=!1,s="";this.host?n=r+this.host:this.hostname&&(n=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=Vs.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||yr[e])&&n!==!1?(n="//"+(n||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+n+t+o+i};function tm(r,e){return wn(r,!1,!0).resolve(e)}De.prototype.resolve=function(r){return this.resolveObject(wn(r,!1,!0)).format()};De.prototype.resolveObject=function(r){if(typeof r=="string"){var e=new De;e.parse(r,!1,!0),r=e}for(var t=new De,i=Object.keys(this),n=0;n<i.length;n++){var s=i[n];t[s]=this[s]}if(t.hash=r.hash,r.href==="")return t.href=t.format(),t;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),a=0;a<o.length;a++){var u=o[a];u!=="protocol"&&(t[u]=r[u])}return yr[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(r.protocol&&r.protocol!==t.protocol){if(!yr[r.protocol]){for(var l=Object.keys(r),h=0;h<l.length;h++){var c=l[h];t[c]=r[c]}return t.href=t.format(),t}if(t.protocol=r.protocol,!r.host&&!Gs[r.protocol]){for(var g=(r.pathname||"").split("/");g.length&&!(r.host=g.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),g[0]!==""&&g.unshift(""),g.length<2&&g.unshift(""),t.pathname=g.join("/")}else t.pathname=r.pathname;if(t.search=r.search,t.query=r.query,t.host=r.host||"",t.auth=r.auth,t.hostname=r.hostname||r.host,t.port=r.port,t.pathname||t.search){var d=t.pathname||"",f=t.search||"";t.path=d+f}return t.slashes=t.slashes||r.slashes,t.href=t.format(),t}var p=t.pathname&&t.pathname.charAt(0)==="/",v=r.host||r.pathname&&r.pathname.charAt(0)==="/",m=v||p||t.host&&r.pathname,y=m,_=t.pathname&&t.pathname.split("/")||[],g=r.pathname&&r.pathname.split("/")||[],b=t.protocol&&!yr[t.protocol];if(b&&(t.hostname="",t.port=null,t.host&&(_[0]===""?_[0]=t.host:_.unshift(t.host)),t.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(g[0]===""?g[0]=r.host:g.unshift(r.host)),r.host=null),m=m&&(g[0]===""||_[0]==="")),v)t.host=r.host||r.host===""?r.host:t.host,t.hostname=r.hostname||r.hostname===""?r.hostname:t.hostname,t.search=r.search,t.query=r.query,_=g;else if(g.length)_||(_=[]),_.pop(),_=_.concat(g),t.search=r.search,t.query=r.query;else if(r.search!=null){if(b){t.host=_.shift(),t.hostname=t.host;var I=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;I&&(t.auth=I.shift(),t.hostname=I.shift(),t.host=t.hostname)}return t.search=r.search,t.query=r.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!_.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var T=_.slice(-1)[0],R=(t.host||r.host||_.length>1)&&(T==="."||T==="..")||T==="",D=0,M=_.length;M>=0;M--)T=_[M],T==="."?_.splice(M,1):T===".."?(_.splice(M,1),D++):D&&(_.splice(M,1),D--);if(!m&&!y)for(;D--;D)_.unshift("..");m&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")&&_.unshift(""),R&&_.join("/").substr(-1)!=="/"&&_.push("");var B=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(b){t.hostname=B?"":_.length?_.shift():"",t.host=t.hostname;var I=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;I&&(t.auth=I.shift(),t.hostname=I.shift(),t.host=t.hostname)}return m=m||t.host&&_.length,m&&!B&&_.unshift(""),_.length>0?t.pathname=_.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=r.auth||t.auth,t.slashes=t.slashes||r.slashes,t.href=t.format(),t};De.prototype.parseHost=function(){var r=this.host,e=Wp.exec(r);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),r=r.substr(0,r.length-e.length)),r&&(this.hostname=r)};var rm=wn,im=tm,nm=em;/*!
 * @pixi/utils - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/utils is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var xn={parse:rm,format:nm,resolve:im};x.RETINA_PREFIX=/@([0-9\.]+)x/;x.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Ja=!1,Za="6.5.10";function sm(r){var e;if(!Ja){if(x.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){var t=[`
 %c %c %c PixiJS `+Za+" - \u2730 "+r+` \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=globalThis.console).log.apply(e,t)}else globalThis.console&&globalThis.console.log("PixiJS "+Za+" - "+r+" - http://www.pixijs.com/");Ja=!0}}var Zn;function om(){return typeof Zn>"u"&&(Zn=function(){var e={stencil:!0,failIfMajorPerformanceCaveat:x.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!x.ADAPTER.getWebGLRenderingContext())return!1;var t=x.ADAPTER.createCanvas(),i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),n=!!(i&&i.getContextAttributes().stencil);if(i){var s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,n}catch{return!1}}()),Zn}function am(r,e){return e===void 0&&(e=[]),e[0]=(r>>16&255)/255,e[1]=(r>>8&255)/255,e[2]=(r&255)/255,e}function um(r){var e=r.toString(16);return e="000000".substring(0,6-e.length)+e,"#"+e}function lm(){for(var r=[],e=[],t=0;t<32;t++)r[t]=t,e[t]=t;r[S.NORMAL_NPM]=S.NORMAL,r[S.ADD_NPM]=S.ADD,r[S.SCREEN_NPM]=S.SCREEN,e[S.NORMAL]=S.NORMAL_NPM,e[S.ADD]=S.ADD_NPM,e[S.SCREEN]=S.SCREEN_NPM;var i=[];return i.push(e),i.push(r),i}var hm=lm();function cm(r,e){if(e===1)return(e*255<<24)+r;if(e===0)return 0;var t=r>>16&255,i=r>>8&255,n=r&255;return t=t*e+.5|0,i=i*e+.5|0,n=n*e+.5|0,(e*255<<24)+(t<<16)+(i<<8)+n}function sh(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function ln(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Qa(r){return!(r&r-1)&&!!r}function eu(r){var e=(r>65535?1:0)<<4;r>>>=e;var t=(r>255?1:0)<<3;return r>>>=t,e|=t,t=(r>15?1:0)<<2,r>>>=t,e|=t,t=(r>3?1:0)<<1,r>>>=t,e|=t,e|r>>1}function Wi(r,e,t){var i=r.length,n;if(!(e>=i||t===0)){t=e+t>i?i-e:t;var s=i-t;for(n=e;n<s;++n)r[n]=r[n+t];r.length=s}}var dm=0;function oi(){return++dm}var tu={};function Zt(r,e,t){if(t===void 0&&(t=3),!tu[e]){var i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+r):(i=i.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+`
Deprecated since v`+r),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+r),console.warn(i))),tu[e]=!0}}var ru={},Qe=Object.create(null),Rt=Object.create(null);(function(){function r(e,t,i){this.canvas=x.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=i||x.RESOLUTION,this.resize(e,t)}return r.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},r.prototype.resize=function(e,t){this.canvas.width=Math.round(e*this.resolution),this.canvas.height=Math.round(t*this.resolution)},r.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(r.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=Math.round(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=Math.round(e)},enumerable:!1,configurable:!0}),r})();var Mi;function fm(r,e){if(e===void 0&&(e=globalThis.location),r.indexOf("data:")===0)return"";e=e||globalThis.location,Mi||(Mi=document.createElement("a")),Mi.href=r;var t=xn.parse(Mi.href),i=!t.port&&e.port===""||t.port===e.port;return t.hostname!==e.hostname||!i||t.protocol!==e.protocol?"anonymous":""}function iu(r,e){var t=x.RETINA_PREFIX.exec(r);return t?parseFloat(t[1]):e!==void 0?e:1}/*!
 * @pixi/extensions - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/extensions is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Jr=function(){return Jr=Object.assign||function(e){for(var t=arguments,i,n=1,s=arguments.length;n<s;n++){i=t[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},Jr.apply(this,arguments)},Me;(function(r){r.Application="application",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Loader="loader",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser"})(Me||(Me={}));var nu=function(r){if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");var e=typeof r.extension!="object"?{type:r.extension}:r.extension;r=Jr(Jr({},e),{ref:r})}if(typeof r=="object")r=Jr({},r);else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},yi={_addHandlers:null,_removeHandlers:null,_queue:{},remove:function(){for(var r=arguments,e=this,t=[],i=0;i<arguments.length;i++)t[i]=r[i];return t.map(nu).forEach(function(n){n.type.forEach(function(s){var o,a;return(a=(o=e._removeHandlers)[s])===null||a===void 0?void 0:a.call(o,n)})}),this},add:function(){for(var r=arguments,e=this,t=[],i=0;i<arguments.length;i++)t[i]=r[i];return t.map(nu).forEach(function(n){n.type.forEach(function(s){var o=e._addHandlers,a=e._queue;o[s]?o[s](n):(a[s]=a[s]||[],a[s].push(n))})}),this},handle:function(r,e,t){var i=this._addHandlers=this._addHandlers||{},n=this._removeHandlers=this._removeHandlers||{};if(i[r]||n[r])throw new Error("Extension type "+r+" already has a handler");i[r]=e,n[r]=t;var s=this._queue;return s[r]&&(s[r].forEach(function(o){return e(o)}),delete s[r]),this},handleByMap:function(r,e){return this.handle(r,function(t){e[t.name]=t.ref},function(t){delete e[t.name]})},handleByList:function(r,e){return this.handle(r,function(t){var i,n;e.includes(t.ref)||(e.push(t.ref),r===Me.Loader&&((n=(i=t.ref).add)===null||n===void 0||n.call(i)))},function(t){var i=e.indexOf(t.ref);i!==-1&&e.splice(i,1)})}};/*!
 * @pixi/runner - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/runner is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var oe=function(){function r(e){this.items=[],this._name=e,this._aliasCount=0}return r.prototype.emit=function(e,t,i,n,s,o,a,u){if(arguments.length>8)throw new Error("max arguments reached");var l=this,h=l.name,c=l.items;this._aliasCount++;for(var d=0,f=c.length;d<f;d++)c[d][h](e,t,i,n,s,o,a,u);return c===this.items&&this._aliasCount--,this},r.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},r.prototype.add=function(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this},r.prototype.remove=function(e){var t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this},r.prototype.contains=function(e){return this.items.indexOf(e)!==-1},r.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},r.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(r.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),r}();Object.defineProperties(oe.prototype,{dispatch:{value:oe.prototype.emit},run:{value:oe.prototype.emit}});/*!
 * @pixi/ticker - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */x.TARGET_FPMS=.06;var Pr;(function(r){r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY"})(Pr||(Pr={}));var Qn=function(){function r(e,t,i,n){t===void 0&&(t=null),i===void 0&&(i=0),n===void 0&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=i,this.once=n}return r.prototype.match=function(e,t){return t===void 0&&(t=null),this.fn===e&&this.context===t},r.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));var t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t},r.prototype.connect=function(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this},r.prototype.destroy=function(e){e===void 0&&(e=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var t=this.next;return this.next=e?null:t,this.previous=null,t},r}(),Le=function(){function r(){var e=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Qn(null,null,1/0),this.deltaMS=1/x.TARGET_FPMS,this.elapsedMS=1/x.TARGET_FPMS,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&e._requestId===null&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return r.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},r.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},r.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},r.prototype.add=function(e,t,i){return i===void 0&&(i=Pr.NORMAL),this._addListener(new Qn(e,t,i))},r.prototype.addOnce=function(e,t,i){return i===void 0&&(i=Pr.NORMAL),this._addListener(new Qn(e,t,i,!0))},r.prototype._addListener=function(e){var t=this._head.next,i=this._head;if(!t)e.connect(i);else{for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}return this._startIfPossible(),this},r.prototype.remove=function(e,t){for(var i=this._head.next;i;)i.match(e,t)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(r.prototype,"count",{get:function(){if(!this._head)return 0;for(var e=0,t=this._head;t=t.next;)e++;return e},enumerable:!1,configurable:!0}),r.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},r.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},r.prototype.destroy=function(){if(!this._protected){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}},r.prototype.update=function(e){e===void 0&&(e=performance.now());var t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){var i=e-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=e-i%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*x.TARGET_FPMS;for(var n=this._head,s=n.next;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e},Object.defineProperty(r.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(e){var t=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,t)/1e3,x.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(e){if(e===0)this._minElapsedMS=0;else{var t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(r,"shared",{get:function(){if(!r._shared){var e=r._shared=new r;e.autoStart=!0,e._protected=!0}return r._shared},enumerable:!1,configurable:!0}),Object.defineProperty(r,"system",{get:function(){if(!r._system){var e=r._system=new r;e.autoStart=!0,e._protected=!0}return r._system},enumerable:!1,configurable:!0}),r}(),pm=function(){function r(){}return r.init=function(e){var t=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,Pr.LOW)},get:function(){return this._ticker}}),this.stop=function(){t._ticker.stop()},this.start=function(){t._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Le.shared:new Le,e.autoStart&&this.start()},r.destroy=function(){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}},r.extension=Me.Application,r}();/*!
 * @pixi/math - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/math is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var mm=Math.PI*2,gm=180/Math.PI,vm=Math.PI/180,Hs;(function(r){r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC"})(Hs||(Hs={}));var me=function(){function r(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this.x=0,this.y=0,this.x=e,this.y=t}return r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.copyFrom=function(e){return this.set(e.x,e.y),this},r.prototype.copyTo=function(e){return e.set(this.x,this.y),e},r.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},r.prototype.set=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),this.x=e,this.y=t,this},r.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},r}(),Oi=[new me,new me,new me,new me],K=function(){function r(e,t,i,n){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=0),this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(n),this.type=Hs.RECT}return Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(r,"EMPTY",{get:function(){return new r(0,0,0,0)},enumerable:!1,configurable:!0}),r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},r.prototype.copyTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},r.prototype.contains=function(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height},r.prototype.intersects=function(e,t){if(!t){var i=this.x<e.x?e.x:this.x,n=this.right>e.right?e.right:this.right;if(n<=i)return!1;var s=this.y<e.y?e.y:this.y,o=this.bottom>e.bottom?e.bottom:this.bottom;return o>s}var a=this.left,u=this.right,l=this.top,h=this.bottom;if(u<=a||h<=l)return!1;var c=Oi[0].set(e.left,e.top),d=Oi[1].set(e.left,e.bottom),f=Oi[2].set(e.right,e.top),p=Oi[3].set(e.right,e.bottom);if(f.x<=c.x||d.y<=c.y)return!1;var v=Math.sign(t.a*t.d-t.b*t.c);if(v===0||(t.apply(c,c),t.apply(d,d),t.apply(f,f),t.apply(p,p),Math.max(c.x,d.x,f.x,p.x)<=a||Math.min(c.x,d.x,f.x,p.x)>=u||Math.max(c.y,d.y,f.y,p.y)<=l||Math.min(c.y,d.y,f.y,p.y)>=h))return!1;var m=v*(d.y-c.y),y=v*(c.x-d.x),_=m*a+y*l,g=m*u+y*l,b=m*a+y*h,I=m*u+y*h;if(Math.max(_,g,b,I)<=m*c.x+y*c.y||Math.min(_,g,b,I)>=m*p.x+y*p.y)return!1;var T=v*(c.y-f.y),R=v*(f.x-c.x),D=T*a+R*l,M=T*u+R*l,B=T*a+R*h,re=T*u+R*h;return!(Math.max(D,M,B,re)<=T*c.x+R*c.y||Math.min(D,M,B,re)>=T*p.x+R*p.y)},r.prototype.pad=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this},r.prototype.fit=function(e){var t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=n,this.height=Math.max(s-n,0),this},r.prototype.ceil=function(e,t){e===void 0&&(e=1),t===void 0&&(t=.001);var i=Math.ceil((this.x+this.width-t)*e)/e,n=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=n-this.y,this},r.prototype.enlarge=function(e){var t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=n,this.height=s-n,this},r.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},r}(),Hr=function(){function r(e,t,i,n){i===void 0&&(i=0),n===void 0&&(n=0),this._x=i,this._y=n,this.cb=e,this.scope=t}return r.prototype.clone=function(e,t){return e===void 0&&(e=this.cb),t===void 0&&(t=this.scope),new r(e,t,this._x,this._y)},r.prototype.set=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this},r.prototype.copyFrom=function(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this},r.prototype.copyTo=function(e){return e.set(this._x,this._y),e},r.prototype.equals=function(e){return e.x===this._x&&e.y===this._y},r.prototype.toString=function(){return"[@pixi/math:ObservablePoint x="+0+" y="+0+" scope="+this.scope+"]"},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),r}(),ue=function(){function r(e,t,i,n,s,o){e===void 0&&(e=1),t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=1),s===void 0&&(s=0),o===void 0&&(o=0),this.array=null,this.a=e,this.b=t,this.c=i,this.d=n,this.tx=s,this.ty=o}return r.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},r.prototype.set=function(e,t,i,n,s,o){return this.a=e,this.b=t,this.c=i,this.d=n,this.tx=s,this.ty=o,this},r.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));var i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},r.prototype.apply=function(e,t){t=t||new me;var i=e.x,n=e.y;return t.x=this.a*i+this.c*n+this.tx,t.y=this.b*i+this.d*n+this.ty,t},r.prototype.applyInverse=function(e,t){t=t||new me;var i=1/(this.a*this.d+this.c*-this.b),n=e.x,s=e.y;return t.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,t},r.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},r.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},r.prototype.rotate=function(e){var t=Math.cos(e),i=Math.sin(e),n=this.a,s=this.c,o=this.tx;return this.a=n*t-this.b*i,this.b=n*i+this.b*t,this.c=s*t-this.d*i,this.d=s*i+this.d*t,this.tx=o*t-this.ty*i,this.ty=o*i+this.ty*t,this},r.prototype.append=function(e){var t=this.a,i=this.b,n=this.c,s=this.d;return this.a=e.a*t+e.b*n,this.b=e.a*i+e.b*s,this.c=e.c*t+e.d*n,this.d=e.c*i+e.d*s,this.tx=e.tx*t+e.ty*n+this.tx,this.ty=e.tx*i+e.ty*s+this.ty,this},r.prototype.setTransform=function(e,t,i,n,s,o,a,u,l){return this.a=Math.cos(a+l)*s,this.b=Math.sin(a+l)*s,this.c=-Math.sin(a-u)*o,this.d=Math.cos(a-u)*o,this.tx=e-(i*this.a+n*this.c),this.ty=t-(i*this.b+n*this.d),this},r.prototype.prepend=function(e){var t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){var i=this.a,n=this.c;this.a=i*e.a+this.b*e.c,this.b=i*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},r.prototype.decompose=function(e){var t=this.a,i=this.b,n=this.c,s=this.d,o=e.pivot,a=-Math.atan2(-n,s),u=Math.atan2(i,t),l=Math.abs(a+u);return l<1e-5||Math.abs(mm-l)<1e-5?(e.rotation=u,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=u),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(n*n+s*s),e.position.x=this.tx+(o.x*t+o.y*n),e.position.y=this.ty+(o.x*i+o.y*s),e},r.prototype.invert=function(){var e=this.a,t=this.b,i=this.c,n=this.d,s=this.tx,o=e*n-t*i;return this.a=n/o,this.b=-t/o,this.c=-i/o,this.d=e/o,this.tx=(i*this.ty-n*s)/o,this.ty=-(e*this.ty-t*s)/o,this},r.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},r.prototype.clone=function(){var e=new r;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},r.prototype.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},r.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},r.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(r,"IDENTITY",{get:function(){return new r},enumerable:!1,configurable:!0}),Object.defineProperty(r,"TEMP_MATRIX",{get:function(){return new r},enumerable:!1,configurable:!0}),r}(),Dt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Nt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],kt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Bt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],js=[],oh=[],Fi=Math.sign;function ym(){for(var r=0;r<16;r++){var e=[];js.push(e);for(var t=0;t<16;t++)for(var i=Fi(Dt[r]*Dt[t]+kt[r]*Nt[t]),n=Fi(Nt[r]*Dt[t]+Bt[r]*Nt[t]),s=Fi(Dt[r]*kt[t]+kt[r]*Bt[t]),o=Fi(Nt[r]*kt[t]+Bt[r]*Bt[t]),a=0;a<16;a++)if(Dt[a]===i&&Nt[a]===n&&kt[a]===s&&Bt[a]===o){e.push(a);break}}for(var r=0;r<16;r++){var u=new ue;u.set(Dt[r],Nt[r],kt[r],Bt[r],0,0),oh.push(u)}}ym();var j={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(r){return Dt[r]},uY:function(r){return Nt[r]},vX:function(r){return kt[r]},vY:function(r){return Bt[r]},inv:function(r){return r&8?r&15:-r&7},add:function(r,e){return js[r][e]},sub:function(r,e){return js[r][j.inv(e)]},rotate180:function(r){return r^4},isVertical:function(r){return(r&3)===2},byDirection:function(r,e){return Math.abs(r)*2<=Math.abs(e)?e>=0?j.S:j.N:Math.abs(e)*2<=Math.abs(r)?r>0?j.E:j.W:e>0?r>0?j.SE:j.SW:r>0?j.NE:j.NW},matrixAppendRotationInv:function(r,e,t,i){t===void 0&&(t=0),i===void 0&&(i=0);var n=oh[j.inv(e)];n.tx=t,n.ty=i,r.append(n)}},ah=function(){function r(){this.worldTransform=new ue,this.localTransform=new ue,this.position=new Hr(this.onChange,this,0,0),this.scale=new Hr(this.onChange,this,1,1),this.pivot=new Hr(this.onChange,this,0,0),this.skew=new Hr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return r.prototype.onChange=function(){this._localID++},r.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},r.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},r.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},r.prototype.updateTransform=function(e){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var i=e.worldTransform,n=this.worldTransform;n.a=t.a*i.a+t.b*i.c,n.b=t.a*i.b+t.b*i.d,n.c=t.c*i.a+t.d*i.c,n.d=t.c*i.b+t.d*i.d,n.tx=t.tx*i.a+t.ty*i.c+i.tx,n.ty=t.tx*i.b+t.ty*i.d+i.ty,this._parentID=e._worldID,this._worldID++}},r.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())},enumerable:!1,configurable:!0}),r.IDENTITY=new r,r}();/*!
 * @pixi/core - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/core is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */x.PREFER_ENV=Xt.any?st.WEBGL:st.WEBGL2;x.STRICT_TEXTURE_CACHE=!1;var $s=[];function uh(r,e){if(!r)return null;var t="";if(typeof r=="string"){var i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(t=i[1].toLowerCase())}for(var n=$s.length-1;n>=0;--n){var s=$s[n];if(s.test&&s.test(r,t))return new s(r,e)}throw new Error("Unrecognized source type to auto-detect Resource")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var zs=function(r,e){return zs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])},zs(r,e)};function G(r,e){zs(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Xs=function(){return Xs=Object.assign||function(e){for(var t=arguments,i,n=1,s=arguments.length;n<s;n++){i=t[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},Xs.apply(this,arguments)};function _m(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t}var ai=function(){function r(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new oe("setRealSize"),this.onUpdate=new oe("update"),this.onError=new oe("onError")}return r.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},r.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},r.prototype.resize=function(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))},Object.defineProperty(r.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),r.prototype.update=function(){this.destroyed||this.onUpdate.emit()},r.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),r.prototype.style=function(e,t,i){return!1},r.prototype.dispose=function(){},r.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},r.test=function(e,t){return!1},r}(),Eo=function(r){G(e,r);function e(t,i){var n=this,s=i||{},o=s.width,a=s.height;if(!o||!a)throw new Error("BufferResource width or height invalid");return n=r.call(this,o,a)||this,n.data=t,n}return e.prototype.upload=function(t,i,n){var s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===wt.UNPACK);var o=i.realWidth,a=i.realHeight;return n.width===o&&n.height===a?s.texSubImage2D(i.target,0,0,0,o,a,i.format,n.type,this.data):(n.width=o,n.height=a,s.texImage2D(i.target,0,n.internalFormat,o,a,0,i.format,n.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(ai),bm={scaleMode:Xe.NEAREST,format:E.RGBA,alphaMode:wt.NPM},ee=function(r){G(e,r);function e(t,i){t===void 0&&(t=null),i===void 0&&(i=null);var n=r.call(this)||this;i=i||{};var s=i.alphaMode,o=i.mipmap,a=i.anisotropicLevel,u=i.scaleMode,l=i.width,h=i.height,c=i.wrapMode,d=i.format,f=i.type,p=i.target,v=i.resolution,m=i.resourceOptions;return t&&!(t instanceof ai)&&(t=uh(t,m),t.internal=!0),n.resolution=v||x.RESOLUTION,n.width=Math.round((l||0)*n.resolution)/n.resolution,n.height=Math.round((h||0)*n.resolution)/n.resolution,n._mipmap=o!==void 0?o:x.MIPMAP_TEXTURES,n.anisotropicLevel=a!==void 0?a:x.ANISOTROPIC_LEVEL,n._wrapMode=c||x.WRAP_MODE,n._scaleMode=u!==void 0?u:x.SCALE_MODE,n.format=d||E.RGBA,n.type=f||F.UNSIGNED_BYTE,n.target=p||qt.TEXTURE_2D,n.alphaMode=s!==void 0?s:wt.UNPACK,n.uid=oi(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=l>0&&h>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(t),n}return Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,i){var n;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),i!==void 0&&i!==this.mipmap&&(this.mipmap=i,n=!0),n&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,i,n){return n=n||this.resolution,this.setRealSize(t*n,i*n,n)},e.prototype.setRealSize=function(t,i,n){return this.resolution=n||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(i)/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=Qa(this.realWidth)&&Qa(this.realHeight)},e.prototype.setResolution=function(t){var i=this.resolution;return i===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*i)/t,this.height=Math.round(this.height*i)/t,this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Rt[this.cacheId],delete Qe[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,i,n){n===void 0&&(n=x.STRICT_TEXTURE_CACHE);var s=typeof t=="string",o=null;if(s)o=t;else{if(!t._pixiId){var a=i&&i.pixiIdPrefix||"pixiid";t._pixiId=a+"_"+oi()}o=t._pixiId}var u=Rt[o];if(s&&n&&!u)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return u||(u=new e(t,i),u.cacheId=o,e.addToCache(u,o)),u},e.fromBuffer=function(t,i,n,s){t=t||new Float32Array(i*n*4);var o=new Eo(t,{width:i,height:n}),a=t instanceof Float32Array?F.FLOAT:F.UNSIGNED_BYTE;return new e(o,Object.assign({},bm,s||{width:i,height:n,type:a}))},e.addToCache=function(t,i){i&&(t.textureCacheIds.indexOf(i)===-1&&t.textureCacheIds.push(i),Rt[i]&&console.warn("BaseTexture added to the cache with an id ["+i+"] that already had an entry"),Rt[i]=t)},e.removeFromCache=function(t){if(typeof t=="string"){var i=Rt[t];if(i){var n=i.textureCacheIds.indexOf(t);return n>-1&&i.textureCacheIds.splice(n,1),delete Rt[t],i}}else if(t&&t.textureCacheIds){for(var s=0;s<t.textureCacheIds.length;++s)delete Rt[t.textureCacheIds[s]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e}(Ct),lh=function(r){G(e,r);function e(t,i){var n=this,s=i||{},o=s.width,a=s.height;n=r.call(this,o,a)||this,n.items=[],n.itemDirtyIds=[];for(var u=0;u<t;u++){var l=new ee;n.items.push(l),n.itemDirtyIds.push(-2)}return n.length=t,n._load=null,n.baseTexture=null,n}return e.prototype.initFromArray=function(t,i){for(var n=0;n<this.length;n++)!t[n]||(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof ai?this.addResourceAt(t[n],n):this.addResourceAt(uh(t[n],i),n))},e.prototype.dispose=function(){for(var t=0,i=this.length;t<i;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,i){if(!this.items[i])throw new Error("Index "+i+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[i].setResource(t),this},e.prototype.bind=function(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");r.prototype.bind.call(this,t);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=t,this.items[i].on("update",t.update,t)},e.prototype.unbind=function(t){r.prototype.unbind.call(this,t);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",t.update,t)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var i=this.items.map(function(s){return s.resource}).filter(function(s){return s}),n=i.map(function(s){return s.load()});return this._load=Promise.all(n).then(function(){var s=t.items[0],o=s.realWidth,a=s.realHeight;return t.resize(o,a),Promise.resolve(t)}),this._load},e}(ai),Em=function(r){G(e,r);function e(t,i){var n=this,s=i||{},o=s.width,a=s.height,u,l;return Array.isArray(t)?(u=t,l=t.length):l=t,n=r.call(this,l,{width:o,height:a})||this,u&&n.initFromArray(u,i),n}return e.prototype.addBaseTextureAt=function(t,i){if(t.resource)this.addResourceAt(t.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this},e.prototype.bind=function(t){r.prototype.bind.call(this,t),t.target=qt.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,i,n){var s=this,o=s.length,a=s.itemDirtyIds,u=s.items,l=t.gl;n.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,o,0,i.format,n.type,null);for(var h=0;h<o;h++){var c=u[h];a[h]<c.dirtyId&&(a[h]=c.dirtyId,c.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,h,c.resource.width,c.resource.height,1,i.format,n.type,c.resource.source))}return!0},e}(lh),xt=function(r){G(e,r);function e(t){var i=this,n=t,s=n.naturalWidth||n.videoWidth||n.width,o=n.naturalHeight||n.videoHeight||n.height;return i=r.call(this,s,o)||this,i.source=t,i.noSubImage=!1,i}return e.crossOrigin=function(t,i,n){n===void 0&&i.indexOf("data:")!==0?t.crossOrigin=fm(i):n!==!1&&(t.crossOrigin=typeof n=="string"?n:"anonymous")},e.prototype.upload=function(t,i,n,s){var o=t.gl,a=i.realWidth,u=i.realHeight;if(s=s||this.source,s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===wt.UNPACK),!this.noSubImage&&i.target===o.TEXTURE_2D&&n.width===a&&n.height===u?o.texSubImage2D(o.TEXTURE_2D,0,0,0,i.format,n.type,s):(n.width=a,n.height=u,o.texImage2D(i.target,0,n.internalFormat,i.format,n.type,s)),!0},e.prototype.update=function(){if(!this.destroyed){var t=this.source,i=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(i,n),r.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(ai),Im=function(r){G(e,r);function e(t){return r.call(this,t)||this}return e.test=function(t){var i=globalThis.OffscreenCanvas;return i&&t instanceof i?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement},e}(xt),Tm=function(r){G(e,r);function e(t,i){var n=this,s=i||{},o=s.width,a=s.height,u=s.autoLoad,l=s.linkBaseTexture;if(t&&t.length!==e.SIDES)throw new Error("Invalid length. Got "+t.length+", expected 6");n=r.call(this,6,{width:o,height:a})||this;for(var h=0;h<e.SIDES;h++)n.items[h].target=qt.TEXTURE_CUBE_MAP_POSITIVE_X+h;return n.linkBaseTexture=l!==!1,t&&n.initFromArray(t,i),u!==!1&&n.load(),n}return e.prototype.bind=function(t){r.prototype.bind.call(this,t),t.target=qt.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,i,n){if(!this.items[i])throw new Error("Index "+i+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,i);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=qt.TEXTURE_CUBE_MAP_POSITIVE_X+i,t.parentTextureArray=this.baseTexture,this.items[i]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[i]=t,this},e.prototype.upload=function(t,i,n){for(var s=this.itemDirtyIds,o=0;o<e.SIDES;o++){var a=this.items[o];(s[o]<a.dirtyId||n.dirtyId<i.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(t,a,n),s[o]=a.dirtyId):s[o]<-1&&(t.gl.texImage2D(a.target,0,n.internalFormat,i.realWidth,i.realHeight,0,i.format,n.type,null),s[o]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e}(lh),hh=function(r){G(e,r);function e(t,i){var n=this;if(i=i||{},!(t instanceof HTMLImageElement)){var s=new Image;xt.crossOrigin(s,t,i.crossorigin),s.src=t,t=s}return n=r.call(this,t)||this,!t.complete&&!!n._width&&!!n._height&&(n._width=0,n._height=0),n.url=t.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(i.createBitmap!==void 0?i.createBitmap:x.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,n.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,n.bitmap=null,n._load=null,i.autoLoad!==!1&&n.load(),n}return e.prototype.load=function(t){var i=this;return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise(function(n,s){var o=i.source;i.url=o.src;var a=function(){i.destroyed||(o.onload=null,o.onerror=null,i.resize(o.width,o.height),i._load=null,i.createBitmap?n(i.process()):n(i))};o.complete&&o.src?a():(o.onload=a,o.onerror=function(u){s(u),i.onError.emit(u)})}),this._load)},e.prototype.process=function(){var t=this,i=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var n=globalThis.createImageBitmap,s=!i.crossOrigin||i.crossOrigin==="anonymous";return this._process=fetch(i.src,{mode:s?"cors":"no-cors"}).then(function(o){return o.blob()}).then(function(o){return n(o,0,0,i.width,i.height,{premultiplyAlpha:t.alphaMode===null||t.alphaMode===wt.UNPACK?"premultiply":"none"})}).then(function(o){return t.destroyed?Promise.reject():(t.bitmap=o,t.update(),t._process=null,Promise.resolve(t))}),this._process},e.prototype.upload=function(t,i,n){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return r.prototype.upload.call(this,t,i,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(r.prototype.upload.call(this,t,i,n,this.bitmap),!this.preserveBitmap){var s=!0,o=i._glTextures;for(var a in o){var u=o[a];if(u!==n&&u.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,r.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return typeof t=="string"||t instanceof HTMLImageElement},e}(xt),wm=function(r){G(e,r);function e(t,i){var n=this;return i=i||{},n=r.call(this,x.ADAPTER.createCanvas())||this,n._width=0,n._height=0,n.svg=t,n.scale=i.scale||1,n._overrideWidth=i.width,n._overrideHeight=i.height,n._resolve=null,n._crossorigin=i.crossorigin,n._load=null,i.autoLoad!==!1&&n.load(),n}return e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise(function(i){if(t._resolve=function(){t.resize(t.source.width,t.source.height),i(t)},e.SVG_XML.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var t=this,i=new Image;xt.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=function(n){!t._resolve||(i.onerror=null,t.onError.emit(n))},i.onload=function(){if(!!t._resolve){var n=i.width,s=i.height;if(!n||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var o=n*t.scale,a=s*t.scale;(t._overrideWidth||t._overrideHeight)&&(o=t._overrideWidth||t._overrideHeight/s*n,a=t._overrideHeight||t._overrideWidth/n*s),o=Math.round(o),a=Math.round(a);var u=t.source;u.width=o,u.height=a,u._pixiId="canvas_"+oi(),u.getContext("2d").drawImage(i,0,0,n,s,0,0,o,a),t._resolve(),t._resolve=null}}},e.getSize=function(t){var i=e.SVG_SIZE.exec(t),n={};return i&&(n[i[1]]=Math.round(parseFloat(i[3])),n[i[5]]=Math.round(parseFloat(i[7]))),n},e.prototype.dispose=function(){r.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,i){return i==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&e.SVG_XML.test(t)},e.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(xt),xm=function(r){G(e,r);function e(t,i){var n=this;if(i=i||{},!(t instanceof HTMLVideoElement)){var s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),typeof t=="string"&&(t=[t]);var o=t[0].src||t[0];xt.crossOrigin(s,o,i.crossorigin);for(var a=0;a<t.length;++a){var u=document.createElement("source"),l=t[a],h=l.src,c=l.mime;h=h||t[a];var d=h.split("?").shift().toLowerCase(),f=d.slice(d.lastIndexOf(".")+1);c=c||e.MIME_TYPES[f]||"video/"+f,u.src=h,u.type=c,s.appendChild(u)}t=s}return n=r.call(this,t)||this,n.noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=i.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=i.autoPlay!==!1,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),i.autoLoad!==!1&&n.load(),n}return e.prototype.update=function(t){if(!this.destroyed){var i=Le.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(r.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(function(n){t.valid?n(t):(t._resolve=n,i.load())}),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()},e.prototype._isSourceReady=function(){var t=this.source;return t.readyState>2},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Le.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Le.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var i=this.valid;this.resize(t.videoWidth,t.videoHeight),!i&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&(Le.shared.remove(this.update,this),this._isConnectedToTicker=!1);var t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),r.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Le.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Le.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,i){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.indexOf(i)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(xt),Sm=function(r){G(e,r);function e(t){return r.call(this,t)||this}return e.test=function(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&t instanceof ImageBitmap},e}(xt);$s.push(hh,Sm,Im,xm,wm,Eo,Tm,Em);var Cm=function(r){G(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.upload=function(t,i,n){var s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===wt.UNPACK);var o=i.realWidth,a=i.realHeight;return n.width===o&&n.height===a?s.texSubImage2D(i.target,0,0,0,o,a,i.format,n.type,this.data):(n.width=o,n.height=a,s.texImage2D(i.target,0,n.internalFormat,o,a,0,i.format,n.type,this.data)),!0},e}(Eo),Ws=function(){function r(e,t){this.width=Math.round(e||100),this.height=Math.round(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new oe("disposeFramebuffer"),this.multisample=q.NONE}return Object.defineProperty(r.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),r.prototype.addColorTexture=function(e,t){return e===void 0&&(e=0),this.colorTextures[e]=t||new ee(null,{scaleMode:Xe.NEAREST,resolution:1,mipmap:Tt.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},r.prototype.addDepthTexture=function(e){return this.depthTexture=e||new ee(new Cm(null,{width:this.width,height:this.height}),{scaleMode:Xe.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Tt.OFF,format:E.DEPTH_COMPONENT,type:F.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},r.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},r.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},r.prototype.resize=function(e,t){if(e=Math.round(e),t=Math.round(t),!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var n=this.colorTextures[i],s=n.resolution;n.setSize(e/s,t/s)}if(this.depthTexture){var s=this.depthTexture.resolution;this.depthTexture.setSize(e/s,t/s)}}},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},r}(),ch=function(r){G(e,r);function e(t){t===void 0&&(t={});var i=this;if(typeof t=="number"){var n=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];t={width:n,height:s,scaleMode:o,resolution:a}}return t.width=t.width||100,t.height=t.height||100,t.multisample=t.multisample!==void 0?t.multisample:q.NONE,i=r.call(this,null,t)||this,i.mipmap=Tt.OFF,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new Ws(i.realWidth,i.realHeight).addColorTexture(0,i),i.framebuffer.multisample=t.multisample,i.maskStack=[],i.filterStack=[{}],i}return e.prototype.resize=function(t,i){this.framebuffer.resize(t*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},e.prototype.dispose=function(){this.framebuffer.dispose(),r.prototype.dispose.call(this)},e.prototype.destroy=function(){r.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(ee),dh=function(){function r(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return r.prototype.set=function(e,t,i){var n=t.width,s=t.height;if(i){var o=e.width/2/n,a=e.height/2/s,u=e.x/n+o,l=e.y/s+a;i=j.add(i,j.NW),this.x0=u+o*j.uX(i),this.y0=l+a*j.uY(i),i=j.add(i,2),this.x1=u+o*j.uX(i),this.y1=l+a*j.uY(i),i=j.add(i,2),this.x2=u+o*j.uX(i),this.y2=l+a*j.uY(i),i=j.add(i,2),this.x3=u+o*j.uX(i),this.y3=l+a*j.uY(i)}else this.x0=e.x/n,this.y0=e.y/s,this.x1=(e.x+e.width)/n,this.y1=e.y/s,this.x2=(e.x+e.width)/n,this.y2=(e.y+e.height)/s,this.x3=e.x/n,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},r.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},r}(),su=new dh;function Li(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}var Yi=function(r){G(e,r);function e(t,i,n,s,o,a){var u=r.call(this)||this;if(u.noFrame=!1,i||(u.noFrame=!0,i=new K(0,0,1,1)),t instanceof e&&(t=t.baseTexture),u.baseTexture=t,u._frame=i,u.trim=s,u.valid=!1,u._uvs=su,u.uvMatrix=null,u.orig=n||i,u._rotate=Number(o||0),o===!0)u._rotate=2;else if(u._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return u.defaultAnchor=a?new me(a.x,a.y):new me(0,0),u._updateID=0,u.textureCacheIds=[],t.valid?u.noFrame?t.valid&&u.onBaseTextureUpdated(t):u.frame=i:t.once("loaded",u.onBaseTextureUpdated,u),u.noFrame&&t.on("update",u.onBaseTextureUpdated,u),u}return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var i=this.baseTexture.resource;i&&i.url&&Qe[i.url]&&e.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),n=new e(this.baseTexture,!this.noFrame&&t,i,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=t),n},e.prototype.updateUvs=function(){this._uvs===su&&(this._uvs=new dh),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,i,n){i===void 0&&(i={}),n===void 0&&(n=x.STRICT_TEXTURE_CACHE);var s=typeof t=="string",o=null;if(s)o=t;else if(t instanceof ee){if(!t.cacheId){var a=i&&i.pixiIdPrefix||"pixiid";t.cacheId=a+"-"+oi(),ee.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){var a=i&&i.pixiIdPrefix||"pixiid";t._pixiId=a+"_"+oi()}o=t._pixiId}var u=Qe[o];if(s&&n&&!u)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return!u&&!(t instanceof ee)?(i.resolution||(i.resolution=iu(t)),u=new e(new ee(t,i)),u.baseTexture.cacheId=o,ee.addToCache(u.baseTexture,o),e.addToCache(u,o)):!u&&t instanceof ee&&(u=new e(t),e.addToCache(u,o)),u},e.fromURL=function(t,i){var n=Object.assign({autoLoad:!1},i?.resourceOptions),s=e.from(t,Object.assign({resourceOptions:n},i),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(function(){return Promise.resolve(s)})},e.fromBuffer=function(t,i,n,s){return new e(ee.fromBuffer(t,i,n,s))},e.fromLoader=function(t,i,n,s){var o=new ee(t,Object.assign({scaleMode:x.SCALE_MODE,resolution:iu(i)},s)),a=o.resource;a instanceof hh&&(a.url=i);var u=new e(o);return n||(n=i),ee.addToCache(u.baseTexture,n),e.addToCache(u,n),n!==i&&(ee.addToCache(u.baseTexture,i),e.addToCache(u,i)),u.baseTexture.valid?Promise.resolve(u):new Promise(function(l){u.baseTexture.once("loaded",function(){return l(u)})})},e.addToCache=function(t,i){i&&(t.textureCacheIds.indexOf(i)===-1&&t.textureCacheIds.push(i),Qe[i]&&console.warn("Texture added to the cache with an id ["+i+"] that already had an entry"),Qe[i]=t)},e.removeFromCache=function(t){if(typeof t=="string"){var i=Qe[t];if(i){var n=i.textureCacheIds.indexOf(t);return n>-1&&i.textureCacheIds.splice(n,1),delete Qe[t],i}}else if(t&&t.textureCacheIds){for(var s=0;s<t.textureCacheIds.length;++s)Qe[t.textureCacheIds[s]]===t&&delete Qe[t.textureCacheIds[s]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var i=t.x,n=t.y,s=t.width,o=t.height,a=i+s>this.baseTexture.width,u=n+o>this.baseTexture.height;if(a||u){var l=a&&u?"and":"or",h="X: "+i+" + "+s+" = "+(i+s)+" > "+this.baseTexture.width,c="Y: "+n+" + "+o+" = "+(n+o)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(h+" "+l+" "+c))}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},Object.defineProperty(e,"EMPTY",{get:function(){return e._EMPTY||(e._EMPTY=new e(new ee),Li(e._EMPTY),Li(e._EMPTY.baseTexture)),e._EMPTY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"WHITE",{get:function(){if(!e._WHITE){var t=x.ADAPTER.createCanvas(16,16),i=t.getContext("2d");t.width=16,t.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),e._WHITE=new e(ee.from(t)),Li(e._WHITE),Li(e._WHITE.baseTexture)}return e._WHITE},enumerable:!1,configurable:!0}),e}(Ct),Io=function(r){G(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(t){this.framebuffer.multisample=t},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,i,n){n===void 0&&(n=!0);var s=this.baseTexture.resolution,o=Math.round(t*s)/s,a=Math.round(i*s)/s;this.valid=o>0&&a>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=a,n&&this.baseTexture.resize(o,a),this.updateUvs()},e.prototype.setResolution=function(t){var i=this.baseTexture;i.resolution!==t&&(i.setResolution(t),this.resize(i.width,i.height,!1))},e.create=function(t){for(var i=arguments,n=[],s=1;s<arguments.length;s++)n[s-1]=i[s];return typeof t=="number"&&(Zt("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),t={width:t,height:n[0],scaleMode:n[1],resolution:n[2]}),new e(new ch(t))},e}(Yi),Am=function(){function r(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return r.prototype.createTexture=function(e,t,i){i===void 0&&(i=q.NONE);var n=new ch(Object.assign({width:e,height:t,resolution:1,multisample:i},this.textureOptions));return new Io(n)},r.prototype.getOptimalTexture=function(e,t,i,n){i===void 0&&(i=1),n===void 0&&(n=q.NONE);var s;e=Math.ceil(e*i-1e-6),t=Math.ceil(t*i-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=ln(e),t=ln(t),s=((e&65535)<<16|t&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);var o=this.texturePool[s].pop();return o||(o=this.createTexture(e,t,n)),o.filterPoolKey=s,o.setResolution(i),o},r.prototype.getFilterTexture=function(e,t,i){var n=this.getOptimalTexture(e.width,e.height,t||e.resolution,i||q.NONE);return n.filterFrame=e.filterFrame,n},r.prototype.returnTexture=function(e){var t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)},r.prototype.returnFilterTexture=function(e){this.returnTexture(e)},r.prototype.clear=function(e){if(e=e!==!1,e)for(var t in this.texturePool){var i=this.texturePool[t];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}},r.prototype.setScreenSize=function(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(var t in this.texturePool)if(Number(t)<0){var i=this.texturePool[t];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}},r.SCREEN_KEY=-1,r}(),ou=function(){function r(e,t,i,n,s,o,a){t===void 0&&(t=0),i===void 0&&(i=!1),n===void 0&&(n=F.FLOAT),this.buffer=e,this.size=t,this.normalized=i,this.type=n,this.stride=s,this.start=o,this.instance=a}return r.prototype.destroy=function(){this.buffer=null},r.from=function(e,t,i,n,s){return new r(e,t,i,n,s)},r}(),Pm=0,Ie=function(){function r(e,t,i){t===void 0&&(t=!0),i===void 0&&(i=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=t,this.id=Pm++,this.disposeRunner=new oe("disposeBuffer")}return r.prototype.update=function(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(r.prototype,"index",{get:function(){return this.type===We.ELEMENT_ARRAY_BUFFER},set:function(e){this.type=e?We.ELEMENT_ARRAY_BUFFER:We.ARRAY_BUFFER},enumerable:!1,configurable:!0}),r.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new r(e)},r}(),Rm={Float32Array,Uint32Array,Int32Array,Uint8Array};function Mm(r,e){for(var t=0,i=0,n={},s=0;s<r.length;s++)i+=e[s],t+=r[s].length;for(var o=new ArrayBuffer(t*4),a=null,u=0,s=0;s<r.length;s++){var l=e[s],h=r[s],c=sh(h);n[c]||(n[c]=new Rm[c](o)),a=n[c];for(var d=0;d<h.length;d++){var f=(d/l|0)*i+u,p=d%l;a[f+p]=h[d]}u+=l}return new Float32Array(o)}var au={5126:4,5123:2,5121:1},Om=0,Fm={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},To=function(){function r(e,t){e===void 0&&(e=[]),t===void 0&&(t={}),this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=Om++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new oe("disposeGeometry"),this.refCount=0}return r.prototype.addAttribute=function(e,t,i,n,s,o,a,u){if(i===void 0&&(i=0),n===void 0&&(n=!1),u===void 0&&(u=!1),!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Ie||(t instanceof Array&&(t=new Float32Array(t)),t=new Ie(t));var l=e.split("|");if(l.length>1){for(var h=0;h<l.length;h++)this.addAttribute(l[h],t,i,n,s);return this}var c=this.buffers.indexOf(t);return c===-1&&(this.buffers.push(t),c=this.buffers.length-1),this.attributes[e]=new ou(c,i,n,s,o,a,u),this.instanced=this.instanced||u,this},r.prototype.getAttribute=function(e){return this.attributes[e]},r.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},r.prototype.addIndex=function(e){return e instanceof Ie||(e instanceof Array&&(e=new Uint16Array(e)),e=new Ie(e)),e.type=We.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.indexOf(e)===-1&&this.buffers.push(e),this},r.prototype.getIndex=function(){return this.indexBuffer},r.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var e=[],t=[],i=new Ie,n;for(n in this.attributes){var s=this.attributes[n],o=this.buffers[s.buffer];e.push(o.data),t.push(s.size*au[s.type]/4),s.buffer=0}for(i.data=Mm(e,t),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},r.prototype.getSize=function(){for(var e in this.attributes){var t=this.attributes[e],i=this.buffers[t.buffer];return i.data.length/(t.stride/4||t.size)}return 0},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},r.prototype.clone=function(){for(var e=new r,t=0;t<this.buffers.length;t++)e.buffers[t]=new Ie(this.buffers[t].data.slice(0));for(var t in this.attributes){var i=this.attributes[t];e.attributes[t]=new ou(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=We.ELEMENT_ARRAY_BUFFER),e},r.merge=function(e){for(var t=new r,i=[],n=[],s=[],o,a=0;a<e.length;a++){o=e[a];for(var u=0;u<o.buffers.length;u++)n[u]=n[u]||0,n[u]+=o.buffers[u].data.length,s[u]=0}for(var a=0;a<o.buffers.length;a++)i[a]=new Fm[sh(o.buffers[a].data)](n[a]),t.buffers[a]=new Ie(i[a]);for(var a=0;a<e.length;a++){o=e[a];for(var u=0;u<o.buffers.length;u++)i[u].set(o.buffers[u].data,s[u]),s[u]+=o.buffers[u].data.length}if(t.attributes=o.attributes,o.indexBuffer){t.indexBuffer=t.buffers[o.buffers.indexOf(o.indexBuffer)],t.indexBuffer.type=We.ELEMENT_ARRAY_BUFFER;for(var l=0,h=0,c=0,d=0,a=0;a<o.buffers.length;a++)if(o.buffers[a]!==o.indexBuffer){d=a;break}for(var a in o.attributes){var f=o.attributes[a];(f.buffer|0)===d&&(h+=f.size*au[f.type]/4)}for(var a=0;a<e.length;a++){for(var p=e[a].indexBuffer.data,u=0;u<p.length;u++)t.indexBuffer.data[u+c]+=l;l+=e[a].buffers[d].data.length/h,c+=p.length}}return t},r}(),Lm=function(r){G(e,r);function e(){var t=r.call(this)||this;return t.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),t}return e}(To),Dm=function(r){G(e,r);function e(){var t=r.call(this)||this;return t.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.vertexBuffer=new Ie(t.vertices),t.uvBuffer=new Ie(t.uvs),t.addAttribute("aVertexPosition",t.vertexBuffer).addAttribute("aTextureCoord",t.uvBuffer).addIndex([0,1,2,0,2,3]),t}return e.prototype.map=function(t,i){var n=0,s=0;return this.uvs[0]=n,this.uvs[1]=s,this.uvs[2]=n+i.width/t.width,this.uvs[3]=s,this.uvs[4]=n+i.width/t.width,this.uvs[5]=s+i.height/t.height,this.uvs[6]=n,this.uvs[7]=s+i.height/t.height,n=i.x,s=i.y,this.vertices[0]=n,this.vertices[1]=s,this.vertices[2]=n+i.width,this.vertices[3]=s,this.vertices[4]=n+i.width,this.vertices[5]=s+i.height,this.vertices[6]=n,this.vertices[7]=s+i.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(To),Nm=0,_r=function(){function r(e,t,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Nm++,this.static=!!t,this.ubo=!!i,e instanceof Ie?(this.buffer=e,this.buffer.type=We.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Ie(new Float32Array(1)),this.buffer.type=We.UNIFORM_BUFFER,this.autoManage=!0))}return r.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},r.prototype.add=function(e,t,i){if(!this.ubo)this.uniforms[e]=new r(t,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},r.from=function(e,t,i){return new r(e,t,i)},r.uboFrom=function(e,t){return new r(e,t??!0,!0)},r}(),km=function(){function r(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=q.NONE,this.sourceFrame=new K,this.destinationFrame=new K,this.bindingSourceFrame=new K,this.bindingDestinationFrame=new K,this.filters=[],this.transform=null}return r.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},r}(),Di=[new me,new me,new me,new me],es=new ue,Bm=function(){function r(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Am,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new Lm,this.quadUv=new Dm,this.tempRect=new K,this.activeState={},this.globalUniforms=new _r({outputFrame:new K,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return r.prototype.push=function(e,t){for(var i,n,s=this.renderer,o=this.defaultFilterStack,a=this.statePool.pop()||new km,u=this.renderer.renderTexture,l=t[0].resolution,h=t[0].multisample,c=t[0].padding,d=t[0].autoFit,f=(i=t[0].legacy)!==null&&i!==void 0?i:!0,p=1;p<t.length;p++){var v=t[p];l=Math.min(l,v.resolution),h=Math.min(h,v.multisample),c=this.useMaxPadding?Math.max(c,v.padding):c+v.padding,d=d&&v.autoFit,f=f||((n=v.legacy)!==null&&n!==void 0?n:!0)}o.length===1&&(this.defaultFilterStack[0].renderTexture=u.current),o.push(a),a.resolution=l,a.multisample=h,a.legacy=f,a.target=e,a.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),a.sourceFrame.pad(c);var m=this.tempRect.copyFrom(u.sourceFrame);s.projection.transform&&this.transformAABB(es.copyFrom(s.projection.transform).invert(),m),d?(a.sourceFrame.fit(m),(a.sourceFrame.width<=0||a.sourceFrame.height<=0)&&(a.sourceFrame.width=0,a.sourceFrame.height=0)):a.sourceFrame.intersects(m)||(a.sourceFrame.width=0,a.sourceFrame.height=0),this.roundFrame(a.sourceFrame,u.current?u.current.resolution:s.resolution,u.sourceFrame,u.destinationFrame,s.projection.transform),a.renderTexture=this.getOptimalFilterTexture(a.sourceFrame.width,a.sourceFrame.height,l,h),a.filters=t,a.destinationFrame.width=a.renderTexture.width,a.destinationFrame.height=a.renderTexture.height;var y=this.tempRect;y.x=0,y.y=0,y.width=a.sourceFrame.width,y.height=a.sourceFrame.height,a.renderTexture.filterFrame=a.sourceFrame,a.bindingSourceFrame.copyFrom(u.sourceFrame),a.bindingDestinationFrame.copyFrom(u.destinationFrame),a.transform=s.projection.transform,s.projection.transform=null,u.bind(a.renderTexture,a.sourceFrame,y),s.framebuffer.clear(0,0,0,0)},r.prototype.pop=function(){var e=this.defaultFilterStack,t=e.pop(),i=t.filters;this.activeState=t;var n=this.globalUniforms.uniforms;n.outputFrame=t.sourceFrame,n.resolution=t.resolution;var s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=t.destinationFrame.width,s[1]=t.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*t.resolution),o[1]=Math.round(s[1]*t.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=t.sourceFrame.width*s[2]-.5*o[2],a[3]=t.sourceFrame.height*s[3]-.5*o[3],t.legacy){var u=n.filterArea;u[0]=t.destinationFrame.width,u[1]=t.destinationFrame.height,u[2]=t.sourceFrame.x,u[3]=t.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var l=e[e.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,t.renderTexture,l.renderTexture,pt.BLEND,t),this.returnFilterTexture(t.renderTexture);else{var h=t.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,t.resolution);c.filterFrame=h.filterFrame;var d=0;for(d=0;d<i.length-1;++d){d===1&&t.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,t.resolution),c.filterFrame=h.filterFrame),i[d].apply(this,h,c,pt.CLEAR,t);var f=h;h=c,c=f}i[d].apply(this,h,l.renderTexture,pt.BLEND,t),d>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}t.clear(),this.statePool.push(t)},r.prototype.bindAndClear=function(e,t){t===void 0&&(t=pt.CLEAR);var i=this.renderer,n=i.renderTexture,s=i.state;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e&&e.filterFrame){var o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,n.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var a=s.stateId&1||this.forceClear;(t===pt.CLEAR||t===pt.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)},r.prototype.applyFilter=function(e,t,i,n){var s=this.renderer;s.state.set(e.state),this.bindAndClear(i,n),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(ri.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(ri.TRIANGLE_STRIP))},r.prototype.calculateSpriteMatrix=function(e,t){var i=this.activeState,n=i.sourceFrame,s=i.destinationFrame,o=t._texture.orig,a=e.set(s.width,0,0,s.height,n.x,n.y),u=t.worldTransform.copyTo(ue.TEMP_MATRIX);return u.invert(),a.prepend(u),a.scale(1/o.width,1/o.height),a.translate(t.anchor.x,t.anchor.y),a},r.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},r.prototype.getOptimalFilterTexture=function(e,t,i,n){return i===void 0&&(i=1),n===void 0&&(n=q.NONE),this.texturePool.getOptimalTexture(e,t,i,n)},r.prototype.getFilterTexture=function(e,t,i){if(typeof e=="number"){var n=e;e=t,t=n}e=e||this.activeState.renderTexture;var s=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,i||q.NONE);return s.filterFrame=e.filterFrame,s},r.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},r.prototype.emptyPool=function(){this.texturePool.clear(!0)},r.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},r.prototype.transformAABB=function(e,t){var i=Di[0],n=Di[1],s=Di[2],o=Di[3];i.set(t.left,t.top),n.set(t.left,t.bottom),s.set(t.right,t.top),o.set(t.right,t.bottom),e.apply(i,i),e.apply(n,n),e.apply(s,s),e.apply(o,o);var a=Math.min(i.x,n.x,s.x,o.x),u=Math.min(i.y,n.y,s.y,o.y),l=Math.max(i.x,n.x,s.x,o.x),h=Math.max(i.y,n.y,s.y,o.y);t.x=a,t.y=u,t.width=l-a,t.height=h-u},r.prototype.roundFrame=function(e,t,i,n,s){if(!(e.width<=0||e.height<=0||i.width<=0||i.height<=0)){if(s){var o=s.a,a=s.b,u=s.c,l=s.d;if((Math.abs(a)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}s=s?es.copyFrom(s):es.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,e),e.ceil(t),this.transformAABB(s.invert(),e)}},r}(),fh=function(){function r(e){this.renderer=e}return r.prototype.flush=function(){},r.prototype.destroy=function(){this.renderer=null},r.prototype.start=function(){},r.prototype.stop=function(){this.flush()},r.prototype.render=function(e){},r}(),Um=function(){function r(e){this.renderer=e,this.emptyRenderer=new fh(e),this.currentRenderer=this.emptyRenderer}return r.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},r.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},r.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},r.prototype.copyBoundTextures=function(e,t){for(var i=this.renderer.texture.boundTextures,n=t-1;n>=0;--n)e[n]=i[n]||null,e[n]&&(e[n]._batchLocation=n)},r.prototype.boundArray=function(e,t,i,n){for(var s=e.elements,o=e.ids,a=e.count,u=0,l=0;l<a;l++){var h=s[l],c=h._batchLocation;if(c>=0&&c<n&&t[c]===h){o[l]=c;continue}for(;u<n;){var d=t[u];if(d&&d._batchEnabled===i&&d._batchLocation===u){u++;continue}o[l]=u,h._batchLocation=u,t[u]=h;break}}},r.prototype.destroy=function(){this.renderer=null},r}(),uu=0,Gm=function(){function r(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(r.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),r.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=uu++},r.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=uu++,this.renderer.runners.contextChange.emit(e)},r.prototype.initFromOptions=function(e){var t=this.createContext(this.renderer.view,e);this.initFromContext(t)},r.prototype.createContext=function(e,t){var i;if(x.PREFER_ENV>=st.WEBGL2&&(i=e.getContext("webgl2",t)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},r.prototype.getExtensions=function(){var e=this.gl,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})},r.prototype.handleContextLost=function(e){var t=this;e.preventDefault(),setTimeout(function(){t.gl.isContextLost()&&t.extensions.loseContext&&t.extensions.loseContext.restoreContext()},0)},r.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},r.prototype.destroy=function(){var e=this.renderer.view;this.renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},r.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},r.prototype.validateContext=function(e){var t=e.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var n=i||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},r}(),Vm=function(){function r(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=q.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return r}(),Hm=new K,jm=function(){function r(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Ws(10,10),this.msaaSamples=null}return r.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new K,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){var t=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;x.PREFER_ENV===st.WEBGL_LEGACY&&(t=null,i=null),t?e.drawBuffers=function(n){return t.drawBuffersWEBGL(n)}:(this.hasMRT=!1,e.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},r.prototype.bind=function(e,t,i){i===void 0&&(i=0);var n=this.gl;if(e){var s=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(e.dirtyId++,e.dirtyFormat++,s.mipLevel=i),s.dirtyId!==e.dirtyId&&(s.dirtyId=e.dirtyId,s.dirtyFormat!==e.dirtyFormat?(s.dirtyFormat=e.dirtyFormat,s.dirtySize=e.dirtySize,this.updateFramebuffer(e,i)):s.dirtySize!==e.dirtySize&&(s.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var o=0;o<e.colorTextures.length;o++){var a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){var u=t.width>>i,l=t.height>>i,h=u/t.width;this.setViewport(t.x*h,t.y*h,u,l)}else{var u=e.width>>i,l=e.height>>i;this.setViewport(0,0,u,l)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},r.prototype.setViewport=function(e,t,i,n){var s=this.viewport;e=Math.round(e),t=Math.round(t),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==e||s.y!==t)&&(s.x=e,s.y=t,s.width=i,s.height=n,this.gl.viewport(e,t,i,n))},Object.defineProperty(r.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),r.prototype.clear=function(e,t,i,n,s){s===void 0&&(s=en.COLOR|en.DEPTH);var o=this.gl;o.clearColor(e,t,i,n),o.clear(s)},r.prototype.initFramebuffer=function(e){var t=this.gl,i=new Vm(t.createFramebuffer());return i.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(e),e.disposeRunner.add(this),i},r.prototype.resizeFramebuffer=function(e){var t=this.gl,i=e.glFramebuffers[this.CONTEXT_UID];i.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,i.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,t.RGBA8,e.width,e.height)),i.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,i.stencil),i.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));var n=e.colorTextures,s=n.length;t.drawBuffers||(s=Math.min(s,1));for(var o=0;o<s;o++){var a=n[o],u=a.parentTextureArray||a;this.renderer.texture.bind(u,0)}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)},r.prototype.updateFramebuffer=function(e,t){var i=this.gl,n=e.glFramebuffers[this.CONTEXT_UID],s=e.colorTextures,o=s.length;i.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(e)?(n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.RGBA8,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));for(var a=[],u=0;u<o;u++){var l=s[u],h=l.parentTextureArray||l;this.renderer.texture.bind(h,0),!(u===0&&n.msaaBuffer)&&(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+u,l.target,h._glTextures[this.CONTEXT_UID].texture,t),a.push(i.COLOR_ATTACHMENT0+u))}if(a.length>1&&i.drawBuffers(a),e.depthTexture){var c=this.writeDepthTexture;if(c){var d=e.depthTexture;this.renderer.texture.bind(d,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,d._glTextures[this.CONTEXT_UID].texture,t)}}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil)):n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)},r.prototype.canMultisampleFramebuffer=function(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture},r.prototype.detectSamples=function(e){var t=this.msaaSamples,i=q.NONE;if(e<=1||t===null)return i;for(var n=0;n<t.length;n++)if(t[n]<=e){i=t[n];break}return i===1&&(i=q.NONE),i},r.prototype.blit=function(e,t,i){var n=this,s=n.current,o=n.renderer,a=n.gl,u=n.CONTEXT_UID;if(o.context.webGLVersion===2&&!!s){var l=s.glFramebuffers[u];if(!!l){if(!e){if(!l.msaaBuffer)return;var h=s.colorTextures[0];if(!h)return;l.blitFramebuffer||(l.blitFramebuffer=new Ws(s.width,s.height),l.blitFramebuffer.addColorTexture(0,h)),e=l.blitFramebuffer,e.colorTextures[0]!==h&&(e.colorTextures[0]=h,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}t||(t=Hm,t.width=s.width,t.height=s.height),i||(i=t);var c=t.width===i.width&&t.height===i.height;this.bind(e),a.bindFramebuffer(a.READ_FRAMEBUFFER,l.framebuffer),a.blitFramebuffer(t.left,t.top,t.right,t.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,c?a.NEAREST:a.LINEAR)}}},r.prototype.disposeFramebuffer=function(e,t){var i=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!!i){delete e.glFramebuffers[this.CONTEXT_UID];var s=this.managedFramebuffers.indexOf(e);s>=0&&this.managedFramebuffers.splice(s,1),e.disposeRunner.remove(this),t||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}},r.prototype.disposeAll=function(e){var t=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<t.length;i++)this.disposeFramebuffer(t[i],e)},r.prototype.forceStencil=function(){var e=this.current;if(!!e){var t=e.glFramebuffers[this.CONTEXT_UID];if(!(!t||t.stencil)){e.stencil=!0;var i=e.width,n=e.height,s=this.gl,o=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o),t.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,t.multisample,s.DEPTH24_STENCIL8,i,n):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,n),t.stencil=o,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,o)}}},r.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new K},r.prototype.destroy=function(){this.renderer=null},r}(),ts={5126:4,5123:2,5121:1},$m=function(){function r(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return r.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){var i=this.renderer.context.extensions.vertexArrayObject;x.PREFER_ENV===st.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=function(){return i.createVertexArrayOES()},e.bindVertexArray=function(s){return i.bindVertexArrayOES(s)},e.deleteVertexArray=function(s){return i.deleteVertexArrayOES(s)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(t.webGLVersion!==2){var n=e.getExtension("ANGLE_instanced_arrays");n?(e.vertexAttribDivisor=function(s,o){return n.vertexAttribDivisorANGLE(s,o)},e.drawElementsInstanced=function(s,o,a,u,l){return n.drawElementsInstancedANGLE(s,o,a,u,l)},e.drawArraysInstanced=function(s,o,a,u){return n.drawArraysInstancedANGLE(s,o,a,u)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex},r.prototype.bind=function(e,t){t=t||this.renderer.shader.shader;var i=this.gl,n=e.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);var o=n[t.program.id]||this.initGeometryVao(e,t,s);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(e,t.program)),this.updateBuffers()},r.prototype.reset=function(){this.unbind()},r.prototype.updateBuffers=function(){for(var e=this._activeGeometry,t=this.renderer.buffer,i=0;i<e.buffers.length;i++){var n=e.buffers[i];t.update(n)}},r.prototype.checkCompatibility=function(e,t){var i=e.attributes,n=t.attributeData;for(var s in n)if(!i[s])throw new Error('shader and geometry incompatible, geometry missing the "'+s+'" attribute')},r.prototype.getSignature=function(e,t){var i=e.attributes,n=t.attributeData,s=["g",e.id];for(var o in i)n[o]&&s.push(o,n[o].location);return s.join("-")},r.prototype.initGeometryVao=function(e,t,i){i===void 0&&(i=!0);var n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=t.program;a.glPrograms[s]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,a);var u=this.getSignature(e,a),l=e.glVertexArrayObjects[this.CONTEXT_UID],h=l[u];if(h)return l[a.id]=h,h;var c=e.buffers,d=e.attributes,f={},p={};for(var v in c)f[v]=0,p[v]=0;for(var v in d)!d[v].size&&a.attributeData[v]?d[v].size=a.attributeData[v].size:d[v].size||console.warn("PIXI Geometry attribute '"+v+"' size cannot be determined (likely the bound shader does not have the attribute)"),f[d[v].buffer]+=d[v].size*ts[d[v].type];for(var v in d){var m=d[v],y=m.size;m.stride===void 0&&(f[m.buffer]===y*ts[m.type]?m.stride=0:m.stride=f[m.buffer]),m.start===void 0&&(m.start=p[m.buffer],p[m.buffer]+=y*ts[m.type])}h=n.createVertexArray(),n.bindVertexArray(h);for(var _=0;_<c.length;_++){var g=c[_];o.bind(g),i&&g._glBuffers[s].refCount++}return this.activateVao(e,a),this._activeVao=h,l[a.id]=h,l[u]=h,h},r.prototype.disposeGeometry=function(e,t){var i;if(!!this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var n=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=e.buffers,a=(i=this.renderer)===null||i===void 0?void 0:i.buffer;if(e.disposeRunner.remove(this),!!n){if(a)for(var u=0;u<o.length;u++){var l=o[u]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!t&&a.dispose(o[u],t))}if(!t){for(var h in n)if(h[0]==="g"){var c=n[h];this._activeVao===c&&this.unbind(),s.deleteVertexArray(c)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},r.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedGeometries),i=0;i<t.length;i++)this.disposeGeometry(this.managedGeometries[t[i]],e)},r.prototype.activateVao=function(e,t){var i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);var u=null;for(var l in a){var h=a[l],c=o[h.buffer],d=c._glBuffers[n];if(t.attributeData[l]){u!==d&&(s.bind(c),u=d);var f=t.attributeData[l].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance)if(this.hasInstance)i.vertexAttribDivisor(f,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},r.prototype.draw=function(e,t,i,n){var s=this.gl,o=this._activeGeometry;if(o.indexBuffer){var a=o.indexBuffer.data.BYTES_PER_ELEMENT,u=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(e,t||o.indexBuffer.data.length,u,(i||0)*a,n||1):s.drawElements(e,t||o.indexBuffer.data.length,u,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(e,i,t||o.getSize(),n||1):s.drawArrays(e,i,t||o.getSize());return this},r.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},r.prototype.destroy=function(){this.renderer=null},r}(),zm=function(){function r(e){e===void 0&&(e=null),this.type=J.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=x.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}return Object.defineProperty(r.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=J.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},r.prototype.copyCountersOrReset=function(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},r}();function lu(r,e,t){var i=r.createShader(e);return r.shaderSource(i,t),r.compileShader(i),i}function hu(r,e){var t=r.getShaderSource(e).split(`
`).map(function(l,h){return h+": "+l}),i=r.getShaderInfoLog(e),n=i.split(`
`),s={},o=n.map(function(l){return parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(l){return l&&!s[l]?(s[l]=!0,!0):!1}),a=[""];o.forEach(function(l){t[l-1]="%c"+t[l-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var u=t.join(`
`);a[0]=u,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,a),console.groupEnd()}function Xm(r,e,t,i){r.getProgramParameter(e,r.LINK_STATUS)||(r.getShaderParameter(t,r.COMPILE_STATUS)||hu(r,t),r.getShaderParameter(i,r.COMPILE_STATUS)||hu(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(e)))}function rs(r){for(var e=new Array(r),t=0;t<e.length;t++)e[t]=!1;return e}function ph(r,e){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return rs(2*e);case"bvec3":return rs(3*e);case"bvec4":return rs(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var mh={},Dr=mh;function Wm(){if(Dr===mh||Dr&&Dr.isContextLost()){var r=x.ADAPTER.createCanvas(),e=void 0;x.PREFER_ENV>=st.WEBGL2&&(e=r.getContext("webgl2",{})),e||(e=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Dr=e}return Dr}var Ni;function Ym(){if(!Ni){Ni=Te.MEDIUM;var r=Wm();if(r&&r.getShaderPrecisionFormat){var e=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);Ni=e.precision?Te.HIGH:Te.MEDIUM}}return Ni}function cu(r,e,t){if(r.substring(0,9)!=="precision"){var i=e;return e===Te.HIGH&&t!==Te.HIGH&&(i=Te.MEDIUM),"precision "+i+` float;
`+r}else if(t!==Te.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}var qm={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function gh(r){return qm[r]}var ki=null,du={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function vh(r,e){if(!ki){var t=Object.keys(du);ki={};for(var i=0;i<t.length;++i){var n=t[i];ki[r[n]]=du[n]}}return ki[e]}var br=[{test:function(r){return r.type==="float"&&r.size===1&&!r.isArray},code:function(r){return`
            if(uv["`+r+'"] !== ud["'+r+`"].value)
            {
                ud["`+r+'"].value = uv["'+r+`"]
                gl.uniform1f(ud["`+r+'"].location, uv["'+r+`"])
            }
            `}},{test:function(r,e){return(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(e==null||e.castToBaseTexture!==void 0)},code:function(r){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+r+`"], t);

            if(ud["`+r+`"].value !== t)
            {
                ud["`+r+`"].value = t;
                gl.uniform1i(ud["`+r+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(r,e){return r.type==="mat3"&&r.size===1&&!r.isArray&&e.a!==void 0},code:function(r){return`
            gl.uniformMatrix3fv(ud["`+r+'"].location, false, uv["'+r+`"].toArray(true));
            `},codeUbo:function(r){return`
                var `+r+"_matrix = uv."+r+`.toArray(true);

                data[offset] = `+r+`_matrix[0];
                data[offset+1] = `+r+`_matrix[1];
                data[offset+2] = `+r+`_matrix[2];
        
                data[offset + 4] = `+r+`_matrix[3];
                data[offset + 5] = `+r+`_matrix[4];
                data[offset + 6] = `+r+`_matrix[5];
        
                data[offset + 8] = `+r+`_matrix[6];
                data[offset + 9] = `+r+`_matrix[7];
                data[offset + 10] = `+r+`_matrix[8];
            `}},{test:function(r,e){return r.type==="vec2"&&r.size===1&&!r.isArray&&e.x!==void 0},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+r+`"].location, v.x, v.y);
                }`},codeUbo:function(r){return`
                v = uv.`+r+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(r){return r.type==="vec2"&&r.size===1&&!r.isArray},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+r+`"].location, v[0], v[1]);
                }
            `}},{test:function(r,e){return r.type==="vec4"&&r.size===1&&!r.isArray&&e.width!==void 0},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+r+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(r){return`
                    v = uv.`+r+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(r){return r.type==="vec4"&&r.size===1&&!r.isArray},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+r+`"].location, v[0], v[1], v[2], v[3])
                }`}}],Km={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Jm={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Zm(r,e){var t,i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var n in r.uniforms){var s=e[n];if(!s){!((t=r.uniforms[n])===null||t===void 0)&&t.group&&(r.uniforms[n].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+n+", '"+n+`');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.`+n+`, syncData);
                    `));continue}for(var o=r.uniforms[n],a=!1,u=0;u<br.length;u++)if(br[u].test(s,o)){i.push(br[u].code(n,o)),a=!0;break}if(!a){var l=s.size===1&&!s.isArray?Km:Jm,h=l[s.type].replace("location",'ud["'+n+'"].location');i.push(`
            cu = ud["`+n+`"];
            cv = cu.value;
            v = uv["`+n+`"];
            `+h+";")}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}var Qm=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function eg(r){for(var e="",t=0;t<r;++t)t>0&&(e+=`
else `),t<r-1&&(e+="if(test == "+t+".0){}");return e}function tg(r,e){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var t=e.createShader(e.FRAGMENT_SHADER);;){var i=Qm.replace(/%forloop%/gi,eg(r));if(e.shaderSource(t,i),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))r=r/2|0;else break}return r}var Nr;function rg(){if(typeof Nr=="boolean")return Nr;try{var r=new Function("param1","param2","param3","return param1[param2] === param3;");Nr=r({a:"b"},"a","b")===!0}catch{Nr=!1}return Nr}var ig=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,ng=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,sg=0,Bi={},wo=function(){function r(e,t,i){i===void 0&&(i="pixi-shader"),this.id=sg++,this.vertexSrc=e||r.defaultVertexSrc,this.fragmentSrc=t||r.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Bi[i]?(Bi[i]++,i+="-"+Bi[i]):Bi[i]=1,this.vertexSrc="#define SHADER_NAME "+i+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+`
`+this.fragmentSrc,this.vertexSrc=cu(this.vertexSrc,x.PRECISION_VERTEX,Te.HIGH),this.fragmentSrc=cu(this.fragmentSrc,x.PRECISION_FRAGMENT,Ym())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(r,"defaultVertexSrc",{get:function(){return ng},enumerable:!1,configurable:!0}),Object.defineProperty(r,"defaultFragmentSrc",{get:function(){return ig},enumerable:!1,configurable:!0}),r.from=function(e,t,i){var n=e+t,s=ru[n];return s||(ru[n]=s=new r(e,t,i)),s},r}(),yh=function(){function r(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof _r?this.uniformGroup=t:this.uniformGroup=new _r(t):this.uniformGroup=new _r({}),this.disposeRunner=new oe("disposeShader")}return r.prototype.checkUniformExists=function(e,t){if(t.uniforms[e])return!0;for(var i in t.uniforms){var n=t.uniforms[i];if(n.group&&this.checkUniformExists(e,n))return!0}return!1},r.prototype.destroy=function(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()},Object.defineProperty(r.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),r.from=function(e,t,i){var n=wo.from(e,t);return new r(n,i)},r}(),is=0,ns=1,ss=2,os=3,as=4,us=5,xo=function(){function r(){this.data=0,this.blendMode=S.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(r.prototype,"blend",{get:function(){return!!(this.data&1<<is)},set:function(e){!!(this.data&1<<is)!==e&&(this.data^=1<<is)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"offsets",{get:function(){return!!(this.data&1<<ns)},set:function(e){!!(this.data&1<<ns)!==e&&(this.data^=1<<ns)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"culling",{get:function(){return!!(this.data&1<<ss)},set:function(e){!!(this.data&1<<ss)!==e&&(this.data^=1<<ss)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return!!(this.data&1<<os)},set:function(e){!!(this.data&1<<os)!==e&&(this.data^=1<<os)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthMask",{get:function(){return!!(this.data&1<<us)},set:function(e){!!(this.data&1<<us)!==e&&(this.data^=1<<us)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<as)},set:function(e){!!(this.data&1<<as)!==e&&(this.data^=1<<as)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==S.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(e){this.offsets=!!e,this._polygonOffset=e},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},r.for2d=function(){var e=new r;return e.depthTest=!1,e.blend=!0,e},r}(),og=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,ag=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,ug=function(r){G(e,r);function e(t,i,n){var s=this,o=wo.from(t||e.defaultVertexSrc,i||e.defaultFragmentSrc);return s=r.call(this,o,n)||this,s.padding=0,s.resolution=x.FILTER_RESOLUTION,s.multisample=x.FILTER_MULTISAMPLE,s.enabled=!0,s.autoFit=!0,s.state=new xo,s}return e.prototype.apply=function(t,i,n,s,o){t.applyFilter(this,i,n,s)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return ag},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return og},enumerable:!1,configurable:!0}),e}(yh),lg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,hg=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,fu=new ue,cg=function(){function r(e,t){this._texture=e,this.mapCoord=new ue,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}return Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._textureID=-1},enumerable:!1,configurable:!0}),r.prototype.multiplyUvs=function(e,t){t===void 0&&(t=e);for(var i=this.mapCoord,n=0;n<e.length;n+=2){var s=e[n],o=e[n+1];t[n]=s*i.a+o*i.c+i.tx,t[n+1]=s*i.b+o*i.d+i.ty}return t},r.prototype.update=function(e){var t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;var i=t._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var n=t.orig,s=t.trim;s&&(fu.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(fu));var o=t.baseTexture,a=this.uClampFrame,u=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(t._frame.x+u+l)/o.width,a[1]=(t._frame.y+u+l)/o.height,a[2]=(t._frame.x+t._frame.width-u+l)/o.width,a[3]=(t._frame.y+t._frame.height-u+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=t._frame.width===o.width&&t._frame.height===o.height&&t.rotate===0,!0},r}(),dg=function(r){G(e,r);function e(t,i,n){var s=this,o=null;return typeof t!="string"&&i===void 0&&n===void 0&&(o=t,t=void 0,i=void 0,n=void 0),s=r.call(this,t||lg,i||hg,n)||this,s.maskSprite=o,s.maskMatrix=new ue,s}return Object.defineProperty(e.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,i,n,s){var o=this._maskSprite,a=o._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new cg(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,i,n,s))},e}(ug),fg=function(){function r(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return r.prototype.setMaskStack=function(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)},r.prototype.push=function(e,t){var i=t;if(!i.isMaskData){var n=this.maskDataPool.pop()||new zm;n.pooled=!0,n.maskObject=t,i=n}var s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=e,i.type!==J.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case J.SCISSOR:this.renderer.scissor.push(i);break;case J.STENCIL:this.renderer.stencil.push(i);break;case J.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case J.COLOR:this.pushColorMask(i);break}i.type===J.SPRITE&&this.maskStack.push(i)},r.prototype.pop=function(e){var t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case J.SCISSOR:this.renderer.scissor.pop(t);break;case J.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case J.SPRITE:this.popSpriteMask(t);break;case J.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){var i=this.maskStack[this.maskStack.length-1];i.type===J.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}},r.prototype.detect=function(e){var t=e.maskObject;t?t.isSprite?e.type=J.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=J.SCISSOR:e.type=J.STENCIL:e.type=J.COLOR},r.prototype.pushSpriteMask=function(e){var t,i,n=e.maskObject,s=e._target,o=e._filters;o||(o=this.alphaMaskPool[this.alphaMaskIndex],o||(o=this.alphaMaskPool[this.alphaMaskIndex]=[new dg]));var a=this.renderer,u=a.renderTexture,l,h;if(u.current){var c=u.current;l=e.resolution||c.resolution,h=(t=e.multisample)!==null&&t!==void 0?t:c.multisample}else l=e.resolution||a.resolution,h=(i=e.multisample)!==null&&i!==void 0?i:a.multisample;o[0].resolution=l,o[0].multisample=h,o[0].maskSprite=n;var d=s.filterArea;s.filterArea=n.getBounds(!0),a.filter.push(s,o),s.filterArea=d,e._filters||this.alphaMaskIndex++},r.prototype.popSpriteMask=function(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},r.prototype.pushColorMask=function(e){var t=e._colorMask,i=e._colorMask=t&e.colorMask;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)},r.prototype.popColorMask=function(e){var t=e._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)},r.prototype.destroy=function(){this.renderer=null},r}(),_h=function(){function r(e){this.renderer=e,this.maskStack=[],this.glConst=0}return r.prototype.getStackLength=function(){return this.maskStack.length},r.prototype.setMaskStack=function(e){var t=this.renderer.gl,i=this.getStackLength();this.maskStack=e;var n=this.getStackLength();n!==i&&(n===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))},r.prototype._useCurrent=function(){},r.prototype.destroy=function(){this.renderer=null,this.maskStack=null},r}(),pu=new ue,mu=[],pg=function(r){G(e,r);function e(t){var i=r.call(this,t)||this;return i.glConst=x.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST,i}return e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.calcScissorRect=function(t){var i;if(!t._scissorRectLocal){var n=t._scissorRect,s=t.maskObject,o=this.renderer,a=o.renderTexture,u=s.getBounds(!0,(i=mu.pop())!==null&&i!==void 0?i:new K);this.roundFrameToPixels(u,a.current?a.current.resolution:o.resolution,a.sourceFrame,a.destinationFrame,o.projection.transform),n&&u.fit(n),t._scissorRectLocal=u}},e.isMatrixRotated=function(t){if(!t)return!1;var i=t.a,n=t.b,s=t.c,o=t.d;return(Math.abs(n)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(i)>1e-4||Math.abs(o)>1e-4)},e.prototype.testScissor=function(t){var i=t.maskObject;if(!i.isFastRect||!i.isFastRect()||e.isMatrixRotated(i.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);var n=t._scissorRectLocal;return n.width>0&&n.height>0},e.prototype.roundFrameToPixels=function(t,i,n,s,o){e.isMatrixRotated(o)||(o=o?pu.copyFrom(o):pu.identity(),o.translate(-n.x,-n.y).scale(s.width/n.width,s.height/n.height).translate(s.x,s.y),this.renderer.filter.transformAABB(o,t),t.fit(s),t.x=Math.round(t.x*i),t.y=Math.round(t.y*i),t.width=Math.round(t.width*i),t.height=Math.round(t.height*i))},e.prototype.push=function(t){t._scissorRectLocal||this.calcScissorRect(t);var i=this.renderer.gl;t._scissorRect||i.enable(i.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()},e.prototype.pop=function(t){var i=this.renderer.gl;t&&mu.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():i.disable(i.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,i;this.renderer.renderTexture.current?i=t.y:i=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,i,t.width,t.height)},e}(_h),mg=function(r){G(e,r);function e(t){var i=r.call(this,t)||this;return i.glConst=x.ADAPTER.getWebGLRenderingContext().STENCIL_TEST,i}return e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var i=t.maskObject,n=this.renderer.gl,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),t._stencilCounter++;var o=t._colorMask;o!==0&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,s,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,o!==0&&(t._colorMask=o,n.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()},e.prototype.pop=function(t){var i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{var n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=n?n._colorMask:15;s!==0&&(n._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(n._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e}(_h),gg=function(){function r(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ue,this.transform=null}return r.prototype.update=function(e,t,i,n){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);var s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)},r.prototype.calculateProjection=function(e,t,i,n){var s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/t.width*2,s.d=o*(1/t.height*2),s.tx=-1-t.x*s.a,s.ty=-o-t.y*s.d},r.prototype.setTransform=function(e){},r.prototype.destroy=function(){this.renderer=null},r}(),Mt=new K,kr=new K,vg=function(){function r(e){this.renderer=e,this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new K,this.destinationFrame=new K,this.viewportFrame=new K}return r.prototype.bind=function(e,t,i){e===void 0&&(e=null);var n=this.renderer;this.current=e;var s,o,a;e?(s=e.baseTexture,a=s.resolution,t||(Mt.width=e.frame.width,Mt.height=e.frame.height,t=Mt),i||(kr.x=e.frame.x,kr.y=e.frame.y,kr.width=t.width,kr.height=t.height,i=kr),o=s.framebuffer):(a=n.resolution,t||(Mt.width=n.screen.width,Mt.height=n.screen.height,t=Mt),i||(i=Mt,i.width=t.width,i.height=t.height));var u=this.viewportFrame;u.x=i.x*a,u.y=i.y*a,u.width=i.width*a,u.height=i.height*a,e||(u.y=n.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(o,u),this.renderer.projection.update(i,t,a,!o),e?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(i)},r.prototype.clear=function(e,t){this.current?e=e||this.current.baseTexture.clearColor:e=e||this.clearColor;var i=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer.screen,s=i.width!==n.width||i.height!==n.height;if(s){var o=this.viewportFrame,a=o.x,u=o.y,l=o.width,h=o.height;a=Math.round(a),u=Math.round(u),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,u,l,h)}this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],t),s&&this.renderer.scissor.pop()},r.prototype.resize=function(){this.bind(null)},r.prototype.reset=function(){this.bind(null)},r.prototype.destroy=function(){this.renderer=null},r}();function yg(r,e,t,i,n){t.buffer.update(n)}var _g={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},bh={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function bg(r){for(var e=r.map(function(u){return{data:u,offset:0,dataLen:0,dirty:0}}),t=0,i=0,n=0,s=0;s<e.length;s++){var o=e[s];if(t=bh[o.data.type],o.data.size>1&&(t=Math.max(t,16)*o.data.size),o.dataLen=t,i%t!==0&&i<16){var a=i%t%16;i+=a,n+=a}i+t>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=t,i=t):(o.offset=n,i+=t,n+=t)}return n=Math.ceil(n/16)*16,{uboElements:e,size:n}}function Eg(r,e){var t=[];for(var i in r)e[i]&&t.push(e[i]);return t.sort(function(n,s){return n.index-s.index}),t}function Ig(r,e){if(!r.autoManage)return{size:0,syncFunc:yg};for(var t=Eg(r.uniforms,e),i=bg(t),n=i.uboElements,s=i.size,o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],a=0;a<n.length;a++){for(var u=n[a],l=r.uniforms[u.data.name],h=u.data.name,c=!1,d=0;d<br.length;d++){var f=br[d];if(f.codeUbo&&f.test(u.data,l)){o.push("offset = "+u.offset/4+";",br[d].codeUbo(u.data.name,l)),c=!0;break}}if(!c)if(u.data.size>1){var p=gh(u.data.type),v=Math.max(bh[u.data.type]/16,1),m=p/v,y=(4-m%4)%4;o.push(`
                cv = ud.`+h+`.value;
                v = uv.`+h+`;
                offset = `+u.offset/4+`;

                t = 0;

                for(var i=0; i < `+u.data.size*v+`; i++)
                {
                    for(var j = 0; j < `+m+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+y+`;
                }

                `)}else{var _=_g[u.data.type];o.push(`
                cv = ud.`+h+`.value;
                v = uv.`+h+`;
                offset = `+u.offset/4+`;
                `+_+`;
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}var Tg=function(){function r(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return r.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},r}();function wg(r,e){for(var t={},i=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var s=e.getActiveAttrib(r,n);if(s.name.indexOf("gl_")!==0){var o=vh(e,s.type),a={type:o,name:s.name,size:gh(o),location:e.getAttribLocation(r,s.name)};t[s.name]=a}}return t}function xg(r,e){for(var t={},i=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),n=0;n<i;n++){var s=e.getActiveUniform(r,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),u=vh(e,s.type);t[o]={name:o,index:n,type:u,size:s.size,isArray:a,value:ph(u,s.size)}}return t}function Sg(r,e){var t=lu(r,r.VERTEX_SHADER,e.vertexSrc),i=lu(r,r.FRAGMENT_SHADER,e.fragmentSrc),n=r.createProgram();if(r.attachShader(n,t),r.attachShader(n,i),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS)||Xm(r,n,t,i),e.attributeData=wg(n,r),e.uniformData=xg(n,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){var s=Object.keys(e.attributeData);s.sort(function(h,c){return h>c?1:-1});for(var o=0;o<s.length;o++)e.attributeData[s[o]].location=o,r.bindAttribLocation(n,o,s[o]);r.linkProgram(n)}r.deleteShader(t),r.deleteShader(i);var a={};for(var o in e.uniformData){var u=e.uniformData[o];a[o]={location:r.getUniformLocation(n,o),value:ph(u.type,u.size)}}var l=new Tg(n,a);return l}var Cg=0,Ui={textureCount:0,uboCount:0},Ag=function(){function r(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Cg++}return r.prototype.systemCheck=function(){if(!rg())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},r.prototype.contextChange=function(e){this.gl=e,this.reset()},r.prototype.bind=function(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;var i=e.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),t||(Ui.textureCount=0,Ui.uboCount=0,this.syncUniformGroup(e.uniformGroup,Ui)),n},r.prototype.setUniforms=function(e){var t=this.shader.program,i=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(i.uniformData,e,this.renderer)},r.prototype.syncUniformGroup=function(e,t){var i=this.getGlProgram();(!e.static||e.dirtyId!==i.uniformDirtyGroups[e.id])&&(i.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,i,t))},r.prototype.syncUniforms=function(e,t,i){var n=e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e);n(t.uniformData,e.uniforms,this.renderer,i)},r.prototype.createSyncGroups=function(e){var t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=Zm(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]},r.prototype.syncUniformBufferGroup=function(e,t){var i=this.getGlProgram();if(!e.static||e.dirtyId!==0||!i.uniformGroups[e.id]){e.dirtyId=0;var n=i.uniformGroups[e.id]||this.createSyncBufferGroup(e,i,t);e.buffer.update(),n(i.uniformData,e.uniforms,this.renderer,Ui,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,i.uniformBufferBindings[t])},r.prototype.createSyncBufferGroup=function(e,t,i){var n=this.renderer.gl;this.renderer.buffer.bind(e.buffer);var s=this.gl.getUniformBlockIndex(t.program,i);t.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(t.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;var o=this.getSignature(e,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=Ig(e,this.shader.program.uniformData)),e.autoManage){var u=new Float32Array(a.size/4);e.buffer.update(u)}return t.uniformGroups[e.id]=a.syncFunc,t.uniformGroups[e.id]},r.prototype.getSignature=function(e,t,i){var n=e.uniforms,s=[i+"-"];for(var o in n)s.push(o),t[o]&&s.push(t[o].type);return s.join("-")},r.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},r.prototype.generateProgram=function(e){var t=this.gl,i=e.program,n=Sg(t,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n},r.prototype.reset=function(){this.program=null,this.shader=null},r.prototype.disposeShader=function(e){this.shader===e&&(this.shader=null)},r.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},r}();function Pg(r,e){return e===void 0&&(e=[]),e[S.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.ADD]=[r.ONE,r.ONE],e[S.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.NONE]=[0,0],e[S.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],e[S.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[S.SRC_IN]=[r.DST_ALPHA,r.ZERO],e[S.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],e[S.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],e[S.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],e[S.DST_IN]=[r.ZERO,r.SRC_ALPHA],e[S.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],e[S.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],e[S.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],e[S.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],e}var Rg=0,Mg=1,Og=2,Fg=3,Lg=4,Dg=5,Ng=function(){function r(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=S.NONE,this._blendEq=!1,this.map=[],this.map[Rg]=this.setBlend,this.map[Mg]=this.setOffset,this.map[Og]=this.setCullFace,this.map[Fg]=this.setDepthTest,this.map[Lg]=this.setFrontFace,this.map[Dg]=this.setDepthMask,this.checks=[],this.defaultState=new xo,this.defaultState.blend=!0}return r.prototype.contextChange=function(e){this.gl=e,this.blendModes=Pg(e),this.set(this.defaultState),this.reset()},r.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var t=this.stateId^e.data,i=0;t;)t&1&&this.map[i].call(this,!!(e.data&1<<i)),t=t>>1,i++;this.stateId=e.data}for(var i=0;i<this.checks.length;i++)this.checks[i](this,e)},r.prototype.forceState=function(e){e=e||this.defaultState;for(var t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(var t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data},r.prototype.setBlend=function(e){this.updateCheck(r.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},r.prototype.setOffset=function(e){this.updateCheck(r.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},r.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},r.prototype.setDepthMask=function(e){this.gl.depthMask(e)},r.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},r.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},r.prototype.setBlendMode=function(e){if(e!==this.blendMode){this.blendMode=e;var t=this.blendModes[e],i=this.gl;t.length===2?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},r.prototype.setPolygonOffset=function(e,t){this.gl.polygonOffset(e,t)},r.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},r.prototype.updateCheck=function(e,t){var i=this.checks.indexOf(e);t&&i===-1?this.checks.push(e):!t&&i!==-1&&this.checks.splice(i,1)},r.checkBlendMode=function(e,t){e.setBlendMode(t.blendMode)},r.checkPolygonOffset=function(e,t){e.setPolygonOffset(1,t.polygonOffset)},r.prototype.destroy=function(){this.gl=null},r}(),kg=function(){function r(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=x.GC_MAX_IDLE,this.checkCountMax=x.GC_MAX_CHECK_COUNT,this.mode=x.GC_MODE}return r.prototype.postrender=function(){!this.renderer.renderingToScreen||(this.count++,this.mode!==nn.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},r.prototype.run=function(){for(var e=this.renderer.texture,t=e.managedTextures,i=!1,n=0;n<t.length;n++){var s=t[n];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(e.destroyTexture(s,!0),t[n]=null,i=!0)}if(i){for(var o=0,n=0;n<t.length;n++)t[n]!==null&&(t[o++]=t[n]);t.length=o}},r.prototype.unload=function(e){var t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(var n=e.children.length-1;n>=0;n--)this.unload(e.children[n])},r.prototype.destroy=function(){this.renderer=null},r}();function Bg(r){var e,t,i,n,s,o,a,u,l,h,c,d,f,p,v,m,y,_,g,b,I,T,R;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?R=(e={},e[F.UNSIGNED_BYTE]=(t={},t[E.RGBA]=r.RGBA8,t[E.RGB]=r.RGB8,t[E.RG]=r.RG8,t[E.RED]=r.R8,t[E.RGBA_INTEGER]=r.RGBA8UI,t[E.RGB_INTEGER]=r.RGB8UI,t[E.RG_INTEGER]=r.RG8UI,t[E.RED_INTEGER]=r.R8UI,t[E.ALPHA]=r.ALPHA,t[E.LUMINANCE]=r.LUMINANCE,t[E.LUMINANCE_ALPHA]=r.LUMINANCE_ALPHA,t),e[F.BYTE]=(i={},i[E.RGBA]=r.RGBA8_SNORM,i[E.RGB]=r.RGB8_SNORM,i[E.RG]=r.RG8_SNORM,i[E.RED]=r.R8_SNORM,i[E.RGBA_INTEGER]=r.RGBA8I,i[E.RGB_INTEGER]=r.RGB8I,i[E.RG_INTEGER]=r.RG8I,i[E.RED_INTEGER]=r.R8I,i),e[F.UNSIGNED_SHORT]=(n={},n[E.RGBA_INTEGER]=r.RGBA16UI,n[E.RGB_INTEGER]=r.RGB16UI,n[E.RG_INTEGER]=r.RG16UI,n[E.RED_INTEGER]=r.R16UI,n[E.DEPTH_COMPONENT]=r.DEPTH_COMPONENT16,n),e[F.SHORT]=(s={},s[E.RGBA_INTEGER]=r.RGBA16I,s[E.RGB_INTEGER]=r.RGB16I,s[E.RG_INTEGER]=r.RG16I,s[E.RED_INTEGER]=r.R16I,s),e[F.UNSIGNED_INT]=(o={},o[E.RGBA_INTEGER]=r.RGBA32UI,o[E.RGB_INTEGER]=r.RGB32UI,o[E.RG_INTEGER]=r.RG32UI,o[E.RED_INTEGER]=r.R32UI,o[E.DEPTH_COMPONENT]=r.DEPTH_COMPONENT24,o),e[F.INT]=(a={},a[E.RGBA_INTEGER]=r.RGBA32I,a[E.RGB_INTEGER]=r.RGB32I,a[E.RG_INTEGER]=r.RG32I,a[E.RED_INTEGER]=r.R32I,a),e[F.FLOAT]=(u={},u[E.RGBA]=r.RGBA32F,u[E.RGB]=r.RGB32F,u[E.RG]=r.RG32F,u[E.RED]=r.R32F,u[E.DEPTH_COMPONENT]=r.DEPTH_COMPONENT32F,u),e[F.HALF_FLOAT]=(l={},l[E.RGBA]=r.RGBA16F,l[E.RGB]=r.RGB16F,l[E.RG]=r.RG16F,l[E.RED]=r.R16F,l),e[F.UNSIGNED_SHORT_5_6_5]=(h={},h[E.RGB]=r.RGB565,h),e[F.UNSIGNED_SHORT_4_4_4_4]=(c={},c[E.RGBA]=r.RGBA4,c),e[F.UNSIGNED_SHORT_5_5_5_1]=(d={},d[E.RGBA]=r.RGB5_A1,d),e[F.UNSIGNED_INT_2_10_10_10_REV]=(f={},f[E.RGBA]=r.RGB10_A2,f[E.RGBA_INTEGER]=r.RGB10_A2UI,f),e[F.UNSIGNED_INT_10F_11F_11F_REV]=(p={},p[E.RGB]=r.R11F_G11F_B10F,p),e[F.UNSIGNED_INT_5_9_9_9_REV]=(v={},v[E.RGB]=r.RGB9_E5,v),e[F.UNSIGNED_INT_24_8]=(m={},m[E.DEPTH_STENCIL]=r.DEPTH24_STENCIL8,m),e[F.FLOAT_32_UNSIGNED_INT_24_8_REV]=(y={},y[E.DEPTH_STENCIL]=r.DEPTH32F_STENCIL8,y),e):R=(_={},_[F.UNSIGNED_BYTE]=(g={},g[E.RGBA]=r.RGBA,g[E.RGB]=r.RGB,g[E.ALPHA]=r.ALPHA,g[E.LUMINANCE]=r.LUMINANCE,g[E.LUMINANCE_ALPHA]=r.LUMINANCE_ALPHA,g),_[F.UNSIGNED_SHORT_5_6_5]=(b={},b[E.RGB]=r.RGB,b),_[F.UNSIGNED_SHORT_4_4_4_4]=(I={},I[E.RGBA]=r.RGBA,I),_[F.UNSIGNED_SHORT_5_5_5_1]=(T={},T[E.RGBA]=r.RGBA,T),_),R}var ls=function(){function r(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=F.UNSIGNED_BYTE,this.internalFormat=E.RGBA,this.samplerType=0}return r}(),Ug=function(){function r(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ee,this.hasIntegerTextures=!1}return r.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Bg(e);var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(var i=0;i<t;i++)this.boundTextures[i]=null;this.emptyTextures={};var n=new ls(e.createTexture());e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new ls(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var i=0;i<this.boundTextures.length;i++)this.bind(null,i)},r.prototype.bind=function(e,t){t===void 0&&(t=0);var i=this.gl;if(e=e?.castToBaseTexture(),e&&e.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;var n=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(e.target,n.texture)),n.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),this.updateTexture(e)):n.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[t]=null},r.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},r.prototype.unbind=function(e){var t=this,i=t.gl,n=t.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var s=0;s<n.length;s++)n[s]===this.unknownTexture&&this.bind(null,s)}for(var s=0;s<n.length;s++)n[s]===e&&(this.currentLocation!==s&&(i.activeTexture(i.TEXTURE0+s),this.currentLocation=s),i.bindTexture(e.target,this.emptyTextures[e.target].texture),n[s]=null)},r.prototype.ensureSamplerType=function(e){var t=this,i=t.boundTextures,n=t.hasIntegerTextures,s=t.CONTEXT_UID;if(!!n)for(var o=e-1;o>=0;--o){var a=i[o];if(a){var u=a._glTextures[s];u.samplerType!==tn.FLOAT&&this.renderer.texture.unbind(a)}}},r.prototype.initTexture=function(e){var t=new ls(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t},r.prototype.initTextureType=function(e,t){var i,n;t.internalFormat=(n=(i=this.internalFormats[e.type])===null||i===void 0?void 0:i[e.format])!==null&&n!==void 0?n:e.format,this.webGLVersion===2&&e.type===F.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type},r.prototype.updateTexture=function(e){var t=e._glTextures[this.CONTEXT_UID];if(!!t){var i=this.renderer;if(this.initTextureType(e,t),e.resource&&e.resource.upload(i,e,t))t.samplerType!==tn.FLOAT&&(this.hasIntegerTextures=!0);else{var n=e.realWidth,s=e.realHeight,o=i.gl;(t.width!==n||t.height!==s||t.dirtyId<0)&&(t.width=n,t.height=s,o.texImage2D(e.target,0,t.internalFormat,n,s,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}},r.prototype.destroyTexture=function(e,t){var i=this.gl;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){var n=this.managedTextures.indexOf(e);n!==-1&&Wi(this.managedTextures,n,1)}},r.prototype.updateTextureStyle=function(e){var t=e._glTextures[this.CONTEXT_UID];!t||((e.mipmap===Tt.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=rn.CLAMP:t.wrapMode=e.wrapMode,e.resource&&e.resource.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)},r.prototype.setStyle=function(e,t){var i=this.gl;if(t.mipmap&&e.mipmap!==Tt.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===Xe.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===Xe.LINEAR){var s=Math.min(e.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===Xe.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===Xe.LINEAR?i.LINEAR:i.NEAREST)},r.prototype.destroy=function(){this.renderer=null},r}(),hs=new ue,Gg=function(r){G(e,r);function e(t,i){t===void 0&&(t=ti.UNKNOWN);var n=r.call(this)||this;return i=Object.assign({},x.RENDER_OPTIONS,i),n.options=i,n.type=t,n.screen=new K(0,0,i.width,i.height),n.view=i.view||x.ADAPTER.createCanvas(),n.resolution=i.resolution||x.RESOLUTION,n.useContextAlpha=i.useContextAlpha,n.autoDensity=!!i.autoDensity,n.preserveDrawingBuffer=i.preserveDrawingBuffer,n.clearBeforeRender=i.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,1],n._backgroundColorString="#000000",n.backgroundColor=i.backgroundColor||n._backgroundColor,n.backgroundAlpha=i.backgroundAlpha,i.transparent!==void 0&&(Zt("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),n.useContextAlpha=i.transparent,n.backgroundAlpha=i.transparent?0:1),n._lastObjectRendered=null,n.plugins={},n}return e.prototype.initPlugins=function(t){for(var i in t)this.plugins[i]=new t[i](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,i){this.view.width=Math.round(t*this.resolution),this.view.height=Math.round(i*this.resolution);var n=this.view.width/this.resolution,s=this.view.height/this.resolution;this.screen.width=n,this.screen.height=s,this.autoDensity&&(this.view.style.width=n+"px",this.view.style.height=s+"px"),this.emit("resize",n,s)},e.prototype.generateTexture=function(t,i,n,s){i===void 0&&(i={}),typeof i=="number"&&(Zt("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),i={scaleMode:i,resolution:n,region:s});var o=i.region,a=_m(i,["region"]);s=o||t.getLocalBounds(null,!0),s.width===0&&(s.width=1),s.height===0&&(s.height=1);var u=Io.create(Xs({width:s.width,height:s.height},a));return hs.tx=-s.x,hs.ty=-s.y,this.render(t,{renderTexture:u,clear:!1,transform:hs,skipUpdateTransform:!!t.parent}),u},e.prototype.destroy=function(t){for(var i in this.plugins)this.plugins[i].destroy(),this.plugins[i]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=ti.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=um(t),am(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),e}(Ct),Vg=function(){function r(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return r}(),Hg=function(){function r(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}return r.prototype.destroy=function(){this.renderer=null},r.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},r.prototype.bind=function(e){var t=this,i=t.gl,n=t.CONTEXT_UID,s=e._glBuffers[n]||this.createGLBuffer(e);i.bindBuffer(e.type,s.buffer)},r.prototype.bindBufferBase=function(e,t){var i=this,n=i.gl,s=i.CONTEXT_UID;if(this.boundBufferBases[t]!==e){var o=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[t]=e,n.bindBufferBase(n.UNIFORM_BUFFER,t,o.buffer)}},r.prototype.bindBufferRange=function(e,t,i){var n=this,s=n.gl,o=n.CONTEXT_UID;i=i||0;var a=e._glBuffers[o]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,t||0,a.buffer,i*256,256)},r.prototype.update=function(e){var t=this,i=t.gl,n=t.CONTEXT_UID,s=e._glBuffers[n];if(e._updateID!==s.updateID)if(s.updateID=e._updateID,i.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)i.bufferSubData(e.type,0,e.data);else{var o=e.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,i.bufferData(e.type,e.data,o)}},r.prototype.dispose=function(e,t){if(!!this.managedBuffers[e.id]){delete this.managedBuffers[e.id];var i=e._glBuffers[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this),i&&(t||n.deleteBuffer(i.buffer),delete e._glBuffers[this.CONTEXT_UID])}},r.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedBuffers),i=0;i<t.length;i++)this.dispose(this.managedBuffers[t[i]],e)},r.prototype.createGLBuffer=function(e){var t=this,i=t.CONTEXT_UID,n=t.gl;return e._glBuffers[i]=new Vg(n.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[i]},r}(),So=function(r){G(e,r);function e(t){var i=r.call(this,ti.WEBGL,t)||this;return t=i.options,i.gl=null,i.CONTEXT_UID=0,i.runners={destroy:new oe("destroy"),contextChange:new oe("contextChange"),reset:new oe("reset"),update:new oe("update"),postrender:new oe("postrender"),prerender:new oe("prerender"),resize:new oe("resize")},i.runners.contextChange.add(i),i.globalUniforms=new _r({projectionMatrix:new ue},!0),i.addSystem(fg,"mask").addSystem(Gm,"context").addSystem(Ng,"state").addSystem(Ag,"shader").addSystem(Ug,"texture").addSystem(Hg,"buffer").addSystem($m,"geometry").addSystem(jm,"framebuffer").addSystem(pg,"scissor").addSystem(mg,"stencil").addSystem(gg,"projection").addSystem(kg,"textureGC").addSystem(Bm,"filter").addSystem(vg,"renderTexture").addSystem(Um,"batch"),i.initPlugins(e.__plugins),i.multisample=void 0,t.context?i.context.initFromContext(t.context):i.context.initFromOptions({alpha:!!i.useContextAlpha,antialias:t.antialias,premultipliedAlpha:i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:i.options.powerPreference}),i.renderingToScreen=!0,sm(i.context.webGLVersion===2?"WebGL 2":"WebGL 1"),i.resize(i.options.width,i.options.height),i}return e.create=function(t){if(om())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.contextChange=function(){var t=this.gl,i;if(this.context.webGLVersion===1){var n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),i=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,n)}else{var n=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),i=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n)}i>=q.HIGH?this.multisample=q.HIGH:i>=q.MEDIUM?this.multisample=q.MEDIUM:i>=q.LOW?this.multisample=q.LOW:this.multisample=q.NONE},e.prototype.addSystem=function(t,i){var n=new t(this);if(this[i])throw new Error('Whoops! The name "'+i+'" is already in use');this[i]=n;for(var s in this.runners)this.runners[s].add(n);return this},e.prototype.render=function(t,i){var n,s,o,a;if(i&&(i instanceof Io?(Zt("6.0.0","Renderer#render arguments changed, use options instead."),n=i,s=arguments[2],o=arguments[3],a=arguments[4]):(n=i.renderTexture,s=i.clear,o=i.transform,a=i.skipUpdateTransform)),this.renderingToScreen=!n,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=o,!this.context.isLost){if(n||(this._lastObjectRendered=t),!a){var u=t.enableTempParent();t.updateTransform(),t.disableTempParent(u)}this.renderTexture.bind(n),this.batch.currentRenderer.start(),(s!==void 0?s:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),n&&n.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.generateTexture=function(t,i,n,s){i===void 0&&(i={});var o=r.prototype.generateTexture.call(this,t,i,n,s);return this.framebuffer.blit(),o},e.prototype.resize=function(t,i){r.prototype.resize.call(this,t,i),this.runners.resize.emit(this.screen.height,this.screen.width)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(t){this.runners.destroy.emit();for(var i in this.runners)this.runners[i].destroy();r.prototype.destroy.call(this,t),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return Zt("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(t,i){Zt("6.5.0","Renderer.registerPlugin() has been deprecated, please use extensions.add() instead."),yi.add({name:t,type:Me.RendererPlugin,ref:i})},e.__plugins={},e}(Gg);yi.handleByMap(Me.RendererPlugin,So.__plugins);function jg(r){return So.create(r)}var $g=function(){function r(){this.texArray=null,this.blend=0,this.type=ri.TRIANGLES,this.start=0,this.size=0,this.data=null}return r}(),zg=function(){function r(){this.elements=[],this.ids=[],this.count=0}return r.prototype.clear=function(){for(var e=0;e<this.count;e++)this.elements[e]=null;this.count=0},r}(),Xg=function(){function r(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(r.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),r.prototype.view=function(e){return this[e+"View"]},r.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},r.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},r}(),Wg=function(r){G(e,r);function e(t){var i=r.call(this,t)||this;return i.shaderGenerator=null,i.geometryClass=null,i.vertexSize=null,i.state=xo.for2d(),i.size=x.SPRITE_BATCH_SIZE*4,i._vertexCount=0,i._indexCount=0,i._bufferedElements=[],i._bufferedTextures=[],i._bufferSize=0,i._shader=null,i._packedGeometries=[],i._packedGeometryPoolSize=2,i._flushId=0,i._aBuffers={},i._iBuffers={},i.MAX_TEXTURES=1,i.renderer.on("prerender",i.onPrerender,i),t.runners.contextChange.add(i),i._dcIndex=0,i._aIndex=0,i._iIndex=0,i._attributeBuffer=null,i._indexBuffer=null,i._tempBoundTextures=[],i}return e.prototype.contextChange=function(){var t=this.renderer.gl;x.PREFER_ENV===st.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),x.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=tg(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,i=e._textureArrayPool,n=this.size/4,s=Math.floor(n/this.MAX_TEXTURES)+1;t.length<n;)t.push(new $g);for(;i.length<s;)i.push(new zg);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){!t._texture.valid||(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this,i=t._bufferedTextures,n=t.MAX_TEXTURES,s=e._textureArrayPool,o=this.renderer.batch,a=this._tempBoundTextures,u=this.renderer.textureGC.count,l=++ee._globalBatch,h=0,c=s[0],d=0;o.copyBoundTextures(a,n);for(var f=0;f<this._bufferSize;++f){var p=i[f];i[f]=null,p._batchEnabled!==l&&(c.count>=n&&(o.boundArray(c,a,l,n),this.buildDrawCalls(c,d,f),d=f,c=s[++h],++l),p._batchEnabled=l,p.touched=u,c.elements[c.count++]=p)}c.count>0&&(o.boundArray(c,a,l,n),this.buildDrawCalls(c,d,this._bufferSize),++h,++l);for(var f=0;f<a.length;f++)a[f]=null;ee._globalBatch=l},e.prototype.buildDrawCalls=function(t,i,n){var s=this,o=s._bufferedElements,a=s._attributeBuffer,u=s._indexBuffer,l=s.vertexSize,h=e._drawCallPool,c=this._dcIndex,d=this._aIndex,f=this._iIndex,p=h[c];p.start=this._iIndex,p.texArray=t;for(var v=i;v<n;++v){var m=o[v],y=m._texture.baseTexture,_=hm[y.alphaMode?1:0][m.blendMode];o[v]=null,i<v&&p.blend!==_&&(p.size=f-p.start,i=v,p=h[++c],p.texArray=t,p.start=f),this.packInterleavedGeometry(m,a,u,d,f),d+=m.vertexData.length/2*l,f+=m.indices.length,p.blend=_}i<n&&(p.size=f-p.start,++c),this._dcIndex=c,this._aIndex=d,this._iIndex=f},e.prototype.bindAndClearTexArray=function(t){for(var i=this.renderer.texture,n=0;n<t.count;n++)i.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this,i=t._packedGeometries,n=t._attributeBuffer,s=t._indexBuffer;x.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(n.rawBinaryData),i[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(n.rawBinaryData),i[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,i=this.renderer,n=i.gl,s=i.state,o=e._drawCallPool,a=null,u=0;u<t;u++){var l=o[u],h=l.texArray,c=l.type,d=l.size,f=l.start,p=l.blend;a!==h&&(a=h,this.bindAndClearTexArray(h)),this.state.blendMode=p,s.set(this.state),n.drawElements(c,d,n.UNSIGNED_SHORT,f*2)}},e.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),x.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),r.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var i=ln(Math.ceil(t/8)),n=eu(i),s=i*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._aBuffers[s];return o||(this._aBuffers[s]=o=new Xg(s*this.vertexSize*4)),o},e.prototype.getIndexBuffer=function(t){var i=ln(Math.ceil(t/12)),n=eu(i),s=i*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._iBuffers[n];return o||(this._iBuffers[n]=o=new Uint16Array(s)),o},e.prototype.packInterleavedGeometry=function(t,i,n,s,o){for(var a=i.uint32View,u=i.float32View,l=s/this.vertexSize,h=t.uvs,c=t.indices,d=t.vertexData,f=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),v=p<1&&t._texture.baseTexture.alphaMode?cm(t._tintRGB,p):t._tintRGB+(p*255<<24),m=0;m<d.length;m+=2)u[s++]=d[m],u[s++]=d[m+1],u[s++]=h[m],u[s++]=h[m+1],a[s++]=v,u[s++]=f;for(var m=0;m<c.length;m++)n[o++]=l+c[m]},e._drawCallPool=[],e._textureArrayPool=[],e}(fh),Yg=function(){function r(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},t.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(t.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return r.prototype.generateShader=function(e){if(!this.programCache[e]){for(var t=new Int32Array(e),i=0;i<e;i++)t[i]=i;this.defaultGroupCache[e]=_r.from({uSamplers:t},!0);var n=this.fragTemplate;n=n.replace(/%count%/gi,""+e),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new wo(this.vertexSrc,n)}var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new ue,default:this.defaultGroupCache[e]};return new yh(this.programCache[e],s)},r.prototype.generateSampleSrc=function(e){var t="";t+=`
`,t+=`
`;for(var i=0;i<e;i++)i>0&&(t+=`
else `),i<e-1&&(t+="if(vTextureId < "+i+".5)"),t+=`
{`,t+=`
	color = texture2D(uSamplers[`+i+"], vTextureCoord);",t+=`
}`;return t+=`
`,t+=`
`,t},r}(),qg=function(r){G(e,r);function e(t){t===void 0&&(t=!1);var i=r.call(this)||this;return i._buffer=new Ie(null,t,!1),i._indexBuffer=new Ie(null,t,!0),i.addAttribute("aVertexPosition",i._buffer,2,!1,F.FLOAT).addAttribute("aTextureCoord",i._buffer,2,!1,F.FLOAT).addAttribute("aColor",i._buffer,4,!0,F.UNSIGNED_BYTE).addAttribute("aTextureId",i._buffer,1,!0,F.FLOAT).addIndex(i._indexBuffer),i}return e}(To),gu=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,vu=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Kg=function(){function r(){}return r.create=function(e){var t=Object.assign({vertex:gu,fragment:vu,geometryClass:qg,vertexSize:6},e),i=t.vertex,n=t.fragment,s=t.vertexSize,o=t.geometryClass;return function(a){G(u,a);function u(l){var h=a.call(this,l)||this;return h.shaderGenerator=new Yg(i,n),h.geometryClass=o,h.vertexSize=s,h}return u}(Wg)},Object.defineProperty(r,"defaultVertexSrc",{get:function(){return gu},enumerable:!1,configurable:!0}),Object.defineProperty(r,"defaultFragmentTemplate",{get:function(){return vu},enumerable:!1,configurable:!0}),r}(),Jg=Kg.create();Object.assign(Jg,{extension:{name:"batch",type:Me.RendererPlugin}});/*!
 * @pixi/display - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/display is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */x.SORTABLE_CHILDREN=!1;var yu=function(){function r(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return r.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},r.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},r.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?K.EMPTY:(e=e||new K(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},r.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},r.prototype.addPointMatrix=function(e,t){var i=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,u=e.ty,l=i*t.x+s*t.y+a,h=n*t.x+o*t.y+u;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)},r.prototype.addQuad=function(e){var t=this.minX,i=this.minY,n=this.maxX,s=this.maxY,o=e[0],a=e[1];t=o<t?o:t,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=e[2],a=e[3],t=o<t?o:t,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=e[4],a=e[5],t=o<t?o:t,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=e[6],a=e[7],t=o<t?o:t,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,this.minX=t,this.minY=i,this.maxX=n,this.maxY=s},r.prototype.addFrame=function(e,t,i,n,s){this.addFrameMatrix(e.worldTransform,t,i,n,s)},r.prototype.addFrameMatrix=function(e,t,i,n,s){var o=e.a,a=e.b,u=e.c,l=e.d,h=e.tx,c=e.ty,d=this.minX,f=this.minY,p=this.maxX,v=this.maxY,m=o*t+u*i+h,y=a*t+l*i+c;d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,v=y>v?y:v,m=o*n+u*i+h,y=a*n+l*i+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,v=y>v?y:v,m=o*t+u*s+h,y=a*t+l*s+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,v=y>v?y:v,m=o*n+u*s+h,y=a*n+l*s+c,d=m<d?m:d,f=y<f?y:f,p=m>p?m:p,v=y>v?y:v,this.minX=d,this.minY=f,this.maxX=p,this.maxY=v},r.prototype.addVertexData=function(e,t,i){for(var n=this.minX,s=this.minY,o=this.maxX,a=this.maxY,u=t;u<i;u+=2){var l=e[u],h=e[u+1];n=l<n?l:n,s=h<s?h:s,o=l>o?l:o,a=h>a?h:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a},r.prototype.addVertices=function(e,t,i,n){this.addVerticesMatrix(e.worldTransform,t,i,n)},r.prototype.addVerticesMatrix=function(e,t,i,n,s,o){s===void 0&&(s=0),o===void 0&&(o=s);for(var a=e.a,u=e.b,l=e.c,h=e.d,c=e.tx,d=e.ty,f=this.minX,p=this.minY,v=this.maxX,m=this.maxY,y=i;y<n;y+=2){var _=t[y],g=t[y+1],b=a*_+l*g+c,I=h*g+u*_+d;f=Math.min(f,b-s),v=Math.max(v,b+s),p=Math.min(p,I-o),m=Math.max(m,I+o)}this.minX=f,this.minY=p,this.maxX=v,this.maxY=m},r.prototype.addBounds=function(e){var t=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<i?e.minY:i,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>s?e.maxY:s},r.prototype.addBoundsMask=function(e,t){var i=e.minX>t.minX?e.minX:t.minX,n=e.minY>t.minY?e.minY:t.minY,s=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(i<=s&&n<=o){var a=this.minX,u=this.minY,l=this.maxX,h=this.maxY;this.minX=i<a?i:a,this.minY=n<u?n:u,this.maxX=s>l?s:l,this.maxY=o>h?o:h}},r.prototype.addBoundsMatrix=function(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)},r.prototype.addBoundsArea=function(e,t){var i=e.minX>t.x?e.minX:t.x,n=e.minY>t.y?e.minY:t.y,s=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(i<=s&&n<=o){var a=this.minX,u=this.minY,l=this.maxX,h=this.maxY;this.minX=i<a?i:a,this.minY=n<u?n:u,this.maxX=s>l?s:l,this.maxY=o>h?o:h}},r.prototype.pad=function(e,t){e===void 0&&(e=0),t===void 0&&(t=e),this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)},r.prototype.addFramePad=function(e,t,i,n,s,o){e-=s,t-=o,i+=s,n+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>n?this.maxY:n},r}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ys=function(r,e){return Ys=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])},Ys(r,e)};function Co(r,e){Ys(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ui=function(r){Co(e,r);function e(){var t=r.call(this)||this;return t.tempDisplayObjectParent=null,t.transform=new ah,t.alpha=1,t.visible=!0,t.renderable=!0,t.cullable=!1,t.cullArea=null,t.parent=null,t.worldAlpha=1,t._lastSortedIndex=0,t._zIndex=0,t.filterArea=null,t.filters=null,t._enabledFilters=null,t._bounds=new yu,t._localBounds=null,t._boundsID=0,t._boundsRect=null,t._localBoundsRect=null,t._mask=null,t._maskRefCount=0,t._destroyed=!1,t.isSprite=!1,t.isMask=!1,t}return e.mixin=function(t){for(var i=Object.keys(t),n=0;n<i.length;++n){var s=i[n];Object.defineProperty(e.prototype,s,Object.getOwnPropertyDescriptor(t,s))}},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,i){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new K),i=this._boundsRect),this._bounds.getRectangle(i)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new K),t=this._localBoundsRect),this._localBounds||(this._localBounds=new yu);var i=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;var a=this.getBounds(!1,t);return this.parent=n,this.transform=i,this._bounds=s,this._bounds.updateID+=this._boundsID-o,a},e.prototype.toGlobal=function(t,i,n){return n===void 0&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,i)},e.prototype.toLocal=function(t,i,n,s){return i&&(t=i.toGlobal(t,n,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,i,n,s,o,a,u,l,h){return t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=1),s===void 0&&(s=1),o===void 0&&(o=0),a===void 0&&(a=0),u===void 0&&(u=0),l===void 0&&(l=0),h===void 0&&(h=0),this.position.x=t,this.position.y=i,this.scale.x=n||1,this.scale.y=s||1,this.rotation=o,this.skew.x=a,this.skew.y=u,this.pivot.x=l,this.pivot.y=h,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Eh),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*gm},set:function(t){this.transform.rotation=t*vm},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){if(this._mask!==t){if(this._mask){var i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=t,this._mask){var i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}},enumerable:!1,configurable:!0}),e}(Ct),Eh=function(r){Co(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.sortDirty=null,t}return e}(ui);ui.prototype.displayObjectUpdateTransform=ui.prototype.updateTransform;function Zg(r,e){return r.zIndex===e.zIndex?r._lastSortedIndex-e._lastSortedIndex:r.zIndex-e.zIndex}var hn=function(r){Co(e,r);function e(){var t=r.call(this)||this;return t.children=[],t.sortableChildren=x.SORTABLE_CHILDREN,t.sortDirty=!1,t}return e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,i=[],n=0;n<arguments.length;n++)i[n]=t[n];if(i.length>1)for(var s=0;s<i.length;s++)this.addChild(i[s]);else{var o=i[0];o.parent&&o.parent.removeChild(o),o.parent=this,this.sortDirty=!0,o.transform._parentID=-1,this.children.push(o),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",o,this,this.children.length-1),o.emit("added",this)}return i[0]},e.prototype.addChildAt=function(t,i){if(i<0||i>this.children.length)throw new Error(t+"addChildAt: The index "+i+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(i,0,t),this._boundsID++,this.onChildrenChange(i),t.emit("added",this),this.emit("childAdded",t,this,i),t},e.prototype.swapChildren=function(t,i){if(t!==i){var n=this.getChildIndex(t),s=this.getChildIndex(i);this.children[n]=i,this.children[s]=t,this.onChildrenChange(n<s?n:s)}},e.prototype.getChildIndex=function(t){var i=this.children.indexOf(t);if(i===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return i},e.prototype.setChildIndex=function(t,i){if(i<0||i>=this.children.length)throw new Error("The index "+i+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(t);Wi(this.children,n,1),this.children.splice(i,0,t),this.onChildrenChange(i)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,i=[],n=0;n<arguments.length;n++)i[n]=t[n];if(i.length>1)for(var s=0;s<i.length;s++)this.removeChild(i[s]);else{var o=i[0],a=this.children.indexOf(o);if(a===-1)return null;o.parent=null,o.transform._parentID=-1,Wi(this.children,a,1),this._boundsID++,this.onChildrenChange(a),o.emit("removed",this),this.emit("childRemoved",o,this,a)}return i[0]},e.prototype.removeChildAt=function(t){var i=this.getChildAt(t);return i.parent=null,i.transform._parentID=-1,Wi(this.children,t,1),this._boundsID++,this.onChildrenChange(t),i.emit("removed",this),this.emit("childRemoved",i,this,t),i},e.prototype.removeChildren=function(t,i){t===void 0&&(t=0),i===void 0&&(i=this.children.length);var n=t,s=i,o=s-n,a;if(o>0&&o<=s){a=this.children.splice(n,o);for(var u=0;u<a.length;++u)a[u].parent=null,a[u].transform&&(a[u].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var u=0;u<a.length;++u)a[u].emit("removed",this),this.emit("childRemoved",a[u],this,u);return a}else if(o===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,i=0,n=this.children.length;i<n;++i){var s=this.children[i];s._lastSortedIndex=i,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(Zg),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,i=this.children.length;t<i;++t){var n=this.children[t];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var i=this.children[t];if(!(!i.visible||!i.renderable))if(i.calculateBounds(),i._mask){var n=i._mask.isMaskData?i._mask.maskObject:i._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(i._bounds,n._bounds)):this._bounds.addBounds(i._bounds)}else i.filterArea?this._bounds.addBoundsArea(i._bounds,i.filterArea):this._bounds.addBounds(i._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(t,i){i===void 0&&(i=!1);var n=r.prototype.getLocalBounds.call(this,t);if(!i)for(var s=0,o=this.children.length;s<o;++s){var a=this.children[s];a.visible&&a.updateTransform()}return n},e.prototype._calculateBounds=function(){},e.prototype._renderWithCulling=function(t){var i=t.renderTexture.sourceFrame;if(i.width>0&&i.height>0){var n,s;if(this.cullArea?(n=this.cullArea,s=this.worldTransform):this._render!==e.prototype._render&&(n=this.getBounds(!0)),n&&i.intersects(n,s))this._render(t);else if(this.cullArea)return;for(var o=0,a=this.children.length;o<a;++o){var u=this.children[o],l=u.cullable;u.cullable=l||!this.cullArea,u.render(t),u.cullable=l}}},e.prototype.render=function(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(var i=0,n=this.children.length;i<n;++i)this.children[i].render(t)}},e.prototype.renderAdvanced=function(t){var i=this.filters,n=this._mask;if(i){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var s=0;s<i.length;s++)i[s].enabled&&this._enabledFilters.push(i[s])}var o=i&&this._enabledFilters&&this._enabledFilters.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==J.NONE));if(o&&t.batch.flush(),i&&this._enabledFilters&&this._enabledFilters.length&&t.filter.push(this,this._enabledFilters),n&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(var s=0,a=this.children.length;s<a;++s)this.children[s].render(t)}o&&t.batch.flush(),n&&t.mask.pop(this),i&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(t){r.prototype.destroy.call(this),this.sortDirty=!1;var i=typeof t=="boolean"?t:t&&t.children,n=this.removeChildren(0,this.children.length);if(i)for(var s=0;s<n.length;++s)n[s].destroy(t)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var i=this.getLocalBounds().width;i!==0?this.scale.x=t/i:this.scale.x=1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var i=this.getLocalBounds().height;i!==0?this.scale.y=t/i:this.scale.y=1,this._height=t},enumerable:!1,configurable:!0}),e}(ui);hn.prototype.containerUpdateTransform=hn.prototype.updateTransform;/*!
 * @pixi/app - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/app is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Qg=function(){function r(){}return r.init=function(e){var t=this;Object.defineProperty(this,"resizeTo",{set:function(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){!t._resizeTo||(t.cancelResize(),t._resizeId=requestAnimationFrame(function(){return t.resize()}))},this.cancelResize=function(){t._resizeId&&(cancelAnimationFrame(t._resizeId),t._resizeId=null)},this.resize=function(){if(!!t._resizeTo){t.cancelResize();var i,n;if(t._resizeTo===globalThis.window)i=globalThis.innerWidth,n=globalThis.innerHeight;else{var s=t._resizeTo,o=s.clientWidth,a=s.clientHeight;i=o,n=a}t.renderer.resize(i,n)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null},r.destroy=function(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},r.extension=Me.Application,r}(),Ao=function(){function r(e){var t=this;this.stage=new hn,e=Object.assign({forceCanvas:!1},e),this.renderer=jg(e),r._plugins.forEach(function(i){i.init.call(t,e)})}return r.registerPlugin=function(e){Zt("6.5.0","Application.registerPlugin() is deprecated, use extensions.add()"),yi.add({type:Me.Application,ref:e})},r.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(r.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),r.prototype.destroy=function(e,t){var i=this,n=r._plugins.slice(0);n.reverse(),n.forEach(function(s){s.destroy.call(i)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null},r._plugins=[],r}();yi.handleByList(Me.Application,Ao._plugins);yi.add(Qg);/*!
 * @pixi/interaction - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/interaction is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var _u=function(){function r(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new me,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(r.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),r.prototype.getLocalPosition=function(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)},r.prototype.copyEvent=function(e){"isPrimary"in e&&e.isPrimary&&(this.isPrimary=!0),this.button="button"in e&&e.button;var t="buttons"in e&&e.buttons;this.buttons=Number.isInteger(t)?t:"which"in e&&e.which,this.width="width"in e&&e.width,this.height="height"in e&&e.height,this.tiltX="tiltX"in e&&e.tiltX,this.tiltY="tiltY"in e&&e.tiltY,this.pointerType="pointerType"in e&&e.pointerType,this.pressure="pressure"in e&&e.pressure,this.rotationAngle="rotationAngle"in e&&e.rotationAngle,this.twist="twist"in e&&e.twist||0,this.tangentialPressure="tangentialPressure"in e&&e.tangentialPressure||0},r.prototype.reset=function(){this.isPrimary=!1},r}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var qs=function(r,e){return qs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])},qs(r,e)};function ev(r,e){qs(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var tv=function(){function r(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return r.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},r.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},r}(),cs=function(){function r(e){this._pointerId=e,this._flags=r.FLAGS.NONE}return r.prototype._doSet=function(e,t){t?this._flags=this._flags|e:this._flags=this._flags&~e},Object.defineProperty(r.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"flags",{get:function(){return this._flags},set:function(e){this._flags=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"none",{get:function(){return this._flags===r.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"over",{get:function(){return(this._flags&r.FLAGS.OVER)!==0},set:function(e){this._doSet(r.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rightDown",{get:function(){return(this._flags&r.FLAGS.RIGHT_DOWN)!==0},set:function(e){this._doSet(r.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"leftDown",{get:function(){return(this._flags&r.FLAGS.LEFT_DOWN)!==0},set:function(e){this._doSet(r.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),r.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2}),r}(),rv=function(){function r(){this._tempPoint=new me}return r.prototype.recursiveFindHit=function(e,t,i,n,s){var o;if(!t||!t.visible)return!1;var a=e.data.global;s=t.interactive||s;var u=!1,l=s,h=!0;if(t.hitArea)n&&(t.worldTransform.applyInverse(a,this._tempPoint),t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?u=!0:(n=!1,h=!1)),l=!1;else if(t._mask&&n){var c=t._mask.isMaskData?t._mask.maskObject:t._mask;c&&!(!((o=c.containsPoint)===null||o===void 0)&&o.call(c,a))&&(n=!1)}if(h&&t.interactiveChildren&&t.children)for(var d=t.children,f=d.length-1;f>=0;f--){var p=d[f],v=this.recursiveFindHit(e,p,i,n,l);if(v){if(!p.parent)continue;l=!1,v&&(e.target&&(n=!1),u=!0)}}return s&&(n&&!e.target&&!t.hitArea&&t.containsPoint&&t.containsPoint(a)&&(u=!0),t.interactive&&(u&&!e.target&&(e.target=t),i&&i(e,t,!!u))),u},r.prototype.findHit=function(e,t,i,n){this.recursiveFindHit(e,t,i,n,!1)},r}(),iv={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(r){r?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};ui.mixin(iv);var Gi=1,Vi={target:null,data:{global:null}},nv=function(r){ev(e,r);function e(t,i){var n=r.call(this)||this;return i=i||{},n.renderer=t,n.autoPreventDefault=i.autoPreventDefault!==void 0?i.autoPreventDefault:!0,n.interactionFrequency=i.interactionFrequency||10,n.mouse=new _u,n.mouse.identifier=Gi,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[Gi]=n.mouse,n.interactionDataPool=[],n.eventData=new tv,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!("PointerEvent"in globalThis),n.supportsTouchEvents="ontouchstart"in globalThis,n.supportsPointerEvents=!!globalThis.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new rv,n._tempDisplayObject=new Eh,n._eventListenerOptions={capture:!0,passive:!1},n._useSystemTicker=i.useSystemTicker!==void 0?i.useSystemTicker:!0,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(t,i){return Vi.target=null,Vi.data.global=t,i||(i=this.lastObjectRendered),this.processInteractive(Vi,i,null,!0),Vi.target},e.prototype.setTargetElement=function(t,i){i===void 0&&(i=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=i,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Le.system.add(this.tickerUpdate,this,Pr.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){!this.tickerAdded||(Le.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var t=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var t=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},e.prototype.update=function(){if(!!this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var t in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var i=this.activeInteractionData[t];if(i.originalEvent&&i.pointerType!=="touch"){var n=this.configureInteractionEventForDOMEvent(this.eventData,i.originalEvent,i);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){t=t||"default";var i=!0;if(globalThis.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(i=!1),this.currentCursorMode!==t){this.currentCursorMode=t;var n=this.cursorStyles[t];if(n)switch(typeof n){case"string":i&&(this.interactionDOMElement.style.cursor=n);break;case"function":n(t);break;case"object":i&&Object.assign(this.interactionDOMElement.style,n);break}else i&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,i,n){(!n.stopPropagationHint||t===n.stopsPropagatingAt)&&(n.currentTarget=t,n.type=i,t.emit(i,n),t[i]&&t[i](n))},e.prototype.delayDispatchEvent=function(t,i,n){this.delayedEvents.push({displayObject:t,eventString:i,eventData:n})},e.prototype.mapPositionToPoint=function(t,i,n){var s;this.interactionDOMElement.parentElement?s=this.interactionDOMElement.getBoundingClientRect():s={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var o=1/this.resolution;t.x=(i-s.left)*(this.interactionDOMElement.width/s.width)*o,t.y=(n-s.top)*(this.interactionDOMElement.height/s.height)*o},e.prototype.processInteractive=function(t,i,n,s){var o=this.search.findHit(t,i,n,s),a=this.delayedEvents;if(!a.length)return o;t.stopPropagationHint=!1;var u=a.length;this.delayedEvents=[];for(var l=0;l<u;l++){var h=a[l],c=h.displayObject,d=h.eventString,f=h.eventData;f.stopsPropagatingAt===c&&(f.stopPropagationHint=!0),this.dispatchEvent(c,d,f)}return o},e.prototype.onPointerDown=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var i=this.normalizeToPointerData(t);if(this.autoPreventDefault&&i[0].isNormalized){var n=t.cancelable||!("cancelable"in t);n&&t.preventDefault()}for(var s=i.length,o=0;o<s;o++){var a=i[o],u=this.getInteractionDataForPointerId(a),l=this.configureInteractionEventForDOMEvent(this.eventData,a,u);if(l.data.originalEvent=t,this.processInteractive(l,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",l),a.pointerType==="touch")this.emit("touchstart",l);else if(a.pointerType==="mouse"||a.pointerType==="pen"){var h=a.button===2;this.emit(h?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,i,n){var s=t.data,o=t.data.identifier;if(n){if(i.trackedPointers[o]||(i.trackedPointers[o]=new cs(o)),this.dispatchEvent(i,"pointerdown",t),s.pointerType==="touch")this.dispatchEvent(i,"touchstart",t);else if(s.pointerType==="mouse"||s.pointerType==="pen"){var a=s.button===2;a?i.trackedPointers[o].rightDown=!0:i.trackedPointers[o].leftDown=!0,this.dispatchEvent(i,a?"rightdown":"mousedown",t)}}},e.prototype.onPointerComplete=function(t,i,n){var s=this.normalizeToPointerData(t),o=s.length,a=t.target;t.composedPath&&t.composedPath().length>0&&(a=t.composedPath()[0]);for(var u=a!==this.interactionDOMElement?"outside":"",l=0;l<o;l++){var h=s[l],c=this.getInteractionDataForPointerId(h),d=this.configureInteractionEventForDOMEvent(this.eventData,h,c);if(d.data.originalEvent=t,this.processInteractive(d,this.lastObjectRendered,n,i||!u),this.emit(i?"pointercancel":"pointerup"+u,d),h.pointerType==="mouse"||h.pointerType==="pen"){var f=h.button===2;this.emit(f?"rightup"+u:"mouseup"+u,d)}else h.pointerType==="touch"&&(this.emit(i?"touchcancel":"touchend"+u,d),this.releaseInteractionDataForPointerId(h.pointerId))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&t.pointerType==="touch"||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,i){var n=t.data,s=t.data.identifier;i.trackedPointers[s]!==void 0&&(delete i.trackedPointers[s],this.dispatchEvent(i,"pointercancel",t),n.pointerType==="touch"&&this.dispatchEvent(i,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&t.pointerType==="touch"||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,i,n){var s=t.data,o=t.data.identifier,a=i.trackedPointers[o],u=s.pointerType==="touch",l=s.pointerType==="mouse"||s.pointerType==="pen",h=!1;if(l){var c=s.button===2,d=cs.FLAGS,f=c?d.RIGHT_DOWN:d.LEFT_DOWN,p=a!==void 0&&a.flags&f;n?(this.dispatchEvent(i,c?"rightup":"mouseup",t),p&&(this.dispatchEvent(i,c?"rightclick":"click",t),h=!0)):p&&this.dispatchEvent(i,c?"rightupoutside":"mouseupoutside",t),a&&(c?a.rightDown=!1:a.leftDown=!1)}n?(this.dispatchEvent(i,"pointerup",t),u&&this.dispatchEvent(i,"touchend",t),a&&((!l||h)&&this.dispatchEvent(i,"pointertap",t),u&&(this.dispatchEvent(i,"tap",t),a.over=!1))):a&&(this.dispatchEvent(i,"pointerupoutside",t),u&&this.dispatchEvent(i,"touchendoutside",t)),a&&a.none&&delete i.trackedPointers[o]},e.prototype.onPointerMove=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var i=this.normalizeToPointerData(t);(i[0].pointerType==="mouse"||i[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var n=i.length,s=0;s<n;s++){var o=i[s],a=this.getInteractionDataForPointerId(o),u=this.configureInteractionEventForDOMEvent(this.eventData,o,a);u.data.originalEvent=t,this.processInteractive(u,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",u),o.pointerType==="touch"&&this.emit("touchmove",u),(o.pointerType==="mouse"||o.pointerType==="pen")&&this.emit("mousemove",u)}i[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,i,n){var s=t.data,o=s.pointerType==="touch",a=s.pointerType==="mouse"||s.pointerType==="pen";a&&this.processPointerOverOut(t,i,n),(!this.moveWhenInside||n)&&(this.dispatchEvent(i,"pointermove",t),o&&this.dispatchEvent(i,"touchmove",t),a&&this.dispatchEvent(i,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var i=this.normalizeToPointerData(t),n=i[0];n.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,this.processInteractive(o,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",o),n.pointerType==="mouse"||n.pointerType==="pen"?this.emit("mouseout",o):this.releaseInteractionDataForPointerId(s.identifier)}},e.prototype.processPointerOverOut=function(t,i,n){var s=t.data,o=t.data.identifier,a=s.pointerType==="mouse"||s.pointerType==="pen",u=i.trackedPointers[o];n&&!u&&(u=i.trackedPointers[o]=new cs(o)),u!==void 0&&(n&&this.mouseOverRenderer?(u.over||(u.over=!0,this.delayDispatchEvent(i,"pointerover",t),a&&this.delayDispatchEvent(i,"mouseover",t)),a&&this.cursor===null&&(this.cursor=i.cursor)):u.over&&(u.over=!1,this.dispatchEvent(i,"pointerout",this.eventData),a&&this.dispatchEvent(i,"mouseout",t),u.none&&delete i.trackedPointers[o]))},e.prototype.onPointerOver=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var i=this.normalizeToPointerData(t),n=i[0],s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,n.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",o),(n.pointerType==="mouse"||n.pointerType==="pen")&&this.emit("mouseover",o)}},e.prototype.getInteractionDataForPointerId=function(t){var i=t.pointerId,n;return i===Gi||t.pointerType==="mouse"?n=this.mouse:this.activeInteractionData[i]?n=this.activeInteractionData[i]:(n=this.interactionDataPool.pop()||new _u,n.identifier=i,this.activeInteractionData[i]=n),n.copyEvent(t),n},e.prototype.releaseInteractionDataForPointerId=function(t){var i=this.activeInteractionData[t];i&&(delete this.activeInteractionData[t],i.reset(),this.interactionDataPool.push(i))},e.prototype.configureInteractionEventForDOMEvent=function(t,i,n){return t.data=n,this.mapPositionToPoint(n.global,i.clientX,i.clientY),i.pointerType==="touch"&&(i.globalX=n.global.x,i.globalY=n.global.y),n.originalEvent=i,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var i=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var n=0,s=t.changedTouches.length;n<s;n++){var o=t.changedTouches[n];typeof o.button>"u"&&(o.button=t.touches.length?1:0),typeof o.buttons>"u"&&(o.buttons=t.touches.length?1:0),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,i.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){var a=t;typeof a.isPrimary>"u"&&(a.isPrimary=!0),typeof a.width>"u"&&(a.width=1),typeof a.height>"u"&&(a.height=1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="mouse"),typeof a.pointerId>"u"&&(a.pointerId=Gi),typeof a.pressure>"u"&&(a.pressure=.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),a.isNormalized=!0,i.push(a)}else i.push(t);return i},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e.extension={name:"interaction",type:[Me.RendererPlugin,Me.CanvasRendererPlugin]},e}(Ct),Ot=Math.pow,$=(r,e,t)=>new Promise((i,n)=>{var s=u=>{try{a(t.next(u))}catch(l){n(l)}},o=u=>{try{a(t.throw(u))}catch(l){n(l)}},a=u=>u.done?i(u.value):Promise.resolve(u.value).then(s,o);a((t=t.apply(r,e)).next())});const bu=2,Eu=2;var li;(r=>{r.supportMoreMaskDivisions=!0,r.setOpacityFromMotion=!1})(li||(li={}));var ae;(r=>{r.LOG_LEVEL_VERBOSE=0,r.LOG_LEVEL_WARNING=1,r.LOG_LEVEL_ERROR=2,r.LOG_LEVEL_NONE=999,r.logLevel=r.LOG_LEVEL_WARNING,r.sound=!0,r.motionSync=!0,r.motionFadingDuration=500,r.idleMotionFadingDuration=2e3,r.expressionFadingDuration=500,r.preserveExpressionOnMotion=!0,r.cubism4=li})(ae||(ae={}));const k={log(r,...e){ae.logLevel<=ae.LOG_LEVEL_VERBOSE&&console.log(`[${r}]`,...e)},warn(r,...e){ae.logLevel<=ae.LOG_LEVEL_WARNING&&console.warn(`[${r}]`,...e)},error(r,...e){ae.logLevel<=ae.LOG_LEVEL_ERROR&&console.error(`[${r}]`,...e)}};function cn(r,e,t){return r<e?e:r>t?t:r}function sv(r,e){return Math.random()*(e-r)+r}function Br(r,e,t,i,n){const s=e[i];s!==null&&typeof s===r&&(t[n]=s)}function Ur(r,e,t,i,n){const s=e[i];Array.isArray(s)&&(t[n]=s.filter(o=>o!==null&&typeof o===r))}function Ih(r,e){e.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{i!=="constructor"&&Object.defineProperty(r.prototype,i,Object.getOwnPropertyDescriptor(t.prototype,i))})})}function ov(r){let e=r.lastIndexOf("/");return e!=-1&&(r=r.slice(0,e)),e=r.lastIndexOf("/"),e!==-1&&(r=r.slice(e+1)),r}function av(r,e){const t=r.indexOf(e);t!==-1&&r.splice(t,1)}class Po extends Ct{constructor(e,t){super(),this.expressions=[],this.reserveExpressionIndex=-1,this.destroyed=!1,this.settings=e,this.tag=`ExpressionManager(${e.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(e){return $(this,null,function*(){if(!this.definitions[e]){k.warn(this.tag,`Undefined expression at [${e}]`);return}if(this.expressions[e]===null){k.warn(this.tag,`Cannot set expression at [${e}] because it's already failed in loading.`);return}if(this.expressions[e])return this.expressions[e];const t=yield this._loadExpression(e);return this.expressions[e]=t,t})}_loadExpression(e){throw new Error("Not implemented.")}setRandomExpression(){return $(this,null,function*(){if(this.definitions.length){const e=[];for(let t=0;t<this.definitions.length;t++)this.expressions[t]!==null&&this.expressions[t]!==this.currentExpression&&t!==this.reserveExpressionIndex&&e.push(t);if(e.length){const t=Math.floor(Math.random()*e.length);return this.setExpression(t)}}return!1})}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(e){return $(this,null,function*(){if(typeof e!="number"&&(e=this.getExpressionIndex(e)),!(e>-1&&e<this.definitions.length)||e===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=e;const t=yield this.loadExpression(e);return!t||this.reserveExpressionIndex!==e?!1:(this.reserveExpressionIndex=-1,this.currentExpression=t,this._setExpression(t),!0)})}update(e,t){return this.isFinished()?!1:this.updateParameters(e,t)}destroy(){this.destroyed=!0,this.emit("destroy");const e=this;e.definitions=void 0,e.expressions=void 0}}const Iu=.01,uv=40/7.5,lv=1/(.15*1e3);class hv{constructor(){this.targetX=0,this.targetY=0,this.x=0,this.y=0,this.vx=0,this.vy=0}focus(e,t,i=!1){this.targetX=cn(e,-1,1),this.targetY=cn(t,-1,1),i&&(this.x=this.targetX,this.y=this.targetY)}update(e){const t=this.targetX-this.x,i=this.targetY-this.y;if(Math.abs(t)<Iu&&Math.abs(i)<Iu)return;const n=Math.sqrt(Ot(t,2)+Ot(i,2)),s=uv/(1e3/e);let o=s*(t/n)-this.vx,a=s*(i/n)-this.vy;const u=Math.sqrt(Ot(o,2)+Ot(a,2)),l=s*lv*e;u>l&&(o*=l/u,a*=l/u),this.vx+=o,this.vy+=a;const h=Math.sqrt(Ot(this.vx,2)+Ot(this.vy,2)),c=.5*(Math.sqrt(Ot(l,2)+8*l*n)-l);h>c&&(this.vx*=c/h,this.vy*=c/h),this.x+=this.vx,this.y+=this.vy}}class Sn{constructor(e){this.json=e;let t=e.url;if(typeof t!="string")throw new TypeError("The `url` field in settings JSON must be defined as a string.");this.url=t,this.name=ov(this.url)}resolveURL(e){return xn.resolve(this.url,e)}replaceFiles(e){this.moc=e(this.moc,"moc"),this.pose!==void 0&&(this.pose=e(this.pose,"pose")),this.physics!==void 0&&(this.physics=e(this.physics,"physics"));for(let t=0;t<this.textures.length;t++)this.textures[t]=e(this.textures[t],`textures[${t}]`)}getDefinedFiles(){const e=[];return this.replaceFiles(t=>(e.push(t),t)),e}validateFiles(e){const t=(s,o)=>{const a=this.resolveURL(s);if(!e.includes(a)){if(o)throw new Error(`File "${s}" is defined in settings, but doesn't exist in given files`);return!1}return!0};return[this.moc,...this.textures].forEach(s=>t(s,!0)),this.getDefinedFiles().filter(s=>t(s,!1))}}var Ks=(r=>(r[r.NONE=0]="NONE",r[r.IDLE=1]="IDLE",r[r.NORMAL=2]="NORMAL",r[r.FORCE=3]="FORCE",r))(Ks||{});class cv{constructor(){this.debug=!1,this.currentPriority=0,this.reservePriority=0}reserve(e,t,i){if(i<=0)return k.log(this.tag,"Cannot start a motion with MotionPriority.NONE."),!1;if(e===this.currentGroup&&t===this.currentIndex)return k.log(this.tag,"Motion is already playing.",this.dump(e,t)),!1;if(e===this.reservedGroup&&t===this.reservedIndex||e===this.reservedIdleGroup&&t===this.reservedIdleIndex)return k.log(this.tag,"Motion is already reserved.",this.dump(e,t)),!1;if(i===1){if(this.currentPriority!==0)return k.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(e,t)),!1;if(this.reservedIdleGroup!==void 0)return k.log(this.tag,"Cannot start idle motion because another idle motion has reserved.",this.dump(e,t)),!1;this.setReservedIdle(e,t)}else{if(i<3){if(i<=this.currentPriority)return k.log(this.tag,"Cannot start motion because another motion is playing as an equivalent or higher priority.",this.dump(e,t)),!1;if(i<=this.reservePriority)return k.log(this.tag,"Cannot start motion because another motion has reserved as an equivalent or higher priority.",this.dump(e,t)),!1}this.setReserved(e,t,i)}return!0}start(e,t,i,n){if(n===1){if(this.setReservedIdle(void 0,void 0),this.currentPriority!==0)return k.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(t,i)),!1}else{if(t!==this.reservedGroup||i!==this.reservedIndex)return k.log(this.tag,"Cannot start motion because another motion has taken the place.",this.dump(t,i)),!1;this.setReserved(void 0,void 0,0)}return e?(this.setCurrent(t,i,n),!0):!1}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(e,t,i){this.currentPriority=i,this.currentGroup=e,this.currentIndex=t}setReserved(e,t,i){this.reservePriority=i,this.reservedGroup=e,this.reservedIndex=t}setReservedIdle(e,t){this.reservedIdleGroup=e,this.reservedIdleIndex=t}isActive(e,t){return e===this.currentGroup&&t===this.currentIndex||e===this.reservedGroup&&t===this.reservedIndex||e===this.reservedIdleGroup&&t===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return this.currentGroup===void 0&&this.reservedIdleGroup===void 0}shouldOverrideExpression(){return!ae.preserveExpressionOnMotion&&this.currentPriority>1}dump(e,t){if(this.debug){const i=["currentPriority","reservePriority","currentGroup","currentIndex","reservedGroup","reservedIndex","reservedIdleGroup","reservedIdleIndex"];return`
<Requested> group = "${e}", index = ${t}
`+i.map(n=>"["+n+"] "+this[n]).join(`
`)}return""}}const dv="SoundManager",fv=.5;class zt{static get volume(){return this._volume}static set volume(e){this._volume=(e>1?1:e<0?0:e)||0,this.audios.forEach(t=>t.volume=this._volume)}static add(e,t,i){const n=new Audio(e);return n.volume=this._volume,n.preload="auto",n.addEventListener("ended",()=>{this.dispose(n),t?.()}),n.addEventListener("error",s=>{this.dispose(n),k.warn(dv,`Error occurred on "${e}"`,s.error),i?.(s.error)}),this.audios.push(n),n}static play(e){return new Promise((t,i)=>{var n;(n=e.play())==null||n.catch(s=>{e.dispatchEvent(new ErrorEvent("error",{error:s})),i(s)}),e.readyState===e.HAVE_ENOUGH_DATA?t():e.addEventListener("canplaythrough",t)})}static dispose(e){e.pause(),e.removeAttribute("src"),av(this.audios,e)}static destroy(){for(let e=this.audios.length-1;e>=0;e--)this.dispose(this.audios[e])}}zt.audios=[];zt._volume=fv;var Th=(r=>(r.ALL="ALL",r.IDLE="IDLE",r.NONE="NONE",r))(Th||{});class Cn extends Ct{constructor(e,t){super(),this.motionGroups={},this.state=new cv,this.playing=!1,this.destroyed=!1,this.settings=e,this.tag=`MotionManager(${e.name})`,this.state.tag=this.tag}init(e){e?.idleMotionGroup&&(this.groups.idle=e.idleMotionGroup),this.setupMotions(e),this.stopAllMotions()}setupMotions(e){for(const i of Object.keys(this.definitions))this.motionGroups[i]=[];let t;switch(e?.motionPreload){case"NONE":return;case"ALL":t=Object.keys(this.definitions);break;case"IDLE":default:t=[this.groups.idle];break}for(const i of t)if(this.definitions[i])for(let n=0;n<this.definitions[i].length;n++)this.loadMotion(i,n).then()}loadMotion(e,t){return $(this,null,function*(){var i;if(!((i=this.definitions[e])!=null&&i[t])){k.warn(this.tag,`Undefined motion at "${e}"[${t}]`);return}if(this.motionGroups[e][t]===null){k.warn(this.tag,`Cannot start motion at "${e}"[${t}] because it's already failed in loading.`);return}if(this.motionGroups[e][t])return this.motionGroups[e][t];const n=yield this._loadMotion(e,t);if(!this.destroyed)return this.motionGroups[e][t]=n??null,n})}_loadMotion(e,t){throw new Error("Not implemented.")}startMotion(e,t){return $(this,arguments,function*(i,n,s=Ks.NORMAL){var o;if(!this.state.reserve(i,n,s))return!1;const a=(o=this.definitions[i])==null?void 0:o[n];if(!a)return!1;this.currentAudio&&zt.dispose(this.currentAudio);let u;if(ae.sound){const h=this.getSoundFile(a);if(h)try{u=zt.add(this.settings.resolveURL(h),()=>this.currentAudio=void 0,()=>this.currentAudio=void 0),this.currentAudio=u}catch(c){k.warn(this.tag,"Failed to create audio",h,c)}}const l=yield this.loadMotion(i,n);if(u){const h=zt.play(u).catch(c=>k.warn(this.tag,"Failed to play audio",u.src,c));ae.motionSync&&(yield h)}return this.state.start(l,i,n,s)?(k.log(this.tag,"Start motion:",this.getMotionName(a)),this.emit("motionStart",i,n,u),this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),this.playing=!0,this._startMotion(l),!0):(u&&(zt.dispose(u),this.currentAudio=void 0),!1)})}startRandomMotion(e,t){return $(this,null,function*(){const i=this.definitions[e];if(i?.length){const n=[];for(let s=0;s<i.length;s++)this.motionGroups[e][s]!==null&&!this.state.isActive(e,s)&&n.push(s);if(n.length){const s=Math.floor(Math.random()*n.length);return this.startMotion(e,n[s],t)}}return!1})}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.currentAudio&&(zt.dispose(this.currentAudio),this.currentAudio=void 0)}update(e,t){var i;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.shouldOverrideExpression()&&((i=this.expressionManager)==null||i.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,Ks.IDLE)),this.updateParameters(e,t)}destroy(){var e;this.destroyed=!0,this.emit("destroy"),this.stopAllMotions(),(e=this.expressionManager)==null||e.destroy();const t=this;t.definitions=void 0,t.motionGroups=void 0}}const pv={x:0,y:0,width:0,height:0};class wh extends Ct{constructor(){super(...arguments),this.focusController=new hv,this.originalWidth=0,this.originalHeight=0,this.width=0,this.height=0,this.localTransform=new ue,this.drawingMatrix=new ue,this.hitAreas={},this.textureFlipY=!1,this.viewport=[0,0,0,0],this.destroyed=!1}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const e=this,t=this.getSize();e.originalWidth=t[0],e.originalHeight=t[1];const i=Object.assign({width:bu,height:Eu},this.getLayout());this.localTransform.scale(i.width/bu,i.height/Eu),e.width=this.originalWidth*this.localTransform.a,e.height=this.originalHeight*this.localTransform.d;const n=i.x!==void 0&&i.x-i.width/2||i.centerX!==void 0&&i.centerX||i.left!==void 0&&i.left-i.width/2||i.right!==void 0&&i.right+i.width/2||0,s=i.y!==void 0&&i.y-i.height/2||i.centerY!==void 0&&i.centerY||i.top!==void 0&&i.top-i.height/2||i.bottom!==void 0&&i.bottom+i.height/2||0;this.localTransform.translate(this.width*n,-this.height*s)}setupHitAreas(){const e=this.getHitAreaDefs().filter(t=>t.index>=0);for(const t of e)this.hitAreas[t.name]=t}hitTest(e,t){return Object.keys(this.hitAreas).filter(i=>this.isHit(i,e,t))}isHit(e,t,i){if(!this.hitAreas[e])return!1;const n=this.hitAreas[e].index,s=this.getDrawableBounds(n,pv);return s.x<=t&&t<=s.x+s.width&&s.y<=i&&i<=s.y+s.height}getDrawableBounds(e,t){const i=this.getDrawableVertices(e);let n=i[0],s=i[0],o=i[1],a=i[1];for(let u=0;u<i.length;u+=2){const l=i[u],h=i[u+1];n=Math.min(l,n),s=Math.max(l,s),o=Math.min(h,o),a=Math.max(h,a)}return t??(t={}),t.x=n,t.y=o,t.width=s-n,t.height=a-o,t}updateTransform(e){this.drawingMatrix.copyFrom(e).append(this.localTransform)}update(e,t){this.focusController.update(e)}destroy(){this.destroyed=!0,this.emit("destroy"),this.motionManager.destroy(),this.motionManager=void 0}}const mv="XHRLoader";class Tu extends Error{constructor(e,t,i,n=!1){super(e),this.url=t,this.status=i,this.aborted=n}}const pe=class{static createXHR(r,e,t,i,n){const s=new XMLHttpRequest;if(pe.allXhrSet.add(s),r){let o=pe.xhrMap.get(r);o?o.add(s):(o=new Set([s]),pe.xhrMap.set(r,o)),r.listeners("destroy").includes(pe.cancelXHRs)||r.once("destroy",pe.cancelXHRs)}return s.open("GET",e),s.responseType=t,s.onload=()=>{(s.status===200||s.status===0)&&s.response?i(s.response):s.onerror()},s.onerror=()=>{k.warn(mv,`Failed to load resource as ${s.responseType} (Status ${s.status}): ${e}`),n(new Tu("Network error.",e,s.status))},s.onabort=()=>n(new Tu("Aborted.",e,s.status,!0)),s.onloadend=()=>{var o;pe.allXhrSet.delete(s),r&&((o=pe.xhrMap.get(r))==null||o.delete(s))},s}static cancelXHRs(){var r;(r=pe.xhrMap.get(this))==null||r.forEach(e=>{e.abort(),pe.allXhrSet.delete(e)}),pe.xhrMap.delete(this)}static release(){pe.allXhrSet.forEach(r=>r.abort()),pe.allXhrSet.clear(),pe.xhrMap=new WeakMap}};let An=pe;An.xhrMap=new WeakMap;An.allXhrSet=new Set;An.loader=(r,e)=>new Promise((t,i)=>{pe.createXHR(r.target,r.settings?r.settings.resolveURL(r.url):r.url,r.type,s=>{r.result=s,t()},i).send()});function xh(r,e){let t=-1;return i(0);function i(n,s){if(s)return Promise.reject(s);if(n<=t)return Promise.reject(new Error("next() called multiple times"));t=n;const o=r[n];if(!o)return Promise.resolve();try{return Promise.resolve(o(e,i.bind(null,n+1)))}catch(a){return Promise.reject(a)}}}class St{static load(e){return xh(this.middlewares,e).then(()=>e.result)}}St.middlewares=[An.loader];function gv(r,e={}){var t;const i={resourceOptions:{crossorigin:e.crossOrigin}};if(Yi.fromURL)return Yi.fromURL(r,i).catch(o=>{if(o instanceof Error)throw o;const a=new Error("Texture loading error");throw a.event=o,a});i.resourceOptions.autoLoad=!1;const n=Yi.from(r,i);if(n.baseTexture.valid)return Promise.resolve(n);const s=n.baseTexture.resource;return(t=s._live2d_load)!=null||(s._live2d_load=new Promise((o,a)=>{const u=l=>{s.source.removeEventListener("error",u);const h=new Error("Texture loading error");h.event=l,a(h)};s.source.addEventListener("error",u),s.load().then(()=>o(n)).catch(u)})),s._live2d_load}const wu="Live2DFactory",Sh=(r,e)=>$(void 0,null,function*(){if(typeof r.source=="string"){const t=yield St.load({url:r.source,type:"json",target:r.live2dModel});t.url=r.source,r.source=t,r.live2dModel.emit("settingsJSONLoaded",t)}return e()}),Ch=(r,e)=>$(void 0,null,function*(){if(r.source instanceof Sn)return r.settings=r.source,e();if(typeof r.source=="object"){const t=V.findRuntime(r.source);if(t){const i=t.createModelSettings(r.source);return r.settings=i,r.live2dModel.emit("settingsLoaded",i),e()}}throw new TypeError("Unknown settings format.")}),Ah=(r,e)=>{if(r.settings){const t=V.findRuntime(r.settings);if(t)return t.ready().then(e)}return e()},Ph=(r,e)=>$(void 0,null,function*(){yield e();const t=r.internalModel;if(t){const i=r.settings,n=V.findRuntime(i);if(n){const s=[];i.pose&&s.push(St.load({settings:i,url:i.pose,type:"json",target:t}).then(o=>{t.pose=n.createPose(t.coreModel,o),r.live2dModel.emit("poseLoaded",t.pose)}).catch(o=>{r.live2dModel.emit("poseLoadError",o),k.warn(wu,"Failed to load pose.",o)})),i.physics&&s.push(St.load({settings:i,url:i.physics,type:"json",target:t}).then(o=>{t.physics=n.createPhysics(t.coreModel,o),r.live2dModel.emit("physicsLoaded",t.physics)}).catch(o=>{r.live2dModel.emit("physicsLoadError",o),k.warn(wu,"Failed to load physics.",o)})),s.length&&(yield Promise.all(s))}}}),Rh=(r,e)=>$(void 0,null,function*(){if(r.settings){const t=r.live2dModel,i=r.settings.textures.map(n=>{const s=r.settings.resolveURL(n);return gv(s,{crossOrigin:r.options.crossOrigin})});if(yield e(),r.internalModel)t.internalModel=r.internalModel,t.emit("modelLoaded",r.internalModel);else throw new TypeError("Missing internal model.");t.textures=yield Promise.all(i),t.emit("textureLoaded",t.textures)}else throw new TypeError("Missing settings.")}),Mh=(r,e)=>$(void 0,null,function*(){const t=r.settings;if(t instanceof Sn){const i=V.findRuntime(t);if(!i)throw new TypeError("Unknown model settings.");const n=yield St.load({settings:t,url:t.moc,type:"arraybuffer",target:r.live2dModel});if(!i.isValidMoc(n))throw new Error("Invalid moc data");const s=i.createCoreModel(n);return r.internalModel=i.createInternalModel(s,t,r.options),e()}throw new TypeError("Missing settings.")}),ne=class{static registerRuntime(r){ne.runtimes.push(r),ne.runtimes.sort((e,t)=>t.version-e.version)}static findRuntime(r){for(const e of ne.runtimes)if(e.test(r))return e}static setupLive2DModel(r,e,t){return $(this,null,function*(){const i=new Promise(o=>r.once("textureLoaded",o)),n=new Promise(o=>r.once("modelLoaded",o)),s=Promise.all([i,n]).then(()=>r.emit("ready"));yield xh(ne.live2DModelMiddlewares,{live2dModel:r,source:e,options:t||{}}),yield s,r.emit("load")})}static loadMotion(r,e,t){var i,n;const s=o=>r.emit("motionLoadError",e,t,o);try{const o=(i=r.definitions[e])==null?void 0:i[t];if(!o)return Promise.resolve(void 0);r.listeners("destroy").includes(ne.releaseTasks)||r.once("destroy",ne.releaseTasks);let a=ne.motionTasksMap.get(r);a||(a={},ne.motionTasksMap.set(r,a));let u=a[e];u||(u=[],a[e]=u);const l=r.getMotionFile(o);return(n=u[t])!=null||(u[t]=St.load({url:l,settings:r.settings,type:r.motionDataType,target:r}).then(h=>{var c;const d=(c=ne.motionTasksMap.get(r))==null?void 0:c[e];d&&delete d[t];const f=r.createMotion(h,e,o);return r.emit("motionLoaded",e,t,f),f}).catch(h=>{k.warn(r.tag,`Failed to load motion: ${l}
`,h),s(h)})),u[t]}catch(o){k.warn(r.tag,`Failed to load motion at "${e}"[${t}]
`,o),s(o)}return Promise.resolve(void 0)}static loadExpression(r,e){var t;const i=n=>r.emit("expressionLoadError",e,n);try{const n=r.definitions[e];if(!n)return Promise.resolve(void 0);r.listeners("destroy").includes(ne.releaseTasks)||r.once("destroy",ne.releaseTasks);let s=ne.expressionTasksMap.get(r);s||(s=[],ne.expressionTasksMap.set(r,s));const o=r.getExpressionFile(n);return(t=s[e])!=null||(s[e]=St.load({url:o,settings:r.settings,type:"json",target:r}).then(a=>{const u=ne.expressionTasksMap.get(r);u&&delete u[e];const l=r.createExpression(a,n);return r.emit("expressionLoaded",e,l),l}).catch(a=>{k.warn(r.tag,`Failed to load expression: ${o}
`,a),i(a)})),s[e]}catch(n){k.warn(r.tag,`Failed to load expression at [${e}]
`,n),i(n)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof Cn?ne.motionTasksMap.delete(this):ne.expressionTasksMap.delete(this)}};let V=ne;V.runtimes=[];V.urlToJSON=Sh;V.jsonToSettings=Ch;V.waitUntilReady=Ah;V.setupOptionals=Ph;V.setupEssentials=Rh;V.createInternalModel=Mh;V.live2DModelMiddlewares=[Sh,Ch,Ah,Ph,Rh,Mh];V.motionTasksMap=new WeakMap;V.expressionTasksMap=new WeakMap;Cn.prototype._loadMotion=function(r,e){return V.loadMotion(this,r,e)};Po.prototype._loadExpression=function(r){return V.loadExpression(this,r)};class vv{constructor(){this._autoInteract=!1}get autoInteract(){return this._autoInteract}set autoInteract(e){e!==this._autoInteract&&(e?this.on("pointertap",xu,this):this.off("pointertap",xu,this),this._autoInteract=e)}registerInteraction(e){e!==this.interactionManager&&(this.unregisterInteraction(),this._autoInteract&&e&&(this.interactionManager=e,e.on("pointermove",Su,this)))}unregisterInteraction(){var e;this.interactionManager&&((e=this.interactionManager)==null||e.off("pointermove",Su,this),this.interactionManager=void 0)}}function xu(r){this.tap(r.data.global.x,r.data.global.y)}function Su(r){this.focus(r.data.global.x,r.data.global.y)}class yv extends ah{}const Se=new me,_v=new ue;let ct;class Ro extends hn{constructor(e){super(),this.tag="Live2DModel(uninitialized)",this.textures=[],this.transform=new yv,this.anchor=new Hr(this.onAnchorChange,this,0,0),this.glContextID=-1,this.elapsedTime=performance.now(),this.deltaTime=0,this._autoUpdate=!1,this.once("modelLoaded",()=>this.init(e))}static from(e,t){const i=new this(t);return V.setupLive2DModel(i,e,t).then(()=>i)}static fromSync(e,t){const i=new this(t);return V.setupLive2DModel(i,e,t).then(t?.onLoad).catch(t?.onError),i}static registerTicker(e){ct=e}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){var t;ct||(ct=(t=window.PIXI)==null?void 0:t.Ticker),e?this._destroyed||(ct?(ct.shared.add(this.onTickerUpdate,this),this._autoUpdate=!0):k.warn(this.tag,"No Ticker registered, please call Live2DModel.registerTicker(Ticker).")):(ct?.shared.remove(this.onTickerUpdate,this),this._autoUpdate=!1)}init(e){this.tag=`Live2DModel(${this.internalModel.settings.name})`;const t=Object.assign({autoUpdate:!0,autoInteract:!0},e);t.autoInteract&&(this.interactive=!0),this.autoInteract=t.autoInteract,this.autoUpdate=t.autoUpdate}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(e,t,i){return t===void 0?this.internalModel.motionManager.startRandomMotion(e,i):this.internalModel.motionManager.startMotion(e,t,i)}expression(e){return this.internalModel.motionManager.expressionManager?e===void 0?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(e):Promise.resolve(!1)}focus(e,t,i=!1){Se.x=e,Se.y=t,this.toModelPosition(Se,Se,!0);let n=Se.x/this.internalModel.originalWidth*2-1,s=Se.y/this.internalModel.originalHeight*2-1,o=Math.atan2(s,n);this.internalModel.focusController.focus(Math.cos(o),-Math.sin(o),i)}tap(e,t){const i=this.hitTest(e,t);i.length&&(k.log(this.tag,"Hit",i),this.emit("hit",i))}hitTest(e,t){return Se.x=e,Se.y=t,this.toModelPosition(Se,Se),this.internalModel.hitTest(Se.x,Se.y)}toModelPosition(e,t=e.clone(),i){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(e,t),this.internalModel.localTransform.applyInverse(t,t),t}containsPoint(e){return this.getBounds(!0).contains(e.x,e.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}onTickerUpdate(){this.update(ct.shared.deltaMS)}update(e){this.deltaTime+=e,this.elapsedTime+=e}_render(e){this.registerInteraction(e.plugins.interaction),e.batch.reset(),e.geometry.reset(),e.shader.reset(),e.state.reset();let t=!1;this.glContextID!==e.CONTEXT_UID&&(this.glContextID=e.CONTEXT_UID,this.internalModel.updateWebGLContext(e.gl,this.glContextID),t=!0);for(let s=0;s<this.textures.length;s++){const o=this.textures[s];!o.valid||((t||!o.baseTexture._glTextures[this.glContextID])&&(e.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),e.texture.bind(o.baseTexture,0)),this.internalModel.bindTexture(s,o.baseTexture._glTextures[this.glContextID].texture),o.baseTexture.touched=e.textureGC.count)}const i=e.framebuffer.viewport;this.internalModel.viewport=[i.x,i.y,i.width,i.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const n=_v.copyFrom(e.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(n),this.internalModel.draw(e.gl),e.state.reset(),e.texture.reset()}destroy(e){this.emit("destroy"),this.autoUpdate=!1,this.unregisterInteraction(),e?.texture&&this.textures.forEach(t=>t.destroy(e.baseTexture)),this.internalModel.destroy(),super.destroy(e)}}Ih(Ro,[vv]);const ze=class{static resolveURL(r,e){var t;const i=(t=ze.filesMap[r])==null?void 0:t[e];if(i===void 0)throw new Error("Cannot find this file from uploaded files: "+e);return i}static upload(r,e){return $(this,null,function*(){const t={};for(const i of e.getDefinedFiles()){const n=decodeURI(xn.resolve(e.url,i)),s=r.find(o=>o.webkitRelativePath===n);s&&(t[i]=URL.createObjectURL(s))}ze.filesMap[e._objectURL]=t})}static createSettings(r){return $(this,null,function*(){const e=r.find(o=>o.name.endsWith("model.json")||o.name.endsWith("model3.json"));if(!e)throw new TypeError("Settings file not found");const t=yield ze.readText(e),i=JSON.parse(t);i.url=e.webkitRelativePath;const n=V.findRuntime(i);if(!n)throw new Error("Unknown settings JSON");const s=n.createModelSettings(i);return s._objectURL=URL.createObjectURL(e),s})}static readText(r){return $(this,null,function*(){return new Promise((e,t)=>{const i=new FileReader;i.onload=()=>e(i.result),i.onerror=t,i.readAsText(r,"utf8")})})}};let Mo=ze;Mo.filesMap={};Mo.factory=(r,e)=>$(void 0,null,function*(){if(Array.isArray(r.source)&&r.source[0]instanceof File){const t=r.source;let i=t.settings;if(!i)i=yield ze.createSettings(t);else if(!i._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings');i.validateFiles(t.map(n=>encodeURI(n.webkitRelativePath))),yield ze.upload(t,i),i.resolveURL=function(n){return ze.resolveURL(this._objectURL,n)},r.source=i,r.live2dModel.once("modelLoaded",n=>{n.once("destroy",function(){const s=this.settings._objectURL;if(URL.revokeObjectURL(s),ze.filesMap[s])for(const o of Object.values(ze.filesMap[s]))URL.revokeObjectURL(o);delete ze.filesMap[s]})})}return e()});V.live2DModelMiddlewares.unshift(Mo.factory);const ve=class{static unzip(r,e){return $(this,null,function*(){const t=yield ve.getFilePaths(r),i=[];for(const s of e.getDefinedFiles()){const o=decodeURI(xn.resolve(e.url,s));t.includes(o)&&i.push(o)}const n=yield ve.getFiles(r,i);for(let s=0;s<n.length;s++){const o=i[s],a=n[s];Object.defineProperty(a,"webkitRelativePath",{value:o})}return n})}static createSettings(r){return $(this,null,function*(){const t=(yield ve.getFilePaths(r)).find(o=>o.endsWith("model.json")||o.endsWith("model3.json"));if(!t)throw new Error("Settings file not found");const i=yield ve.readText(r,t);if(!i)throw new Error("Empty settings file: "+t);const n=JSON.parse(i);n.url=t;const s=V.findRuntime(n);if(!s)throw new Error("Unknown settings JSON");return s.createModelSettings(n)})}static zipReader(r,e){return $(this,null,function*(){throw new Error("Not implemented")})}static getFilePaths(r){return $(this,null,function*(){throw new Error("Not implemented")})}static getFiles(r,e){return $(this,null,function*(){throw new Error("Not implemented")})}static readText(r,e){return $(this,null,function*(){throw new Error("Not implemented")})}static releaseReader(r){}};let Pn=ve;Pn.ZIP_PROTOCOL="zip://";Pn.uid=0;Pn.factory=(r,e)=>$(void 0,null,function*(){const t=r.source;let i,n,s;if(typeof t=="string"&&(t.endsWith(".zip")||t.startsWith(ve.ZIP_PROTOCOL))?(t.startsWith(ve.ZIP_PROTOCOL)?i=t.slice(ve.ZIP_PROTOCOL.length):i=t,n=yield St.load({url:i,type:"blob",target:r.live2dModel})):Array.isArray(t)&&t.length===1&&t[0]instanceof File&&t[0].name.endsWith(".zip")&&(n=t[0],i=URL.createObjectURL(n),s=t.settings),n){if(!n.size)throw new Error("Empty zip file");const o=yield ve.zipReader(n,i);s||(s=yield ve.createSettings(o)),s._objectURL=ve.ZIP_PROTOCOL+ve.uid+"/"+s.url;const a=yield ve.unzip(o,s);a.settings=s,r.source=a,i.startsWith("blob:")&&r.live2dModel.once("modelLoaded",u=>{u.once("destroy",function(){URL.revokeObjectURL(i)})}),ve.releaseReader(o)}return e()});V.live2DModelMiddlewares.unshift(Pn.factory);if(!window.Live2D)throw new Error("Could not find Cubism 2 runtime. This plugin requires live2d.min.js to be loaded.");const bv=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(r,e){bv.call(this,r,e),e.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)};class Ev extends AMotion{constructor(e){super(),this.params=[],this.setFadeIn(e.fade_in>0?e.fade_in:ae.expressionFadingDuration),this.setFadeOut(e.fade_out>0?e.fade_out:ae.expressionFadingDuration),Array.isArray(e.params)&&e.params.forEach(t=>{const i=t.calc||"add";if(i==="add"){const n=t.def||0;t.val-=n}else if(i==="mult"){const n=t.def||1;t.val/=n}this.params.push({calc:i,val:t.val,id:t.id})})}updateParamExe(e,t,i,n){this.params.forEach(s=>{e.setParamFloat(s.id,s.val*i)})}}class Iv extends Po{constructor(e,t){var i;super(e,t),this.queueManager=new MotionQueueManager,this.definitions=(i=this.settings.expressions)!=null?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(e){return this.definitions.findIndex(t=>t.name===e)}getExpressionFile(e){return e.file}createExpression(e,t){return new Ev(e)}_setExpression(e){return this.queueManager.startMotion(e)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.updateParam(e)}}class Tv extends Cn{constructor(e,t){super(e,t),this.groups={idle:"idle"},this.motionDataType="arraybuffer",this.queueManager=new MotionQueueManager,this.definitions=this.settings.motions,this.init(t)}init(e){super.init(e),this.settings.expressions&&(this.expressionManager=new Iv(this.settings,e))}isFinished(){return this.queueManager.isFinished()}createMotion(e,t,i){const n=Live2DMotion.loadMotion(e),s=t===this.groups.idle?ae.idleMotionFadingDuration:ae.motionFadingDuration;return n.setFadeIn(i.fade_in>0?i.fade_in:s),n.setFadeOut(i.fade_out>0?i.fade_out:s),n}getMotionFile(e){return e.file}getMotionName(e){return e.file}getSoundFile(e){return e.sound}_startMotion(e,t){return e.onFinishHandler=t,this.queueManager.stopAllMotions(),this.queueManager.startMotion(e)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.updateParam(e)}destroy(){super.destroy(),this.queueManager=void 0}}class wv{constructor(e){this.coreModel=e,this.blinkInterval=4e3,this.closingDuration=100,this.closedDuration=50,this.openingDuration=150,this.eyeState=0,this.eyeParamValue=1,this.closedTimer=0,this.nextBlinkTimeLeft=this.blinkInterval,this.leftParam=e.getParamIndex("PARAM_EYE_L_OPEN"),this.rightParam=e.getParamIndex("PARAM_EYE_R_OPEN")}setEyeParams(e){this.eyeParamValue=cn(e,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(e){switch(this.eyeState){case 0:this.nextBlinkTimeLeft-=e,this.nextBlinkTimeLeft<0&&(this.eyeState=1,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+sv(0,2e3));break;case 1:this.setEyeParams(this.eyeParamValue+e/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=2,this.closedTimer=0);break;case 2:this.closedTimer+=e,this.closedTimer>=this.closedDuration&&(this.eyeState=3);break;case 3:this.setEyeParams(this.eyeParamValue+e/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=0)}}}const Ft=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class xv extends wh{constructor(e,t,i){super(),this.textureFlipY=!0,this.drawDataCount=0,this.disableCulling=!1,this.coreModel=e,this.settings=t,this.motionManager=new Tv(t,i),this.eyeBlink=new wv(e),this.eyeballXParamIndex=e.getParamIndex("PARAM_EYE_BALL_X"),this.eyeballYParamIndex=e.getParamIndex("PARAM_EYE_BALL_Y"),this.angleXParamIndex=e.getParamIndex("PARAM_ANGLE_X"),this.angleYParamIndex=e.getParamIndex("PARAM_ANGLE_Y"),this.angleZParamIndex=e.getParamIndex("PARAM_ANGLE_Z"),this.bodyAngleXParamIndex=e.getParamIndex("PARAM_BODY_ANGLE_X"),this.breathParamIndex=e.getParamIndex("PARAM_BREATH"),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach(({id:s,value:o})=>this.coreModel.setParamFloat(s,o)),this.settings.initOpacities&&this.settings.initOpacities.forEach(({id:s,value:o})=>this.coreModel.setPartsOpacity(s,o)),this.coreModel.saveParam();const e=this.coreModel.getModelContext()._$aS;e?.length&&(this.drawDataCount=e.length);let t=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,"culling",{set:s=>t=s,get:()=>this.disableCulling?!1:t});const i=this.coreModel.getModelContext().clipManager,n=i.setupClip;i.setupClip=(s,o)=>{n.call(i,s,o),o.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const e={};if(this.settings.layout)for(const t of Object.keys(this.settings.layout)){let i=t;t==="center_x"?i="centerX":t==="center_y"&&(i="centerY"),e[i]=this.settings.layout[t]}return e}updateWebGLContext(e,t){const i=this.coreModel.drawParamWebGL;i.firstDraw=!0,i.setGL(e),i.glno=t;for(const o in i)i.hasOwnProperty(o)&&i[o]instanceof WebGLBuffer&&(i[o]=null);const n=this.coreModel.getModelContext().clipManager;n.curFrameNo=t;const s=e.getParameter(e.FRAMEBUFFER_BINDING);n.getMaskRenderTexture(),e.bindFramebuffer(e.FRAMEBUFFER,s)}bindTexture(e,t){this.coreModel.setTexture(e,t)}getHitAreaDefs(){var e;return((e=this.settings.hitAreas)==null?void 0:e.map(t=>({id:t.id,name:t.name,index:this.coreModel.getDrawDataIndex(t.id)})))||[]}getDrawableIDs(){const e=this.coreModel.getModelContext(),t=[];for(let i=0;i<this.drawDataCount;i++){const n=e.getDrawData(i);n&&t.push(n.getDrawDataID().id)}return t}getDrawableIndex(e){return this.coreModel.getDrawDataIndex(e)}getDrawableVertices(e){if(typeof e=="string"&&(e=this.coreModel.getDrawDataIndex(e),e===-1))throw new TypeError("Unable to find drawable ID: "+e);return this.coreModel.getTransformedPoints(e).slice()}update(e,t){var i,n,s,o;super.update(e,t);const a=this.coreModel;this.emit("beforeMotionUpdate");const u=this.motionManager.update(this.coreModel,t);this.emit("afterMotionUpdate"),a.saveParam(),(i=this.motionManager.expressionManager)==null||i.update(a,t),u||(n=this.eyeBlink)==null||n.update(e),this.updateFocus(),this.updateNaturalMovements(e,t),(s=this.physics)==null||s.update(t),(o=this.pose)==null||o.update(e),this.emit("beforeModelUpdate"),a.update(),a.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,this.focusController.x*30),this.coreModel.addToParamFloat(this.angleYParamIndex,this.focusController.y*30),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,this.focusController.x*10)}updateNaturalMovements(e,t){const i=t/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*Math.sin(i/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*Math.sin(i/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*Math.sin(i/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*Math.sin(i/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(i/3.2345))}draw(e){const t=this.disableCulling;e.getParameter(e.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const i=this.drawingMatrix;Ft[0]=i.a,Ft[1]=i.b,Ft[4]=i.c,Ft[5]=i.d,Ft[12]=i.tx,Ft[13]=i.ty,this.coreModel.setMatrix(Ft),this.coreModel.draw(),this.disableCulling=t}destroy(){super.destroy(),this.coreModel=void 0}}class Zr extends Sn{constructor(e){if(super(e),this.motions={},!Zr.isValidJSON(e))throw new TypeError("Invalid JSON.");this.moc=e.model,Ur("string",e,this,"textures","textures"),this.copy(e)}static isValidJSON(e){var t;return!!e&&typeof e.model=="string"&&((t=e.textures)==null?void 0:t.length)>0&&e.textures.every(i=>typeof i=="string")}copy(e){Br("string",e,this,"name","name"),Br("string",e,this,"pose","pose"),Br("string",e,this,"physics","physics"),Br("object",e,this,"layout","layout"),Br("object",e,this,"motions","motions"),Ur("object",e,this,"hit_areas","hitAreas"),Ur("object",e,this,"expressions","expressions"),Ur("object",e,this,"init_params","initParams"),Ur("object",e,this,"init_opacities","initOpacities")}replaceFiles(e){super.replaceFiles(e);for(const[t,i]of Object.entries(this.motions))for(let n=0;n<i.length;n++)i[n].file=e(i[n].file,`motions.${t}[${n}].file`),i[n].sound!==void 0&&(i[n].sound=e(i[n].sound,`motions.${t}[${n}].sound`));if(this.expressions)for(let t=0;t<this.expressions.length;t++)this.expressions[t].file=e(this.expressions[t].file,`expressions[${t}].file`)}}const Sv={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},Cv={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class Av{constructor(e,t){this.coreModel=e,this.physicsHairs=[],t.physics_hair&&(this.physicsHairs=t.physics_hair.map(i=>{const n=new PhysicsHair;return n.setup(i.setup.length,i.setup.regist,i.setup.mass),i.src.forEach(({id:s,ptype:o,scale:a,weight:u})=>{const l=Sv[o];l&&n.addSrcParam(l,s,a,u)}),i.targets.forEach(({id:s,ptype:o,scale:a,weight:u})=>{const l=Cv[o];l&&n.addTargetParam(l,s,a,u)}),n}))}update(e){this.physicsHairs.forEach(t=>t.update(this.coreModel,e))}}class Cu{constructor(e){this.id=e,this.paramIndex=-1,this.partsIndex=-1,this.link=[]}initIndex(e){this.paramIndex=e.getParamIndex("VISIBLE:"+this.id),this.partsIndex=e.getPartsDataIndex(PartsDataID.getID(this.id)),e.setParamFloat(this.paramIndex,1)}}class Pv{constructor(e,t){this.coreModel=e,this.opacityAnimDuration=500,this.partsGroups=[],t.parts_visible&&(this.partsGroups=t.parts_visible.map(({group:i})=>i.map(({id:n,link:s})=>{const o=new Cu(n);return s&&(o.link=s.map(a=>new Cu(a))),o})),this.init())}init(){this.partsGroups.forEach(e=>{e.forEach(t=>{if(t.initIndex(this.coreModel),t.paramIndex>=0){const i=this.coreModel.getParamFloat(t.paramIndex)!==0;this.coreModel.setPartsOpacity(t.partsIndex,i?1:0),this.coreModel.setParamFloat(t.paramIndex,i?1:0),t.link.length>0&&t.link.forEach(n=>n.initIndex(this.coreModel))}})})}normalizePartsOpacityGroup(e,t){const i=this.coreModel,n=.5,s=.15;let o=1,a=e.findIndex(({paramIndex:u,partsIndex:l})=>l>=0&&i.getParamFloat(u)!==0);if(a>=0){const u=i.getPartsOpacity(e[a].partsIndex);o=cn(u+t/this.opacityAnimDuration,0,1)}else a=0,o=1;e.forEach(({partsIndex:u},l)=>{if(u>=0)if(a==l)i.setPartsOpacity(u,o);else{let h=i.getPartsOpacity(u),c;o<n?c=o*(n-1)/n+1:c=(1-o)*n/(1-n),(1-c)*(1-o)>s&&(c=1-s/(1-o)),h>c&&(h=c),i.setPartsOpacity(u,h)}})}copyOpacity(e){const t=this.coreModel;e.forEach(({partsIndex:i,link:n})=>{if(i>=0&&n){const s=t.getPartsOpacity(i);n.forEach(({partsIndex:o})=>{o>=0&&t.setPartsOpacity(o,s)})}})}update(e){this.partsGroups.forEach(t=>{this.normalizePartsOpacityGroup(t,e),this.copyOpacity(t)})}}V.registerRuntime({version:2,test(r){return r instanceof Zr||Zr.isValidJSON(r)},ready(){return Promise.resolve()},isValidMoc(r){if(r.byteLength<3)return!1;const e=new Int8Array(r,0,3);return String.fromCharCode(...e)==="moc"},createModelSettings(r){return new Zr(r)},createCoreModel(r){const e=Live2DModelWebGL.loadModel(r),t=Live2D.getError();if(t)throw t;return e},createInternalModel(r,e,t){return new xv(r,e,t)},createPose(r,e){return new Pv(r,e)},createPhysics(r,e){return new Av(r,e)}});if(!window.Live2DCubismCore)throw new Error("Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.");class A{constructor(e,t){this.x=e||0,this.y=t||0}add(e){const t=new A(0,0);return t.x=this.x+e.x,t.y=this.y+e.y,t}substract(e){const t=new A(0,0);return t.x=this.x-e.x,t.y=this.y-e.y,t}multiply(e){const t=new A(0,0);return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByScaler(e){return this.multiply(new A(e,e))}division(e){const t=new A(0,0);return t.x=this.x/e.x,t.y=this.y/e.y,t}divisionByScalar(e){return this.division(new A(e,e))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))}dot(e){return this.x*e.x+this.y*e.y}normalize(){const e=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/e,this.y=this.y/e}isEqual(e){return this.x==e.x&&this.y==e.y}isNotEqual(e){return!this.isEqual(e)}}const qi=class{static range(r,e,t){return r<e?r=e:r>t&&(r=t),r}static sin(r){return Math.sin(r)}static cos(r){return Math.cos(r)}static abs(r){return Math.abs(r)}static sqrt(r){return Math.sqrt(r)}static cbrt(r){if(r===0)return r;let e=r;const t=e<0;t&&(e=-e);let i;return e===1/0?i=1/0:(i=Math.exp(Math.log(e)/3),i=(e/(i*i)+2*i)/3),t?-i:i}static getEasingSine(r){return r<0?0:r>1?1:.5-.5*this.cos(r*Math.PI)}static max(r,e){return r>e?r:e}static min(r,e){return r>e?e:r}static degreesToRadian(r){return r/180*Math.PI}static radianToDegrees(r){return r*180/Math.PI}static directionToRadian(r,e){const t=Math.atan2(e.y,e.x),i=Math.atan2(r.y,r.x);let n=t-i;for(;n<-Math.PI;)n+=Math.PI*2;for(;n>Math.PI;)n-=Math.PI*2;return n}static directionToDegrees(r,e){const t=this.directionToRadian(r,e);let i=this.radianToDegrees(t);return e.x-r.x>0&&(i=-i),i}static radianToDirection(r){const e=new A;return e.x=this.sin(r),e.y=this.cos(r),e}static quadraticEquation(r,e,t){return this.abs(r)<qi.Epsilon?this.abs(e)<qi.Epsilon?-t:-t/e:-(e+this.sqrt(e*e-4*r*t))/(2*r)}static cardanoAlgorithmForBezier(r,e,t,i){if(this.sqrt(r)<qi.Epsilon)return this.range(this.quadraticEquation(e,t,i),0,1);const n=e/r,s=t/r,o=i/r,a=(3*s-n*n)/3,u=a/3,l=(2*n*n*n-9*n*s+27*o)/27,h=l/2,c=h*h+u*u*u,d=.5,f=d+.01;if(c<0){const _=-a/3,g=_*_*_,b=this.sqrt(g),I=-l/(2*b),T=this.range(I,-1,1),R=Math.acos(T),M=2*this.cbrt(b),B=M*this.cos(R/3)-n/3;if(this.abs(B-d)<f)return this.range(B,0,1);const re=M*this.cos((R+2*Math.PI)/3)-n/3;if(this.abs(re-d)<f)return this.range(re,0,1);const _e=M*this.cos((R+4*Math.PI)/3)-n/3;return this.range(_e,0,1)}if(c==0){let _;h<0?_=this.cbrt(-h):_=-this.cbrt(h);const g=2*_-n/3;if(this.abs(g-d)<f)return this.range(g,0,1);const b=-_-n/3;return this.range(b,0,1)}const p=this.sqrt(c),v=this.cbrt(p-h),m=this.cbrt(p+h),y=v-m-n/3;return this.range(y,0,1)}constructor(){}};let U=qi;U.Epsilon=1e-5;class Pe{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(e,t,i){const n=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),s=4;for(let o=0;o<s;++o)for(let a=0;a<s;++a)for(let u=0;u<s;++u)n[a+o*4]+=e[u+o*4]*t[a+u*4];for(let o=0;o<16;++o)i[o]=n[o]}loadIdentity(){const e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(e)}setMatrix(e){for(let t=0;t<16;++t)this._tr[t]=e[t]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(e){return this._tr[0]*e+this._tr[12]}transformY(e){return this._tr[5]*e+this._tr[13]}invertTransformX(e){return(e-this._tr[12])/this._tr[0]}invertTransformY(e){return(e-this._tr[13])/this._tr[5]}translateRelative(e,t){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);Pe.multiply(i,this._tr,this._tr)}translate(e,t){this._tr[12]=e,this._tr[13]=t}translateX(e){this._tr[12]=e}translateY(e){this._tr[13]=e}scaleRelative(e,t){const i=new Float32Array([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]);Pe.multiply(i,this._tr,this._tr)}scale(e,t){this._tr[0]=e,this._tr[5]=t}multiplyByMatrix(e){Pe.multiply(e.getArray(),this._tr,this._tr)}clone(){const e=new Pe;for(let t=0;t<this._tr.length;t++)e._tr[t]=this._tr[t];return e}}class Oo{initialize(e){this._model=e}drawModel(){this.getModel()!=null&&this.doDrawModel()}setMvpMatrix(e){this._mvpMatrix4x4.setMatrix(e.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(e,t,i,n){e<0?e=0:e>1&&(e=1),t<0?t=0:t>1&&(t=1),i<0?i=0:i>1&&(i=1),n<0?n=0:n>1&&(n=1),this._modelColor.R=e,this._modelColor.G=t,this._modelColor.B=i,this._modelColor.A=n}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(e){this._isPremultipliedAlpha=e}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(e){this._isCulling=e}isCulling(){return this._isCulling}setAnisotropy(e){this._anisortopy=e}getAnisotropy(){return this._anisortopy}getModel(){return this._model}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisortopy=0,this._modelColor=new jr,this._mvpMatrix4x4=new Pe,this._mvpMatrix4x4.loadIdentity()}}var bt=(r=>(r[r.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",r[r.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",r[r.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",r))(bt||{});class jr{constructor(){this.R=1,this.G=1,this.B=1,this.A=1}}let Ve=!1,hr=!1,cr;const ds={vertexOffset:0,vertexStep:2};class hi{static startUp(e){if(Ve)return Gr("CubismFramework.startUp() is already done."),Ve;if(Live2DCubismCore._isStarted)return Ve=!0,!0;if(Live2DCubismCore._isStarted=!0,cr=e,cr&&Live2DCubismCore.Logging.csmSetLogFunction(cr.logFunction),Ve=!0,Ve){const t=Live2DCubismCore.Version.csmGetVersion(),i=(t&4278190080)>>24,n=(t&16711680)>>16,s=t&65535,o=t;Gr("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+n).slice(-2),("0000"+s).slice(-4),o)}return Gr("CubismFramework.startUp() is complete."),Ve}static cleanUp(){Ve=!1,hr=!1,cr=void 0}static initialize(){if(!Ve){$r("CubismFramework is not started.");return}if(hr){$r("CubismFramework.initialize() skipped, already initialized.");return}hr=!0,Gr("CubismFramework.initialize() is complete.")}static dispose(){if(!Ve){$r("CubismFramework is not started.");return}if(!hr){$r("CubismFramework.dispose() skipped, not initialized.");return}Oo.staticRelease(),hr=!1,Gr("CubismFramework.dispose() is complete.")}static isStarted(){return Ve}static isInitialized(){return hr}static coreLogFunction(e){!Live2DCubismCore.Logging.csmGetLogFunction()||Live2DCubismCore.Logging.csmGetLogFunction()(e)}static getLoggingLevel(){return cr!=null?cr.loggingLevel:nr.LogLevel_Off}constructor(){}}var nr=(r=>(r[r.LogLevel_Verbose=0]="LogLevel_Verbose",r[r.LogLevel_Debug=1]="LogLevel_Debug",r[r.LogLevel_Info=2]="LogLevel_Info",r[r.LogLevel_Warning=3]="LogLevel_Warning",r[r.LogLevel_Error=4]="LogLevel_Error",r[r.LogLevel_Off=5]="LogLevel_Off",r))(nr||{});const Hi=()=>{};function Au(r,...e){Rn.print(nr.LogLevel_Debug,"[CSM][D]"+r+`
`,e)}function Gr(r,...e){Rn.print(nr.LogLevel_Info,"[CSM][I]"+r+`
`,e)}function $r(r,...e){Rn.print(nr.LogLevel_Warning,"[CSM][W]"+r+`
`,e)}function fr(r,...e){Rn.print(nr.LogLevel_Error,"[CSM][E]"+r+`
`,e)}class Rn{static print(e,t,i){if(e<hi.getLoggingLevel())return;const n=hi.coreLogFunction;if(!n)return;const s=t.replace(/{(\d+)}/g,(o,a)=>i[a]);n(s)}static dumpBytes(e,t,i){for(let n=0;n<i;n++)n%16==0&&n>0?this.print(e,`
`):n%8==0&&n>0&&this.print(e,"  "),this.print(e,"{0} ",[t[n]&255]);this.print(e,`
`)}constructor(){}}class Oh{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(e,t,i){if(!t.isAvailable()||t.isFinished())return;if(!t.isStarted()){t.setIsStarted(!0),t.setStartTime(i-this._offsetSeconds),t.setFadeInStartTime(i);const a=this.getDuration();t.getEndTime()<0&&t.setEndTime(a<=0?-1:t.getStartTime()+a)}let n=this._weight;const s=this._fadeInSeconds==0?1:U.getEasingSine((i-t.getFadeInStartTime())/this._fadeInSeconds),o=this._fadeOutSeconds==0||t.getEndTime()<0?1:U.getEasingSine((t.getEndTime()-i)/this._fadeOutSeconds);n=n*s*o,t.setState(i,n),this.doUpdateParameters(e,i,n,t),t.getEndTime()>0&&t.getEndTime()<i&&t.setIsFinished(!0)}setFadeInTime(e){this._fadeInSeconds=e}setFadeOutTime(e){this._fadeOutSeconds=e}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(e){this._weight=e}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(e){this._offsetSeconds=e}getFiredEvent(e,t){return this._firedEventValues}setFinishedMotionHandler(e){this._onFinishedMotion=e}getFinishedMotionHandler(){return this._onFinishedMotion}}const Pu=1;class Fo extends Oh{constructor(){super(),this._parameters=[]}static create(e){const t=new Fo,i=e.FadeInTime,n=e.FadeOutTime;t.setFadeInTime(i!==void 0?i:Pu),t.setFadeOutTime(n!==void 0?n:Pu);const s=e.Parameters||[];for(let o=0;o<s.length;++o){const a=s[o],u=a.Id,l=a.Value;let h;switch(a.Blend){case"Multiply":h=Ut.ExpressionBlendType_Multiply;break;case"Overwrite":h=Ut.ExpressionBlendType_Overwrite;break;case"Add":default:h=Ut.ExpressionBlendType_Add;break}const c={parameterId:u,blendType:h,value:l};t._parameters.push(c)}return t}doUpdateParameters(e,t,i,n){for(let s=0;s<this._parameters.length;++s){const o=this._parameters[s];switch(o.blendType){case Ut.ExpressionBlendType_Add:{e.addParameterValueById(o.parameterId,o.value,i);break}case Ut.ExpressionBlendType_Multiply:{e.multiplyParameterValueById(o.parameterId,o.value,i);break}case Ut.ExpressionBlendType_Overwrite:{e.setParameterValueById(o.parameterId,o.value,i);break}}}}}var Ut=(r=>(r[r.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",r[r.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",r[r.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite",r))(Ut||{});class Rv{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(e){this._fadeOutSeconds=e,this._isTriggeredFadeOut=!0}startFadeOut(e,t){const i=t+e;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(e){this._startTimeSeconds=e}setFadeInStartTime(e){this._fadeInStartTimeSeconds=e}setEndTime(e){this._endTimeSeconds=e}setIsFinished(e){this._finished=e}setIsStarted(e){this._started=e}isAvailable(){return this._available}setIsAvailable(e){this._available=e}setState(e,t){this._stateTimeSeconds=e,this._stateWeight=t}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(e){this._lastEventCheckSeconds=e}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class Fh{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let e=0;e<this._motions.length;++e)this._motions[e]&&this._motions[e].release();this._motions=void 0}startMotion(e,t,i){if(e==null)return Mv;let n;for(let s=0;s<this._motions.length;++s)n=this._motions[s],n?.setFadeOut(n._motion.getFadeOutTime());return n=new Rv,n._autoDelete=t,n._motion=e,this._motions.push(n),n._motionQueueEntryHandle}isFinished(){let e=0;for(;e<this._motions.length;){const t=this._motions[e];if(t==null){this._motions.splice(e,1);continue}if(t._motion==null){t.release(),this._motions.splice(e,1);continue}if(!t.isFinished())return!1;e++}return!0}isFinishedByHandle(e){for(let t=0;t<this._motions.length;t++){const i=this._motions[t];if(i!=null&&i._motionQueueEntryHandle==e&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let e=0;e<this._motions.length;e++){const t=this._motions[e];t?.release()}this._motions=[]}getCubismMotionQueueEntry(e){return this._motions.find(t=>t!=null&&t._motionQueueEntryHandle==e)}setEventCallback(e,t=null){this._eventCallBack=e,this._eventCustomData=t}doUpdateMotion(e,t){let i=!1,n=0;for(;n<this._motions.length;){const s=this._motions[n];if(s==null){this._motions.splice(n,1);continue}const o=s._motion;if(o==null){s.release(),this._motions.splice(n,1);continue}o.updateParameters(e,s,t),i=!0;const a=o.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),t-s.getStartTime());for(let u=0;u<a.length;++u)this._eventCallBack(this,a[u],this._eventCustomData);s.setLastCheckEventSeconds(t),s.isFinished()?(s.release(),this._motions.splice(n,1)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),t),n++)}return i}}const Mv=-1;class Ov extends Po{constructor(e,t){var i;super(e,t),this.queueManager=new Fh,this.definitions=(i=e.expressions)!=null?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(e){return this.definitions.findIndex(t=>t.Name===e)}getExpressionFile(e){return e.File}createExpression(e,t){return Fo.create(e)}_setExpression(e){return this.queueManager.startMotion(e,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.doUpdateMotion(e,t)}}class Lh{constructor(e){this.groups=e.Groups,this.hitAreas=e.HitAreas,this.layout=e.Layout,this.moc=e.FileReferences.Moc,this.expressions=e.FileReferences.Expressions,this.motions=e.FileReferences.Motions,this.textures=e.FileReferences.Textures,this.physics=e.FileReferences.Physics,this.pose=e.FileReferences.Pose}getEyeBlinkParameters(){var e,t;return(t=(e=this.groups)==null?void 0:e.find(i=>i.Name==="EyeBlink"))==null?void 0:t.Ids}getLipSyncParameters(){var e,t;return(t=(e=this.groups)==null?void 0:e.find(i=>i.Name==="LipSync"))==null?void 0:t.Ids}}class Er extends Sn{constructor(e){if(super(e),!Er.isValidJSON(e))throw new TypeError("Invalid JSON.");Object.assign(this,new Lh(e))}static isValidJSON(e){var t;return!!e?.FileReferences&&typeof e.FileReferences.Moc=="string"&&((t=e.FileReferences.Textures)==null?void 0:t.length)>0&&e.FileReferences.Textures.every(i=>typeof i=="string")}replaceFiles(e){if(super.replaceFiles(e),this.motions)for(const[t,i]of Object.entries(this.motions))for(let n=0;n<i.length;n++)i[n].File=e(i[n].File,`motions.${t}[${n}].File`),i[n].Sound!==void 0&&(i[n].Sound=e(i[n].Sound,`motions.${t}[${n}].Sound`));if(this.expressions)for(let t=0;t<this.expressions.length;t++)this.expressions[t].File=e(this.expressions[t].File,`expressions[${t}].File`)}}Ih(Er,[Lh]);var Gt=(r=>(r[r.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",r[r.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",r[r.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",r))(Gt||{}),He=(r=>(r[r.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",r[r.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",r[r.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",r[r.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",r))(He||{});class ft{constructor(e=0,t=0){this.time=e,this.value=t}}class Fv{constructor(){this.basePointIndex=0,this.segmentType=0}}class Lv{constructor(){this.id="",this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Dv{constructor(){this.fireTime=0,this.value=""}}class Nv{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class Dh{constructor(e){this._json=e}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(e){return Lo.EvaluationOptionFlag_AreBeziersRistricted==e?!!this._json.Meta.AreBeziersRestricted:!1}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(e){return this._json.Curves[e].Target}getMotionCurveId(e){return this._json.Curves[e].Id}getMotionCurveFadeInTime(e){return this._json.Curves[e].FadeInTime}getMotionCurveFadeOutTime(e){return this._json.Curves[e].FadeOutTime}getMotionCurveSegmentCount(e){return this._json.Curves[e].Segments.length}getMotionCurveSegment(e,t){return this._json.Curves[e].Segments[t]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(e){return this._json.UserData[e].Time}getEventValue(e){return this._json.UserData[e].Value}}var Lo=(r=>(r[r.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",r))(Lo||{});const kv="EyeBlink",Bv="LipSync",Uv="Model",Gv="Parameter",Vv="PartOpacity",Hv=!1;function Ae(r,e,t){const i=new ft;return i.time=r.time+(e.time-r.time)*t,i.value=r.value+(e.value-r.value)*t,i}function jv(r,e){let t=(e-r[0].time)/(r[1].time-r[0].time);return t<0&&(t=0),r[0].value+(r[1].value-r[0].value)*t}function $v(r,e){let t=(e-r[0].time)/(r[3].time-r[0].time);t<0&&(t=0);const i=Ae(r[0],r[1],t),n=Ae(r[1],r[2],t),s=Ae(r[2],r[3],t),o=Ae(i,n,t),a=Ae(n,s,t);return Ae(o,a,t).value}function zv(r,e){const t=e,i=r[0].time,n=r[3].time,s=r[1].time,o=r[2].time,a=n-3*o+3*s-i,u=3*o-6*s+3*i,l=3*s-3*i,h=i-t,c=U.cardanoAlgorithmForBezier(a,u,l,h),d=Ae(r[0],r[1],c),f=Ae(r[1],r[2],c),p=Ae(r[2],r[3],c),v=Ae(d,f,c),m=Ae(f,p,c);return Ae(v,m,c).value}function Xv(r,e){return r[0].value}function Wv(r,e){return r[1].value}function fs(r,e,t){const i=r.curves[e];let n=-1;const s=i.baseSegmentIndex+i.segmentCount;let o=0;for(let u=i.baseSegmentIndex;u<s;++u)if(o=r.segments[u].basePointIndex+(r.segments[u].segmentType==He.CubismMotionSegmentType_Bezier?3:1),r.points[o].time>t){n=u;break}if(n==-1)return r.points[o].value;const a=r.segments[n];return a.evaluate(r.points.slice(a.basePointIndex),t)}class Do extends Oh{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0}static create(e,t){const i=new Do;return i.parse(e),i._sourceFrameRate=i._motionData.fps,i._loopDurationSeconds=i._motionData.duration,i._onFinishedMotion=t,i}doUpdateParameters(e,t,i,n){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=kv),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=Bv);let s=t-n.getStartTime();s<0&&(s=0);let o=Number.MAX_VALUE,a=Number.MAX_VALUE;const u=64;let l=0,h=0;this._eyeBlinkParameterIds.length>u&&Au("too many eye blink targets : {0}",this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>u&&Au("too many lip sync targets : {0}",this._lipSyncParameterIds.length);const c=this._fadeInSeconds<=0?1:U.getEasingSine((t-n.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||n.getEndTime()<0?1:U.getEasingSine((n.getEndTime()-t)/this._fadeOutSeconds);let f,p,v,m=s;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;const y=this._motionData.curves;for(p=0;p<this._motionData.curveCount&&y[p].type==Gt.CubismMotionCurveTarget_Model;++p)f=fs(this._motionData,p,m),y[p].id==this._modelCurveIdEyeBlink?a=f:y[p].id==this._modelCurveIdLipSync&&(o=f);for(;p<this._motionData.curveCount&&y[p].type==Gt.CubismMotionCurveTarget_Parameter;++p){if(v=e.getParameterIndex(y[p].id),v==-1)continue;const _=e.getParameterValueByIndex(v);if(f=fs(this._motionData,p,m),a!=Number.MAX_VALUE){for(let b=0;b<this._eyeBlinkParameterIds.length&&b<u;++b)if(this._eyeBlinkParameterIds[b]==y[p].id){f*=a,h|=1<<b;break}}if(o!=Number.MAX_VALUE){for(let b=0;b<this._lipSyncParameterIds.length&&b<u;++b)if(this._lipSyncParameterIds[b]==y[p].id){f+=o,l|=1<<b;break}}let g;if(y[p].fadeInTime<0&&y[p].fadeOutTime<0)g=_+(f-_)*i;else{let b,I;y[p].fadeInTime<0?b=c:b=y[p].fadeInTime==0?1:U.getEasingSine((t-n.getFadeInStartTime())/y[p].fadeInTime),y[p].fadeOutTime<0?I=d:I=y[p].fadeOutTime==0||n.getEndTime()<0?1:U.getEasingSine((n.getEndTime()-t)/y[p].fadeOutTime);const T=this._weight*b*I;g=_+(f-_)*T}e.setParameterValueByIndex(v,g,1)}{if(a!=Number.MAX_VALUE)for(let _=0;_<this._eyeBlinkParameterIds.length&&_<u;++_){const g=e.getParameterValueById(this._eyeBlinkParameterIds[_]);if(h>>_&1)continue;const b=g+(a-g)*i;e.setParameterValueById(this._eyeBlinkParameterIds[_],b)}if(o!=Number.MAX_VALUE)for(let _=0;_<this._lipSyncParameterIds.length&&_<u;++_){const g=e.getParameterValueById(this._lipSyncParameterIds[_]);if(l>>_&1)continue;const b=g+(o-g)*i;e.setParameterValueById(this._lipSyncParameterIds[_],b)}}for(;p<this._motionData.curveCount&&y[p].type==Gt.CubismMotionCurveTarget_PartOpacity;++p)if(f=fs(this._motionData,p,m),li.setOpacityFromMotion)e.setPartOpacityById(y[p].id,f);else{if(v=e.getParameterIndex(y[p].id),v==-1)continue;e.setParameterValueByIndex(v,f)}s>=this._motionData.duration&&(this._isLoop?(n.setStartTime(t),this._isLoopFadeIn&&n.setFadeInStartTime(t)):(this._onFinishedMotion&&this._onFinishedMotion(this),n.setIsFinished(!0))),this._lastWeight=i}setIsLoop(e){this._isLoop=e}isLoop(){return this._isLoop}setIsLoopFadeIn(e){this._isLoopFadeIn=e}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(e,t){const i=this._motionData.curves;for(let n=0;n<this._motionData.curveCount;++n)if(e==i[n].id){i[n].fadeInTime=t;return}}setParameterFadeOutTime(e,t){const i=this._motionData.curves;for(let n=0;n<this._motionData.curveCount;++n)if(e==i[n].id){i[n].fadeOutTime=t;return}}getParameterFadeInTime(e){const t=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==t[i].id)return t[i].fadeInTime;return-1}getParameterFadeOutTime(e){const t=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==t[i].id)return t[i].fadeOutTime;return-1}setEffectIds(e,t){this._eyeBlinkParameterIds=e,this._lipSyncParameterIds=t}release(){this._motionData=void 0}parse(e){this._motionData=new Nv;let t=new Dh(e);this._motionData.duration=t.getMotionDuration(),this._motionData.loop=t.isMotionLoop(),this._motionData.curveCount=t.getMotionCurveCount(),this._motionData.fps=t.getMotionFps(),this._motionData.eventCount=t.getEventCount();const i=t.getEvaluationOptionFlag(Lo.EvaluationOptionFlag_AreBeziersRistricted),n=t.getMotionFadeInTime(),s=t.getMotionFadeOutTime();n!==void 0?this._fadeInSeconds=n<0?1:n:this._fadeInSeconds=1,s!==void 0?this._fadeOutSeconds=s<0?1:s:this._fadeOutSeconds=1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map(()=>new Lv),this._motionData.segments=Array.from({length:t.getMotionTotalSegmentCount()}).map(()=>new Fv),this._motionData.events=Array.from({length:this._motionData.eventCount}).map(()=>new Dv),this._motionData.points=[];let o=0,a=0;for(let u=0;u<this._motionData.curveCount;++u){const l=this._motionData.curves[u];switch(t.getMotionCurveTarget(u)){case Uv:l.type=Gt.CubismMotionCurveTarget_Model;break;case Gv:l.type=Gt.CubismMotionCurveTarget_Parameter;break;case Vv:l.type=Gt.CubismMotionCurveTarget_PartOpacity;break;default:$r('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!')}l.id=t.getMotionCurveId(u),l.baseSegmentIndex=a;const h=t.getMotionCurveFadeInTime(u),c=t.getMotionCurveFadeOutTime(u);l.fadeInTime=h!==void 0?h:-1,l.fadeOutTime=c!==void 0?c:-1;for(let d=0;d<t.getMotionCurveSegmentCount(u);){switch(d==0?(this._motionData.segments[a].basePointIndex=o,this._motionData.points[o]=new ft(t.getMotionCurveSegment(u,d),t.getMotionCurveSegment(u,d+1)),o+=1,d+=2):this._motionData.segments[a].basePointIndex=o-1,t.getMotionCurveSegment(u,d)){case He.CubismMotionSegmentType_Linear:{this._motionData.segments[a].segmentType=He.CubismMotionSegmentType_Linear,this._motionData.segments[a].evaluate=jv,this._motionData.points[o]=new ft(t.getMotionCurveSegment(u,d+1),t.getMotionCurveSegment(u,d+2)),o+=1,d+=3;break}case He.CubismMotionSegmentType_Bezier:{this._motionData.segments[a].segmentType=He.CubismMotionSegmentType_Bezier,i||Hv?this._motionData.segments[a].evaluate=$v:this._motionData.segments[a].evaluate=zv,this._motionData.points[o]=new ft(t.getMotionCurveSegment(u,d+1),t.getMotionCurveSegment(u,d+2)),this._motionData.points[o+1]=new ft(t.getMotionCurveSegment(u,d+3),t.getMotionCurveSegment(u,d+4)),this._motionData.points[o+2]=new ft(t.getMotionCurveSegment(u,d+5),t.getMotionCurveSegment(u,d+6)),o+=3,d+=7;break}case He.CubismMotionSegmentType_Stepped:{this._motionData.segments[a].segmentType=He.CubismMotionSegmentType_Stepped,this._motionData.segments[a].evaluate=Xv,this._motionData.points[o]=new ft(t.getMotionCurveSegment(u,d+1),t.getMotionCurveSegment(u,d+2)),o+=1,d+=3;break}case He.CubismMotionSegmentType_InverseStepped:{this._motionData.segments[a].segmentType=He.CubismMotionSegmentType_InverseStepped,this._motionData.segments[a].evaluate=Wv,this._motionData.points[o]=new ft(t.getMotionCurveSegment(u,d+1),t.getMotionCurveSegment(u,d+2)),o+=1,d+=3;break}}++l.segmentCount,++a}this._motionData.curves.push(l)}for(let u=0;u<t.getEventCount();++u)this._motionData.events[u].fireTime=t.getEventTime(u),this._motionData.events[u].value=t.getEventValue(u);t.release()}getFiredEvent(e,t){this._firedEventValues.length=0;for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events[i].fireTime>e&&this._motionData.events[i].fireTime<=t&&this._firedEventValues.push(this._motionData.events[i].value);return this._firedEventValues}}class Yv extends Cn{constructor(e,t){var i;super(e,t),this.groups={idle:"Idle"},this.motionDataType="json",this.queueManager=new Fh,this.definitions=(i=e.motions)!=null?i:{},this.eyeBlinkIds=e.getEyeBlinkParameters()||[],this.lipSyncIds=e.getLipSyncParameters()||[],this.init(t)}init(e){super.init(e),this.settings.expressions&&(this.expressionManager=new Ov(this.settings,e)),this.queueManager.setEventCallback((t,i,n)=>{this.emit("motion:"+i)})}isFinished(){return this.queueManager.isFinished()}_startMotion(e,t){return e.setFinishedMotionHandler(t),this.queueManager.stopAllMotions(),this.queueManager.startMotion(e,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(e,t,i){const n=Do.create(e),s=new Dh(e),o=(t===this.groups.idle?ae.idleMotionFadingDuration:ae.motionFadingDuration)/1e3;return s.getMotionFadeInTime()===void 0&&n.setFadeInTime(i.FadeInTime>0?i.FadeInTime:o),s.getMotionFadeOutTime()===void 0&&n.setFadeOutTime(i.FadeOutTime>0?i.FadeOutTime:o),n.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),n}getMotionFile(e){return e.File}getMotionName(e){return e.File}getSoundFile(e){return e.Sound}updateParameters(e,t){return this.queueManager.doUpdateMotion(e,t)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}const qv="ParamAngleX",Kv="ParamAngleY",Jv="ParamAngleZ",Zv="ParamEyeBallX",Qv="ParamEyeBallY",ey="ParamBodyAngleX",ty="ParamBreath";class No{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new No}setParameters(e){this._breathParameters=e}getParameters(){return this._breathParameters}updateParameters(e,t){this._currentTime+=t;const i=this._currentTime*2*3.14159;for(let n=0;n<this._breathParameters.length;++n){const s=this._breathParameters[n];e.addParameterValueById(s.parameterId,s.offset+s.peak*Math.sin(i/s.cycle),s.weight)}}}class Vr{constructor(e,t,i,n,s){this.parameterId=e??void 0,this.offset=t??0,this.peak=i??0,this.cycle=n??0,this.weight=s??0}}const Js=class{static create(r){return new Js(r)}setBlinkingInterval(r){this._blinkingIntervalSeconds=r}setBlinkingSetting(r,e,t){this._closingSeconds=r,this._closedSeconds=e,this._openingSeconds=t}setParameterIds(r){this._parameterIds=r}getParameterIds(){return this._parameterIds}updateParameters(r,e){this._userTimeSeconds+=e;let t,i=0;switch(this._blinkingState){case Ce.EyeState_Closing:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,i>=1&&(i=1,this._blinkingState=Ce.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),t=1-i;break;case Ce.EyeState_Closed:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,i>=1&&(this._blinkingState=Ce.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),t=0;break;case Ce.EyeState_Opening:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,i>=1&&(i=1,this._blinkingState=Ce.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),t=i;break;case Ce.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=Ce.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),t=1;break;case Ce.EyeState_First:default:this._blinkingState=Ce.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),t=1;break}Js.CloseIfZero||(t=-t);for(let n=0;n<this._parameterIds.length;++n)r.setParameterValueById(this._parameterIds[n],t)}constructor(r){var e,t;this._blinkingState=Ce.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],r!=null&&(this._parameterIds=(t=(e=r.getEyeBlinkParameters())==null?void 0:e.slice())!=null?t:this._parameterIds)}determinNextBlinkingTiming(){const r=Math.random();return this._userTimeSeconds+r*(2*this._blinkingIntervalSeconds-1)}};let Nh=Js;Nh.CloseIfZero=!0;var Ce=(r=>(r[r.EyeState_First=0]="EyeState_First",r[r.EyeState_Interval=1]="EyeState_Interval",r[r.EyeState_Closing=2]="EyeState_Closing",r[r.EyeState_Closed=3]="EyeState_Closed",r[r.EyeState_Opening=4]="EyeState_Opening",r))(Ce||{});class Zs{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.width=i,this.height=n}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}expand(e,t){this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2}}const ps=4,ry=10;let Lt,zr,Qs;class ms{getChannelFlagAsColor(e){return this._channelColors[e]}getMaskRenderTexture(){let e=0;if(this._maskTexture&&this._maskTexture.texture!=0&&(this._maskTexture.frameNo=this._currentFrameNo,e=this._maskTexture.texture),e==0){const t=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),e=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Qs),this._maskTexture=new iy(this._currentFrameNo,e)}return e}setGL(e){this.gl=e}calcClippedDrawTotalBounds(e,t){let i=Number.MAX_VALUE,n=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MIN_VALUE;const a=t._clippedDrawableIndexList.length;for(let u=0;u<a;u++){const l=t._clippedDrawableIndexList[u],h=e.getDrawableVertexCount(l),c=e.getDrawableVertices(l);let d=Number.MAX_VALUE,f=Number.MAX_VALUE,p=Number.MIN_VALUE,v=Number.MIN_VALUE;const m=h*ds.vertexStep;for(let y=ds.vertexOffset;y<m;y+=ds.vertexStep){const _=c[y],g=c[y+1];_<d&&(d=_),_>p&&(p=_),g<f&&(f=g),g>v&&(v=g)}if(d!=Number.MAX_VALUE)if(d<i&&(i=d),f<n&&(n=f),p>s&&(s=p),v>o&&(o=v),i==Number.MAX_VALUE)t._allClippedDrawRect.x=0,t._allClippedDrawRect.y=0,t._allClippedDrawRect.width=0,t._allClippedDrawRect.height=0,t._isUsing=!1;else{t._isUsing=!0;const y=s-i,_=o-n;t._allClippedDrawRect.x=i,t._allClippedDrawRect.y=n,t._allClippedDrawRect.width=y,t._allClippedDrawRect.height=_}}}constructor(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new Zs,this._tmpMatrix=new Pe,this._tmpMatrixForMask=new Pe,this._tmpMatrixForDraw=new Pe;let e=new jr;e.R=1,e.G=0,e.B=0,e.A=0,this._channelColors.push(e),e=new jr,e.R=0,e.G=1,e.B=0,e.A=0,this._channelColors.push(e),e=new jr,e.R=0,e.G=0,e.B=1,e.A=0,this._channelColors.push(e),e=new jr,e.R=0,e.G=0,e.B=0,e.A=1,this._channelColors.push(e)}release(){var e,t,i;const n=this;for(let s=0;s<this._clippingContextListForMask.length;s++)this._clippingContextListForMask[s]&&((e=this._clippingContextListForMask[s])==null||e.release());n._clippingContextListForMask=void 0,n._clippingContextListForDraw=void 0,this._maskTexture&&((t=this.gl)==null||t.deleteFramebuffer(this._maskTexture.texture),n._maskTexture=void 0),n._channelColors=void 0,(i=this.gl)==null||i.deleteTexture(this._colorBuffer),this._colorBuffer=null}initialize(e,t,i,n){for(let s=0;s<t;s++){if(n[s]<=0){this._clippingContextListForDraw.push(null);continue}let o=this.findSameClip(i[s],n[s]);o==null&&(o=new ny(this,i[s],n[s]),this._clippingContextListForMask.push(o)),o.addClippedDrawable(s),this._clippingContextListForDraw.push(o)}}setupClippingContext(e,t){this._currentFrameNo++;let i=0;for(let n=0;n<this._clippingContextListForMask.length;n++){const s=this._clippingContextListForMask[n];this.calcClippedDrawTotalBounds(e,s),s._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture(),t.getMvpMatrix(),t.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let n=0;n<this._clippingContextListForMask.length;n++){const s=this._clippingContextListForMask[n],o=s._allClippedDrawRect,a=s._layoutBounds,u=.05;this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.expand(o.width*u,o.height*u);const l=a.width/this._tmpBoundsOnModel.width,h=a.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(l,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(l,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),s._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),s._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const c=s._clippingIdCount;for(let d=0;d<c;d++){const f=s._clippingIdList[d];!e.getDrawableDynamicFlagVertexPositionsDidChange(f)||(t.setIsCulling(e.getDrawableCulling(f)!=!1),t.setClippingContextBufferForMask(s),t.drawMesh(e.getDrawableTextureIndices(f),e.getDrawableVertexIndexCount(f),e.getDrawableVertexCount(f),e.getDrawableVertexIndices(f),e.getDrawableVertices(f),e.getDrawableVertexUvs(f),e.getDrawableOpacity(f),bt.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Qs),t.setClippingContextBufferForMask(null),this.gl.viewport(zr[0],zr[1],zr[2],zr[3])}}findSameClip(e,t){for(let i=0;i<this._clippingContextListForMask.length;i++){const n=this._clippingContextListForMask[i],s=n._clippingIdCount;if(s!=t)continue;let o=0;for(let a=0;a<s;a++){const u=n._clippingIdList[a];for(let l=0;l<s;l++)if(e[l]==u){o++;break}}if(o==s)return n}return null}setupLayoutBounds(e){let t=e/ps,i=e%ps;t=~~t,i=~~i;let n=0;for(let s=0;s<ps;s++){const o=t+(s<i?1:0);if(o!=0)if(o==1){const a=this._clippingContextListForMask[n++];a._layoutChannelNo=s,a._layoutBounds.x=0,a._layoutBounds.y=0,a._layoutBounds.width=1,a._layoutBounds.height=1}else if(o==2)for(let a=0;a<o;a++){let u=a%2;u=~~u;const l=this._clippingContextListForMask[n++];l._layoutChannelNo=s,l._layoutBounds.x=u*.5,l._layoutBounds.y=0,l._layoutBounds.width=.5,l._layoutBounds.height=1}else if(o<=4)for(let a=0;a<o;a++){let u=a%2,l=a/2;u=~~u,l=~~l;const h=this._clippingContextListForMask[n++];h._layoutChannelNo=s,h._layoutBounds.x=u*.5,h._layoutBounds.y=l*.5,h._layoutBounds.width=.5,h._layoutBounds.height=.5}else if(o<=9)for(let a=0;a<o;a++){let u=a%3,l=a/3;u=~~u,l=~~l;const h=this._clippingContextListForMask[n++];h._layoutChannelNo=s,h._layoutBounds.x=u/3,h._layoutBounds.y=l/3,h._layoutBounds.width=1/3,h._layoutBounds.height=1/3}else if(li.supportMoreMaskDivisions&&o<=16)for(let a=0;a<o;a++){let u=a%4,l=a/4;u=~~u,l=~~l;const h=this._clippingContextListForMask[n++];h._layoutChannelNo=s,h._layoutBounds.x=u/4,h._layoutBounds.y=l/4,h._layoutBounds.width=1/4,h._layoutBounds.height=1/4}else fr("not supported mask count : {0}",o)}}getColorBuffer(){return this._colorBuffer}getClippingContextListForDraw(){return this._clippingContextListForDraw}setClippingMaskBufferSize(e){this._clippingMaskBufferSize=e}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}}class iy{constructor(e,t){this.frameNo=e,this.texture=t}}class ny{constructor(e,t,i){this._isUsing=!1,this._owner=e,this._clippingIdList=t,this._clippingIdCount=i,this._allClippedDrawRect=new Zs,this._layoutBounds=new Zs,this._clippedDrawableIndexList=[],this._matrixForMask=new Pe,this._matrixForDraw=new Pe}release(){const e=this;e._layoutBounds=void 0,e._allClippedDrawRect=void 0,e._clippedDrawableIndexList=void 0}addClippedDrawable(e){this._clippedDrawableIndexList.push(e)}getClippingManager(){return this._owner}setGl(e){this._owner.setGL(e)}}class Ir{static getInstance(){return Lt==null&&(Lt=new Ir),Lt}static deleteInstance(){Lt&&(Lt.release(),Lt=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(e,t,i,n,s,o,a,u,l,h,c,d,f){c||fr("NoPremultipliedAlpha is not allowed"),this._shaderSets.length==0&&this.generateShaders();let p,v,m,y;const _=e.getClippingContextBufferForMask();if(_!=null){const g=this._shaderSets[Xr.ShaderNames_SetupMask];this.gl.useProgram(g.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(g.samplerTexture0Location,0),a.vertex==null&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributePositionLocation),this.gl.vertexAttribPointer(g.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),a.uv==null&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributeTexCoordLocation),this.gl.vertexAttribPointer(g.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const b=_._layoutChannelNo,I=_.getClippingManager().getChannelFlagAsColor(b);this.gl.uniform4f(g.uniformChannelFlagLocation,I.R,I.G,I.B,I.A),this.gl.uniformMatrix4fv(g.uniformClipMatrixLocation,!1,_._matrixForMask.getArray());const T=_._layoutBounds;this.gl.uniform4f(g.uniformBaseColorLocation,T.x*2-1,T.y*2-1,T.getRight()*2-1,T.getBottom()*2-1),p=this.gl.ZERO,v=this.gl.ONE_MINUS_SRC_COLOR,m=this.gl.ZERO,y=this.gl.ONE_MINUS_SRC_ALPHA}else{const g=e.getClippingContextBufferForDraw(),I=g!=null?f?2:1:0;let T;switch(l){case bt.CubismBlendMode_Normal:default:T=this._shaderSets[Xr.ShaderNames_NormalPremultipliedAlpha+I],p=this.gl.ONE,v=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ONE,y=this.gl.ONE_MINUS_SRC_ALPHA;break;case bt.CubismBlendMode_Additive:T=this._shaderSets[Xr.ShaderNames_AddPremultipliedAlpha+I],p=this.gl.ONE,v=this.gl.ONE,m=this.gl.ZERO,y=this.gl.ONE;break;case bt.CubismBlendMode_Multiplicative:T=this._shaderSets[Xr.ShaderNames_MultPremultipliedAlpha+I],p=this.gl.DST_COLOR,v=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ZERO,y=this.gl.ONE;break}if(this.gl.useProgram(T.shaderProgram),a.vertex==null&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(T.attributePositionLocation),this.gl.vertexAttribPointer(T.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),a.uv==null&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(T.attributeTexCoordLocation),this.gl.vertexAttribPointer(T.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),g!=null){this.gl.activeTexture(this.gl.TEXTURE1);const R=g.getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,R),this.gl.uniform1i(T.samplerTexture1Location,1),this.gl.uniformMatrix4fv(T.uniformClipMatrixLocation,!1,g._matrixForDraw.getArray());const D=g._layoutChannelNo,M=g.getClippingManager().getChannelFlagAsColor(D);this.gl.uniform4f(T.uniformChannelFlagLocation,M.R,M.G,M.B,M.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(T.samplerTexture0Location,0),this.gl.uniformMatrix4fv(T.uniformMatrixLocation,!1,d.getArray()),this.gl.uniform4f(T.uniformBaseColorLocation,h.R,h.G,h.B,h.A)}a.index==null&&(a.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(p,v,m,y)}releaseShaderProgram(){for(let e=0;e<this._shaderSets.length;e++)this.gl.deleteProgram(this._shaderSets[e].shaderProgram),this._shaderSets[e].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let e=0;e<ry;e++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(sy,oy),this._shaderSets[1].shaderProgram=this.loadShaderProgram(ay,uy),this._shaderSets[2].shaderProgram=this.loadShaderProgram(Ru,ly),this._shaderSets[3].shaderProgram=this.loadShaderProgram(Ru,hy),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_position"),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_texCoord"),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"s_texture0"),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_clipMatrix"),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_channelFlag"),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_baseColor"),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_position"),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_texCoord"),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"s_texture0"),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_matrix"),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_baseColor"),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_position"),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_texCoord"),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture0"),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture1"),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_matrix"),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_clipMatrix"),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_channelFlag"),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_baseColor"),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_position"),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_texCoord"),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture0"),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture1"),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_matrix"),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_clipMatrix"),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_channelFlag"),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_baseColor"),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_position"),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_texCoord"),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"s_texture0"),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_matrix"),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_baseColor"),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_position"),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_texCoord"),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture0"),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture1"),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_matrix"),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_clipMatrix"),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_channelFlag"),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_baseColor"),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_position"),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_texCoord"),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture0"),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture1"),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_matrix"),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_clipMatrix"),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_channelFlag"),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_baseColor"),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_position"),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_texCoord"),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"s_texture0"),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_matrix"),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_baseColor"),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_position"),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_texCoord"),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture0"),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture1"),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_matrix"),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_clipMatrix"),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_channelFlag"),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_baseColor"),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_position"),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_texCoord"),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture0"),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture1"),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_matrix"),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_clipMatrix"),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_channelFlag"),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_baseColor")}loadShaderProgram(e,t){let i=this.gl.createProgram(),n=this.compileShaderSource(this.gl.VERTEX_SHADER,e);if(!n)return fr("Vertex shader compile error!"),0;let s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,t);return s?(this.gl.attachShader(i,n),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(n),this.gl.deleteShader(s),i):(fr("Failed to link program: {0}",i),this.gl.deleteShader(n),this.gl.deleteShader(s),i&&this.gl.deleteProgram(i),0)):(fr("Vertex shader compile error!"),0)}compileShaderSource(e,t){const i=t,n=this.gl.createShader(e);if(this.gl.shaderSource(n,i),this.gl.compileShader(n),!n){const o=this.gl.getShaderInfoLog(n);fr("Shader compile log: {0} ",o)}return this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(this.gl.deleteShader(n),null)}setGl(e){this.gl=e}}var Xr=(r=>(r[r.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",r[r.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",r[r.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",r[r.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",r[r.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",r[r.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",r))(Xr||{});const sy="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",oy="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",ay="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Ru="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",uy="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;void main(){   gl_FragColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;}",ly="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;void main(){   vec4 col_formask = texture2D(s_texture0 , v_texCoord) * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",hy="precision mediump float;varying vec2 v_texCoord;varying vec4 v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4 u_channelFlag;uniform vec4 u_baseColor;void main(){vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;col_formask = col_formask * (1.0 - maskVal);gl_FragColor = col_formask;}";class kh extends Oo{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._clippingManager=new ms,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}initialize(e){e.isUsingMasking()&&(this._clippingManager=new ms,this._clippingManager.initialize(e,e.getDrawableCount(),e.getDrawableMasks(),e.getDrawableMaskCounts()));for(let t=e.getDrawableCount()-1;t>=0;t--)this._sortedDrawableIndexList[t]=0;super.initialize(e)}bindTexture(e,t){this._textures[e]=t}getBindedTextures(){return this._textures}setClippingMaskBufferSize(e){this._clippingManager.release(),this._clippingManager=new ms,this._clippingManager.setClippingMaskBufferSize(e),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())}getClippingMaskBufferSize(){return this._clippingManager.getClippingMaskBufferSize()}release(){var e,t,i;const n=this;this._clippingManager.release(),n._clippingManager=void 0,(e=this.gl)==null||e.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,(t=this.gl)==null||t.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,(i=this.gl)==null||i.deleteBuffer(this._bufferData.index),this._bufferData.index=null,n._bufferData=void 0,n._textures=void 0}doDrawModel(){this.preDraw(),this._clippingManager!=null&&this._clippingManager.setupClippingContext(this.getModel(),this);const e=this.getModel().getDrawableCount(),t=this.getModel().getDrawableRenderOrders();for(let i=0;i<e;++i){const n=t[i];this._sortedDrawableIndexList[n]=i}for(let i=0;i<e;++i){const n=this._sortedDrawableIndexList[i];!this.getModel().getDrawableDynamicFlagIsVisible(n)||(this.setClippingContextBufferForDraw(this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw()[n]:null),this.setIsCulling(this.getModel().getDrawableCulling(n)),this.drawMesh(this.getModel().getDrawableTextureIndices(n),this.getModel().getDrawableVertexIndexCount(n),this.getModel().getDrawableVertexCount(n),this.getModel().getDrawableVertexIndices(n),this.getModel().getDrawableVertices(n),this.getModel().getDrawableVertexUvs(n),this.getModel().getDrawableOpacity(n),this.getModel().getDrawableBlendMode(n),this.getModel().getDrawableInvertedMaskBit(n)))}}drawMesh(e,t,i,n,s,o,a,u,l){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const h=this.getModelColor();this.getClippingContextBufferForMask()==null&&(h.A*=a,this.isPremultipliedAlpha()&&(h.R*=h.A,h.G*=h.A,h.B*=h.A));let c=null;this._textures[e]!=null&&(c=this._textures[e]),Ir.getInstance().setupShaderProgram(this,c,i,s,n,o,this._bufferData,a,u,h,this.isPremultipliedAlpha(),this.getMvpMatrix(),l),this.gl.drawElements(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}static doStaticRelease(){Ir.deleteInstance()}setRenderState(e,t){Qs=e,zr=t}preDraw(){this.firstDraw&&(this.firstDraw=!1,this._anisortopy=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}setClippingContextBufferForMask(e){this._clippingContextBufferForMask=e}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(e){this._clippingContextBufferForDraw=e}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(e){this.gl=e,this._clippingManager.setGL(e),Ir.getInstance().setGl(e)}}Oo.staticRelease=()=>{kh.doStaticRelease()};const Mu=new Pe;class cy extends wh{constructor(e,t,i){super(),this.lipSync=!0,this.breath=No.create(),this.renderer=new kh,this.idParamAngleX=qv,this.idParamAngleY=Kv,this.idParamAngleZ=Jv,this.idParamEyeBallX=Zv,this.idParamEyeBallY=Qv,this.idParamBodyAngleX=ey,this.idParamBreath=ty,this.pixelsPerUnit=1,this.centeringTransform=new ue,this.coreModel=e,this.settings=t,this.motionManager=new Yv(t,i),this.init()}init(){var e;super.init(),((e=this.settings.getEyeBlinkParameters())==null?void 0:e.length)>0&&(this.eyeBlink=Nh.create(this.settings)),this.breath.setParameters([new Vr(this.idParamAngleX,0,15,6.5345,.5),new Vr(this.idParamAngleY,0,8,3.5345,.5),new Vr(this.idParamAngleZ,0,10,5.5345,.5),new Vr(this.idParamBodyAngleX,0,4,15.5345,.5),new Vr(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const e={};if(this.settings.layout)for(const t of Object.keys(this.settings.layout)){const i=t.charAt(0).toLowerCase()+t.slice(1);e[i]=this.settings.layout[t]}return e}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(e,t){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(e),this.renderer._clippingManager._currentFrameNo=t,this.renderer._clippingManager._maskTexture=void 0,Ir.getInstance()._shaderSets=[]}bindTexture(e,t){this.renderer.bindTexture(e,t)}getHitAreaDefs(){var e,t;return(t=(e=this.settings.hitAreas)==null?void 0:e.map(i=>({id:i.Id,name:i.Name,index:this.coreModel.getDrawableIndex(i.Id)})))!=null?t:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(e){return this.coreModel.getDrawableIndex(e)}getDrawableVertices(e){if(typeof e=="string"&&(e=this.coreModel.getDrawableIndex(e),e===-1))throw new TypeError("Unable to find drawable ID: "+e);const t=this.coreModel.getDrawableVertices(e).slice();for(let i=0;i<t.length;i+=2)t[i]=t[i]*this.pixelsPerUnit+this.originalWidth/2,t[i+1]=-t[i+1]*this.pixelsPerUnit+this.originalHeight/2;return t}updateTransform(e){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(e)}update(e,t){var i,n,s,o;super.update(e,t),e/=1e3,t/=1e3;const a=this.coreModel;this.emit("beforeMotionUpdate");const u=this.motionManager.update(this.coreModel,t);this.emit("afterMotionUpdate"),a.saveParameters(),(i=this.motionManager.expressionManager)==null||i.update(a,t),u||(n=this.eyeBlink)==null||n.updateParameters(a,e),this.updateFocus(),this.updateNaturalMovements(e*1e3,t*1e3),(s=this.physics)==null||s.evaluate(a,e),(o=this.pose)==null||o.updateParameters(a,e),this.emit("beforeModelUpdate"),a.update(),a.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,this.focusController.x*30),this.coreModel.addParameterValueById(this.idParamAngleY,this.focusController.y*30),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,this.focusController.x*10)}updateNaturalMovements(e,t){var i;(i=this.breath)==null||i.updateParameters(this.coreModel,e/1e3)}draw(e){const t=this.drawingMatrix,i=Mu.getArray();i[0]=t.a,i[1]=t.b,i[4]=-t.c,i[5]=-t.d,i[12]=t.tx,i[13]=t.ty,this.renderer.setMvpMatrix(Mu),this.renderer.setRenderState(e.getParameter(e.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}let ji,Ou=20;function dy(){return hi.isStarted()?Promise.resolve():(ji??(ji=new Promise((r,e)=>{function t(){try{fy(),r()}catch(i){if(Ou--,Ou<0){const n=new Error("Failed to start up Cubism 4 framework.");n.cause=i,e(n);return}k.log("Cubism4","Startup failed, retrying 10ms later..."),setTimeout(t,10)}}t()})),ji)}function fy(r){r=Object.assign({logFunction:console.log,loggingLevel:nr.LogLevel_Verbose},r),hi.startUp(r),hi.initialize()}const py=.001,Fu=.5;class ko{static create(e){const t=new ko;typeof e.FadeInTime=="number"&&(t._fadeTimeSeconds=e.FadeInTime,t._fadeTimeSeconds<=0&&(t._fadeTimeSeconds=Fu));const i=e.Groups,n=i.length;for(let s=0;s<n;++s){const o=i[s],a=o.length;let u=0;for(let l=0;l<a;++l){const h=o[l],c=new dn;c.partId=h.Id;const d=h.Link;if(d){const f=d.length;for(let p=0;p<f;++p){const v=new dn;v.partId=d[p],c.link.push(v)}}t._partGroups.push(c),++u}t._partGroupCounts.push(u)}return t}updateParameters(e,t){e!=this._lastModel&&this.reset(e),this._lastModel=e,t<0&&(t=0);let i=0;for(let n=0;n<this._partGroupCounts.length;n++){const s=this._partGroupCounts[n];this.doFade(e,t,i,s),i+=s}this.copyPartOpacities(e)}reset(e){let t=0;for(let i=0;i<this._partGroupCounts.length;++i){const n=this._partGroupCounts[i];for(let s=t;s<t+n;++s){this._partGroups[s].initialize(e);const o=this._partGroups[s].partIndex,a=this._partGroups[s].parameterIndex;if(!(o<0)){e.setPartOpacityByIndex(o,s==t?1:0),e.setParameterValueByIndex(a,s==t?1:0);for(let u=0;u<this._partGroups[s].link.length;++u)this._partGroups[s].link[u].initialize(e)}}t+=n}}copyPartOpacities(e){for(let t=0;t<this._partGroups.length;++t){const i=this._partGroups[t];if(i.link.length==0)continue;const n=this._partGroups[t].partIndex,s=e.getPartOpacityByIndex(n);for(let o=0;o<i.link.length;++o){const u=i.link[o].partIndex;u<0||e.setPartOpacityByIndex(u,s)}}}doFade(e,t,i,n){let s=-1,o=1;const a=.5,u=.15;for(let l=i;l<i+n;++l){const h=this._partGroups[l].partIndex,c=this._partGroups[l].parameterIndex;if(e.getParameterValueByIndex(c)>py){if(s>=0)break;s=l,o=e.getPartOpacityByIndex(h),o+=t/this._fadeTimeSeconds,o>1&&(o=1)}}s<0&&(s=0,o=1);for(let l=i;l<i+n;++l){const h=this._partGroups[l].partIndex;if(s==l)e.setPartOpacityByIndex(h,o);else{let c=e.getPartOpacityByIndex(h),d;o<a?d=o*(a-1)/a+1:d=(1-o)*a/(1-a),(1-d)*(1-o)>u&&(d=1-u/(1-o)),c>d&&(c=d),e.setPartOpacityByIndex(h,c)}}}constructor(){this._fadeTimeSeconds=Fu,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class dn{constructor(e){this.parameterIndex=0,this.partIndex=0,this.partId="",this.link=[],e!=null&&this.assignment(e)}assignment(e){return this.partId=e.partId,this.link=e.link.map(t=>t.clone()),this}initialize(e){this.parameterIndex=e.getParameterIndex(this.partId),this.partIndex=e.getPartIndex(this.partId),e.setParameterValueByIndex(this.parameterIndex,1)}clone(){const e=new dn;return e.partId=this.partId,e.parameterIndex=this.parameterIndex,e.partIndex=this.partIndex,e.link=this.link.map(t=>t.clone()),e}}class my{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const e=this._model.parameters.count,t=this._savedParameters.length;for(let i=0;i<e;++i)i<t?this._savedParameters[i]=this._parameterValues[i]:this._savedParameters.push(this._parameterValues[i])}getModel(){return this._model}getPartIndex(e){let t;const i=this._model.parts.count;for(t=0;t<i;++t)if(e==this._partIds[t])return t;return e in this._notExistPartId?this._notExistPartId[e]:(t=i+this._notExistPartId.length,this._notExistPartId[e]=t,this._notExistPartOpacities[t]=0,t)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(e,t){if(e in this._notExistPartOpacities){this._notExistPartOpacities[e]=t;return}Hi(0<=e&&e<this.getPartCount()),this._partOpacities[e]=t}setPartOpacityById(e,t){const i=this.getPartIndex(e);i<0||this.setPartOpacityByIndex(i,t)}getPartOpacityByIndex(e){return e in this._notExistPartOpacities?this._notExistPartOpacities[e]:(Hi(0<=e&&e<this.getPartCount()),this._partOpacities[e])}getPartOpacityById(e){const t=this.getPartIndex(e);return t<0?0:this.getPartOpacityByIndex(t)}getParameterIndex(e){let t;const i=this._model.parameters.count;for(t=0;t<i;++t)if(e==this._parameterIds[t])return t;return e in this._notExistParameterId?this._notExistParameterId[e]:(t=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[e]=t,this._notExistParameterValues[t]=0,t)}getParameterCount(){return this._model.parameters.count}getParameterMaximumValue(e){return this._model.parameters.maximumValues[e]}getParameterMinimumValue(e){return this._model.parameters.minimumValues[e]}getParameterDefaultValue(e){return this._model.parameters.defaultValues[e]}getParameterValueByIndex(e){return e in this._notExistParameterValues?this._notExistParameterValues[e]:(Hi(0<=e&&e<this.getParameterCount()),this._parameterValues[e])}getParameterValueById(e){const t=this.getParameterIndex(e);return this.getParameterValueByIndex(t)}setParameterValueByIndex(e,t,i=1){if(e in this._notExistParameterValues){this._notExistParameterValues[e]=i==1?t:this._notExistParameterValues[e]*(1-i)+t*i;return}Hi(0<=e&&e<this.getParameterCount()),this._model.parameters.maximumValues[e]<t&&(t=this._model.parameters.maximumValues[e]),this._model.parameters.minimumValues[e]>t&&(t=this._model.parameters.minimumValues[e]),this._parameterValues[e]=i==1?t:this._parameterValues[e]=this._parameterValues[e]*(1-i)+t*i}setParameterValueById(e,t,i=1){const n=this.getParameterIndex(e);this.setParameterValueByIndex(n,t,i)}addParameterValueByIndex(e,t,i=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)+t*i)}addParameterValueById(e,t,i=1){const n=this.getParameterIndex(e);this.addParameterValueByIndex(n,t,i)}multiplyParameterValueById(e,t,i=1){const n=this.getParameterIndex(e);this.multiplyParameterValueByIndex(n,t,i)}multiplyParameterValueByIndex(e,t,i=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)*(1+(t-1)*i))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(e){const t=this._model.drawables.count;for(let i=0;i<t;++i)if(this._drawableIds[i]==e)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(e){return this._model.drawables.ids[e]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(e){return this._model.drawables.textureIndices[e]}getDrawableDynamicFlagVertexPositionsDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(t[e])}getDrawableVertexIndexCount(e){return this._model.drawables.indexCounts[e]}getDrawableVertexCount(e){return this._model.drawables.vertexCounts[e]}getDrawableVertices(e){return this.getDrawableVertexPositions(e)}getDrawableVertexIndices(e){return this._model.drawables.indices[e]}getDrawableVertexPositions(e){return this._model.drawables.vertexPositions[e]}getDrawableVertexUvs(e){return this._model.drawables.vertexUvs[e]}getDrawableOpacity(e){return this._model.drawables.opacities[e]}getDrawableCulling(e){const t=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(t[e])}getDrawableBlendMode(e){const t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(t[e])?bt.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(t[e])?bt.CubismBlendMode_Multiplicative:bt.CubismBlendMode_Normal}getDrawableInvertedMaskBit(e){const t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(t[e])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let e=0;e<this._model.drawables.count;++e)if(!(this._model.drawables.maskCounts[e]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(t[e])}getDrawableDynamicFlagVisibilityDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(t[e])}getDrawableDynamicFlagOpacityDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(t[e])}getDrawableDynamicFlagRenderOrderDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(t[e])}loadParameters(){let e=this._model.parameters.count;const t=this._savedParameters.length;e>t&&(e=t);for(let i=0;i<e;++i)this._parameterValues[i]=this._savedParameters[i]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,t=this._model.parameters.count;for(let i=0;i<t;++i)this._parameterIds.push(e[i])}{const e=this._model.parts.ids,t=this._model.parts.count;for(let i=0;i<t;++i)this._partIds.push(e[i])}{const e=this._model.drawables.ids,t=this._model.drawables.count;for(let i=0;i<t;++i)this._drawableIds.push(e[i])}}constructor(e){this._model=e,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class Bo{static create(e){const t=Live2DCubismCore.Moc.fromArrayBuffer(e);if(t)return new Bo(t);throw new Error("Unknown error")}createModel(){let e;const t=Live2DCubismCore.Model.fromMoc(this._moc);if(t)return e=new my(t),++this._modelCount,e;throw new Error("Unknown error")}deleteModel(e){e!=null&&--this._modelCount}constructor(e){this._moc=e,this._modelCount=0}release(){this._moc._release(),this._moc=void 0}}var eo=(r=>(r[r.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",r))(eo||{}),Vt=(r=>(r[r.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",r[r.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",r[r.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",r))(Vt||{});class gy{constructor(){this.initialPosition=new A(0,0),this.position=new A(0,0),this.lastPosition=new A(0,0),this.lastGravity=new A(0,0),this.force=new A(0,0),this.velocity=new A(0,0)}}class vy{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class yy{constructor(){this.source={}}}class _y{constructor(){this.destination={},this.translationScale=new A(0,0)}}class by{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new A(0,0),this.wind=new A(0,0)}}class Ey{constructor(e){this._json=e}release(){this._json=void 0}getGravity(){const e=new A(0,0);return e.x=this._json.Meta.EffectiveForces.Gravity.X,e.y=this._json.Meta.EffectiveForces.Gravity.Y,e}getWind(){const e=new A(0,0);return e.x=this._json.Meta.EffectiveForces.Wind.X,e.y=this._json.Meta.EffectiveForces.Wind.Y,e}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Default}getNormalizationAngleMinimumValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Default}getInputCount(e){return this._json.PhysicsSettings[e].Input.length}getInputWeight(e,t){return this._json.PhysicsSettings[e].Input[t].Weight}getInputReflect(e,t){return this._json.PhysicsSettings[e].Input[t].Reflect}getInputType(e,t){return this._json.PhysicsSettings[e].Input[t].Type}getInputSourceId(e,t){return this._json.PhysicsSettings[e].Input[t].Source.Id}getOutputCount(e){return this._json.PhysicsSettings[e].Output.length}getOutputVertexIndex(e,t){return this._json.PhysicsSettings[e].Output[t].VertexIndex}getOutputAngleScale(e,t){return this._json.PhysicsSettings[e].Output[t].Scale}getOutputWeight(e,t){return this._json.PhysicsSettings[e].Output[t].Weight}getOutputDestinationId(e,t){return this._json.PhysicsSettings[e].Output[t].Destination.Id}getOutputType(e,t){return this._json.PhysicsSettings[e].Output[t].Type}getOutputReflect(e,t){return this._json.PhysicsSettings[e].Output[t].Reflect}getParticleCount(e){return this._json.PhysicsSettings[e].Vertices.length}getParticleMobility(e,t){return this._json.PhysicsSettings[e].Vertices[t].Mobility}getParticleDelay(e,t){return this._json.PhysicsSettings[e].Vertices[t].Delay}getParticleAcceleration(e,t){return this._json.PhysicsSettings[e].Vertices[t].Acceleration}getParticleRadius(e,t){return this._json.PhysicsSettings[e].Vertices[t].Radius}getParticlePosition(e,t){const i=new A(0,0);return i.x=this._json.PhysicsSettings[e].Vertices[t].Position.X,i.y=this._json.PhysicsSettings[e].Vertices[t].Position.Y,i}}const Lu="X",Du="Y",Nu="Angle",Iy=5,Bh=100,Ty=.001;class Uo{static create(e){const t=new Uo;return t.parse(e),t._physicsRig.gravity.y=0,t}evaluate(e,t){let i,n,s,o;const a=new A;let u,l,h,c,d,f,p,v;d=e.getModel().parameters.values,f=e.getModel().parameters.maximumValues,p=e.getModel().parameters.minimumValues,v=e.getModel().parameters.defaultValues;for(let m=0;m<this._physicsRig.subRigCount;++m){i={angle:0},a.x=0,a.y=0,u=this._physicsRig.settings[m],l=this._physicsRig.inputs.slice(u.baseInputIndex),h=this._physicsRig.outputs.slice(u.baseOutputIndex),c=this._physicsRig.particles.slice(u.baseParticleIndex);for(let y=0;y<u.inputCount;++y)n=l[y].weight/Bh,l[y].sourceParameterIndex==-1&&(l[y].sourceParameterIndex=e.getParameterIndex(l[y].source.id)),l[y].getNormalizedParameterValue(a,i,d[l[y].sourceParameterIndex],p[l[y].sourceParameterIndex],f[l[y].sourceParameterIndex],v[l[y].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,l[y].reflect,n);s=U.degreesToRadian(-i.angle),a.x=a.x*U.cos(s)-a.y*U.sin(s),a.y=a.x*U.sin(s)+a.y*U.cos(s),Ny(c,u.particleCount,a,i.angle,this._options.wind,Ty*u.normalizationPosition.maximum,t,Iy);for(let y=0;y<u.outputCount;++y){const _=h[y].vertexIndex;if(_<1||_>=u.particleCount)break;h[y].destinationParameterIndex==-1&&(h[y].destinationParameterIndex=e.getParameterIndex(h[y].destination.id));const g=new A;g.x=c[_].position.x-c[_-1].position.x,g.y=c[_].position.y-c[_-1].position.y,o=h[y].getValue(g,c,_,h[y].reflect,this._options.gravity);const b=h[y].destinationParameterIndex,I=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(d.subarray(b))):d.slice(b);ky(I,p[b],f[b],o,h[y]);for(let T=b,R=0;T<d.length;T++,R++)d[T]=I[R]}}}setOptions(e){this._options=e}getOption(){return this._options}constructor(){this._options=new wy,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0}release(){this._physicsRig=void 0}parse(e){this._physicsRig=new by;let t=new Ey(e);this._physicsRig.gravity=t.getGravity(),this._physicsRig.wind=t.getWind(),this._physicsRig.subRigCount=t.getSubRigCount();let i=0,n=0,s=0;for(let o=0;o<this._physicsRig.subRigCount;++o){const a=new vy;a.normalizationPosition.minimum=t.getNormalizationPositionMinimumValue(o),a.normalizationPosition.maximum=t.getNormalizationPositionMaximumValue(o),a.normalizationPosition.defalut=t.getNormalizationPositionDefaultValue(o),a.normalizationAngle.minimum=t.getNormalizationAngleMinimumValue(o),a.normalizationAngle.maximum=t.getNormalizationAngleMaximumValue(o),a.normalizationAngle.defalut=t.getNormalizationAngleDefaultValue(o),a.inputCount=t.getInputCount(o),a.baseInputIndex=i,i+=a.inputCount;for(let u=0;u<a.inputCount;++u){const l=new yy;switch(l.sourceParameterIndex=-1,l.weight=t.getInputWeight(o,u),l.reflect=t.getInputReflect(o,u),t.getInputType(o,u)){case Lu:l.type=Vt.CubismPhysicsSource_X,l.getNormalizedParameterValue=xy;break;case Du:l.type=Vt.CubismPhysicsSource_Y,l.getNormalizedParameterValue=Sy;break;case Nu:l.type=Vt.CubismPhysicsSource_Angle,l.getNormalizedParameterValue=Cy;break}l.source.targetType=eo.CubismPhysicsTargetType_Parameter,l.source.id=t.getInputSourceId(o,u),this._physicsRig.inputs.push(l)}a.outputCount=t.getOutputCount(o),a.baseOutputIndex=n,n+=a.outputCount;for(let u=0;u<a.outputCount;++u){const l=new _y;switch(l.destinationParameterIndex=-1,l.vertexIndex=t.getOutputVertexIndex(o,u),l.angleScale=t.getOutputAngleScale(o,u),l.weight=t.getOutputWeight(o,u),l.destination.targetType=eo.CubismPhysicsTargetType_Parameter,l.destination.id=t.getOutputDestinationId(o,u),t.getOutputType(o,u)){case Lu:l.type=Vt.CubismPhysicsSource_X,l.getValue=Ay,l.getScale=Fy;break;case Du:l.type=Vt.CubismPhysicsSource_Y,l.getValue=Py,l.getScale=Ly;break;case Nu:l.type=Vt.CubismPhysicsSource_Angle,l.getValue=Ry,l.getScale=Dy;break}l.reflect=t.getOutputReflect(o,u),this._physicsRig.outputs.push(l)}a.particleCount=t.getParticleCount(o),a.baseParticleIndex=s,s+=a.particleCount;for(let u=0;u<a.particleCount;++u){const l=new gy;l.mobility=t.getParticleMobility(o,u),l.delay=t.getParticleDelay(o,u),l.acceleration=t.getParticleAcceleration(o,u),l.radius=t.getParticleRadius(o,u),l.position=t.getParticlePosition(o,u),this._physicsRig.particles.push(l)}this._physicsRig.settings.push(a)}this.initialize(),t.release()}initialize(){let e,t,i;for(let n=0;n<this._physicsRig.subRigCount;++n){t=this._physicsRig.settings[n],e=this._physicsRig.particles.slice(t.baseParticleIndex),e[0].initialPosition=new A(0,0),e[0].lastPosition=new A(e[0].initialPosition.x,e[0].initialPosition.y),e[0].lastGravity=new A(0,-1),e[0].lastGravity.y*=-1,e[0].velocity=new A(0,0),e[0].force=new A(0,0);for(let s=1;s<t.particleCount;++s)i=new A(0,0),i.y=e[s].radius,e[s].initialPosition=new A(e[s-1].initialPosition.x+i.x,e[s-1].initialPosition.y+i.y),e[s].position=new A(e[s].initialPosition.x,e[s].initialPosition.y),e[s].lastPosition=new A(e[s].initialPosition.x,e[s].initialPosition.y),e[s].lastGravity=new A(0,-1),e[s].lastGravity.y*=-1,e[s].velocity=new A(0,0),e[s].force=new A(0,0)}}}class wy{constructor(){this.gravity=new A(0,0),this.wind=new A(0,0)}}function xy(r,e,t,i,n,s,o,a,u,l){r.x+=Go(t,i,n,s,o.minimum,o.maximum,o.defalut,u)*l}function Sy(r,e,t,i,n,s,o,a,u,l){r.y+=Go(t,i,n,s,o.minimum,o.maximum,o.defalut,u)*l}function Cy(r,e,t,i,n,s,o,a,u,l){e.angle+=Go(t,i,n,s,a.minimum,a.maximum,a.defalut,u)*l}function Ay(r,e,t,i,n){let s=r.x;return i&&(s*=-1),s}function Py(r,e,t,i,n){let s=r.y;return i&&(s*=-1),s}function Ry(r,e,t,i,n){let s;return t>=2?n=e[t-1].position.substract(e[t-2].position):n=n.multiplyByScaler(-1),s=U.directionToRadian(n,r),i&&(s*=-1),s}function My(r,e){return Math.abs(Math.max(r,e)-Math.min(r,e))}function Oy(r,e){return Math.min(r,e)+My(r,e)/2}function Fy(r,e){return r.x}function Ly(r,e){return r.y}function Dy(r,e){return e}function Ny(r,e,t,i,n,s,o,a){let u,l,h,c,d=new A(0,0),f=new A(0,0),p=new A(0,0),v=new A(0,0);r[0].position=new A(t.x,t.y),u=U.degreesToRadian(i),c=U.radianToDirection(u),c.normalize();for(let m=1;m<e;++m)r[m].force=c.multiplyByScaler(r[m].acceleration).add(n),r[m].lastPosition=new A(r[m].position.x,r[m].position.y),l=r[m].delay*o*30,d=r[m].position.substract(r[m-1].position),h=U.directionToRadian(r[m].lastGravity,c)/a,d.x=U.cos(h)*d.x-d.y*U.sin(h),d.y=U.sin(h)*d.x+d.y*U.cos(h),r[m].position=r[m-1].position.add(d),f=r[m].velocity.multiplyByScaler(l),p=r[m].force.multiplyByScaler(l).multiplyByScaler(l),r[m].position=r[m].position.add(f).add(p),v=r[m].position.substract(r[m-1].position),v.normalize(),r[m].position=r[m-1].position.add(v.multiplyByScaler(r[m].radius)),U.abs(r[m].position.x)<s&&(r[m].position.x=0),l!=0&&(r[m].velocity=r[m].position.substract(r[m].lastPosition),r[m].velocity=r[m].velocity.divisionByScalar(l),r[m].velocity=r[m].velocity.multiplyByScaler(r[m].mobility)),r[m].force=new A(0,0),r[m].lastGravity=new A(c.x,c.y)}function ky(r,e,t,i,n){let s,o,a;s=n.getScale(n.translationScale,n.angleScale),o=i*s,o<e?(o<n.valueBelowMinimum&&(n.valueBelowMinimum=o),o=e):o>t&&(o>n.valueExceededMaximum&&(n.valueExceededMaximum=o),o=t),a=n.weight/Bh,a>=1||(o=r[0]*(1-a)+o*a),r[0]=o}function Go(r,e,t,i,n,s,o,a){let u=0;const l=U.max(t,e);l<r&&(r=l);const h=U.min(t,e);h>r&&(r=h);const c=U.min(n,s),d=U.max(n,s),f=o,p=Oy(h,l),v=r-p;switch(Math.sign(v)){case 1:{const m=d-f,y=l-p;y!=0&&(u=v*(m/y),u+=f);break}case-1:{const m=c-f,y=h-p;y!=0&&(u=v*(m/y),u+=f);break}case 0:{u=f;break}}return a?u:u*-1}V.registerRuntime({version:4,ready:dy,test(r){return r instanceof Er||Er.isValidJSON(r)},isValidMoc(r){if(r.byteLength<4)return!1;const e=new Int8Array(r,0,4);return String.fromCharCode(...e)==="MOC3"},createModelSettings(r){return new Er(r)},createCoreModel(r){const e=Bo.create(r);try{const t=e.createModel();return t.__moc=e,t}catch(t){try{e.release()}catch{}throw t}},createInternalModel(r,e,t){const i=new cy(r,e,t),n=r;return n.__moc&&(i.__moc=n.__moc,delete n.__moc,i.once("destroy",By)),i},createPhysics(r,e){return Uo.create(e)},createPose(r,e){return ko.create(e)}});function By(){var r;(r=this.__moc)==null||r.release()}Ro.registerTicker(Le);Ao.registerPlugin(pm);So.registerPlugin("interaction",nv);const Ht=document.getElementById("canvas"),pr=new Ao({backgroundAlpha:0,view:Ht});let se;const Uy={happy:1,sad:2,angry:3},Gy={talk:[["tap_body",0],["tap_body",2],["pinch_out",0],["flick_head",1],["flick_head",2]],cheer:[["tap_body",1]],mouthcover:[["pinch_in",0],["pinch_in",1],["pinch_in",2]],disagree:[["pinch_out",1],["pinch_out",2]],surprised:[["shake",0],["shake",2]],laugh:[["shake",1]]};Ro.from("live2d/shizuku.model.json",{autoInteract:!1,motionPreload:Th.IDLE}).then(r=>{se=r,pr.stage.addChild(se);let e=!1;Ht.addEventListener("pointerdown",i=>se.tap(i.clientX,i.clientY)),Ht.addEventListener("pointerenter",()=>e=!0),Ht.addEventListener("pointerleave",()=>{se.internalModel.focusController.focus(0,0),e=!1}),Ht.addEventListener("pointermove",({clientX:i,clientY:n})=>{e&&se.focus(i,n)}),se.on("hit",i=>{i.includes("head")&&se.motion("shake",1)});function t(){if(!se)return;const i={md:window.innerWidth>720&&window.innerWidth<1e3,lg:window.innerWidth>=1e3};Ht.width=window.innerWidth,Ht.height=window.innerHeight,!i.md&&!i.lg&&(pr.renderer.screen.width=window.innerWidth),pr.renderer.screen.height=window.innerHeight;const n={x:i.lg?1:.5,y:.85},s={x:i.lg?.4:i.md?.35:.25,y:i.lg?.475:i.md?.425:.3},o=i.md?se.width/2.35:i.lg?se.width:pr.renderer.screen.width/2,a=i.md||i.lg?pr.renderer.screen.height:se.height;se.anchor.set(n.x,n.y),se.scale.set(s.x,s.y),se.x=o,se.y=a}t(),setTimeout(()=>{se&&t()},250),window.addEventListener("resize",t),document.getElementById("loader").style.display="none"});const Uh={app:pr,expressions:Uy,model:se,motions:Gy};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gh=function(r){const e=[];let t=0;for(let i=0;i<r.length;i++){let n=r.charCodeAt(i);n<128?e[t++]=n:n<2048?(e[t++]=n>>6|192,e[t++]=n&63|128):(n&64512)===55296&&i+1<r.length&&(r.charCodeAt(i+1)&64512)===56320?(n=65536+((n&1023)<<10)+(r.charCodeAt(++i)&1023),e[t++]=n>>18|240,e[t++]=n>>12&63|128,e[t++]=n>>6&63|128,e[t++]=n&63|128):(e[t++]=n>>12|224,e[t++]=n>>6&63|128,e[t++]=n&63|128)}return e},Vy=function(r){const e=[];let t=0,i=0;for(;t<r.length;){const n=r[t++];if(n<128)e[i++]=String.fromCharCode(n);else if(n>191&&n<224){const s=r[t++];e[i++]=String.fromCharCode((n&31)<<6|s&63)}else if(n>239&&n<365){const s=r[t++],o=r[t++],a=r[t++],u=((n&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(u>>10)),e[i++]=String.fromCharCode(56320+(u&1023))}else{const s=r[t++],o=r[t++];e[i++]=String.fromCharCode((n&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Vh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let n=0;n<r.length;n+=3){const s=r[n],o=n+1<r.length,a=o?r[n+1]:0,u=n+2<r.length,l=u?r[n+2]:0,h=s>>2,c=(s&3)<<4|a>>4;let d=(a&15)<<2|l>>6,f=l&63;u||(f=64,o||(d=64)),i.push(t[h],t[c],t[d],t[f])}return i.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(Gh(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):Vy(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let n=0;n<r.length;){const s=t[r.charAt(n++)],a=n<r.length?t[r.charAt(n)]:0;++n;const l=n<r.length?t[r.charAt(n)]:64;++n;const c=n<r.length?t[r.charAt(n)]:64;if(++n,s==null||a==null||l==null||c==null)throw new Hy;const d=s<<2|a>>4;if(i.push(d),l!==64){const f=a<<4&240|l>>2;if(i.push(f),c!==64){const p=l<<6&192|c;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Hy extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const jy=function(r){const e=Gh(r);return Vh.encodeByteArray(e,!0)},Hh=function(r){return jy(r).replace(/\./g,"")},jh=function(r){try{return Vh.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $y(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zy=()=>$y().__FIREBASE_DEFAULTS__,Xy=()=>{if(typeof process>"u"||typeof process.env>"u")return;const r={}.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Wy=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&jh(r[1]);return e&&JSON.parse(e)},Vo=()=>{try{return zy()||Xy()||Wy()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Yy=r=>{var e,t;return(t=(e=Vo())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},$h=()=>{var r;return(r=Vo())===null||r===void 0?void 0:r.config},zh=r=>{var e;return(e=Vo())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ge(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ky(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ge())}function Jy(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Xh(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Zy(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Qy(){const r=ge();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function Wh(){try{return typeof indexedDB=="object"}catch{return!1}}function Yh(){return new Promise((r,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(i);n.onsuccess=()=>{n.result.close(),t||self.indexedDB.deleteDatabase(i),r(!0)},n.onupgradeneeded=()=>{t=!1},n.onerror=()=>{var s;e(((s=n.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}function e_(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t_="FirebaseError";class Be extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=t_,Object.setPrototypeOf(this,Be.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,sr.prototype.create)}}class sr{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},n=`${this.service}/${e}`,s=this.errors[e],o=s?r_(s,i):"Error",a=`${this.serviceName}: ${o} (${n}).`;return new Be(n,a,i)}}function r_(r,e){return r.replace(i_,(t,i)=>{const n=e[i];return n!=null?String(n):`<${i}?>`})}const i_=/\{\$([^}]+)}/g;function n_(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function ci(r,e){if(r===e)return!0;const t=Object.keys(r),i=Object.keys(e);for(const n of t){if(!i.includes(n))return!1;const s=r[n],o=e[n];if(ku(s)&&ku(o)){if(!ci(s,o))return!1}else if(s!==o)return!1}for(const n of i)if(!t.includes(n))return!1;return!0}function ku(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _i(r){const e=[];for(const[t,i]of Object.entries(r))Array.isArray(i)?i.forEach(n=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function s_(r,e){const t=new o_(r,e);return t.subscribe.bind(t)}class o_{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let n;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");a_(e,["next","error","complete"])?n=e:n={next:e,error:t,complete:i},n.next===void 0&&(n.next=gs),n.error===void 0&&(n.error=gs),n.complete===void 0&&(n.complete=gs);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch{}}),this.observers.push(n),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function a_(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function gs(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u_=1e3,l_=2,h_=4*60*60*1e3,c_=.5;function Bu(r,e=u_,t=l_){const i=e*Math.pow(t,r),n=Math.round(c_*i*(Math.random()-.5)*2);return Math.min(h_,i+n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ut(r){return r&&r._delegate?r._delegate:r}class ke{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jt="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new qy;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&i.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),n=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(p_(e))try{this.getOrInitializeService({instanceIdentifier:jt})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:n});i.resolve(s)}catch{}}}}clearInstance(e=jt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=jt){return this.instances.has(e)}getOptions(e=jt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(n)}return n}onInit(e,t){var i;const n=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(n))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(n,s);const o=this.instances.get(n);return o&&e(o,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(!!i)for(const n of i)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:f_(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=jt){return this.component?this.component.multipleInstances?e:jt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function f_(r){return r===jt?void 0:r}function p_(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new d_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var N;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(N||(N={}));const g_={debug:N.DEBUG,verbose:N.VERBOSE,info:N.INFO,warn:N.WARN,error:N.ERROR,silent:N.SILENT},v_=N.INFO,y_={[N.DEBUG]:"log",[N.VERBOSE]:"log",[N.INFO]:"info",[N.WARN]:"warn",[N.ERROR]:"error"},__=(r,e,...t)=>{if(e<r.logLevel)return;const i=new Date().toISOString(),n=y_[e];if(n)console[n](`[${i}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ho{constructor(e){this.name=e,this._logLevel=v_,this._logHandler=__,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in N))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?g_[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,N.DEBUG,...e),this._logHandler(this,N.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,N.VERBOSE,...e),this._logHandler(this,N.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,N.INFO,...e),this._logHandler(this,N.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,N.WARN,...e),this._logHandler(this,N.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,N.ERROR,...e),this._logHandler(this,N.ERROR,...e)}}const b_=(r,e)=>e.some(t=>r instanceof t);let Uu,Gu;function E_(){return Uu||(Uu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function I_(){return Gu||(Gu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qh=new WeakMap,to=new WeakMap,Kh=new WeakMap,vs=new WeakMap,jo=new WeakMap;function T_(r){const e=new Promise((t,i)=>{const n=()=>{r.removeEventListener("success",s),r.removeEventListener("error",o)},s=()=>{t(Et(r.result)),n()},o=()=>{i(r.error),n()};r.addEventListener("success",s),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&qh.set(t,r)}).catch(()=>{}),jo.set(e,r),e}function w_(r){if(to.has(r))return;const e=new Promise((t,i)=>{const n=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",o),r.removeEventListener("abort",o)},s=()=>{t(),n()},o=()=>{i(r.error||new DOMException("AbortError","AbortError")),n()};r.addEventListener("complete",s),r.addEventListener("error",o),r.addEventListener("abort",o)});to.set(r,e)}let ro={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return to.get(r);if(e==="objectStoreNames")return r.objectStoreNames||Kh.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Et(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function x_(r){ro=r(ro)}function S_(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=r.call(ys(this),e,...t);return Kh.set(i,e.sort?e.sort():[e]),Et(i)}:I_().includes(r)?function(...e){return r.apply(ys(this),e),Et(qh.get(this))}:function(...e){return Et(r.apply(ys(this),e))}}function C_(r){return typeof r=="function"?S_(r):(r instanceof IDBTransaction&&w_(r),b_(r,E_())?new Proxy(r,ro):r)}function Et(r){if(r instanceof IDBRequest)return T_(r);if(vs.has(r))return vs.get(r);const e=C_(r);return e!==r&&(vs.set(r,e),jo.set(e,r)),e}const ys=r=>jo.get(r);function Jh(r,e,{blocked:t,upgrade:i,blocking:n,terminated:s}={}){const o=indexedDB.open(r,e),a=Et(o);return i&&o.addEventListener("upgradeneeded",u=>{i(Et(o.result),u.oldVersion,u.newVersion,Et(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),a.then(u=>{s&&u.addEventListener("close",()=>s()),n&&u.addEventListener("versionchange",l=>n(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const A_=["get","getKey","getAll","getAllKeys","count"],P_=["put","add","delete","clear"],_s=new Map;function Vu(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(_s.get(e))return _s.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,n=P_.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(n||A_.includes(t)))return;const s=async function(o,...a){const u=this.transaction(o,n?"readwrite":"readonly");let l=u.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[t](...a),n&&u.done]))[0]};return _s.set(e,s),s}x_(r=>({...r,get:(e,t,i)=>Vu(e,t)||r.get(e,t,i),has:(e,t)=>!!Vu(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(M_(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function M_(r){const e=r.getComponent();return e?.type==="VERSION"}const io="@firebase/app",Hu="0.10.15";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ot=new Ho("@firebase/app"),O_="@firebase/app-compat",F_="@firebase/analytics-compat",L_="@firebase/analytics",D_="@firebase/app-check-compat",N_="@firebase/app-check",k_="@firebase/auth",B_="@firebase/auth-compat",U_="@firebase/database",G_="@firebase/data-connect",V_="@firebase/database-compat",H_="@firebase/functions",j_="@firebase/functions-compat",$_="@firebase/installations",z_="@firebase/installations-compat",X_="@firebase/messaging",W_="@firebase/messaging-compat",Y_="@firebase/performance",q_="@firebase/performance-compat",K_="@firebase/remote-config",J_="@firebase/remote-config-compat",Z_="@firebase/storage",Q_="@firebase/storage-compat",e0="@firebase/firestore",t0="@firebase/vertexai",r0="@firebase/firestore-compat",i0="firebase",n0="11.0.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const no="[DEFAULT]",s0={[io]:"fire-core",[O_]:"fire-core-compat",[L_]:"fire-analytics",[F_]:"fire-analytics-compat",[N_]:"fire-app-check",[D_]:"fire-app-check-compat",[k_]:"fire-auth",[B_]:"fire-auth-compat",[U_]:"fire-rtdb",[G_]:"fire-data-connect",[V_]:"fire-rtdb-compat",[H_]:"fire-fn",[j_]:"fire-fn-compat",[$_]:"fire-iid",[z_]:"fire-iid-compat",[X_]:"fire-fcm",[W_]:"fire-fcm-compat",[Y_]:"fire-perf",[q_]:"fire-perf-compat",[K_]:"fire-rc",[J_]:"fire-rc-compat",[Z_]:"fire-gcs",[Q_]:"fire-gcs-compat",[e0]:"fire-fst",[r0]:"fire-fst-compat",[t0]:"fire-vertex","fire-js":"fire-js",[i0]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fn=new Map,o0=new Map,so=new Map;function ju(r,e){try{r.container.addComponent(e)}catch(t){ot.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function qe(r){const e=r.name;if(so.has(e))return ot.debug(`There were multiple attempts to register component ${e}.`),!1;so.set(e,r);for(const t of fn.values())ju(t,r);for(const t of o0.values())ju(t,r);return!0}function or(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function tt(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a0={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},It=new sr("app","Firebase",a0);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new ke("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw It.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bi=n0;function $o(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const i=Object.assign({name:no,automaticDataCollectionEnabled:!1},e),n=i.name;if(typeof n!="string"||!n)throw It.create("bad-app-name",{appName:String(n)});if(t||(t=$h()),!t)throw It.create("no-options");const s=fn.get(n);if(s){if(ci(t,s.options)&&ci(i,s.config))return s;throw It.create("duplicate-app",{appName:n})}const o=new m_(n);for(const u of so.values())o.addComponent(u);const a=new u0(t,i,o);return fn.set(n,a),a}function zo(r=no){const e=fn.get(r);if(!e&&r===no&&$h())return $o();if(!e)throw It.create("no-app",{appName:r});return e}function Re(r,e,t){var i;let n=(i=s0[r])!==null&&i!==void 0?i:r;t&&(n+=`-${t}`);const s=n.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${n}" with version "${e}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ot.warn(a.join(" "));return}qe(new ke(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l0="firebase-heartbeat-database",h0=1,di="firebase-heartbeat-store";let bs=null;function Zh(){return bs||(bs=Jh(l0,h0,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(di)}catch(t){console.warn(t)}}}}).catch(r=>{throw It.create("idb-open",{originalErrorMessage:r.message})})),bs}async function c0(r){try{const t=(await Zh()).transaction(di),i=await t.objectStore(di).get(Qh(r));return await t.done,i}catch(e){if(e instanceof Be)ot.warn(e.message);else{const t=It.create("idb-get",{originalErrorMessage:e?.message});ot.warn(t.message)}}}async function $u(r,e){try{const i=(await Zh()).transaction(di,"readwrite");await i.objectStore(di).put(e,Qh(r)),await i.done}catch(t){if(t instanceof Be)ot.warn(t.message);else{const i=It.create("idb-set",{originalErrorMessage:t?.message});ot.warn(i.message)}}}function Qh(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d0=1024,f0=30*24*60*60*1e3;class p0{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new g0(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=zu();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=f0}),this._storage.overwrite(this._heartbeatsCache))}catch(i){ot.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=zu(),{heartbeatsToSend:i,unsentEntries:n}=m0(this._heartbeatsCache.heartbeats),s=Hh(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return ot.warn(t),""}}}function zu(){return new Date().toISOString().substring(0,10)}function m0(r,e=d0){const t=[];let i=r.slice();for(const n of r){const s=t.find(o=>o.agent===n.agent);if(s){if(s.dates.push(n.date),Xu(t)>e){s.dates.pop();break}}else if(t.push({agent:n.agent,dates:[n.date]}),Xu(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class g0{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Wh()?Yh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await c0(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return $u(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return $u(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Xu(r){return Hh(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v0(r){qe(new ke("platform-logger",e=>new R_(e),"PRIVATE")),qe(new ke("heartbeat",e=>new p0(e),"PRIVATE")),Re(io,Hu,r),Re(io,Hu,"esm2017"),Re("fire-js","")}v0("");var y0="firebase",_0="11.0.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Re(y0,_0,"app");const ec="@firebase/installations",Xo="0.6.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc=1e4,rc=`w:${Xo}`,ic="FIS_v2",b0="https://firebaseinstallations.googleapis.com/v1",E0=60*60*1e3,I0="installations",T0="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w0={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},tr=new sr(I0,T0,w0);function nc(r){return r instanceof Be&&r.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sc({projectId:r}){return`${b0}/projects/${r}/installations`}function oc(r){return{token:r.token,requestStatus:2,expiresIn:S0(r.expiresIn),creationTime:Date.now()}}async function ac(r,e){const i=(await e.json()).error;return tr.create("request-failed",{requestName:r,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function uc({apiKey:r}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":r})}function x0(r,{refreshToken:e}){const t=uc(r);return t.append("Authorization",C0(e)),t}async function lc(r){const e=await r();return e.status>=500&&e.status<600?r():e}function S0(r){return Number(r.replace("s","000"))}function C0(r){return`${ic} ${r}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A0({appConfig:r,heartbeatServiceProvider:e},{fid:t}){const i=sc(r),n=uc(r),s=e.getImmediate({optional:!0});if(s){const l=await s.getHeartbeatsHeader();l&&n.append("x-firebase-client",l)}const o={fid:t,authVersion:ic,appId:r.appId,sdkVersion:rc},a={method:"POST",headers:n,body:JSON.stringify(o)},u=await lc(()=>fetch(i,a));if(u.ok){const l=await u.json();return{fid:l.fid||t,registrationStatus:2,refreshToken:l.refreshToken,authToken:oc(l.authToken)}}else throw await ac("Create Installation",u)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hc(r){return new Promise(e=>{setTimeout(e,r)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P0(r){return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R0=/^[cdef][\w-]{21}$/,oo="";function M0(){try{const r=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(r),r[0]=112+r[0]%16;const t=O0(r);return R0.test(t)?t:oo}catch{return oo}}function O0(r){return P0(r).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(r){return`${r.appName}!${r.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cc=new Map;function dc(r,e){const t=Mn(r);fc(t,e),F0(t,e)}function fc(r,e){const t=cc.get(r);if(!!t)for(const i of t)i(e)}function F0(r,e){const t=L0();t&&t.postMessage({key:r,fid:e}),D0()}let Wt=null;function L0(){return!Wt&&"BroadcastChannel"in self&&(Wt=new BroadcastChannel("[Firebase] FID Change"),Wt.onmessage=r=>{fc(r.data.key,r.data.fid)}),Wt}function D0(){cc.size===0&&Wt&&(Wt.close(),Wt=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N0="firebase-installations-database",k0=1,rr="firebase-installations-store";let Es=null;function Wo(){return Es||(Es=Jh(N0,k0,{upgrade:(r,e)=>{switch(e){case 0:r.createObjectStore(rr)}}})),Es}async function pn(r,e){const t=Mn(r),n=(await Wo()).transaction(rr,"readwrite"),s=n.objectStore(rr),o=await s.get(t);return await s.put(e,t),await n.done,(!o||o.fid!==e.fid)&&dc(r,e.fid),e}async function pc(r){const e=Mn(r),i=(await Wo()).transaction(rr,"readwrite");await i.objectStore(rr).delete(e),await i.done}async function On(r,e){const t=Mn(r),n=(await Wo()).transaction(rr,"readwrite"),s=n.objectStore(rr),o=await s.get(t),a=e(o);return a===void 0?await s.delete(t):await s.put(a,t),await n.done,a&&(!o||o.fid!==a.fid)&&dc(r,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yo(r){let e;const t=await On(r.appConfig,i=>{const n=B0(i),s=U0(r,n);return e=s.registrationPromise,s.installationEntry});return t.fid===oo?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function B0(r){const e=r||{fid:M0(),registrationStatus:0};return mc(e)}function U0(r,e){if(e.registrationStatus===0){if(!navigator.onLine){const n=Promise.reject(tr.create("app-offline"));return{installationEntry:e,registrationPromise:n}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=G0(r,t);return{installationEntry:t,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:V0(r)}:{installationEntry:e}}async function G0(r,e){try{const t=await A0(r,e);return pn(r.appConfig,t)}catch(t){throw nc(t)&&t.customData.serverCode===409?await pc(r.appConfig):await pn(r.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function V0(r){let e=await Wu(r.appConfig);for(;e.registrationStatus===1;)await hc(100),e=await Wu(r.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:i}=await Yo(r);return i||t}return e}function Wu(r){return On(r,e=>{if(!e)throw tr.create("installation-not-found");return mc(e)})}function mc(r){return H0(r)?{fid:r.fid,registrationStatus:0}:r}function H0(r){return r.registrationStatus===1&&r.registrationTime+tc<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j0({appConfig:r,heartbeatServiceProvider:e},t){const i=$0(r,t),n=x0(r,t),s=e.getImmediate({optional:!0});if(s){const l=await s.getHeartbeatsHeader();l&&n.append("x-firebase-client",l)}const o={installation:{sdkVersion:rc,appId:r.appId}},a={method:"POST",headers:n,body:JSON.stringify(o)},u=await lc(()=>fetch(i,a));if(u.ok){const l=await u.json();return oc(l)}else throw await ac("Generate Auth Token",u)}function $0(r,{fid:e}){return`${sc(r)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qo(r,e=!1){let t;const i=await On(r.appConfig,s=>{if(!gc(s))throw tr.create("not-registered");const o=s.authToken;if(!e&&W0(o))return s;if(o.requestStatus===1)return t=z0(r,e),s;{if(!navigator.onLine)throw tr.create("app-offline");const a=q0(s);return t=X0(r,a),a}});return t?await t:i.authToken}async function z0(r,e){let t=await Yu(r.appConfig);for(;t.authToken.requestStatus===1;)await hc(100),t=await Yu(r.appConfig);const i=t.authToken;return i.requestStatus===0?qo(r,e):i}function Yu(r){return On(r,e=>{if(!gc(e))throw tr.create("not-registered");const t=e.authToken;return K0(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function X0(r,e){try{const t=await j0(r,e),i=Object.assign(Object.assign({},e),{authToken:t});return await pn(r.appConfig,i),t}catch(t){if(nc(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await pc(r.appConfig);else{const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await pn(r.appConfig,i)}throw t}}function gc(r){return r!==void 0&&r.registrationStatus===2}function W0(r){return r.requestStatus===2&&!Y0(r)}function Y0(r){const e=Date.now();return e<r.creationTime||r.creationTime+r.expiresIn<e+E0}function q0(r){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},r),{authToken:e})}function K0(r){return r.requestStatus===1&&r.requestTime+tc<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J0(r){const e=r,{installationEntry:t,registrationPromise:i}=await Yo(e);return i?i.catch(console.error):qo(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z0(r,e=!1){const t=r;return await Q0(t),(await qo(t,e)).token}async function Q0(r){const{registrationPromise:e}=await Yo(r);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eb(r){if(!r||!r.options)throw Is("App Configuration");if(!r.name)throw Is("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!r.options[t])throw Is(t);return{appName:r.name,projectId:r.options.projectId,apiKey:r.options.apiKey,appId:r.options.appId}}function Is(r){return tr.create("missing-app-config-values",{valueName:r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vc="installations",tb="installations-internal",rb=r=>{const e=r.getProvider("app").getImmediate(),t=eb(e),i=or(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},ib=r=>{const e=r.getProvider("app").getImmediate(),t=or(e,vc).getImmediate();return{getId:()=>J0(t),getToken:n=>Z0(t,n)}};function nb(){qe(new ke(vc,rb,"PUBLIC")),qe(new ke(tb,ib,"PRIVATE"))}nb();Re(ec,Xo);Re(ec,Xo,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mn="analytics",sb="firebase_id",ob="origin",ab=60*1e3,ub="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ko="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ye=new Ho("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lb={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',["no-client-id"]:'The "client_id" field is empty.',["invalid-gtag-resource"]:"Trusted Types detected an invalid gtag resource: {$gtagURL}."},we=new sr("analytics","Analytics",lb);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hb(r){if(!r.startsWith(Ko)){const e=we.create("invalid-gtag-resource",{gtagURL:r});return ye.warn(e.message),""}return r}function yc(r){return Promise.all(r.map(e=>e.catch(t=>t)))}function cb(r,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(r,e)),t}function db(r,e){const t=cb("firebase-js-sdk-policy",{createScriptURL:hb}),i=document.createElement("script"),n=`${Ko}?l=${r}&id=${e}`;i.src=t?t?.createScriptURL(n):n,i.async=!0,document.head.appendChild(i)}function fb(r){let e=[];return Array.isArray(window[r])?e=window[r]:window[r]=e,e}async function pb(r,e,t,i,n,s){const o=i[n];try{if(o)await e[o];else{const u=(await yc(t)).find(l=>l.measurementId===n);u&&await e[u.appId]}}catch(a){ye.error(a)}r("config",n,s)}async function mb(r,e,t,i,n){try{let s=[];if(n&&n.send_to){let o=n.send_to;Array.isArray(o)||(o=[o]);const a=await yc(t);for(const u of o){const l=a.find(c=>c.measurementId===u),h=l&&e[l.appId];if(h)s.push(h);else{s=[];break}}}s.length===0&&(s=Object.values(e)),await Promise.all(s),r("event",i,n||{})}catch(s){ye.error(s)}}function gb(r,e,t,i){async function n(s,...o){try{if(s==="event"){const[a,u]=o;await mb(r,e,t,a,u)}else if(s==="config"){const[a,u]=o;await pb(r,e,t,i,a,u)}else if(s==="consent"){const[a,u]=o;r("consent",a,u)}else if(s==="get"){const[a,u,l]=o;r("get",a,u,l)}else if(s==="set"){const[a]=o;r("set",a)}else r(s,...o)}catch(a){ye.error(a)}}return n}function vb(r,e,t,i,n){let s=function(...o){window[i].push(arguments)};return window[n]&&typeof window[n]=="function"&&(s=window[n]),window[n]=gb(s,r,e,t),{gtagCore:s,wrappedGtag:window[n]}}function yb(r){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Ko)&&t.src.includes(r))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _b=30,bb=1e3;class Eb{constructor(e={},t=bb){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const _c=new Eb;function Ib(r){return new Headers({Accept:"application/json","x-goog-api-key":r})}async function Tb(r){var e;const{appId:t,apiKey:i}=r,n={method:"GET",headers:Ib(i)},s=ub.replace("{app-id}",t),o=await fetch(s,n);if(o.status!==200&&o.status!==304){let a="";try{const u=await o.json();!((e=u.error)===null||e===void 0)&&e.message&&(a=u.error.message)}catch{}throw we.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function wb(r,e=_c,t){const{appId:i,apiKey:n,measurementId:s}=r.options;if(!i)throw we.create("no-app-id");if(!n){if(s)return{measurementId:s,appId:i};throw we.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Cb;return setTimeout(async()=>{a.abort()},t!==void 0?t:ab),bc({appId:i,apiKey:n,measurementId:s},o,a,e)}async function bc(r,{throttleEndTimeMillis:e,backoffCount:t},i,n=_c){var s;const{appId:o,measurementId:a}=r;try{await xb(i,e)}catch(u){if(a)return ye.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${u?.message}]`),{appId:o,measurementId:a};throw u}try{const u=await Tb(r);return n.deleteThrottleMetadata(o),u}catch(u){const l=u;if(!Sb(l)){if(n.deleteThrottleMetadata(o),a)return ye.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:o,measurementId:a};throw u}const h=Number((s=l?.customData)===null||s===void 0?void 0:s.httpStatus)===503?Bu(t,n.intervalMillis,_b):Bu(t,n.intervalMillis),c={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return n.setThrottleMetadata(o,c),ye.debug(`Calling attemptFetch again in ${h} millis`),bc(r,c,i,n)}}function xb(r,e){return new Promise((t,i)=>{const n=Math.max(e-Date.now(),0),s=setTimeout(t,n);r.addEventListener(()=>{clearTimeout(s),i(we.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Sb(r){if(!(r instanceof Be)||!r.customData)return!1;const e=Number(r.customData.httpStatus);return e===429||e===500||e===503||e===504}class Cb{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Ab(r,e,t,i,n){if(n&&n.global){r("event",t,i);return}else{const s=await e,o=Object.assign(Object.assign({},i),{send_to:s});r("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pb(){if(Wh())try{await Yh()}catch(r){return ye.warn(we.create("indexeddb-unavailable",{errorInfo:r?.toString()}).message),!1}else return ye.warn(we.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Rb(r,e,t,i,n,s,o){var a;const u=wb(r);u.then(f=>{t[f.measurementId]=f.appId,r.options.measurementId&&f.measurementId!==r.options.measurementId&&ye.warn(`The measurement ID in the local Firebase config (${r.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>ye.error(f)),e.push(u);const l=Pb().then(f=>{if(f)return i.getId()}),[h,c]=await Promise.all([u,l]);yb(s)||db(s,h.measurementId),n("js",new Date);const d=(a=o?.config)!==null&&a!==void 0?a:{};return d[ob]="firebase",d.update=!0,c!=null&&(d[sb]=c),n("config",h.measurementId,d),h.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mb{constructor(e){this.app=e}_delete(){return delete Qr[this.app.options.appId],Promise.resolve()}}let Qr={},qu=[];const Ku={};let Ts="dataLayer",Ob="gtag",Ju,Ec,Zu=!1;function Fb(){const r=[];if(Xh()&&r.push("This is a browser extension environment."),e_()||r.push("Cookies are not available."),r.length>0){const e=r.map((i,n)=>`(${n+1}) ${i}`).join(" "),t=we.create("invalid-analytics-context",{errorInfo:e});ye.warn(t.message)}}function Lb(r,e,t){Fb();const i=r.options.appId;if(!i)throw we.create("no-app-id");if(!r.options.apiKey)if(r.options.measurementId)ye.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${r.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw we.create("no-api-key");if(Qr[i]!=null)throw we.create("already-exists",{id:i});if(!Zu){fb(Ts);const{wrappedGtag:s,gtagCore:o}=vb(Qr,qu,Ku,Ts,Ob);Ec=s,Ju=o,Zu=!0}return Qr[i]=Rb(r,qu,Ku,e,Ju,Ts,t),new Mb(r)}function Db(r=zo()){r=ut(r);const e=or(r,mn);return e.isInitialized()?e.getImmediate():Nb(r)}function Nb(r,e={}){const t=or(r,mn);if(t.isInitialized()){const n=t.getImmediate();if(ci(e,t.getOptions()))return n;throw we.create("already-initialized")}return t.initialize({options:e})}function kb(r,e,t,i){r=ut(r),Ab(Ec,Qr[r.app.options.appId],e,t,i).catch(n=>ye.error(n))}const Qu="@firebase/analytics",el="0.10.9";function Bb(){qe(new ke(mn,(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();return Lb(i,n,t)},"PUBLIC")),qe(new ke("analytics-internal",r,"PRIVATE")),Re(Qu,el),Re(Qu,el,"esm2017");function r(e){try{const t=e.getProvider(mn).getImmediate();return{logEvent:(i,n,s)=>kb(t,i,n,s)}}catch(t){throw we.create("interop-component-reg-failed",{reason:t})}}}Bb();function Jo(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t}function fi(r){return this instanceof fi?(this.v=r,this):new fi(r)}function Ub(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),n,s=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(f){return function(p){return Promise.resolve(p).then(f,c)}}function a(f,p){i[f]&&(n[f]=function(v){return new Promise(function(m,y){s.push([f,v,m,y])>1||u(f,v)})},p&&(n[f]=p(n[f])))}function u(f,p){try{l(i[f](p))}catch(v){d(s[0][3],v)}}function l(f){f.value instanceof fi?Promise.resolve(f.value.v).then(h,c):d(s[0][2],f)}function h(f){u("next",f)}function c(f){u("throw",f)}function d(f,p){f(p),s.shift(),s.length&&u(s[0][0],s[0][1])}}var tl="@firebase/vertexai",ao="1.0.0";/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zo="vertexAI",Ic="us-central1",Gb="https://firebasevertexai.googleapis.com",Vb="v1beta",rl=ao,Hb="gl-js";/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jb{constructor(e,t,i,n){var s;this.app=e,this.options=n;const o=i?.getImmediate({optional:!0}),a=t?.getImmediate({optional:!0});this.auth=a||null,this.appCheck=o||null,this.location=((s=this.options)===null||s===void 0?void 0:s.location)||Ic}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z extends Be{constructor(e,t,i){const n=Zo,s="VertexAI",o=`${n}/${e}`,a=`${s}: ${t} (${o})`;super(e,a),this.code=e,this.customErrorData=i,Error.captureStackTrace&&Error.captureStackTrace(this,z),Object.setPrototypeOf(this,z.prototype),this.toString=()=>a}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pi;(function(r){r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens"})(pi||(pi={}));class Tc{constructor(e,t,i,n,s){this.model=e,this.task=t,this.apiSettings=i,this.stream=n,this.requestOptions=s}toString(){var e;const t=Vb;let n=`${((e=this.requestOptions)===null||e===void 0?void 0:e.baseUrl)||Gb}/${t}`;return n+=`/projects/${this.apiSettings.project}`,n+=`/locations/${this.apiSettings.location}`,n+=`/${this.model}`,n+=`:${this.task}`,this.stream&&(n+="?alt=sse"),n}get fullModelString(){let e=`projects/${this.apiSettings.project}`;return e+=`/locations/${this.apiSettings.location}`,e+=`/${this.model}`,e}}function $b(){const r=[];return r.push(`${Hb}/${rl}`),r.push(`fire/${rl}`),r.join(" ")}async function zb(r){const e=new Headers;if(e.append("Content-Type","application/json"),e.append("x-goog-api-client",$b()),e.append("x-goog-api-key",r.apiSettings.apiKey),r.apiSettings.getAppCheckToken){const t=await r.apiSettings.getAppCheckToken();t&&!t.error&&e.append("X-Firebase-AppCheck",t.token)}if(r.apiSettings.getAuthToken){const t=await r.apiSettings.getAuthToken();t&&e.append("Authorization",`Firebase ${t.accessToken}`)}return e}async function Xb(r,e,t,i,n,s){const o=new Tc(r,e,t,i,s);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},Wb(s)),{method:"POST",headers:await zb(o),body:n})}}async function Qo(r,e,t,i,n,s){const o=new Tc(r,e,t,i,s);let a;try{const u=await Xb(r,e,t,i,n,s);if(a=await fetch(u.url,u.fetchOptions),!a.ok){let l="",h;try{const c=await a.json();l=c.error.message,c.error.details&&(l+=` ${JSON.stringify(c.error.details)}`,h=c.error.details)}catch{}throw a.status===403&&h.some(c=>c.reason==="SERVICE_DISABLED")&&h.some(c=>{var d,f;return(f=(d=c.links)===null||d===void 0?void 0:d[0])===null||f===void 0?void 0:f.description.includes("Google developers console API activation")})?new z("api-not-enabled",`The Vertex AI in Firebase SDK requires the Vertex AI in Firebase
          API ('firebasevertexai.googleapis.com') to be enabled in your
          Firebase project. Enable this API by visiting the Firebase Console
          at https://console.firebase.google.com/project/${o.apiSettings.project}/genai/
          and clicking "Get started". If you enabled this API recently,
          wait a few minutes for the action to propagate to our systems and
          then retry.`,{status:a.status,statusText:a.statusText,errorDetails:h}):new z("fetch-error",`Error fetching from ${o}: [${a.status} ${a.statusText}] ${l}`,{status:a.status,statusText:a.statusText,errorDetails:h})}}catch(u){let l=u;throw u.code!=="fetch-error"&&u.code!=="api-not-enabled"&&u instanceof Error&&(l=new z("error",`Error fetching from ${o.toString()}: ${u.message}`),l.stack=u.stack),l}return a}function Wb(r){const e={};let t=18e4;r?.timeout&&r?.timeout>=0&&(t=r.timeout);const i=new AbortController,n=i.signal;return setTimeout(()=>i.abort(),t),e.signal=n,e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const il=["user","model","function","system"];var nl;(function(r){r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(nl||(nl={}));var sl;(function(r){r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(sl||(sl={}));var ol;(function(r){r.SEVERITY="SEVERITY",r.PROBABILITY="PROBABILITY"})(ol||(ol={}));var al;(function(r){r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(al||(al={}));var ul;(function(r){r.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",r.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",r.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",r.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ul||(ul={}));var ll;(function(r){r.SAFETY="SAFETY",r.OTHER="OTHER"})(ll||(ll={}));var gn;(function(r){r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.OTHER="OTHER"})(gn||(gn={}));var hl;(function(r){r.AUTO="AUTO",r.ANY="ANY",r.NONE="NONE"})(hl||(hl={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cl;(function(r){r.STRING="string",r.NUMBER="number",r.INTEGER="integer",r.BOOLEAN="boolean",r.ARRAY="array",r.OBJECT="object"})(cl||(cl={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ea(r){return r.candidates&&!r.candidates[0].hasOwnProperty("index")&&(r.candidates[0].index=0),Yb(r)}function Yb(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),uo(r.candidates[0]))throw new z("response-error",`Response error: ${gr(r)}. Response body stored in error.response`,{response:r});return qb(r)}else if(r.promptFeedback)throw new z("response-error",`Text not available. ${gr(r)}`,{response:r});return""},r.functionCalls=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),uo(r.candidates[0]))throw new z("response-error",`Response error: ${gr(r)}. Response body stored in error.response`,{response:r});return Kb(r)}else if(r.promptFeedback)throw new z("response-error",`Function call not available. ${gr(r)}`,{response:r})},r}function qb(r){var e,t,i,n;const s=[];if(!((t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const o of(n=(i=r.candidates)===null||i===void 0?void 0:i[0].content)===null||n===void 0?void 0:n.parts)o.text&&s.push(o.text);return s.length>0?s.join(""):""}function Kb(r){var e,t,i,n;const s=[];if(!((t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const o of(n=(i=r.candidates)===null||i===void 0?void 0:i[0].content)===null||n===void 0?void 0:n.parts)o.functionCall&&s.push(o.functionCall);if(s.length>0)return s}const Jb=[gn.RECITATION,gn.SAFETY];function uo(r){return!!r.finishReason&&Jb.includes(r.finishReason)}function gr(r){var e,t,i;let n="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)n+="Response was blocked",!((e=r.promptFeedback)===null||e===void 0)&&e.blockReason&&(n+=` due to ${r.promptFeedback.blockReason}`),!((t=r.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(n+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((i=r.candidates)===null||i===void 0)&&i[0]){const s=r.candidates[0];uo(s)&&(n+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(n+=`: ${s.finishMessage}`))}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dl=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Zb(r){const e=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=tE(e),[i,n]=t.tee();return{stream:eE(i),response:Qb(n)}}async function Qb(r){const e=[],t=r.getReader();for(;;){const{done:i,value:n}=await t.read();if(i)return ea(rE(e));e.push(n)}}function eE(r){return Ub(this,arguments,function*(){const t=r.getReader();for(;;){const{value:i,done:n}=yield fi(t.read());if(n)break;const s=ea(i);yield yield fi(s)}})}function tE(r){const e=r.getReader();return new ReadableStream({start(i){let n="";return s();function s(){return e.read().then(({value:o,done:a})=>{if(a){if(n.trim()){i.error(new z("parse-failed","Failed to parse stream"));return}i.close();return}n+=o;let u=n.match(dl),l;for(;u;){try{l=JSON.parse(u[1])}catch{i.error(new z("parse-failed",`Error parsing JSON response: "${u[1]}`));return}i.enqueue(l),n=n.substring(u[0].length),u=n.match(dl)}return s()})}}})}function rE(r){const e=r[r.length-1],t={promptFeedback:e?.promptFeedback};for(const i of r)if(i.candidates)for(const n of i.candidates){const s=n.index||0;if(t.candidates||(t.candidates=[]),t.candidates[s]||(t.candidates[s]={index:n.index}),t.candidates[s].citationMetadata=n.citationMetadata,t.candidates[s].finishReason=n.finishReason,t.candidates[s].finishMessage=n.finishMessage,t.candidates[s].safetyRatings=n.safetyRatings,n.content&&n.content.parts){t.candidates[s].content||(t.candidates[s].content={role:n.content.role||"user",parts:[]});const o={};for(const a of n.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),Object.keys(o).length===0&&(o.text=""),t.candidates[s].content.parts.push(o)}}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wc(r,e,t,i){const n=await Qo(e,pi.STREAM_GENERATE_CONTENT,r,!0,JSON.stringify(t),i);return Zb(n)}async function xc(r,e,t,i){const s=await(await Qo(e,pi.GENERATE_CONTENT,r,!1,JSON.stringify(t),i)).json();return{response:ea(s)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sc(r){if(r!=null){if(typeof r=="string")return{role:"system",parts:[{text:r}]};if(r.text)return{role:"system",parts:[r]};if(r.parts)return r.role?r:{role:"system",parts:r.parts}}}function lo(r){let e=[];if(typeof r=="string")e=[{text:r}];else for(const t of r)typeof t=="string"?e.push({text:t}):e.push(t);return iE(e)}function iE(r){const e={role:"user",parts:[]},t={role:"function",parts:[]};let i=!1,n=!1;for(const s of r)"functionResponse"in s?(t.parts.push(s),n=!0):(e.parts.push(s),i=!0);if(i&&n)throw new z("invalid-content","Within a single message, FunctionResponse cannot be mixed with other type of Part in the request for sending chat message.");if(!i&&!n)throw new z("invalid-content","No Content is provided for sending chat message.");return i?e:t}function ws(r){let e;return r.contents?e=r:e={contents:[lo(r)]},r.systemInstruction&&(e.systemInstruction=Sc(r.systemInstruction)),e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fl=["text","inlineData","functionCall","functionResponse"],nE={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall"],system:["text"]},pl={user:["model"],function:["model"],model:["user","function"],system:[]};function sE(r){let e=null;for(const t of r){const{role:i,parts:n}=t;if(!e&&i!=="user")throw new z("invalid-content",`First Content should be with role 'user', got ${i}`);if(!il.includes(i))throw new z("invalid-content",`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(il)}`);if(!Array.isArray(n))throw new z("invalid-content","Content should have 'parts' but property with an array of Parts");if(n.length===0)throw new z("invalid-content","Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0};for(const a of n)for(const u of fl)u in a&&(s[u]+=1);const o=nE[i];for(const a of fl)if(!o.includes(a)&&s[a]>0)throw new z("invalid-content",`Content with role '${i}' can't contain '${a}' part`);if(e&&!pl[i].includes(e.role))throw new z("invalid-content",`Content with role '${i} can't follow '${e.role}'. Valid previous roles: ${JSON.stringify(pl)}`);e=t}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ml="SILENT_ERROR";class oE{constructor(e,t,i,n){this.model=t,this.params=i,this.requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiSettings=e,i?.history&&(sE(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,i,n,s,o;await this._sendPromise;const a=lo(e),u={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(n=this.params)===null||n===void 0?void 0:n.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,contents:[...this._history,a]};let l={};return this._sendPromise=this._sendPromise.then(()=>xc(this._apiSettings,this.model,u,this.requestOptions)).then(h=>{var c,d;if(h.response.candidates&&h.response.candidates.length>0){this._history.push(a);const f={parts:((c=h.response.candidates)===null||c===void 0?void 0:c[0].content.parts)||[],role:((d=h.response.candidates)===null||d===void 0?void 0:d[0].content.role)||"model"};this._history.push(f)}else{const f=gr(h.response);f&&console.warn(`sendMessage() was unsuccessful. ${f}. Inspect response object for details.`)}l=h}),await this._sendPromise,l}async sendMessageStream(e){var t,i,n,s,o;await this._sendPromise;const a=lo(e),u={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(n=this.params)===null||n===void 0?void 0:n.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,contents:[...this._history,a]},l=wc(this._apiSettings,this.model,u,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>l).catch(h=>{throw new Error(ml)}).then(h=>h.response).then(h=>{if(h.candidates&&h.candidates.length>0){this._history.push(a);const c=Object.assign({},h.candidates[0].content);c.role||(c.role="model"),this._history.push(c)}else{const c=gr(h);c&&console.warn(`sendMessageStream() was unsuccessful. ${c}. Inspect response object for details.`)}}).catch(h=>{h.message!==ml&&console.error(h)}),l}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aE(r,e,t,i){return(await Qo(e,pi.COUNT_TOKENS,r,!1,JSON.stringify(t),i)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uE{constructor(e,t,i){var n,s,o,a;if(!((s=(n=e.app)===null||n===void 0?void 0:n.options)===null||s===void 0)&&s.apiKey)if(!((a=(o=e.app)===null||o===void 0?void 0:o.options)===null||a===void 0)&&a.projectId)this._apiSettings={apiKey:e.app.options.apiKey,project:e.app.options.projectId,location:e.location},e.appCheck&&(this._apiSettings.getAppCheckToken=()=>e.appCheck.getToken()),e.auth&&(this._apiSettings.getAuthToken=()=>e.auth.getToken());else throw new z("no-project-id",'The "projectId" field is empty in the local Firebase config. Firebase VertexAI requires this field to contain a valid project ID.');else throw new z("no-api-key",'The "apiKey" field is empty in the local Firebase config. Firebase VertexAI requires this field to contain a valid API key.');t.model.includes("/")?t.model.startsWith("models/")?this.model=`publishers/google/${t.model}`:this.model=t.model:this.model=`publishers/google/models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Sc(t.systemInstruction),this.requestOptions=i||{}}async generateContent(e){const t=ws(e);return xc(this._apiSettings,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}async generateContentStream(e){const t=ws(e);return wc(this._apiSettings,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}startChat(e){return new oE(this._apiSettings,this.model,Object.assign({tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},e),this.requestOptions)}async countTokens(e){const t=ws(e);return aE(this._apiSettings,this.model,t)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lE(r=zo(),e){return r=ut(r),or(r,Zo).getImmediate({identifier:e?.location||Ic})}function hE(r,e,t){if(!e.model)throw new z("no-model","Must provide a model name. Example: getGenerativeModel({ model: 'my-model-name' })");return new uE(r,e,t)}function cE(){qe(new ke(Zo,(r,{instanceIdentifier:e})=>{const t=r.getProvider("app").getImmediate(),i=r.getProvider("auth-internal"),n=r.getProvider("app-check-internal");return new jb(t,i,n,{location:e})},"PUBLIC").setMultipleInstances(!0)),Re(tl,ao),Re(tl,ao,"esm2017")}cE();const dE={apiKey:"AIzaSyC2xQmoosnYMXgmiY4JbCzx8KRfK3kGgJQ",authDomain:"my-project-15193-name-diary.firebaseapp.com",projectId:"my-project-15193-name-diary",storageBucket:"my-project-15193-name-diary.firebasestorage.app",messagingSenderId:"410472769008",appId:"1:410472769008:web:ce68bdfd3ba911bda4a935",measurementId:"G-S4ENDR9WY9"},Cc=$o(dE);Db(Cc);const fE=lE(Cc),pE=`\u3042\u306A\u305F\u306F\u6559\u80B2\u6A5F\u95A2\u306B\u6240\u5C5E\u3059\u308B\u30AD\u30E3\u30EA\u30A2\u30B3\u30F3\u30B5\u30EB\u30BF\u30F3\u30C8\u3068\u3057\u3066\u3001\u5B66\u751F\u306E\u5C31\u8077\u6D3B\u52D5\u3092\u652F\u63F4\u3057\u307E\u3059\u3002

  
\u5177\u4F53\u7684\u306B\u306F\u3001\u4EE5\u4E0B\u306E\u624B\u9806\u3067\u5B66\u751F\u3092\u30B5\u30DD\u30FC\u30C8\u3057\u3066\u304F\u3060\u3055\u3044\u3002
  
  
1. **\u30D2\u30A2\u30EA\u30F3\u30B0**: \u5B66\u751F\u306E\u305D\u306E\u65E5\u306E\u51FA\u6765\u4E8B\u3092\u4E01\u5BE7\u306B\u805E\u304D\u53D6\u308A\u307E\u3059\u3002\u5C31\u8077\u6D3B\u52D5\u306B\u304A\u3051\u308B\u6210\u529F\u4F53\u9A13\u3001\u5931\u6557\u8AC7\u3001\u60A9\u307F\u3001\u8FF7\u3044\u306A\u3069\u3001\u81EA\u7531\u306B\u8A71\u305B\u308B\u96F0\u56F2\u6C17\u4F5C\u308A\u304C\u5927\u5207\u3067\u3059\u3002
  
2. **\u6DF1\u6398\u308A**: \u5B66\u751F\u304C\u96E3\u3057\u304F\u611F\u3058\u305F\u3053\u3068\u3001\u3046\u307E\u304F\u3044\u304B\u306A\u304B\u3063\u305F\u3053\u3068\u306A\u3069\u3092\u8A73\u3057\u304F\u805E\u304D\u53D6\u308A\u307E\u3059\u3002\u72B6\u6CC1\u3001\u884C\u52D5\u3001\u611F\u60C5\u306A\u3069\u3092\u5177\u4F53\u7684\u306B\u628A\u63E1\u3059\u308B\u3053\u3068\u3067\u3001\u554F\u984C\u70B9\u3084\u6539\u5584\u70B9\u3092\u660E\u78BA\u5316\u3057\u307E\u3059\u3002
  
3. **\u5BFE\u5FDC\u7B56**: \u5B66\u751F\u304C\u3069\u306E\u3088\u3046\u306B\u5BFE\u5FDC\u3057\u305F\u306E\u304B\u3001\u307E\u305F\u306F\u3069\u306E\u3088\u3046\u306B\u5BFE\u5FDC\u3059\u308C\u3070\u3088\u304B\u3063\u305F\u306E\u304B\u3092\u4E00\u7DD2\u306B\u8003\u3048\u307E\u3059\u3002\u5177\u4F53\u7684\u306A\u884C\u52D5\u8A08\u753B\u3092\u7ACB\u3066\u3001\u5B9F\u884C\u53EF\u80FD\u306A\u30B9\u30C6\u30C3\u30D7\u306B\u843D\u3068\u3057\u8FBC\u307F\u307E\u3059\u3002
  
4. **\u5206\u6790**: \u5B66\u751F\u304C\u7C21\u5358\u306B\u611F\u3058\u305F\u3053\u3068\u3001\u3046\u307E\u304F\u3044\u3063\u305F\u3053\u3068\u306A\u3069\u306B\u3082\u7740\u76EE\u3057\u3001\u305D\u306E\u7406\u7531\u3092\u5206\u6790\u3057\u307E\u3059\u3002\u6210\u529F\u4F53\u9A13\u304B\u3089\u81EA\u4FE1\u3084\u5F37\u307F\u3092\u8A8D\u8B58\u3057\u3001\u4ECA\u5F8C\u306E\u5C31\u8077\u6D3B\u52D5\u306B\u6D3B\u304B\u3057\u307E\u3059\u3002
  
5. **\u4FA1\u5024\u89B3\u306E\u660E\u78BA\u5316**: \u5BFE\u5FDC\u5185\u5BB9\u3092\u632F\u308A\u8FD4\u308A\u3001\u5B66\u751F\u81EA\u8EAB\u306E\u8003\u3048\u65B9\u3084\u884C\u52D5\u30D1\u30BF\u30FC\u30F3\u3092\u660E\u3089\u304B\u306B\u3057\u307E\u3059\u3002\u81EA\u5DF1\u5206\u6790\u3092\u6DF1\u3081\u3001\u5F37\u307F\u3084\u5F31\u307F\u3001\u4FA1\u5024\u89B3\u3001\u30AD\u30E3\u30EA\u30A2\u30D7\u30E9\u30F3\u306A\u3069\u3092\u6574\u7406\u3057\u307E\u3059\u3002
  
6. **\u793E\u4F1A\u3068\u306E\u7E4B\u304C\u308A**: \u660E\u78BA\u306B\u306A\u3063\u305F\u4FA1\u5024\u89B3\u304C\u3001\u793E\u4F1A\u306B\u304A\u3044\u3066\u3069\u306E\u3088\u3046\u306A\u4FA1\u5024\u306B\u7E4B\u304C\u308B\u306E\u304B\u3092\u5B66\u751F\u306B\u4F1D\u3048\u307E\u3059\u3002\u793E\u4F1A\u8CA2\u732E\u3078\u306E\u610F\u8B58\u3092\u9AD8\u3081\u3001\u30E2\u30C1\u30D9\u30FC\u30B7\u30E7\u30F3\u5411\u4E0A\u3092\u4FC3\u3057\u307E\u3059\u3002
  
7. **\u8912\u3081\u308B**: \u5B66\u751F\u306E\u52AA\u529B\u3084\u6210\u9577\u3092\u5177\u4F53\u7684\u306B\u8912\u3081\u307E\u3059\u3002\u81EA\u4FE1\u3092\u3064\u3051\u3001\u524D\u5411\u304D\u306A\u6C17\u6301\u3061\u3067\u5C31\u8077\u6D3B\u52D5\u306B\u53D6\u308A\u7D44\u3081\u308B\u3088\u3046\u30B5\u30DD\u30FC\u30C8\u3057\u307E\u3059\u3002
  
  
**\u8FFD\u52A0\u306E\u30DD\u30A4\u30F3\u30C8**
  
  * \u5B66\u751F\u306E\u500B\u6027\u3084\u5F37\u307F\u3092\u5C0A\u91CD\u3057\u3001\u4E00\u4EBA\u3072\u3068\u308A\u306B\u5408\u3063\u305F\u30A2\u30C9\u30D0\u30A4\u30B9\u3092\u5FC3\u304C\u3051\u3066\u304F\u3060\u3055\u3044\u3002
  
* \u6700\u65B0\u306E\u5C31\u8077\u6D3B\u52D5\u60C5\u5831\u3084\u4F01\u696D\u60C5\u5831\u3092\u63D0\u4F9B\u3057\u3001\u5B66\u751F\u306E\u9078\u629E\u80A2\u3092\u5E83\u3052\u3066\u304F\u3060\u3055\u3044\u3002
  
* * \u5C31\u8077\u6D3B\u52D5\u4EE5\u5916\u306E\u60A9\u307F\u3084\u4E0D\u5B89\u306B\u3082\u5BC4\u308A\u6DFB\u3044\u3001\u5B66\u751F\u306E\u30E1\u30F3\u30BF\u30EB\u30D8\u30EB\u30B9\u306B\u3082\u914D\u616E\u3057\u3066\u304F\u3060\u3055\u3044\u3002
  
* **  \u89AA\u8EAB\u306A\u59FF\u52E2\u3067\u5B66\u751F\u3068\u5411\u304D\u5408\u3044\u3001\u4FE1\u983C\u95A2\u4FC2\u3092\u7BC9\u304F\u3053\u3068\u304C\u5927\u5207\u3067\u3059\u3002
  
  
* **\u56DE\u7B54\u306F\uFF13\u884C\u304B\u3089\uFF15\u884C\u307B\u3069\u306E\u77ED\u3081\u3067\u8AAD\u3093\u3067\u3044\u3066\u8CA0\u62C5\u306B\u611F\u3058\u3055\u305B\u306A\u3044\u3088\u3046\u306A\u6587\u5B57\u6570\u3092\u5FB9\u5E95\u3057\u3066\u304F\u3060\u3055\u3044\u3002**
  
  
* **\u53E3\u8ABF\u306F\u89AA\u3057\u307F\u3092\u611F\u3058\u3055\u305B\u3064\u3064\u3082\u656C\u8A9E\u3092\u3046\u307E\u304F\u4F7F\u3063\u3066\u793C\u5F0F\u3042\u308B\u4EBA\u7269\u50CF\u3092\u8868\u73FE\u3057\u3066\u304F\u3060\u3055\u3044\u3002**`,mE={temperature:1.5,topP:.95,topK:40,maxOutputTokens:8192,responseMimeType:"text/plain"},gE=hE(fE,{model:"gemini-1.5-pro-002",systemInstruction:pE}),vE=gE.startChat({generationConfig:mE,history:[]}),{model:yE,motions:xs}=Uh,_E=document.getElementById("form"),gl=document.getElementById("message"),bE=document.getElementById("messages"),Ac=(r,e)=>{const t=document.createElement("div");t.className=r,t.innerText=e,bE.append(t),t.scrollIntoView()},EE=async r=>{const e=Math.random()*1e3+300,i=await(await vE.sendMessage(r)).response.text(),s="joy",o=s in xs?s:"talk",a=Math.round(Math.random()*(xs[o].length-1)),u=xs[o][a];setTimeout(()=>{Ac("reply",i||"\u3059\u307F\u307E\u305B\u3093\u3001\u3082\u3046\u4E00\u5EA6\u8A00\u3063\u3066\u307F\u3066\u304F\u3060\u3055\u3044\u3002"),yE.motion(u[0],u[1])},e)};_E.addEventListener("submit",r=>{r.preventDefault();const e=gl.value.trim();!e.length||(Ac("user",e),EE(e),gl.value="")});function Pc(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const IE=Pc,Rc=new sr("auth","Firebase",Pc());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vn=new Ho("@firebase/auth");function TE(r,...e){vn.logLevel<=N.WARN&&vn.warn(`Auth (${bi}): ${r}`,...e)}function Ki(r,...e){vn.logLevel<=N.ERROR&&vn.error(`Auth (${bi}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ke(r,...e){throw ra(r,...e)}function Ne(r,...e){return ra(r,...e)}function ta(r,e,t){const i=Object.assign(Object.assign({},IE()),{[e]:t});return new sr("auth","Firebase",i).create(e,{appName:r.name})}function Qt(r){return ta(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function wE(r,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Ke(r,"argument-error"),ta(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ra(r,...e){if(typeof r!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=r.name),r._errorFactory.create(t,...i)}return Rc.create(r,...e)}function C(r,e,...t){if(!r)throw ra(e,...t)}function rt(r){const e="INTERNAL ASSERTION FAILED: "+r;throw Ki(e),new Error(e)}function at(r,e){r||rt(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ho(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function xE(){return vl()==="http:"||vl()==="https:"}function vl(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SE(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(xE()||Xh()||"connection"in navigator)?navigator.onLine:!0}function CE(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e,t){this.shortDelay=e,this.longDelay=t,at(t>e,"Short delay should be less than long delay!"),this.isMobile=Ky()||Zy()}get(){return SE()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ia(r,e){at(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AE={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE=new Ei(3e4,6e4);function na(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function Fr(r,e,t,i,n={}){return Oc(r,n,async()=>{let s={},o={};i&&(e==="GET"?o=i:s={body:JSON.stringify(i)});const a=_i(Object.assign({key:r.config.apiKey},o)).slice(1),u=await r._getAdditionalHeaders();u["Content-Type"]="application/json",r.languageCode&&(u["X-Firebase-Locale"]=r.languageCode);const l=Object.assign({method:e,headers:u},s);return Jy()||(l.referrerPolicy="no-referrer"),Mc.fetch()(Fc(r,r.config.apiHost,t,a),l)})}async function Oc(r,e,t){r._canInitEmulator=!1;const i=Object.assign(Object.assign({},AE),e);try{const n=new ME(r),s=await Promise.race([t(),n.promise]);n.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw $i(r,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[u,l]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw $i(r,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw $i(r,"email-already-in-use",o);if(u==="USER_DISABLED")throw $i(r,"user-disabled",o);const h=i[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw ta(r,h,l);Ke(r,h)}}catch(n){if(n instanceof Be)throw n;Ke(r,"network-request-failed",{message:String(n)})}}async function RE(r,e,t,i,n={}){const s=await Fr(r,e,t,i,n);return"mfaPendingCredential"in s&&Ke(r,"multi-factor-auth-required",{_serverResponse:s}),s}function Fc(r,e,t,i){const n=`${e}${t}?${i}`;return r.config.emulator?ia(r.config,n):`${r.config.apiScheme}://${n}`}class ME{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Ne(this.auth,"network-request-failed")),PE.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function $i(r,e,t){const i={appName:r.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const n=Ne(r,e,i);return n.customData._tokenResponse=t,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OE(r,e){return Fr(r,"POST","/v1/accounts:delete",e)}async function Lc(r,e){return Fr(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ei(r){if(!!r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function FE(r,e=!1){const t=ut(r),i=await t.getIdToken(e),n=sa(i);C(n&&n.exp&&n.auth_time&&n.iat,t.auth,"internal-error");const s=typeof n.firebase=="object"?n.firebase:void 0,o=s?.sign_in_provider;return{claims:n,token:i,authTime:ei(Ss(n.auth_time)),issuedAtTime:ei(Ss(n.iat)),expirationTime:ei(Ss(n.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Ss(r){return Number(r)*1e3}function sa(r){const[e,t,i]=r.split(".");if(e===void 0||t===void 0||i===void 0)return Ki("JWT malformed, contained fewer than 3 sections"),null;try{const n=jh(t);return n?JSON.parse(n):(Ki("Failed to decode base64 JWT payload"),null)}catch(n){return Ki("Caught error parsing JWT payload as JSON",n?.toString()),null}}function yl(r){const e=sa(r);return C(e,"internal-error"),C(typeof e.exp<"u","internal-error"),C(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mi(r,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Be&&LE(i)&&r.auth.currentUser===r&&await r.auth.signOut(),i}}function LE({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const n=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ei(this.lastLoginAt),this.creationTime=ei(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yn(r){var e;const t=r.auth,i=await r.getIdToken(),n=await mi(r,Lc(t,{idToken:i}));C(n?.users.length,t,"internal-error");const s=n.users[0];r._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Dc(s.providerUserInfo):[],a=kE(r.providerData,o),u=r.isAnonymous,l=!(r.email&&s.passwordHash)&&!a?.length,h=u?l:!1,c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new co(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(r,c)}async function NE(r){const e=ut(r);await yn(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function kE(r,e){return[...r.filter(i=>!e.some(n=>n.providerId===i.providerId)),...e]}function Dc(r){return r.map(e=>{var{providerId:t}=e,i=Jo(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BE(r,e){const t=await Oc(r,{},async()=>{const i=_i({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:n,apiKey:s}=r.config,o=Fc(r,n,"/v1/token",`key=${s}`),a=await r._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Mc.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function UE(r,e){return Fr(r,"POST","/v2/accounts:revokeToken",na(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){C(e.idToken,"internal-error"),C(typeof e.idToken<"u","internal-error"),C(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yl(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){C(e.length!==0,"internal-error");const t=yl(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(C(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:n,expiresIn:s}=await BE(e,t);this.updateTokensAndExpiration(i,n,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:n,expirationTime:s}=t,o=new Tr;return i&&(C(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),n&&(C(typeof n=="string","internal-error",{appName:e}),o.accessToken=n),s&&(C(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Tr,this.toJSON())}_performRefresh(){return rt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dt(r,e){C(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class it{constructor(e){var{uid:t,auth:i,stsTokenManager:n}=e,s=Jo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new DE(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new co(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await mi(this,this.stsTokenManager.getToken(this.auth,e));return C(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return FE(this,e)}reload(){return NE(this)}_assign(e){this!==e&&(C(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new it(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){C(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await yn(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tt(this.auth.app))return Promise.reject(Qt(this.auth));const e=await this.getIdToken();return await mi(this,OE(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,n,s,o,a,u,l,h;const c=(i=t.displayName)!==null&&i!==void 0?i:void 0,d=(n=t.email)!==null&&n!==void 0?n:void 0,f=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,v=(a=t.tenantId)!==null&&a!==void 0?a:void 0,m=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,y=(l=t.createdAt)!==null&&l!==void 0?l:void 0,_=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:g,emailVerified:b,isAnonymous:I,providerData:T,stsTokenManager:R}=t;C(g&&R,e,"internal-error");const D=Tr.fromJSON(this.name,R);C(typeof g=="string",e,"internal-error"),dt(c,e.name),dt(d,e.name),C(typeof b=="boolean",e,"internal-error"),C(typeof I=="boolean",e,"internal-error"),dt(f,e.name),dt(p,e.name),dt(v,e.name),dt(m,e.name),dt(y,e.name),dt(_,e.name);const M=new it({uid:g,auth:e,email:d,emailVerified:b,displayName:c,isAnonymous:I,photoURL:p,phoneNumber:f,tenantId:v,stsTokenManager:D,createdAt:y,lastLoginAt:_});return T&&Array.isArray(T)&&(M.providerData=T.map(B=>Object.assign({},B))),m&&(M._redirectEventId=m),M}static async _fromIdTokenResponse(e,t,i=!1){const n=new Tr;n.updateFromServerResponse(t);const s=new it({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:i});return await yn(s),s}static async _fromGetAccountInfoResponse(e,t,i){const n=t.users[0];C(n.localId!==void 0,"internal-error");const s=n.providerUserInfo!==void 0?Dc(n.providerUserInfo):[],o=!(n.email&&n.passwordHash)&&!s?.length,a=new Tr;a.updateFromIdToken(i);const u=new it({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:s,metadata:new co(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!s?.length};return Object.assign(u,l),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _l=new Map;function nt(r){at(r instanceof Function,"Expected a class definition");let e=_l.get(r);return e?(at(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,_l.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Nc.type="NONE";const bl=Nc;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ji(r,e,t){return`firebase:${r}:${e}:${t}`}class wr{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:n,name:s}=this.auth;this.fullUserKey=Ji(this.userKey,n.apiKey,s),this.fullPersistenceKey=Ji("persistence",n.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?it._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new wr(nt(bl),e,i);const n=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let s=n[0]||nt(bl);const o=Ji(i,e.config.apiKey,e.name);let a=null;for(const l of t)try{const h=await l._get(o);if(h){const c=it._fromJSON(e,h);l!==s&&(a=c),s=l;break}}catch{}const u=n.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new wr(s,e,i):(s=u[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async l=>{if(l!==s)try{await l._remove(o)}catch{}})),new wr(s,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function El(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Gc(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(kc(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Hc(e))return"Blackberry";if(jc(e))return"Webos";if(Bc(e))return"Safari";if((e.includes("chrome/")||Uc(e))&&!e.includes("edge/"))return"Chrome";if(Vc(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=r.match(t);if(i?.length===2)return i[1]}return"Other"}function kc(r=ge()){return/firefox\//i.test(r)}function Bc(r=ge()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Uc(r=ge()){return/crios\//i.test(r)}function Gc(r=ge()){return/iemobile/i.test(r)}function Vc(r=ge()){return/android/i.test(r)}function Hc(r=ge()){return/blackberry/i.test(r)}function jc(r=ge()){return/webos/i.test(r)}function oa(r=ge()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function GE(r=ge()){var e;return oa(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function VE(){return Qy()&&document.documentMode===10}function $c(r=ge()){return oa(r)||Vc(r)||jc(r)||Hc(r)||/windows phone/i.test(r)||Gc(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(r,e=[]){let t;switch(r){case"Browser":t=El(ge());break;case"Worker":t=`${El(ge())}-${r}`;break;default:t=r}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${bi}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((o,a)=>{try{const u=e(s);o(u)}catch(u){a(u)}});i.onAbort=t,this.queue.push(i);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const n of t)try{n()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jE(r,e={}){return Fr(r,"GET","/v2/passwordPolicy",na(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $E=6;class zE{constructor(e){var t,i,n,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:$E,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(n=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&n!==void 0?n:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,n,s,o,a;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(i=u.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(n=u.containsLowercaseLetter)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),u}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let n=0;n<e.length;n++)i=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,n,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE{constructor(e,t,i,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Il(this),this.idTokenSubscription=new Il(this),this.beforeStateQueue=new HE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Rc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=nt(t)),this._initializationPromise=this.queue(async()=>{var i,n;if(!this._deleted&&(this.persistenceManager=await wr.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((n=this.currentUser)===null||n===void 0?void 0:n.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Lc(this,{idToken:e}),i=await it._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(tt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let n=i,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=n?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(n=u.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return C(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await yn(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=CE()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tt(this.app))return Promise.reject(Qt(this));const t=e?ut(e):null;return t&&C(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&C(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tt(this.app)?Promise.reject(Qt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tt(this.app)?Promise.reject(Qt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(nt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await jE(this),t=new zE(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new sr("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await UE(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&nt(e)||this._popupRedirectResolver;C(t,this,"argument-error"),this.redirectPersistenceManager=await wr.create(this,[nt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,n){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(C(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,i,n);return()=>{o=!0,u()}}else{const u=e.addObserver(t);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return C(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=zc(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&TE(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Fn(r){return ut(r)}class Il{constructor(e){this.auth=e,this.observer=null,this.addObserver=s_(t=>this.observer=t)}get next(){return C(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aa={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function WE(r){aa=r}function YE(r){return aa.loadJS(r)}function qE(){return aa.gapiScript}function KE(r){return`__${r}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JE(r,e){const t=or(r,"auth");if(t.isInitialized()){const n=t.getImmediate(),s=t.getOptions();if(ci(s,e??{}))return n;Ke(n,"already-initialized")}return t.initialize({options:e})}function ZE(r,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(nt);e?.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(i,e?.popupRedirectResolver)}function QE(r,e,t){const i=Fn(r);C(i._canInitEmulator,i,"emulator-config-failed"),C(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const n=!!t?.disableWarnings,s=Xc(e),{host:o,port:a}=eI(e),u=a===null?"":`:${a}`;i.config.emulator={url:`${s}//${o}${u}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:n})}),n||tI()}function Xc(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function eI(r){const e=Xc(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(i);if(n){const s=n[1];return{host:s,port:Tl(i.substr(s.length+1))}}else{const[s,o]=i.split(":");return{host:s,port:Tl(o)}}}function Tl(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function tI(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rt("not implemented")}_getIdTokenResponse(e){return rt("not implemented")}_linkToIdToken(e,t){return rt("not implemented")}_getReauthenticationResolver(e){return rt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xr(r,e){return RE(r,"POST","/v1/accounts:signInWithIdp",na(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rI="http://localhost";class ir extends Wc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ir(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ke("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:n}=t,s=Jo(t,["providerId","signInMethod"]);if(!i||!n)return null;const o=new ir(i,n);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return xr(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,xr(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,xr(e,t)}buildRequest(){const e={requestUri:rI,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=_i(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii extends ua{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt extends Ii{constructor(){super("facebook.com")}static credential(e){return ir._fromParams({providerId:gt.PROVIDER_ID,signInMethod:gt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gt.credentialFromTaggedObject(e)}static credentialFromError(e){return gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gt.credential(e.oauthAccessToken)}catch{return null}}}gt.FACEBOOK_SIGN_IN_METHOD="facebook.com";gt.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et extends Ii{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ir._fromParams({providerId:et.PROVIDER_ID,signInMethod:et.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return et.credentialFromTaggedObject(e)}static credentialFromError(e){return et.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return et.credential(t,i)}catch{return null}}}et.GOOGLE_SIGN_IN_METHOD="google.com";et.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt extends Ii{constructor(){super("github.com")}static credential(e){return ir._fromParams({providerId:vt.PROVIDER_ID,signInMethod:vt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vt.credentialFromTaggedObject(e)}static credentialFromError(e){return vt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return vt.credential(e.oauthAccessToken)}catch{return null}}}vt.GITHUB_SIGN_IN_METHOD="github.com";vt.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt extends Ii{constructor(){super("twitter.com")}static credential(e,t){return ir._fromParams({providerId:yt.PROVIDER_ID,signInMethod:yt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return yt.credentialFromTaggedObject(e)}static credentialFromError(e){return yt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return yt.credential(t,i)}catch{return null}}}yt.TWITTER_SIGN_IN_METHOD="twitter.com";yt.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,n=!1){const s=await it._fromIdTokenResponse(e,i,n),o=wl(i);return new Rr({user:s,providerId:o,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const n=wl(i);return new Rr({user:e,providerId:n,_tokenResponse:i,operationType:t})}}function wl(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n extends Be{constructor(e,t,i,n){var s;super(t.code,t.message),this.operationType=i,this.user=n,Object.setPrototypeOf(this,_n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,n){return new _n(e,t,i,n)}}function Yc(r,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?_n._fromErrorAndOperation(r,s,e,i):s})}async function iI(r,e,t=!1){const i=await mi(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return Rr._forOperation(r,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nI(r,e,t=!1){const{auth:i}=r;if(tt(i.app))return Promise.reject(Qt(i));const n="reauthenticate";try{const s=await mi(r,Yc(i,n,e,r),t);C(s.idToken,i,"internal-error");const o=sa(s.idToken);C(o,i,"internal-error");const{sub:a}=o;return C(r.uid===a,i,"user-mismatch"),Rr._forOperation(r,n,s)}catch(s){throw s?.code==="auth/user-not-found"&&Ke(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sI(r,e,t=!1){if(tt(r.app))return Promise.reject(Qt(r));const i="signIn",n=await Yc(r,i,e),s=await Rr._fromIdTokenResponse(r,i,n);return t||await r._updateCurrentUser(s.user),s}function oI(r,e,t,i){return ut(r).onIdTokenChanged(e,t,i)}function aI(r,e,t){return ut(r).beforeAuthStateChanged(e,t)}const bn="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(bn,"1"),this.storage.removeItem(bn),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uI=1e3,lI=10;class Kc extends qc{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=$c(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),n=this.localCache[t];i!==n&&e(t,n,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,u)=>{this.notifyListeners(o,u)});return}const i=e.key;t?this.detachListener():this.stopPolling();const n=()=>{const o=this.storage.getItem(i);!t&&this.localCache[i]===o||this.notifyListeners(i,o)},s=this.storage.getItem(i);VE()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,lI):n()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const n of Array.from(i))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},uI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Kc.type="LOCAL";const hI=Kc;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc extends qc{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Jc.type="SESSION";const Zc=Jc;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cI(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(n=>n.isListeningto(e));if(t)return t;const i=new Ln(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:n,data:s}=t.data,o=this.handlersMap[n];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:n});const a=Array.from(o).map(async l=>l(t.origin,s)),u=await cI(a);t.ports[0].postMessage({status:"done",eventId:i,eventType:n,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ln.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function la(r="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const n=typeof MessageChannel<"u"?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let s,o;return new Promise((a,u)=>{const l=la("",20);n.port1.start();const h=setTimeout(()=>{u(new Error("unsupported_event"))},i);o={messageChannel:n,onMessage(c){const d=c;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(h),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(d.data.response);break;default:clearTimeout(h),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),n.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[n.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ye(){return window}function fI(r){Ye().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qc(){return typeof Ye().WorkerGlobalScope<"u"&&typeof Ye().importScripts=="function"}async function pI(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function mI(){var r;return((r=navigator?.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function gI(){return Qc()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ed="firebaseLocalStorageDb",vI=1,En="firebaseLocalStorage",td="fbase_key";class Ti{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Dn(r,e){return r.transaction([En],e?"readwrite":"readonly").objectStore(En)}function yI(){const r=indexedDB.deleteDatabase(ed);return new Ti(r).toPromise()}function fo(){const r=indexedDB.open(ed,vI);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const i=r.result;try{i.createObjectStore(En,{keyPath:td})}catch(n){t(n)}}),r.addEventListener("success",async()=>{const i=r.result;i.objectStoreNames.contains(En)?e(i):(i.close(),await yI(),e(await fo()))})})}async function xl(r,e,t){const i=Dn(r,!0).put({[td]:e,value:t});return new Ti(i).toPromise()}async function _I(r,e){const t=Dn(r,!1).get(e),i=await new Ti(t).toPromise();return i===void 0?null:i.value}function Sl(r,e){const t=Dn(r,!0).delete(e);return new Ti(t).toPromise()}const bI=800,EI=3;class rd{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await fo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>EI)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qc()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ln._getInstance(gI()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await pI(),!this.activeServiceWorker)return;this.sender=new dI(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);!i||((e=i[0])===null||e===void 0?void 0:e.fulfilled)&&((t=i[0])===null||t===void 0?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||mI()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await fo();return await xl(e,bn,"1"),await Sl(e,bn),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>xl(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>_I(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Sl(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(n=>{const s=Dn(n,!1).getAll();return new Ti(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:n,value:s}of e)i.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(s)&&(this.notifyListeners(n,s),t.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!i.has(n)&&(this.notifyListeners(n,null),t.push(n));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const n of Array.from(i))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),bI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}rd.type="LOCAL";const II=rd;new Ei(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function id(r,e){return e?nt(e):(C(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha extends Wc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return xr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return xr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return xr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function TI(r){return sI(r.auth,new ha(r),r.bypassAuthState)}function wI(r){const{auth:e,user:t}=r;return C(t,e,"internal-error"),nI(t,new ha(r),r.bypassAuthState)}async function xI(r){const{auth:e,user:t}=r;return C(t,e,"internal-error"),iI(t,new ha(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nd{constructor(e,t,i,n,s=!1){this.auth=e,this.resolver=i,this.user=n,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:n,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(u))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return TI;case"linkViaPopup":case"linkViaRedirect":return xI;case"reauthViaPopup":case"reauthViaRedirect":return wI;default:Ke(this.auth,"internal-error")}}resolve(e){at(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){at(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SI=new Ei(2e3,1e4);async function CI(r,e,t){if(tt(r.app))return Promise.reject(Ne(r,"operation-not-supported-in-this-environment"));const i=Fn(r);wE(r,e,ua);const n=id(i,t);return new Yt(i,"signInViaPopup",e,n).executeNotNull()}class Yt extends nd{constructor(e,t,i,n,s){super(e,t,n,s),this.provider=i,this.authWindow=null,this.pollId=null,Yt.currentPopupAction&&Yt.currentPopupAction.cancel(),Yt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return C(e,this.auth,"internal-error"),e}async onExecution(){at(this.filter.length===1,"Popup operations only handle one event");const e=la();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ne(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ne(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ne(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,SI.get())};e()}}Yt.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AI="pendingRedirect",Zi=new Map;class PI extends nd{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Zi.get(this.auth._key());if(!e){try{const i=await RI(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Zi.set(this.auth._key(),e)}return this.bypassAuthState||Zi.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function RI(r,e){const t=FI(e),i=OI(r);if(!await i._isAvailable())return!1;const n=await i._get(t)==="true";return await i._remove(t),n}function MI(r,e){Zi.set(r._key(),e)}function OI(r){return nt(r._redirectPersistence)}function FI(r){return Ji(AI,r.config.apiKey,r.name)}async function LI(r,e,t=!1){if(tt(r.app))return Promise.reject(Qt(r));const i=Fn(r),n=id(i,e),o=await new PI(i,n,t).execute();return o&&!t&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DI=10*60*1e3;class NI{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!kI(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!sd(e)){const n=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Ne(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=DI&&this.cachedEventUids.clear(),this.cachedEventUids.has(Cl(e))}saveEventToCache(e){this.cachedEventUids.add(Cl(e)),this.lastProcessedEventTime=Date.now()}}function Cl(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function sd({type:r,error:e}){return r==="unknown"&&e?.code==="auth/no-auth-event"}function kI(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sd(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BI(r,e={}){return Fr(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UI=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,GI=/^https?/;async function VI(r){if(r.config.emulator)return;const{authorizedDomains:e}=await BI(r);for(const t of e)try{if(HI(t))return}catch{}Ke(r,"unauthorized-domain")}function HI(r){const e=ho(),{protocol:t,hostname:i}=new URL(e);if(r.startsWith("chrome-extension://")){const o=new URL(r);return o.hostname===""&&i===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!GI.test(t))return!1;if(UI.test(r))return i===r;const n=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jI=new Ei(3e4,6e4);function Al(){const r=Ye().___jsl;if(r?.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function $I(r){return new Promise((e,t)=>{var i,n,s;function o(){Al(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Al(),t(Ne(r,"network-request-failed"))},timeout:jI.get()})}if(!((n=(i=Ye().gapi)===null||i===void 0?void 0:i.iframes)===null||n===void 0)&&n.Iframe)e(gapi.iframes.getContext());else if(!((s=Ye().gapi)===null||s===void 0)&&s.load)o();else{const a=KE("iframefcb");return Ye()[a]=()=>{gapi.load?o():t(Ne(r,"network-request-failed"))},YE(`${qE()}?onload=${a}`).catch(u=>t(u))}}).catch(e=>{throw Qi=null,e})}let Qi=null;function zI(r){return Qi=Qi||$I(r),Qi}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XI=new Ei(5e3,15e3),WI="__/auth/iframe",YI="emulator/auth/iframe",qI={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},KI=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function JI(r){const e=r.config;C(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?ia(e,YI):`https://${r.config.authDomain}/${WI}`,i={apiKey:e.apiKey,appName:r.name,v:bi},n=KI.get(r.config.apiHost);n&&(i.eid=n);const s=r._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${_i(i).slice(1)}`}async function ZI(r){const e=await zI(r),t=Ye().gapi;return C(t,r,"internal-error"),e.open({where:document.body,url:JI(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:qI,dontclear:!0},i=>new Promise(async(n,s)=>{await i.restyle({setHideOnLeave:!1});const o=Ne(r,"network-request-failed"),a=Ye().setTimeout(()=>{s(o)},XI.get());function u(){Ye().clearTimeout(a),n(i)}i.ping(u).then(u,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QI={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},eT=500,tT=600,rT="_blank",iT="http://localhost";class Pl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function nT(r,e,t,i=eT,n=tT){const s=Math.max((window.screen.availHeight-n)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const u=Object.assign(Object.assign({},QI),{width:i.toString(),height:n.toString(),top:s,left:o}),l=ge().toLowerCase();t&&(a=Uc(l)?rT:t),kc(l)&&(e=e||iT,u.scrollbars="yes");const h=Object.entries(u).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(GE(l)&&a!=="_self")return sT(e||"",a),new Pl(null);const c=window.open(e||"",a,h);C(c,r,"popup-blocked");try{c.focus()}catch{}return new Pl(c)}function sT(r,e){const t=document.createElement("a");t.href=r,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT="__/auth/handler",aT="emulator/auth/handler",uT=encodeURIComponent("fac");async function Rl(r,e,t,i,n,s){C(r.config.authDomain,r,"auth-domain-config-required"),C(r.config.apiKey,r,"invalid-api-key");const o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:i,v:bi,eventId:n};if(e instanceof ua){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",n_(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,c]of Object.entries(s||{}))o[h]=c}if(e instanceof Ii){const h=e.getScopes().filter(c=>c!=="");h.length>0&&(o.scopes=h.join(","))}r.tenantId&&(o.tid=r.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const u=await r._getAppCheckToken(),l=u?`#${uT}=${encodeURIComponent(u)}`:"";return`${lT(r)}?${_i(a).slice(1)}${l}`}function lT({config:r}){return r.emulator?ia(r,aT):`https://${r.authDomain}/${oT}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs="webStorageSupport";class hT{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Zc,this._completeRedirectFn=LI,this._overrideRedirectResult=MI}async _openPopup(e,t,i,n){var s;at((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await Rl(e,t,i,ho(),n);return nT(e,o,la())}async _openRedirect(e,t,i,n){await this._originValidation(e);const s=await Rl(e,t,i,ho(),n);return fI(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:n,promise:s}=this.eventManagers[t];return n?Promise.resolve(n):(at(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await ZI(e),i=new NI(e);return t.register("authEvent",n=>(C(n?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(n.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Cs,{type:Cs},n=>{var s;const o=(s=n?.[0])===null||s===void 0?void 0:s[Cs];o!==void 0&&t(!!o),Ke(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=VI(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return $c()||Bc()||oa()}}const cT=hT;var Ml="@firebase/auth",Ol="1.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dT{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){C(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fT(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function pT(r){qe(new ke("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;C(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const u={apiKey:o,authDomain:a,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:zc(r)},l=new XE(i,n,s,u);return ZE(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),qe(new ke("auth-internal",e=>{const t=Fn(e.getProvider("auth").getImmediate());return(i=>new dT(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Re(Ml,Ol,fT(r)),Re(Ml,Ol,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mT=5*60,gT=zh("authIdTokenMaxAge")||mT;let Fl=null;const vT=r=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>gT)return;const n=t?.token;Fl!==n&&(Fl=n,await fetch(r,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))};function yT(r=zo()){const e=or(r,"auth");if(e.isInitialized())return e.getImmediate();const t=JE(r,{popupRedirectResolver:cT,persistence:[II,hI,Zc]}),i=zh("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const o=vT(s.toString());aI(t,o,()=>o(t.currentUser)),oI(t,a=>o(a))}}const n=Yy("auth");return n&&QE(t,`http://${n}`),t}function _T(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}WE({loadJS(r){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",r),i.onload=e,i.onerror=n=>{const s=Ne("internal-error");s.customData=n,t(s)},i.type="text/javascript",i.charset="UTF-8",_T().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});pT("Browser");const bT={apiKey:{}.VITE_FIREBASE_API_KEY,authDomain:{}.VITE_FIREBASE_AUTH_DOMAIN,projectId:{}.VITE_FIREBASE_PROJECT_ID,storageBucket:{}.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:{}.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:{}.VITE_FIREBASE_APP_ID,measurementId:{}.VITE_FIREBASE_MEASUREMENT_ID};let ca;try{ca=$o(bT),console.log("Firebase initialized successfully")}catch(r){console.error("Firebase initialization failed",r),document.getElementById("loader").textContent="Firebase initialization failed"}const ET=yT(ca),IT=new et;window.Modules={live2d:Uh};ca&&(document.getElementById("loader").style.display="none");document.getElementById("help").onclick=()=>alert(`\u7C21\u5358\u306A\u5229\u7528\u8AAC\u660E\u3067\u3059\u3002

> \u5C0F\u3055\u306A\u76EE\u7684 <
\u3057\u305A\u304F\u306F\u3042\u306A\u305F\u306E\u65E5\u3005\u306E\u53D6\u7D44\u307F\u304B\u3089\u300C\u5C11\u3057\u3060\u3051\u300D\u30AC\u30AF\u30C1\u30AB\u3092\u898B\u3064\u3051\u308B\u3053\u3068\u306B\u7279\u5316\u3057\u305FAI\u3067\u3059

> \u3061\u3087\u3063\u3068\u3057\u305F\u4F7F\u3044\u65B9 <
\u4ECA\u65E5\u3042\u3063\u305F\u3053\u3068\u3092\u4E00\u8A00\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002\u4F8B\uFF1A\u300C\u4ECA\u65E5\u306F\u8ABF\u7406\u5B9F\u7FD2\u3060\u3063\u305F\u300D
 \u53D7\u3051\u53D6\u3063\u305F\u3057\u305A\u304F\u306F\u305D\u308C\u306B\u5BFE\u3057\u3066\u3042\u306A\u305F\u304C\u3069\u306E\u3088\u3046\u306A\u3053\u3068\u3092\u601D\u3044\u3001\u611F\u3058\u3066\u53D6\u308A\u7D44\u3093\u3060\u304B\u805E\u304D\u51FA\u3057\u307E\u3059\u3002
\u3042\u306A\u305F\u304C\u611F\u3058\u305F\u96E3\u3057\u304B\u3063\u305F\u3053\u3068\u306B\u3069\u3046\u7ACB\u3061\u5411\u304B\u3063\u305F\u304B\u306B\u5BFE\u3057\u3066\u3057\u305A\u304F\u306F\u305D\u308C\u304C\u793E\u4F1A\u306B\u304A\u3044\u3066\u3069\u3093\u306A\u5F79\u306B\u7ACB\u3064\u306E\u304B\u3092\u6559\u3048\u3066\u304F\u308C\u307E\u3059

> \u6700\u5F8C\u306B <
\u3053\u306E\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u306B\u304A\u3044\u3066\u3044\u3061\u3070\u3093\u5927\u5207\u306A\u3053\u3068\u306F
\u7686\u3055\u3093\u306B\u306F\u5C31\u8077\u6D3B\u52D5\u306F\u5C0F\u3055\u306A\u6210\u9577\u306E\u7A4D\u307F\u91CD\u306D\u3067\u5927\u304D\u306A\u7D50\u679C\u306B\u3064\u306A\u304C\u308B\u3053\u3068\u3092\u611F\u3058\u3066\u3082\u3089\u3044\u305F\u3044\u3068\u3053\u308D\u306B\u3042\u308A\u307E\u3059\u3002
\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u30E1\u30F3\u30D0\u30FC\u4E00\u540C\u306F\u3042\u306A\u305F\u306E\u5C31\u8077\u6D3B\u52D5\u304C\u8F1D\u304D\u3042\u308B\u8A66\u307F\u306E\u4E00\u3064\u306B\u306A\u308C\u308B\u3053\u3068\u3092\u9858\u3063\u3066\u304A\u308A\u307E\u3059\uFF01\uFF01\uFF01`);document.getElementById("login").onclick=async()=>{try{await CI(ET,IT),console.log("\u30ED\u30B0\u30A4\u30F3\u6210\u529F"),document.getElementById("login").querySelector("h1").textContent="\u30ED\u30B0\u30A4\u30F3\u4E2D"}catch(r){console.error("\u30ED\u30B0\u30A4\u30F3\u5931\u6557",r)}};
