(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();/*!
 * @pixi/constants - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var zt;(function(r){r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2"})(zt||(zt={}));var Ar;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS"})(Ar||(Ar={}));var gi;(function(r){r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL"})(gi||(gi={}));var C;(function(r){r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR"})(C||(C={}));var Pr;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Pr||(Pr={}));var x;(function(r){r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(x||(x={}));var Re;(function(r){r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(Re||(Re={}));var F;(function(r){r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT"})(F||(F={}));var vi;(function(r){r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT"})(vi||(vi={}));var Gt;(function(r){r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR"})(Gt||(Gt={}));var yi;(function(r){r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(yi||(yi={}));var se;(function(r){r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL"})(se||(se={}));var oe;(function(r){r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(oe||(oe={}));var Qt;(function(r){r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT"})(Qt||(Qt={}));var _i;(function(r){r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL"})(_i||(_i={}));var xt;(function(r){r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp"})(xt||(xt={}));var K;(function(r){r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR"})(K||(K={}));var ro;(function(r){r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA"})(ro||(ro={}));var Y;(function(r){r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH"})(Y||(Y={}));var Vt;(function(r){r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(Vt||(Vt={}));/*!
 * @pixi/settings - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ih={createCanvas:function(r,t){var e=document.createElement("canvas");return e.width=r,e.height=t,e},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var r;return(r=document.baseURI)!==null&&r!==void 0?r:window.location.href},fetch:function(r,t){return fetch(r,t)}},Wi=/iPhone/i,io=/iPod/i,no=/iPad/i,so=/\biOS-universal(?:.+)Mac\b/i,Yi=/\bAndroid(?:.+)Mobile\b/i,oo=/Android/i,Ge=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,zr=/Silk/i,jt=/Windows Phone/i,ao=/\bWindows(?:.+)ARM\b/i,uo=/BlackBerry/i,lo=/BB10/i,ho=/Opera Mini/i,co=/\b(CriOS|Chrome)(?:.+)Mobile/i,fo=/Mobile(?:.+)Firefox\b/i,po=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function nh(r){return function(t){return t.test(r)}}function sh(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var n=nh(e),s={apple:{phone:n(Wi)&&!n(jt),ipod:n(io),tablet:!n(Wi)&&(n(no)||po(t))&&!n(jt),universal:n(so),device:(n(Wi)||n(io)||n(no)||n(so)||po(t))&&!n(jt)},amazon:{phone:n(Ge),tablet:!n(Ge)&&n(zr),device:n(Ge)||n(zr)},android:{phone:!n(jt)&&n(Ge)||!n(jt)&&n(Yi),tablet:!n(jt)&&!n(Ge)&&!n(Yi)&&(n(zr)||n(oo)),device:!n(jt)&&(n(Ge)||n(zr)||n(Yi)||n(oo))||n(/\bokhttp\b/i)},windows:{phone:n(jt),tablet:n(ao),device:n(jt)||n(ao)},other:{blackberry:n(uo),blackberry10:n(lo),opera:n(ho),firefox:n(fo),chrome:n(co),device:n(uo)||n(lo)||n(ho)||n(fo)||n(co)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}var Pe=sh(globalThis.navigator);function oh(){return!Pe.apple.device}function ah(r){var t=!0;if(Pe.tablet||Pe.phone){if(Pe.apple.device){var e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(e){var i=parseInt(e[1],10);i<11&&(t=!1)}}if(Pe.android.device){var e=navigator.userAgent.match(/Android\s([0-9.]*)/);if(e){var i=parseInt(e[1],10);i<7&&(t=!1)}}}return t?r:4}var I={ADAPTER:ih,MIPMAP_TEXTURES:se.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:Y.NONE,SPRITE_MAX_TEXTURES:ah(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,antialias:!1,preserveDrawingBuffer:!1},GC_MODE:_i.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:yi.CLAMP,SCALE_MODE:Gt.LINEAR,PRECISION_VERTEX:xt.HIGH,PRECISION_FRAGMENT:Pe.apple.device?xt.HIGH:xt.MEDIUM,CAN_UPLOAD_SAME_BUFFER:oh(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},xr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function uh(r){var t=r.default;if(typeof t=="function"){var e=function(){return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),e}var uu={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(u,l,h){this.fn=u,this.context=l,this.once=h||!1}function s(u,l,h,c,f){if(typeof h!="function")throw new TypeError("The listener must be a function");var d=new n(h,c||u,f),p=e?e+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],d]:u._events[p].push(d):(u._events[p]=d,u._eventsCount++),u}function o(u,l){--u._eventsCount===0?u._events=new i:delete u._events[l]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],h,c;if(this._eventsCount===0)return l;for(c in h=this._events)t.call(h,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},a.prototype.listeners=function(l){var h=e?e+l:l,c=this._events[h];if(!c)return[];if(c.fn)return[c.fn];for(var f=0,d=c.length,p=new Array(d);f<d;f++)p[f]=c[f].fn;return p},a.prototype.listenerCount=function(l){var h=e?e+l:l,c=this._events[h];return c?c.fn?1:c.length:0},a.prototype.emit=function(l,h,c,f,d,p){var v=e?e+l:l;if(!this._events[v])return!1;var m=this._events[v],y=arguments.length,_,g;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,c),!0;case 4:return m.fn.call(m.context,h,c,f),!0;case 5:return m.fn.call(m.context,h,c,f,d),!0;case 6:return m.fn.call(m.context,h,c,f,d,p),!0}for(g=1,_=new Array(y-1);g<y;g++)_[g-1]=arguments[g];m.fn.apply(m.context,_)}else{var b=m.length,E;for(g=0;g<b;g++)switch(m[g].once&&this.removeListener(l,m[g].fn,void 0,!0),y){case 1:m[g].fn.call(m[g].context);break;case 2:m[g].fn.call(m[g].context,h);break;case 3:m[g].fn.call(m[g].context,h,c);break;case 4:m[g].fn.call(m[g].context,h,c,f);break;default:if(!_)for(E=1,_=new Array(y-1);E<y;E++)_[E-1]=arguments[E];m[g].fn.apply(m[g].context,_)}}return!0},a.prototype.on=function(l,h,c){return s(this,l,h,c,!1)},a.prototype.once=function(l,h,c){return s(this,l,h,c,!0)},a.prototype.removeListener=function(l,h,c,f){var d=e?e+l:l;if(!this._events[d])return this;if(!h)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===h&&(!f||p.once)&&(!c||p.context===c)&&o(this,d);else{for(var v=0,m=[],y=p.length;v<y;v++)(p[v].fn!==h||f&&!p[v].once||c&&p[v].context!==c)&&m.push(p[v]);m.length?this._events[d]=m.length===1?m[0]:m:o(this,d)}return this},a.prototype.removeAllListeners=function(l){var h;return l?(h=e?e+l:l,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,r.exports=a})(uu);const he=uu.exports;var lu={exports:{}};lu.exports=Oi;lu.exports.default=Oi;function Oi(r,t,e){e=e||2;var i=t&&t.length,n=i?t[0]*e:r.length,s=hu(r,0,n,e,!0),o=[];if(!s||s.next===s.prev)return o;var a,u,l,h,c,f,d;if(i&&(s=dh(r,t,s,e)),r.length>80*e){a=l=r[0],u=h=r[1];for(var p=e;p<n;p+=e)c=r[p],f=r[p+1],c<a&&(a=c),f<u&&(u=f),c>l&&(l=c),f>h&&(h=f);d=Math.max(l-a,h-u),d=d!==0?32767/d:0}return Mr(s,o,e,a,u,d,0),o}function hu(r,t,e,i,n){var s,o;if(n===Nn(r,t,e,i)>0)for(s=t;s<e;s+=i)o=mo(s,r[s],r[s+1],o);else for(s=e-i;s>=t;s-=i)o=mo(s,r[s],r[s+1],o);return o&&Di(o,o.next)&&(Fr(o),o=o.next),o}function Le(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(Di(e,e.next)||$(e.prev,e,e.next)===0)){if(Fr(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Mr(r,t,e,i,n,s,o){if(!!r){!o&&s&&yh(r,i,n,s);for(var a=r,u,l;r.prev!==r.next;){if(u=r.prev,l=r.next,s?hh(r,i,n,s):lh(r)){t.push(u.i/e|0),t.push(r.i/e|0),t.push(l.i/e|0),Fr(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=ch(Le(r),t,e),Mr(r,t,e,i,n,s,2)):o===2&&fh(r,t,e,i,n,s):Mr(Le(r),t,e,i,n,s,1);break}}}}function lh(r){var t=r.prev,e=r,i=r.next;if($(t,e,i)>=0)return!1;for(var n=t.x,s=e.x,o=i.x,a=t.y,u=e.y,l=i.y,h=n<s?n<o?n:o:s<o?s:o,c=a<u?a<l?a:l:u<l?u:l,f=n>s?n>o?n:o:s>o?s:o,d=a>u?a>l?a:l:u>l?u:l,p=i.next;p!==t;){if(p.x>=h&&p.x<=f&&p.y>=c&&p.y<=d&&We(n,a,s,u,o,l,p.x,p.y)&&$(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function hh(r,t,e,i){var n=r.prev,s=r,o=r.next;if($(n,s,o)>=0)return!1;for(var a=n.x,u=s.x,l=o.x,h=n.y,c=s.y,f=o.y,d=a<u?a<l?a:l:u<l?u:l,p=h<c?h<f?h:f:c<f?c:f,v=a>u?a>l?a:l:u>l?u:l,m=h>c?h>f?h:f:c>f?c:f,y=Ln(d,p,t,e,i),_=Ln(v,m,t,e,i),g=r.prevZ,b=r.nextZ;g&&g.z>=y&&b&&b.z<=_;){if(g.x>=d&&g.x<=v&&g.y>=p&&g.y<=m&&g!==n&&g!==o&&We(a,h,u,c,l,f,g.x,g.y)&&$(g.prev,g,g.next)>=0||(g=g.prevZ,b.x>=d&&b.x<=v&&b.y>=p&&b.y<=m&&b!==n&&b!==o&&We(a,h,u,c,l,f,b.x,b.y)&&$(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;g&&g.z>=y;){if(g.x>=d&&g.x<=v&&g.y>=p&&g.y<=m&&g!==n&&g!==o&&We(a,h,u,c,l,f,g.x,g.y)&&$(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;b&&b.z<=_;){if(b.x>=d&&b.x<=v&&b.y>=p&&b.y<=m&&b!==n&&b!==o&&We(a,h,u,c,l,f,b.x,b.y)&&$(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function ch(r,t,e){var i=r;do{var n=i.prev,s=i.next.next;!Di(n,s)&&cu(n,i,i.next,s)&&Rr(n,s)&&Rr(s,n)&&(t.push(n.i/e|0),t.push(i.i/e|0),t.push(s.i/e|0),Fr(i),Fr(i.next),i=r=s),i=i.next}while(i!==r);return Le(i)}function fh(r,t,e,i,n,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&xh(o,a)){var u=fu(o,a);o=Le(o,o.next),u=Le(u,u.next),Mr(o,t,e,i,n,s,0),Mr(u,t,e,i,n,s,0);return}a=a.next}o=o.next}while(o!==r)}function dh(r,t,e,i){var n=[],s,o,a,u,l;for(s=0,o=t.length;s<o;s++)a=t[s]*i,u=s<o-1?t[s+1]*i:r.length,l=hu(r,a,u,i,!1),l===l.next&&(l.steiner=!0),n.push(bh(l));for(n.sort(ph),s=0;s<n.length;s++)e=mh(n[s],e);return e}function ph(r,t){return r.x-t.x}function mh(r,t){var e=gh(r,t);if(!e)return t;var i=fu(e,r);return Le(i,i.next),Le(e,e.next)}function gh(r,t){var e=t,i=r.x,n=r.y,s=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var a=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>s&&(s=a,o=e.x<e.next.x?e:e.next,a===i))return o}e=e.next}while(e!==t);if(!o)return null;var u=o,l=o.x,h=o.y,c=1/0,f;e=o;do i>=e.x&&e.x>=l&&i!==e.x&&We(n<h?i:s,n,l,h,n<h?s:i,n,e.x,e.y)&&(f=Math.abs(n-e.y)/(i-e.x),Rr(e,r)&&(f<c||f===c&&(e.x>o.x||e.x===o.x&&vh(o,e)))&&(o=e,c=f)),e=e.next;while(e!==u);return o}function vh(r,t){return $(r.prev,r,t.prev)<0&&$(t.next,r,r.next)<0}function yh(r,t,e,i){var n=r;do n.z===0&&(n.z=Ln(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,_h(n)}function _h(r){var t,e,i,n,s,o,a,u,l=1;do{for(e=r,r=null,s=null,o=0;e;){for(o++,i=e,a=0,t=0;t<l&&(a++,i=i.nextZ,!!i);t++);for(u=l;a>0||u>0&&i;)a!==0&&(u===0||!i||e.z<=i.z)?(n=e,e=e.nextZ,a--):(n=i,i=i.nextZ,u--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;e=i}s.nextZ=null,l*=2}while(o>1);return r}function Ln(r,t,e,i,n){return r=(r-e)*n|0,t=(t-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function bh(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function We(r,t,e,i,n,s,o,a){return(n-o)*(t-a)>=(r-o)*(s-a)&&(r-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(s-a)>=(n-o)*(i-a)}function xh(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!Eh(r,t)&&(Rr(r,t)&&Rr(t,r)&&Th(r,t)&&($(r.prev,r,t.prev)||$(r,t.prev,t))||Di(r,t)&&$(r.prev,r,r.next)>0&&$(t.prev,t,t.next)>0)}function $(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Di(r,t){return r.x===t.x&&r.y===t.y}function cu(r,t,e,i){var n=Yr($(r,t,e)),s=Yr($(r,t,i)),o=Yr($(e,i,r)),a=Yr($(e,i,t));return!!(n!==s&&o!==a||n===0&&Wr(r,e,t)||s===0&&Wr(r,i,t)||o===0&&Wr(e,r,i)||a===0&&Wr(e,t,i))}function Wr(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function Yr(r){return r>0?1:r<0?-1:0}function Eh(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&cu(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Rr(r,t){return $(r.prev,r,r.next)<0?$(r,t,r.next)>=0&&$(r,r.prev,t)>=0:$(r,t,r.prev)<0||$(r,r.next,t)<0}function Th(r,t){var e=r,i=!1,n=(r.x+t.x)/2,s=(r.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function fu(r,t){var e=new Bn(r.i,r.x,r.y),i=new Bn(t.i,t.x,t.y),n=r.next,s=t.prev;return r.next=t,t.prev=r,e.next=n,n.prev=e,i.next=e,e.prev=i,s.next=i,i.prev=s,i}function mo(r,t,e,i){var n=new Bn(r,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Fr(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Bn(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Oi.deviation=function(r,t,e,i){var n=t&&t.length,s=n?t[0]*e:r.length,o=Math.abs(Nn(r,0,s,e));if(n)for(var a=0,u=t.length;a<u;a++){var l=t[a]*e,h=a<u-1?t[a+1]*e:r.length;o-=Math.abs(Nn(r,l,h,e))}var c=0;for(a=0;a<i.length;a+=3){var f=i[a]*e,d=i[a+1]*e,p=i[a+2]*e;c+=Math.abs((r[f]-r[p])*(r[d+1]-r[f+1])-(r[f]-r[d])*(r[p+1]-r[f+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function Nn(r,t,e,i){for(var n=0,s=t,o=e-i;s<e;s+=i)n+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return n}Oi.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var o=0;o<t;o++)e.vertices.push(r[n][s][o]);n>0&&(i+=r[n-1].length,e.holes.push(i))}return e};var kn={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */(function(r,t){(function(e){var i=t&&!t.nodeType&&t,n=r&&!r.nodeType&&r,s=typeof xr=="object"&&xr;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,u=36,l=1,h=26,c=38,f=700,d=72,p=128,v="-",m=/^xn--/,y=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=u-l,E=Math.floor,T=String.fromCharCode,M;function D(w){throw new RangeError(g[w])}function R(w,A){for(var O=w.length,V=[];O--;)V[O]=A(w[O]);return V}function U(w,A){var O=w.split("@"),V="";O.length>1&&(V=O[0]+"@",w=O[1]),w=w.replace(_,".");var W=w.split("."),ct=R(W,A).join(".");return V+ct}function et(w){for(var A=[],O=0,V=w.length,W,ct;O<V;)W=w.charCodeAt(O++),W>=55296&&W<=56319&&O<V?(ct=w.charCodeAt(O++),(ct&64512)==56320?A.push(((W&1023)<<10)+(ct&1023)+65536):(A.push(W),O--)):A.push(W);return A}function vt(w){return R(w,function(A){var O="";return A>65535&&(A-=65536,O+=T(A>>>10&1023|55296),A=56320|A&1023),O+=T(A),O}).join("")}function Z(w){return w-48<10?w-22:w-65<26?w-65:w-97<26?w-97:u}function lt(w,A){return w+22+75*(w<26)-((A!=0)<<5)}function ht(w,A,O){var V=0;for(w=O?E(w/f):w>>1,w+=E(w/A);w>b*h>>1;V+=u)w=E(w/b);return E(V+(b+1)*w/(w+c))}function yt(w){var A=[],O=w.length,V,W=0,ct=p,rt=d,_t,Pt,Ot,Xt,at,Tt,Mt,Kt,de;for(_t=w.lastIndexOf(v),_t<0&&(_t=0),Pt=0;Pt<_t;++Pt)w.charCodeAt(Pt)>=128&&D("not-basic"),A.push(w.charCodeAt(Pt));for(Ot=_t>0?_t+1:0;Ot<O;){for(Xt=W,at=1,Tt=u;Ot>=O&&D("invalid-input"),Mt=Z(w.charCodeAt(Ot++)),(Mt>=u||Mt>E((a-W)/at))&&D("overflow"),W+=Mt*at,Kt=Tt<=rt?l:Tt>=rt+h?h:Tt-rt,!(Mt<Kt);Tt+=u)de=u-Kt,at>E(a/de)&&D("overflow"),at*=de;V=A.length+1,rt=ht(W-Xt,V,Xt==0),E(W/V)>a-ct&&D("overflow"),ct+=E(W/V),W%=V,A.splice(W++,0,ct)}return vt(A)}function qt(w){var A,O,V,W,ct,rt,_t,Pt,Ot,Xt,at,Tt=[],Mt,Kt,de,zi;for(w=et(w),Mt=w.length,A=p,O=0,ct=d,rt=0;rt<Mt;++rt)at=w[rt],at<128&&Tt.push(T(at));for(V=W=Tt.length,W&&Tt.push(v);V<Mt;){for(_t=a,rt=0;rt<Mt;++rt)at=w[rt],at>=A&&at<_t&&(_t=at);for(Kt=V+1,_t-A>E((a-O)/Kt)&&D("overflow"),O+=(_t-A)*Kt,A=_t,rt=0;rt<Mt;++rt)if(at=w[rt],at<A&&++O>a&&D("overflow"),at==A){for(Pt=O,Ot=u;Xt=Ot<=ct?l:Ot>=ct+h?h:Ot-ct,!(Pt<Xt);Ot+=u)zi=Pt-Xt,de=u-Xt,Tt.push(T(lt(Xt+zi%de,0))),Pt=E(zi/de);Tt.push(T(lt(Pt,0))),ct=ht(O,Kt,V==W),O=0,++V}++O,++A}return Tt.join("")}function $i(w){return U(w,function(A){return m.test(A)?yt(A.slice(4).toLowerCase()):A})}function $r(w){return U(w,function(A){return y.test(A)?"xn--"+qt(A):A})}if(o={version:"1.4.1",ucs2:{decode:et,encode:vt},decode:yt,encode:qt,toASCII:$r,toUnicode:$i},i&&n)if(r.exports==i)n.exports=o;else for(M in o)o.hasOwnProperty(M)&&(i[M]=o[M]);else e.punycode=o})(xr)})(kn,kn.exports);var wh=Error,Ih=EvalError,Ch=RangeError,Sh=ReferenceError,du=SyntaxError,Vr=TypeError,Ah=URIError,Ph=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var s=Object.getOwnPropertySymbols(t);if(s.length!==1||s[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==n||o.enumerable!==!0)return!1}return!0},go=typeof Symbol<"u"&&Symbol,Mh=Ph,Rh=function(){return typeof go!="function"||typeof Symbol!="function"||typeof go("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Mh()},qi={__proto__:null,foo:{}},Fh=Object,Oh=function(){return{__proto__:qi}.foo===qi.foo&&!(qi instanceof Fh)},Dh="Function.prototype.bind called on incompatible ",Lh=Object.prototype.toString,Bh=Math.max,Nh="[object Function]",vo=function(t,e){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var s=0;s<e.length;s+=1)i[s+t.length]=e[s];return i},kh=function(t,e){for(var i=[],n=e||0,s=0;n<t.length;n+=1,s+=1)i[s]=t[n];return i},Uh=function(r,t){for(var e="",i=0;i<r.length;i+=1)e+=r[i],i+1<r.length&&(e+=t);return e},Gh=function(t){var e=this;if(typeof e!="function"||Lh.apply(e)!==Nh)throw new TypeError(Dh+e);for(var i=kh(arguments,1),n,s=function(){if(this instanceof n){var h=e.apply(this,vo(i,arguments));return Object(h)===h?h:this}return e.apply(t,vo(i,arguments))},o=Bh(0,e.length-i.length),a=[],u=0;u<o;u++)a[u]="$"+u;if(n=Function("binder","return function ("+Uh(a,",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var l=function(){};l.prototype=e.prototype,n.prototype=new l,l.prototype=null}return n},Vh=Gh,vs=Function.prototype.bind||Vh,Hh=Function.prototype.call,Xh=Object.prototype.hasOwnProperty,jh=vs,$h=jh.call(Hh,Xh),P,zh=wh,Wh=Ih,Yh=Ch,qh=Sh,rr=du,Ke=Vr,Kh=Ah,pu=Function,Ki=function(r){try{return pu('"use strict"; return ('+r+").constructor;")()}catch{}},Fe=Object.getOwnPropertyDescriptor;if(Fe)try{Fe({},"")}catch{Fe=null}var Zi=function(){throw new Ke},Zh=Fe?function(){try{return arguments.callee,Zi}catch{try{return Fe(arguments,"callee").get}catch{return Zi}}}():Zi,Ve=Rh(),Jh=Oh(),tt=Object.getPrototypeOf||(Jh?function(r){return r.__proto__}:null),$e={},Qh=typeof Uint8Array>"u"||!tt?P:tt(Uint8Array),Oe={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?P:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?P:ArrayBuffer,"%ArrayIteratorPrototype%":Ve&&tt?tt([][Symbol.iterator]()):P,"%AsyncFromSyncIteratorPrototype%":P,"%AsyncFunction%":$e,"%AsyncGenerator%":$e,"%AsyncGeneratorFunction%":$e,"%AsyncIteratorPrototype%":$e,"%Atomics%":typeof Atomics>"u"?P:Atomics,"%BigInt%":typeof BigInt>"u"?P:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?P:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?P:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?P:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":zh,"%eval%":eval,"%EvalError%":Wh,"%Float32Array%":typeof Float32Array>"u"?P:Float32Array,"%Float64Array%":typeof Float64Array>"u"?P:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?P:FinalizationRegistry,"%Function%":pu,"%GeneratorFunction%":$e,"%Int8Array%":typeof Int8Array>"u"?P:Int8Array,"%Int16Array%":typeof Int16Array>"u"?P:Int16Array,"%Int32Array%":typeof Int32Array>"u"?P:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ve&&tt?tt(tt([][Symbol.iterator]())):P,"%JSON%":typeof JSON=="object"?JSON:P,"%Map%":typeof Map>"u"?P:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ve||!tt?P:tt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?P:Promise,"%Proxy%":typeof Proxy>"u"?P:Proxy,"%RangeError%":Yh,"%ReferenceError%":qh,"%Reflect%":typeof Reflect>"u"?P:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?P:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ve||!tt?P:tt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?P:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ve&&tt?tt(""[Symbol.iterator]()):P,"%Symbol%":Ve?Symbol:P,"%SyntaxError%":rr,"%ThrowTypeError%":Zh,"%TypedArray%":Qh,"%TypeError%":Ke,"%Uint8Array%":typeof Uint8Array>"u"?P:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?P:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?P:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?P:Uint32Array,"%URIError%":Kh,"%WeakMap%":typeof WeakMap>"u"?P:WeakMap,"%WeakRef%":typeof WeakRef>"u"?P:WeakRef,"%WeakSet%":typeof WeakSet>"u"?P:WeakSet};if(tt)try{null.error}catch(r){var tc=tt(tt(r));Oe["%Error.prototype%"]=tc}var ec=function r(t){var e;if(t==="%AsyncFunction%")e=Ki("async function () {}");else if(t==="%GeneratorFunction%")e=Ki("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Ki("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=r("%AsyncGenerator%");n&&tt&&(e=tt(n.prototype))}return Oe[t]=e,e},yo={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Hr=vs,bi=$h,rc=Hr.call(Function.call,Array.prototype.concat),ic=Hr.call(Function.apply,Array.prototype.splice),_o=Hr.call(Function.call,String.prototype.replace),xi=Hr.call(Function.call,String.prototype.slice),nc=Hr.call(Function.call,RegExp.prototype.exec),sc=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,oc=/\\(\\)?/g,ac=function(t){var e=xi(t,0,1),i=xi(t,-1);if(e==="%"&&i!=="%")throw new rr("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new rr("invalid intrinsic syntax, expected opening `%`");var n=[];return _o(t,sc,function(s,o,a,u){n[n.length]=a?_o(u,oc,"$1"):o||s}),n},uc=function(t,e){var i=t,n;if(bi(yo,i)&&(n=yo[i],i="%"+n[0]+"%"),bi(Oe,i)){var s=Oe[i];if(s===$e&&(s=ec(i)),typeof s>"u"&&!e)throw new Ke("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:s}}throw new rr("intrinsic "+t+" does not exist!")},or=function(t,e){if(typeof t!="string"||t.length===0)throw new Ke("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Ke('"allowMissing" argument must be a boolean');if(nc(/^%?[^%]*%?$/,t)===null)throw new rr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=ac(t),n=i.length>0?i[0]:"",s=uc("%"+n+"%",e),o=s.name,a=s.value,u=!1,l=s.alias;l&&(n=l[0],ic(i,rc([0,1],l)));for(var h=1,c=!0;h<i.length;h+=1){var f=i[h],d=xi(f,0,1),p=xi(f,-1);if((d==='"'||d==="'"||d==="`"||p==='"'||p==="'"||p==="`")&&d!==p)throw new rr("property names with quotes must have matching quotes");if((f==="constructor"||!c)&&(u=!0),n+="."+f,o="%"+n+"%",bi(Oe,o))a=Oe[o];else if(a!=null){if(!(f in a)){if(!e)throw new Ke("base intrinsic for "+t+" exists, but the property is not available.");return}if(Fe&&h+1>=i.length){var v=Fe(a,f);c=!!v,c&&"get"in v&&!("originalValue"in v.get)?a=v.get:a=a[f]}else c=bi(a,f),a=a[f];c&&!u&&(Oe[o]=a)}}return a},mu={exports:{}},Ji,bo;function ys(){if(bo)return Ji;bo=1;var r=or,t=r("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Ji=t,Ji}var lc=or,ci=lc("%Object.getOwnPropertyDescriptor%",!0);if(ci)try{ci([],"length")}catch{ci=null}var gu=ci,xo=ys(),hc=du,He=Vr,Eo=gu,cc=function(t,e,i){if(!t||typeof t!="object"&&typeof t!="function")throw new He("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new He("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new He("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new He("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new He("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new He("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,u=!!Eo&&Eo(t,e);if(xo)xo(t,e,{configurable:o===null&&u?u.configurable:!o,enumerable:n===null&&u?u.enumerable:!n,value:i,writable:s===null&&u?u.writable:!s});else if(a||!n&&!s&&!o)t[e]=i;else throw new hc("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Un=ys(),vu=function(){return!!Un};vu.hasArrayLengthDefineBug=function(){if(!Un)return null;try{return Un([],"length",{value:1}).length!==1}catch{return!0}};var fc=vu,dc=or,To=cc,pc=fc(),wo=gu,Io=Vr,mc=dc("%Math.floor%"),gc=function(t,e){if(typeof t!="function")throw new Io("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||mc(e)!==e)throw new Io("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,s=!0;if("length"in t&&wo){var o=wo(t,"length");o&&!o.configurable&&(n=!1),o&&!o.writable&&(s=!1)}return(n||s||!i)&&(pc?To(t,"length",e,!0,!0):To(t,"length",e)),t};(function(r){var t=vs,e=or,i=gc,n=Vr,s=e("%Function.prototype.apply%"),o=e("%Function.prototype.call%"),a=e("%Reflect.apply%",!0)||t.call(o,s),u=ys(),l=e("%Math.max%");r.exports=function(f){if(typeof f!="function")throw new n("a function is required");var d=a(t,o,arguments);return i(d,1+l(0,f.length-(arguments.length-1)),!0)};var h=function(){return a(t,s,arguments)};u?u(r.exports,"apply",{value:h}):r.exports.apply=h})(mu);var yu=or,_u=mu.exports,vc=_u(yu("String.prototype.indexOf")),yc=function(t,e){var i=yu(t,!!e);return typeof i=="function"&&vc(t,".prototype.")>-1?_u(i):i};const _c={},bc=Object.freeze(Object.defineProperty({__proto__:null,default:_c},Symbol.toStringTag,{value:"Module"})),xc=uh(bc);var _s=typeof Map=="function"&&Map.prototype,Qi=Object.getOwnPropertyDescriptor&&_s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ei=_s&&Qi&&typeof Qi.get=="function"?Qi.get:null,Co=_s&&Map.prototype.forEach,bs=typeof Set=="function"&&Set.prototype,tn=Object.getOwnPropertyDescriptor&&bs?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ti=bs&&tn&&typeof tn.get=="function"?tn.get:null,So=bs&&Set.prototype.forEach,Ec=typeof WeakMap=="function"&&WeakMap.prototype,Er=Ec?WeakMap.prototype.has:null,Tc=typeof WeakSet=="function"&&WeakSet.prototype,Tr=Tc?WeakSet.prototype.has:null,wc=typeof WeakRef=="function"&&WeakRef.prototype,Ao=wc?WeakRef.prototype.deref:null,Ic=Boolean.prototype.valueOf,Cc=Object.prototype.toString,Sc=Function.prototype.toString,Ac=String.prototype.match,xs=String.prototype.slice,ee=String.prototype.replace,Pc=String.prototype.toUpperCase,Po=String.prototype.toLowerCase,bu=RegExp.prototype.test,Mo=Array.prototype.concat,kt=Array.prototype.join,Mc=Array.prototype.slice,Ro=Math.floor,Gn=typeof BigInt=="function"?BigInt.prototype.valueOf:null,en=Object.getOwnPropertySymbols,Vn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,ir=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ut=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===ir?"object":"symbol")?Symbol.toStringTag:null,xu=Object.prototype.propertyIsEnumerable,Fo=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Oo(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||bu.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-Ro(-r):Ro(r);if(i!==r){var n=String(i),s=xs.call(t,n.length+1);return ee.call(n,e,"$&_")+"."+ee.call(ee.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ee.call(t,e,"$&_")}var Hn=xc,Do=Hn.custom,Lo=Tu(Do)?Do:null,Rc=function r(t,e,i,n){var s=e||{};if(te(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(te(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=te(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(te(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(te(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Iu(t,s);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var u=String(t);return a?Oo(t,u):u}if(typeof t=="bigint"){var l=String(t)+"n";return a?Oo(t,l):l}var h=typeof s.depth>"u"?5:s.depth;if(typeof i>"u"&&(i=0),i>=h&&h>0&&typeof t=="object")return Xn(t)?"[Array]":"[Object]";var c=qc(s,i);if(typeof n>"u")n=[];else if(wu(n,t)>=0)return"[Circular]";function f(Z,lt,ht){if(lt&&(n=Mc.call(n),n.push(lt)),ht){var yt={depth:s.depth};return te(s,"quoteStyle")&&(yt.quoteStyle=s.quoteStyle),r(Z,yt,i+1,n)}return r(Z,s,i+1,n)}if(typeof t=="function"&&!Bo(t)){var d=Gc(t),p=qr(t,f);return"[Function"+(d?": "+d:" (anonymous)")+"]"+(p.length>0?" { "+kt.call(p,", ")+" }":"")}if(Tu(t)){var v=ir?ee.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Vn.call(t);return typeof t=="object"&&!ir?ur(v):v}if(zc(t)){for(var m="<"+Po.call(String(t.nodeName)),y=t.attributes||[],_=0;_<y.length;_++)m+=" "+y[_].name+"="+Eu(Fc(y[_].value),"double",s);return m+=">",t.childNodes&&t.childNodes.length&&(m+="..."),m+="</"+Po.call(String(t.nodeName))+">",m}if(Xn(t)){if(t.length===0)return"[]";var g=qr(t,f);return c&&!Yc(g)?"["+jn(g,c)+"]":"[ "+kt.call(g,", ")+" ]"}if(Dc(t)){var b=qr(t,f);return!("cause"in Error.prototype)&&"cause"in t&&!xu.call(t,"cause")?"{ ["+String(t)+"] "+kt.call(Mo.call("[cause]: "+f(t.cause),b),", ")+" }":b.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+kt.call(b,", ")+" }"}if(typeof t=="object"&&o){if(Lo&&typeof t[Lo]=="function"&&Hn)return Hn(t,{depth:h-i});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Vc(t)){var E=[];return Co&&Co.call(t,function(Z,lt){E.push(f(lt,t,!0)+" => "+f(Z,t))}),No("Map",Ei.call(t),E,c)}if(jc(t)){var T=[];return So&&So.call(t,function(Z){T.push(f(Z,t))}),No("Set",Ti.call(t),T,c)}if(Hc(t))return rn("WeakMap");if($c(t))return rn("WeakSet");if(Xc(t))return rn("WeakRef");if(Bc(t))return ur(f(Number(t)));if(kc(t))return ur(f(Gn.call(t)));if(Nc(t))return ur(Ic.call(t));if(Lc(t))return ur(f(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof xr<"u"&&t===xr)return"{ [object globalThis] }";if(!Oc(t)&&!Bo(t)){var M=qr(t,f),D=Fo?Fo(t)===Object.prototype:t instanceof Object||t.constructor===Object,R=t instanceof Object?"":"null prototype",U=!D&&ut&&Object(t)===t&&ut in t?xs.call(ce(t),8,-1):R?"Object":"",et=D||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",vt=et+(U||R?"["+kt.call(Mo.call([],U||[],R||[]),": ")+"] ":"");return M.length===0?vt+"{}":c?vt+"{"+jn(M,c)+"}":vt+"{ "+kt.call(M,", ")+" }"}return String(t)};function Eu(r,t,e){var i=(e.quoteStyle||t)==="double"?'"':"'";return i+r+i}function Fc(r){return ee.call(String(r),/"/g,"&quot;")}function Xn(r){return ce(r)==="[object Array]"&&(!ut||!(typeof r=="object"&&ut in r))}function Oc(r){return ce(r)==="[object Date]"&&(!ut||!(typeof r=="object"&&ut in r))}function Bo(r){return ce(r)==="[object RegExp]"&&(!ut||!(typeof r=="object"&&ut in r))}function Dc(r){return ce(r)==="[object Error]"&&(!ut||!(typeof r=="object"&&ut in r))}function Lc(r){return ce(r)==="[object String]"&&(!ut||!(typeof r=="object"&&ut in r))}function Bc(r){return ce(r)==="[object Number]"&&(!ut||!(typeof r=="object"&&ut in r))}function Nc(r){return ce(r)==="[object Boolean]"&&(!ut||!(typeof r=="object"&&ut in r))}function Tu(r){if(ir)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Vn)return!1;try{return Vn.call(r),!0}catch{}return!1}function kc(r){if(!r||typeof r!="object"||!Gn)return!1;try{return Gn.call(r),!0}catch{}return!1}var Uc=Object.prototype.hasOwnProperty||function(r){return r in this};function te(r,t){return Uc.call(r,t)}function ce(r){return Cc.call(r)}function Gc(r){if(r.name)return r.name;var t=Ac.call(Sc.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function wu(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function Vc(r){if(!Ei||!r||typeof r!="object")return!1;try{Ei.call(r);try{Ti.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Hc(r){if(!Er||!r||typeof r!="object")return!1;try{Er.call(r,Er);try{Tr.call(r,Tr)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Xc(r){if(!Ao||!r||typeof r!="object")return!1;try{return Ao.call(r),!0}catch{}return!1}function jc(r){if(!Ti||!r||typeof r!="object")return!1;try{Ti.call(r);try{Ei.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function $c(r){if(!Tr||!r||typeof r!="object")return!1;try{Tr.call(r,Tr);try{Er.call(r,Er)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function zc(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Iu(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return Iu(xs.call(r,0,t.maxStringLength),t)+i}var n=ee.call(ee.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Wc);return Eu(n,"single",t)}function Wc(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+Pc.call(t.toString(16))}function ur(r){return"Object("+r+")"}function rn(r){return r+" { ? }"}function No(r,t,e,i){var n=i?jn(e,i):kt.call(e,", ");return r+" ("+t+") {"+n+"}"}function Yc(r){for(var t=0;t<r.length;t++)if(wu(r[t],`
`)>=0)return!1;return!0}function qc(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=kt.call(Array(r.indent+1)," ");else return null;return{base:e,prev:kt.call(Array(t+1),e)}}function jn(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+kt.call(r,","+e)+`
`+t.prev}function qr(r,t){var e=Xn(r),i=[];if(e){i.length=r.length;for(var n=0;n<r.length;n++)i[n]=te(r,n)?t(r[n],r):""}var s=typeof en=="function"?en(r):[],o;if(ir){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var u in r)!te(r,u)||e&&String(Number(u))===u&&u<r.length||ir&&o["$"+u]instanceof Symbol||(bu.call(/[^\w$]/,u)?i.push(t(u,r)+": "+t(r[u],r)):i.push(u+": "+t(r[u],r)));if(typeof en=="function")for(var l=0;l<s.length;l++)xu.call(r,s[l])&&i.push("["+t(s[l])+"]: "+t(r[s[l]],r));return i}var Cu=or,ar=yc,Kc=Rc,Zc=Vr,Kr=Cu("%WeakMap%",!0),Zr=Cu("%Map%",!0),Jc=ar("WeakMap.prototype.get",!0),Qc=ar("WeakMap.prototype.set",!0),tf=ar("WeakMap.prototype.has",!0),ef=ar("Map.prototype.get",!0),rf=ar("Map.prototype.set",!0),nf=ar("Map.prototype.has",!0),Es=function(r,t){for(var e=r,i;(i=e.next)!==null;e=i)if(i.key===t)return e.next=i.next,i.next=r.next,r.next=i,i},sf=function(r,t){var e=Es(r,t);return e&&e.value},of=function(r,t,e){var i=Es(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},af=function(r,t){return!!Es(r,t)},uf=function(){var t,e,i,n={assert:function(s){if(!n.has(s))throw new Zc("Side channel does not contain "+Kc(s))},get:function(s){if(Kr&&s&&(typeof s=="object"||typeof s=="function")){if(t)return Jc(t,s)}else if(Zr){if(e)return ef(e,s)}else if(i)return sf(i,s)},has:function(s){if(Kr&&s&&(typeof s=="object"||typeof s=="function")){if(t)return tf(t,s)}else if(Zr){if(e)return nf(e,s)}else if(i)return af(i,s);return!1},set:function(s,o){Kr&&s&&(typeof s=="object"||typeof s=="function")?(t||(t=new Kr),Qc(t,s,o)):Zr?(e||(e=new Zr),rf(e,s,o)):(i||(i={key:{},next:null}),of(i,s,o))}};return n},lf=String.prototype.replace,hf=/%20/g,nn={RFC1738:"RFC1738",RFC3986:"RFC3986"},Ts={default:nn.RFC3986,formatters:{RFC1738:function(r){return lf.call(r,hf,"+")},RFC3986:function(r){return String(r)}},RFC1738:nn.RFC1738,RFC3986:nn.RFC3986},cf=Ts,sn=Object.prototype.hasOwnProperty,Se=Array.isArray,Dt=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r}(),ff=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(Se(i)){for(var n=[],s=0;s<i.length;++s)typeof i[s]<"u"&&n.push(i[s]);e.obj[e.prop]=n}}},Su=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(i[n]=t[n]);return i},df=function r(t,e,i){if(!e)return t;if(typeof e!="object"){if(Se(t))t.push(e);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!sn.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var n=t;return Se(t)&&!Se(e)&&(n=Su(t,i)),Se(t)&&Se(e)?(e.forEach(function(s,o){if(sn.call(t,o)){var a=t[o];a&&typeof a=="object"&&s&&typeof s=="object"?t[o]=r(a,s,i):t.push(s)}else t[o]=s}),t):Object.keys(e).reduce(function(s,o){var a=e[o];return sn.call(s,o)?s[o]=r(s[o],a,i):s[o]=a,s},n)},pf=function(t,e){return Object.keys(e).reduce(function(i,n){return i[n]=e[n],i},t)},mf=function(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},on=1024,gf=function(t,e,i,n,s){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),i==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(d){return"%26%23"+parseInt(d.slice(2),16)+"%3B"});for(var a="",u=0;u<o.length;u+=on){for(var l=o.length>=on?o.slice(u,u+on):o,h=[],c=0;c<l.length;++c){var f=l.charCodeAt(c);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||s===cf.RFC1738&&(f===40||f===41)){h[h.length]=l.charAt(c);continue}if(f<128){h[h.length]=Dt[f];continue}if(f<2048){h[h.length]=Dt[192|f>>6]+Dt[128|f&63];continue}if(f<55296||f>=57344){h[h.length]=Dt[224|f>>12]+Dt[128|f>>6&63]+Dt[128|f&63];continue}c+=1,f=65536+((f&1023)<<10|l.charCodeAt(c)&1023),h[h.length]=Dt[240|f>>18]+Dt[128|f>>12&63]+Dt[128|f>>6&63]+Dt[128|f&63]}a+=h.join("")}return a},vf=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],n=0;n<e.length;++n)for(var s=e[n],o=s.obj[s.prop],a=Object.keys(o),u=0;u<a.length;++u){var l=a[u],h=o[l];typeof h=="object"&&h!==null&&i.indexOf(h)===-1&&(e.push({obj:o,prop:l}),i.push(h))}return ff(e),t},yf=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},_f=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},bf=function(t,e){return[].concat(t,e)},xf=function(t,e){if(Se(t)){for(var i=[],n=0;n<t.length;n+=1)i.push(e(t[n]));return i}return e(t)},Au={arrayToObject:Su,assign:pf,combine:bf,compact:vf,decode:mf,encode:gf,isBuffer:_f,isRegExp:yf,maybeMap:xf,merge:df},Pu=uf,fi=Au,wr=Ts,Ef=Object.prototype.hasOwnProperty,Mu={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Nt=Array.isArray,Tf=Array.prototype.push,Ru=function(r,t){Tf.apply(r,Nt(t)?t:[t])},wf=Date.prototype.toISOString,ko=wr.default,J={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:fi.encode,encodeValuesOnly:!1,format:ko,formatter:wr.formatters[ko],indices:!1,serializeDate:function(t){return wf.call(t)},skipNulls:!1,strictNullHandling:!1},If=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},an={},Cf=function r(t,e,i,n,s,o,a,u,l,h,c,f,d,p,v,m,y,_){for(var g=t,b=_,E=0,T=!1;(b=b.get(an))!==void 0&&!T;){var M=b.get(t);if(E+=1,typeof M<"u"){if(M===E)throw new RangeError("Cyclic object value");T=!0}typeof b.get(an)>"u"&&(E=0)}if(typeof h=="function"?g=h(e,g):g instanceof Date?g=d(g):i==="comma"&&Nt(g)&&(g=fi.maybeMap(g,function(w){return w instanceof Date?d(w):w})),g===null){if(o)return l&&!m?l(e,J.encoder,y,"key",p):e;g=""}if(If(g)||fi.isBuffer(g)){if(l){var D=m?e:l(e,J.encoder,y,"key",p);return[v(D)+"="+v(l(g,J.encoder,y,"value",p))]}return[v(e)+"="+v(String(g))]}var R=[];if(typeof g>"u")return R;var U;if(i==="comma"&&Nt(g))m&&l&&(g=fi.maybeMap(g,l)),U=[{value:g.length>0?g.join(",")||null:void 0}];else if(Nt(h))U=h;else{var et=Object.keys(g);U=c?et.sort(c):et}var vt=u?e.replace(/\./g,"%2E"):e,Z=n&&Nt(g)&&g.length===1?vt+"[]":vt;if(s&&Nt(g)&&g.length===0)return Z+"[]";for(var lt=0;lt<U.length;++lt){var ht=U[lt],yt=typeof ht=="object"&&typeof ht.value<"u"?ht.value:g[ht];if(!(a&&yt===null)){var qt=f&&u?ht.replace(/\./g,"%2E"):ht,$i=Nt(g)?typeof i=="function"?i(Z,qt):Z:Z+(f?"."+qt:"["+qt+"]");_.set(t,E);var $r=Pu();$r.set(an,_),Ru(R,r(yt,$i,i,n,s,o,a,u,i==="comma"&&m&&Nt(g)?null:l,h,c,f,d,p,v,m,y,$r))}}return R},Sf=function(t){if(!t)return J;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||J.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=wr.default;if(typeof t.format<"u"){if(!Ef.call(wr.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var n=wr.formatters[i],s=J.filter;(typeof t.filter=="function"||Nt(t.filter))&&(s=t.filter);var o;if(t.arrayFormat in Mu?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=J.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:J.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:J.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:J.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:J.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?J.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:J.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:J.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:J.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:J.encodeValuesOnly,filter:s,format:i,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:J.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:J.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:J.strictNullHandling}},Af=function(r,t){var e=r,i=Sf(t),n,s;typeof i.filter=="function"?(s=i.filter,e=s("",e)):Nt(i.filter)&&(s=i.filter,n=s);var o=[];if(typeof e!="object"||e===null)return"";var a=Mu[i.arrayFormat],u=a==="comma"&&i.commaRoundTrip;n||(n=Object.keys(e)),i.sort&&n.sort(i.sort);for(var l=Pu(),h=0;h<n.length;++h){var c=n[h];i.skipNulls&&e[c]===null||Ru(o,Cf(e[c],c,a,u,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,l))}var f=o.join(i.delimiter),d=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),f.length>0?d+f:""},nr=Au,$n=Object.prototype.hasOwnProperty,Pf=Array.isArray,z={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:nr.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},Mf=function(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},Fu=function(r,t){return r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1?r.split(","):r},Rf="utf8=%26%2310003%3B",Ff="utf8=%E2%9C%93",Of=function(t,e){var i={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;n=n.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=n.split(e.delimiter,s),a=-1,u,l=e.charset;if(e.charsetSentinel)for(u=0;u<o.length;++u)o[u].indexOf("utf8=")===0&&(o[u]===Ff?l="utf-8":o[u]===Rf&&(l="iso-8859-1"),a=u,u=o.length);for(u=0;u<o.length;++u)if(u!==a){var h=o[u],c=h.indexOf("]="),f=c===-1?h.indexOf("="):c+1,d,p;f===-1?(d=e.decoder(h,z.decoder,l,"key"),p=e.strictNullHandling?null:""):(d=e.decoder(h.slice(0,f),z.decoder,l,"key"),p=nr.maybeMap(Fu(h.slice(f+1),e),function(m){return e.decoder(m,z.decoder,l,"value")})),p&&e.interpretNumericEntities&&l==="iso-8859-1"&&(p=Mf(p)),h.indexOf("[]=")>-1&&(p=Pf(p)?[p]:p);var v=$n.call(i,d);v&&e.duplicates==="combine"?i[d]=nr.combine(i[d],p):(!v||e.duplicates==="last")&&(i[d]=p)}return i},Df=function(r,t,e,i){for(var n=i?t:Fu(t,e),s=r.length-1;s>=0;--s){var o,a=r[s];if(a==="[]"&&e.parseArrays)o=e.allowEmptyArrays&&(n===""||e.strictNullHandling&&n===null)?[]:[].concat(n);else{o=e.plainObjects?Object.create(null):{};var u=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,l=e.decodeDotInKeys?u.replace(/%2E/g,"."):u,h=parseInt(l,10);!e.parseArrays&&l===""?o={0:n}:!isNaN(h)&&a!==l&&String(h)===l&&h>=0&&e.parseArrays&&h<=e.arrayLimit?(o=[],o[h]=n):l!=="__proto__"&&(o[l]=n)}n=o}return n},Lf=function(t,e,i,n){if(!!t){var s=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,u=i.depth>0&&o.exec(s),l=u?s.slice(0,u.index):s,h=[];if(l){if(!i.plainObjects&&$n.call(Object.prototype,l)&&!i.allowPrototypes)return;h.push(l)}for(var c=0;i.depth>0&&(u=a.exec(s))!==null&&c<i.depth;){if(c+=1,!i.plainObjects&&$n.call(Object.prototype,u[1].slice(1,-1))&&!i.allowPrototypes)return;h.push(u[1])}if(u){if(i.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+i.depth+" and strictDepth is true");h.push("["+s.slice(u.index)+"]")}return Df(h,e,i,n)}},Bf=function(t){if(!t)return z;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?z.charset:t.charset,i=typeof t.duplicates>"u"?z.duplicates:t.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:z.allowDots:!!t.allowDots;return{allowDots:n,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:z.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:z.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:z.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:z.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:z.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:z.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:z.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:z.decoder,delimiter:typeof t.delimiter=="string"||nr.isRegExp(t.delimiter)?t.delimiter:z.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:z.depth,duplicates:i,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:z.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:z.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:z.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:z.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:z.strictNullHandling}},Nf=function(r,t){var e=Bf(t);if(r===""||r===null||typeof r>"u")return e.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?Of(r,e):r,n=e.plainObjects?Object.create(null):{},s=Object.keys(i),o=0;o<s.length;++o){var a=s[o],u=Lf(a,i[a],e,typeof r=="string");n=nr.merge(n,u,e)}return e.allowSparse===!0?n:nr.compact(n)},kf=Af,Uf=Nf,Gf=Ts,Vf={formats:Gf,parse:Uf,stringify:kf},Hf=kn.exports;function Ft(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Xf=/^([a-z0-9.+-]+:)/i,jf=/:[0-9]*$/,$f=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,zf=["<",">",'"',"`"," ","\r",`
`,"	"],Wf=["{","}","|","\\","^","`"].concat(zf),zn=["'"].concat(Wf),Uo=["%","/","?",";","#"].concat(zn),Go=["/","?","#"],Yf=255,Vo=/^[+a-z0-9A-Z_-]{0,63}$/,qf=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Kf={javascript:!0,"javascript:":!0},Wn={javascript:!0,"javascript:":!0},Ze={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Yn=Vf;function Li(r,t,e){if(r&&typeof r=="object"&&r instanceof Ft)return r;var i=new Ft;return i.parse(r,t,e),i}Ft.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),n=i!==-1&&i<r.indexOf("#")?"?":"#",s=r.split(n),o=/\\/g;s[0]=s[0].replace(o,"/"),r=s.join(n);var a=r;if(a=a.trim(),!e&&r.split("#").length===1){var u=$f.exec(a);if(u)return this.path=a,this.href=a,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=Yn.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=Xf.exec(a);if(l){l=l[0];var h=l.toLowerCase();this.protocol=h,a=a.substr(l.length)}if(e||l||a.match(/^\/\/[^@/]+@[^@/]+/)){var c=a.substr(0,2)==="//";c&&!(l&&Wn[l])&&(a=a.substr(2),this.slashes=!0)}if(!Wn[l]&&(c||l&&!Ze[l])){for(var f=-1,d=0;d<Go.length;d++){var p=a.indexOf(Go[d]);p!==-1&&(f===-1||p<f)&&(f=p)}var v,m;f===-1?m=a.lastIndexOf("@"):m=a.lastIndexOf("@",f),m!==-1&&(v=a.slice(0,m),a=a.slice(m+1),this.auth=decodeURIComponent(v)),f=-1;for(var d=0;d<Uo.length;d++){var p=a.indexOf(Uo[d]);p!==-1&&(f===-1||p<f)&&(f=p)}f===-1&&(f=a.length),this.host=a.slice(0,f),a=a.slice(f),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var _=this.hostname.split(/\./),d=0,g=_.length;d<g;d++){var b=_[d];if(!!b&&!b.match(Vo)){for(var E="",T=0,M=b.length;T<M;T++)b.charCodeAt(T)>127?E+="x":E+=b[T];if(!E.match(Vo)){var D=_.slice(0,d),R=_.slice(d+1),U=b.match(qf);U&&(D.push(U[1]),R.unshift(U[2])),R.length&&(a="/"+R.join(".")+a),this.hostname=D.join(".");break}}}this.hostname.length>Yf?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=Hf.toASCII(this.hostname));var et=this.port?":"+this.port:"",vt=this.hostname||"";this.host=vt+et,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!Kf[h])for(var d=0,g=zn.length;d<g;d++){var Z=zn[d];if(a.indexOf(Z)!==-1){var lt=encodeURIComponent(Z);lt===Z&&(lt=escape(Z)),a=a.split(Z).join(lt)}}var ht=a.indexOf("#");ht!==-1&&(this.hash=a.substr(ht),a=a.slice(0,ht));var yt=a.indexOf("?");if(yt!==-1?(this.search=a.substr(yt),this.query=a.substr(yt+1),t&&(this.query=Yn.parse(this.query)),a=a.slice(0,yt)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Ze[h]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var et=this.pathname||"",qt=this.search||"";this.path=et+qt}return this.href=this.format(),this};function Zf(r){return typeof r=="string"&&(r=Li(r)),r instanceof Ft?r.format():Ft.prototype.format.call(r)}Ft.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",n=!1,s="";this.host?n=r+this.host:this.hostname&&(n=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=Yn.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Ze[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+n+e+o+i};function Jf(r,t){return Li(r,!1,!0).resolve(t)}Ft.prototype.resolve=function(r){return this.resolveObject(Li(r,!1,!0)).format()};Ft.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new Ft;t.parse(r,!1,!0),r=t}for(var e=new Ft,i=Object.keys(this),n=0;n<i.length;n++){var s=i[n];e[s]=this[s]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),a=0;a<o.length;a++){var u=o[a];u!=="protocol"&&(e[u]=r[u])}return Ze[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!Ze[r.protocol]){for(var l=Object.keys(r),h=0;h<l.length;h++){var c=l[h];e[c]=r[c]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!Wn[r.protocol]){for(var g=(r.pathname||"").split("/");g.length&&!(r.host=g.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),g[0]!==""&&g.unshift(""),g.length<2&&g.unshift(""),e.pathname=g.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var f=e.pathname||"",d=e.search||"";e.path=f+d}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var p=e.pathname&&e.pathname.charAt(0)==="/",v=r.host||r.pathname&&r.pathname.charAt(0)==="/",m=v||p||e.host&&r.pathname,y=m,_=e.pathname&&e.pathname.split("/")||[],g=r.pathname&&r.pathname.split("/")||[],b=e.protocol&&!Ze[e.protocol];if(b&&(e.hostname="",e.port=null,e.host&&(_[0]===""?_[0]=e.host:_.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(g[0]===""?g[0]=r.host:g.unshift(r.host)),r.host=null),m=m&&(g[0]===""||_[0]==="")),v)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,_=g;else if(g.length)_||(_=[]),_.pop(),_=_.concat(g),e.search=r.search,e.query=r.query;else if(r.search!=null){if(b){e.host=_.shift(),e.hostname=e.host;var E=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;E&&(e.auth=E.shift(),e.hostname=E.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!_.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var T=_.slice(-1)[0],M=(e.host||r.host||_.length>1)&&(T==="."||T==="..")||T==="",D=0,R=_.length;R>=0;R--)T=_[R],T==="."?_.splice(R,1):T===".."?(_.splice(R,1),D++):D&&(_.splice(R,1),D--);if(!m&&!y)for(;D--;D)_.unshift("..");m&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")&&_.unshift(""),M&&_.join("/").substr(-1)!=="/"&&_.push("");var U=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(b){e.hostname=U?"":_.length?_.shift():"",e.host=e.hostname;var E=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;E&&(e.auth=E.shift(),e.hostname=E.shift(),e.host=e.hostname)}return m=m||e.host&&_.length,m&&!U&&_.unshift(""),_.length>0?e.pathname=_.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};Ft.prototype.parseHost=function(){var r=this.host,t=jf.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};var Qf=Li,td=Jf,ed=Zf;/*!
 * @pixi/utils - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/utils is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Bi={parse:Qf,format:ed,resolve:td};I.RETINA_PREFIX=/@([0-9\.]+)x/;I.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Ho=!1,Xo="6.5.10";function rd(r){var t;if(!Ho){if(I.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){var e=[`
 %c %c %c PixiJS `+Xo+" - \u2730 "+r+` \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(t=globalThis.console).log.apply(t,e)}else globalThis.console&&globalThis.console.log("PixiJS "+Xo+" - "+r+" - http://www.pixijs.com/");Ho=!0}}var un;function id(){return typeof un>"u"&&(un=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:I.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!I.ADAPTER.getWebGLRenderingContext())return!1;var e=I.ADAPTER.createCanvas(),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),n=!!(i&&i.getContextAttributes().stencil);if(i){var s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,n}catch{return!1}}()),un}function nd(r,t){return t===void 0&&(t=[]),t[0]=(r>>16&255)/255,t[1]=(r>>8&255)/255,t[2]=(r&255)/255,t}function sd(r){var t=r.toString(16);return t="000000".substring(0,6-t.length)+t,"#"+t}function od(){for(var r=[],t=[],e=0;e<32;e++)r[e]=e,t[e]=e;r[C.NORMAL_NPM]=C.NORMAL,r[C.ADD_NPM]=C.ADD,r[C.SCREEN_NPM]=C.SCREEN,t[C.NORMAL]=C.NORMAL_NPM,t[C.ADD]=C.ADD_NPM,t[C.SCREEN]=C.SCREEN_NPM;var i=[];return i.push(t),i.push(r),i}var ad=od();function ud(r,t){if(t===1)return(t*255<<24)+r;if(t===0)return 0;var e=r>>16&255,i=r>>8&255,n=r&255;return e=e*t+.5|0,i=i*t+.5|0,n=n*t+.5|0,(t*255<<24)+(e<<16)+(i<<8)+n}function Ou(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function wi(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function jo(r){return!(r&r-1)&&!!r}function $o(r){var t=(r>65535?1:0)<<4;r>>>=t;var e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function di(r,t,e){var i=r.length,n;if(!(t>=i||e===0)){e=t+e>i?i-t:e;var s=i-e;for(n=t;n<s;++n)r[n]=r[n+e];r.length=s}}var ld=0;function Or(){return++ld}var zo={};function De(r,t,e){if(e===void 0&&(e=3),!zo[t]){var i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+r):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t+`
Deprecated since v`+r),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+r),console.warn(i))),zo[t]=!0}}var Wo={},$t=Object.create(null),pe=Object.create(null);(function(){function r(t,e,i){this.canvas=I.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=i||I.RESOLUTION,this.resize(t,e)}return r.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},r.prototype.resize=function(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)},r.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(r.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0}),r})();var Jr;function hd(r,t){if(t===void 0&&(t=globalThis.location),r.indexOf("data:")===0)return"";t=t||globalThis.location,Jr||(Jr=document.createElement("a")),Jr.href=r;var e=Bi.parse(Jr.href),i=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!i||e.protocol!==t.protocol?"anonymous":""}function Yo(r,t){var e=I.RETINA_PREFIX.exec(r);return e?parseFloat(e[1]):t!==void 0?t:1}/*!
 * @pixi/extensions - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/extensions is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ir=function(){return Ir=Object.assign||function(t){for(var e=arguments,i,n=1,s=arguments.length;n<s;n++){i=e[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},Ir.apply(this,arguments)},At;(function(r){r.Application="application",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Loader="loader",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser"})(At||(At={}));var qo=function(r){if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");var t=typeof r.extension!="object"?{type:r.extension}:r.extension;r=Ir(Ir({},t),{ref:r})}if(typeof r=="object")r=Ir({},r);else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},Xr={_addHandlers:null,_removeHandlers:null,_queue:{},remove:function(){for(var r=arguments,t=this,e=[],i=0;i<arguments.length;i++)e[i]=r[i];return e.map(qo).forEach(function(n){n.type.forEach(function(s){var o,a;return(a=(o=t._removeHandlers)[s])===null||a===void 0?void 0:a.call(o,n)})}),this},add:function(){for(var r=arguments,t=this,e=[],i=0;i<arguments.length;i++)e[i]=r[i];return e.map(qo).forEach(function(n){n.type.forEach(function(s){var o=t._addHandlers,a=t._queue;o[s]?o[s](n):(a[s]=a[s]||[],a[s].push(n))})}),this},handle:function(r,t,e){var i=this._addHandlers=this._addHandlers||{},n=this._removeHandlers=this._removeHandlers||{};if(i[r]||n[r])throw new Error("Extension type "+r+" already has a handler");i[r]=t,n[r]=e;var s=this._queue;return s[r]&&(s[r].forEach(function(o){return t(o)}),delete s[r]),this},handleByMap:function(r,t){return this.handle(r,function(e){t[e.name]=e.ref},function(e){delete t[e.name]})},handleByList:function(r,t){return this.handle(r,function(e){var i,n;t.includes(e.ref)||(t.push(e.ref),r===At.Loader&&((n=(i=e.ref).add)===null||n===void 0||n.call(i)))},function(e){var i=t.indexOf(e.ref);i!==-1&&t.splice(i,1)})}};/*!
 * @pixi/runner - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/runner is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var nt=function(){function r(t){this.items=[],this._name=t,this._aliasCount=0}return r.prototype.emit=function(t,e,i,n,s,o,a,u){if(arguments.length>8)throw new Error("max arguments reached");var l=this,h=l.name,c=l.items;this._aliasCount++;for(var f=0,d=c.length;f<d;f++)c[f][h](t,e,i,n,s,o,a,u);return c===this.items&&this._aliasCount--,this},r.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},r.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},r.prototype.remove=function(t){var e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},r.prototype.contains=function(t){return this.items.indexOf(t)!==-1},r.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},r.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(r.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),r}();Object.defineProperties(nt.prototype,{dispatch:{value:nt.prototype.emit},run:{value:nt.prototype.emit}});/*!
 * @pixi/ticker - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */I.TARGET_FPMS=.06;var sr;(function(r){r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY"})(sr||(sr={}));var ln=function(){function r(t,e,i,n){e===void 0&&(e=null),i===void 0&&(i=0),n===void 0&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}return r.prototype.match=function(t,e){return e===void 0&&(e=null),this.fn===t&&this.context===e},r.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},r.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},r.prototype.destroy=function(t){t===void 0&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},r}(),Rt=function(){function r(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ln(null,null,1/0),this.deltaMS=1/I.TARGET_FPMS,this.elapsedMS=1/I.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&t._requestId===null&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return r.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},r.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},r.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},r.prototype.add=function(t,e,i){return i===void 0&&(i=sr.NORMAL),this._addListener(new ln(t,e,i))},r.prototype.addOnce=function(t,e,i){return i===void 0&&(i=sr.NORMAL),this._addListener(new ln(t,e,i,!0))},r.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this},r.prototype.remove=function(t,e){for(var i=this._head.next;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(r.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),r.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},r.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},r.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},r.prototype.update=function(t){t===void 0&&(t=performance.now());var e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*I.TARGET_FPMS;for(var n=this._head,s=n.next;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(r.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,I.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(t===0)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(r,"shared",{get:function(){if(!r._shared){var t=r._shared=new r;t.autoStart=!0,t._protected=!0}return r._shared},enumerable:!1,configurable:!0}),Object.defineProperty(r,"system",{get:function(){if(!r._system){var t=r._system=new r;t.autoStart=!0,t._protected=!0}return r._system},enumerable:!1,configurable:!0}),r}(),cd=function(){function r(){}return r.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,sr.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Rt.shared:new Rt,t.autoStart&&this.start()},r.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},r.extension=At.Application,r}();/*!
 * @pixi/math - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/math is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var fd=Math.PI*2,dd=180/Math.PI,pd=Math.PI/180,qn;(function(r){r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC"})(qn||(qn={}));var dt=function(){function r(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},r.prototype.copyTo=function(t){return t.set(this.x,this.y),t},r.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},r.prototype.set=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x=t,this.y=e,this},r.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},r}(),Qr=[new dt,new dt,new dt,new dt],q=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=qn.RECT}return Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(r,"EMPTY",{get:function(){return new r(0,0,0,0)},enumerable:!1,configurable:!0}),r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},r.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},r.prototype.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},r.prototype.intersects=function(t,e){if(!e){var i=this.x<t.x?t.x:this.x,n=this.right>t.right?t.right:this.right;if(n<=i)return!1;var s=this.y<t.y?t.y:this.y,o=this.bottom>t.bottom?t.bottom:this.bottom;return o>s}var a=this.left,u=this.right,l=this.top,h=this.bottom;if(u<=a||h<=l)return!1;var c=Qr[0].set(t.left,t.top),f=Qr[1].set(t.left,t.bottom),d=Qr[2].set(t.right,t.top),p=Qr[3].set(t.right,t.bottom);if(d.x<=c.x||f.y<=c.y)return!1;var v=Math.sign(e.a*e.d-e.b*e.c);if(v===0||(e.apply(c,c),e.apply(f,f),e.apply(d,d),e.apply(p,p),Math.max(c.x,f.x,d.x,p.x)<=a||Math.min(c.x,f.x,d.x,p.x)>=u||Math.max(c.y,f.y,d.y,p.y)<=l||Math.min(c.y,f.y,d.y,p.y)>=h))return!1;var m=v*(f.y-c.y),y=v*(c.x-f.x),_=m*a+y*l,g=m*u+y*l,b=m*a+y*h,E=m*u+y*h;if(Math.max(_,g,b,E)<=m*c.x+y*c.y||Math.min(_,g,b,E)>=m*p.x+y*p.y)return!1;var T=v*(c.y-d.y),M=v*(d.x-c.x),D=T*a+M*l,R=T*u+M*l,U=T*a+M*h,et=T*u+M*h;return!(Math.max(D,R,U,et)<=T*c.x+M*c.y||Math.min(D,R,U,et)>=T*p.x+M*p.y)},r.prototype.pad=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this},r.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(s-n,0),this},r.prototype.ceil=function(t,e){t===void 0&&(t=1),e===void 0&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this},r.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=s-n,this},r.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},r}(),gr=function(){function r(t,e,i,n){i===void 0&&(i=0),n===void 0&&(n=0),this._x=i,this._y=n,this.cb=t,this.scope=e}return r.prototype.clone=function(t,e){return t===void 0&&(t=this.cb),e===void 0&&(e=this.scope),new r(t,e,this._x,this._y)},r.prototype.set=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this},r.prototype.copyFrom=function(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},r.prototype.copyTo=function(t){return t.set(this._x,this._y),t},r.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},r.prototype.toString=function(){return"[@pixi/math:ObservablePoint x="+0+" y="+0+" scope="+this.scope+"]"},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),r}(),ot=function(){function r(t,e,i,n,s,o){t===void 0&&(t=1),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=1),s===void 0&&(s=0),o===void 0&&(o=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o}return r.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},r.prototype.set=function(t,e,i,n,s,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o,this},r.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},r.prototype.apply=function(t,e){e=e||new dt;var i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e},r.prototype.applyInverse=function(t,e){e=e||new dt;var i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},r.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},r.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},r.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},r.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},r.prototype.setTransform=function(t,e,i,n,s,o,a,u,l){return this.a=Math.cos(a+l)*s,this.b=Math.sin(a+l)*s,this.c=-Math.sin(a-u)*o,this.d=Math.cos(a-u)*o,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this},r.prototype.prepend=function(t){var e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){var i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},r.prototype.decompose=function(t){var e=this.a,i=this.b,n=this.c,s=this.d,o=t.pivot,a=-Math.atan2(-n,s),u=Math.atan2(i,e),l=Math.abs(a+u);return l<1e-5||Math.abs(fd-l)<1e-5?(t.rotation=u,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=u),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*i+o.y*s),t},r.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,s=this.tx,o=t*n-e*i;return this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*s)/o,this.ty=-(t*this.ty-e*s)/o,this},r.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},r.prototype.clone=function(){var t=new r;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},r.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},r.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},r.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(r,"IDENTITY",{get:function(){return new r},enumerable:!1,configurable:!0}),Object.defineProperty(r,"TEMP_MATRIX",{get:function(){return new r},enumerable:!1,configurable:!0}),r}(),_e=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],be=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],xe=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ee=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Kn=[],Du=[],ti=Math.sign;function md(){for(var r=0;r<16;r++){var t=[];Kn.push(t);for(var e=0;e<16;e++)for(var i=ti(_e[r]*_e[e]+xe[r]*be[e]),n=ti(be[r]*_e[e]+Ee[r]*be[e]),s=ti(_e[r]*xe[e]+xe[r]*Ee[e]),o=ti(be[r]*xe[e]+Ee[r]*Ee[e]),a=0;a<16;a++)if(_e[a]===i&&be[a]===n&&xe[a]===s&&Ee[a]===o){t.push(a);break}}for(var r=0;r<16;r++){var u=new ot;u.set(_e[r],be[r],xe[r],Ee[r],0,0),Du.push(u)}}md();var H={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(r){return _e[r]},uY:function(r){return be[r]},vX:function(r){return xe[r]},vY:function(r){return Ee[r]},inv:function(r){return r&8?r&15:-r&7},add:function(r,t){return Kn[r][t]},sub:function(r,t){return Kn[r][H.inv(t)]},rotate180:function(r){return r^4},isVertical:function(r){return(r&3)===2},byDirection:function(r,t){return Math.abs(r)*2<=Math.abs(t)?t>=0?H.S:H.N:Math.abs(t)*2<=Math.abs(r)?r>0?H.E:H.W:t>0?r>0?H.SE:H.SW:r>0?H.NE:H.NW},matrixAppendRotationInv:function(r,t,e,i){e===void 0&&(e=0),i===void 0&&(i=0);var n=Du[H.inv(t)];n.tx=e,n.ty=i,r.append(n)}},Lu=function(){function r(){this.worldTransform=new ot,this.localTransform=new ot,this.position=new gr(this.onChange,this,0,0),this.scale=new gr(this.onChange,this,1,1),this.pivot=new gr(this.onChange,this,0,0),this.skew=new gr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return r.prototype.onChange=function(){this._localID++},r.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},r.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},r.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},r.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,n=this.worldTransform;n.a=e.a*i.a+e.b*i.c,n.b=e.a*i.b+e.b*i.d,n.c=e.c*i.a+e.d*i.c,n.d=e.c*i.b+e.d*i.d,n.tx=e.tx*i.a+e.ty*i.c+i.tx,n.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},r.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),r.IDENTITY=new r,r}();/*!
 * @pixi/core - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/core is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */I.PREFER_ENV=Pe.any?zt.WEBGL:zt.WEBGL2;I.STRICT_TEXTURE_CACHE=!1;var Zn=[];function Bu(r,t){if(!r)return null;var e="";if(typeof r=="string"){var i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(var n=Zn.length-1;n>=0;--n){var s=Zn[n];if(s.test&&s.test(r,e))return new s(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Jn=function(r,t){return Jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},Jn(r,t)};function N(r,t){Jn(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Qn=function(){return Qn=Object.assign||function(t){for(var e=arguments,i,n=1,s=arguments.length;n<s;n++){i=e[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},Qn.apply(this,arguments)};function gd(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}var Dr=function(){function r(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new nt("setRealSize"),this.onUpdate=new nt("update"),this.onError=new nt("onError")}return r.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},r.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},r.prototype.resize=function(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(r.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),r.prototype.update=function(){this.destroyed||this.onUpdate.emit()},r.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),r.prototype.style=function(t,e,i){return!1},r.prototype.dispose=function(){},r.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},r.test=function(t,e){return!1},r}(),ws=function(r){N(t,r);function t(e,i){var n=this,s=i||{},o=s.width,a=s.height;if(!o||!a)throw new Error("BufferResource width or height invalid");return n=r.call(this,o,a)||this,n.data=e,n}return t.prototype.upload=function(e,i,n){var s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===oe.UNPACK);var o=i.realWidth,a=i.realHeight;return n.width===o&&n.height===a?s.texSubImage2D(i.target,0,0,0,o,a,i.format,n.type,this.data):(n.width=o,n.height=a,s.texImage2D(i.target,0,n.internalFormat,o,a,0,i.format,n.type,this.data)),!0},t.prototype.dispose=function(){this.data=null},t.test=function(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array},t}(Dr),vd={scaleMode:Gt.NEAREST,format:x.RGBA,alphaMode:oe.NPM},Q=function(r){N(t,r);function t(e,i){e===void 0&&(e=null),i===void 0&&(i=null);var n=r.call(this)||this;i=i||{};var s=i.alphaMode,o=i.mipmap,a=i.anisotropicLevel,u=i.scaleMode,l=i.width,h=i.height,c=i.wrapMode,f=i.format,d=i.type,p=i.target,v=i.resolution,m=i.resourceOptions;return e&&!(e instanceof Dr)&&(e=Bu(e,m),e.internal=!0),n.resolution=v||I.RESOLUTION,n.width=Math.round((l||0)*n.resolution)/n.resolution,n.height=Math.round((h||0)*n.resolution)/n.resolution,n._mipmap=o!==void 0?o:I.MIPMAP_TEXTURES,n.anisotropicLevel=a!==void 0?a:I.ANISOTROPIC_LEVEL,n._wrapMode=c||I.WRAP_MODE,n._scaleMode=u!==void 0?u:I.SCALE_MODE,n.format=f||x.RGBA,n.type=d||F.UNSIGNED_BYTE,n.target=p||Re.TEXTURE_2D,n.alphaMode=s!==void 0?s:oe.UNPACK,n.uid=Or(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=l>0&&h>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(e),n}return Object.defineProperty(t.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mipmap",{get:function(){return this._mipmap},set:function(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),t.prototype.setStyle=function(e,i){var n;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,n=!0),i!==void 0&&i!==this.mipmap&&(this.mipmap=i,n=!0),n&&this.dirtyStyleId++,this},t.prototype.setSize=function(e,i,n){return n=n||this.resolution,this.setRealSize(e*n,i*n,n)},t.prototype.setRealSize=function(e,i,n){return this.resolution=n||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(i)/this.resolution,this._refreshPOT(),this.update(),this},t.prototype._refreshPOT=function(){this.isPowerOfTwo=jo(this.realWidth)&&jo(this.realHeight)},t.prototype.setResolution=function(e){var i=this.resolution;return i===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*i)/e,this.height=Math.round(this.height*i)/e,this.emit("update",this)),this._refreshPOT(),this)},t.prototype.setResource=function(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this},t.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},t.prototype.onError=function(e){this.emit("error",this,e)},t.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete pe[this.cacheId],delete $t[this.cacheId],this.cacheId=null),this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},t.prototype.dispose=function(){this.emit("dispose",this)},t.prototype.castToBaseTexture=function(){return this},t.from=function(e,i,n){n===void 0&&(n=I.STRICT_TEXTURE_CACHE);var s=typeof e=="string",o=null;if(s)o=e;else{if(!e._pixiId){var a=i&&i.pixiIdPrefix||"pixiid";e._pixiId=a+"_"+Or()}o=e._pixiId}var u=pe[o];if(s&&n&&!u)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return u||(u=new t(e,i),u.cacheId=o,t.addToCache(u,o)),u},t.fromBuffer=function(e,i,n,s){e=e||new Float32Array(i*n*4);var o=new ws(e,{width:i,height:n}),a=e instanceof Float32Array?F.FLOAT:F.UNSIGNED_BYTE;return new t(o,Object.assign({},vd,s||{width:i,height:n,type:a}))},t.addToCache=function(e,i){i&&(e.textureCacheIds.indexOf(i)===-1&&e.textureCacheIds.push(i),pe[i]&&console.warn("BaseTexture added to the cache with an id ["+i+"] that already had an entry"),pe[i]=e)},t.removeFromCache=function(e){if(typeof e=="string"){var i=pe[e];if(i){var n=i.textureCacheIds.indexOf(e);return n>-1&&i.textureCacheIds.splice(n,1),delete pe[e],i}}else if(e&&e.textureCacheIds){for(var s=0;s<e.textureCacheIds.length;++s)delete pe[e.textureCacheIds[s]];return e.textureCacheIds.length=0,e}return null},t._globalBatch=0,t}(he),Nu=function(r){N(t,r);function t(e,i){var n=this,s=i||{},o=s.width,a=s.height;n=r.call(this,o,a)||this,n.items=[],n.itemDirtyIds=[];for(var u=0;u<e;u++){var l=new Q;n.items.push(l),n.itemDirtyIds.push(-2)}return n.length=e,n._load=null,n.baseTexture=null,n}return t.prototype.initFromArray=function(e,i){for(var n=0;n<this.length;n++)!e[n]||(e[n].castToBaseTexture?this.addBaseTextureAt(e[n].castToBaseTexture(),n):e[n]instanceof Dr?this.addResourceAt(e[n],n):this.addResourceAt(Bu(e[n],i),n))},t.prototype.dispose=function(){for(var e=0,i=this.length;e<i;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},t.prototype.addResourceAt=function(e,i){if(!this.items[i])throw new Error("Index "+i+" is out of bounds");return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[i].setResource(e),this},t.prototype.bind=function(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");r.prototype.bind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)},t.prototype.unbind=function(e){r.prototype.unbind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)},t.prototype.load=function(){var e=this;if(this._load)return this._load;var i=this.items.map(function(s){return s.resource}).filter(function(s){return s}),n=i.map(function(s){return s.load()});return this._load=Promise.all(n).then(function(){var s=e.items[0],o=s.realWidth,a=s.realHeight;return e.resize(o,a),Promise.resolve(e)}),this._load},t}(Dr),yd=function(r){N(t,r);function t(e,i){var n=this,s=i||{},o=s.width,a=s.height,u,l;return Array.isArray(e)?(u=e,l=e.length):l=e,n=r.call(this,l,{width:o,height:a})||this,u&&n.initFromArray(u,i),n}return t.prototype.addBaseTextureAt=function(e,i){if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this},t.prototype.bind=function(e){r.prototype.bind.call(this,e),e.target=Re.TEXTURE_2D_ARRAY},t.prototype.upload=function(e,i,n){var s=this,o=s.length,a=s.itemDirtyIds,u=s.items,l=e.gl;n.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,o,0,i.format,n.type,null);for(var h=0;h<o;h++){var c=u[h];a[h]<c.dirtyId&&(a[h]=c.dirtyId,c.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,h,c.resource.width,c.resource.height,1,i.format,n.type,c.resource.source))}return!0},t}(Nu),ae=function(r){N(t,r);function t(e){var i=this,n=e,s=n.naturalWidth||n.videoWidth||n.width,o=n.naturalHeight||n.videoHeight||n.height;return i=r.call(this,s,o)||this,i.source=e,i.noSubImage=!1,i}return t.crossOrigin=function(e,i,n){n===void 0&&i.indexOf("data:")!==0?e.crossOrigin=hd(i):n!==!1&&(e.crossOrigin=typeof n=="string"?n:"anonymous")},t.prototype.upload=function(e,i,n,s){var o=e.gl,a=i.realWidth,u=i.realHeight;if(s=s||this.source,s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===oe.UNPACK),!this.noSubImage&&i.target===o.TEXTURE_2D&&n.width===a&&n.height===u?o.texSubImage2D(o.TEXTURE_2D,0,0,0,i.format,n.type,s):(n.width=a,n.height=u,o.texImage2D(i.target,0,n.internalFormat,i.format,n.type,s)),!0},t.prototype.update=function(){if(!this.destroyed){var e=this.source,i=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;this.resize(i,n),r.prototype.update.call(this)}},t.prototype.dispose=function(){this.source=null},t}(Dr),_d=function(r){N(t,r);function t(e){return r.call(this,e)||this}return t.test=function(e){var i=globalThis.OffscreenCanvas;return i&&e instanceof i?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement},t}(ae),bd=function(r){N(t,r);function t(e,i){var n=this,s=i||{},o=s.width,a=s.height,u=s.autoLoad,l=s.linkBaseTexture;if(e&&e.length!==t.SIDES)throw new Error("Invalid length. Got "+e.length+", expected 6");n=r.call(this,6,{width:o,height:a})||this;for(var h=0;h<t.SIDES;h++)n.items[h].target=Re.TEXTURE_CUBE_MAP_POSITIVE_X+h;return n.linkBaseTexture=l!==!1,e&&n.initFromArray(e,i),u!==!1&&n.load(),n}return t.prototype.bind=function(e){r.prototype.bind.call(this,e),e.target=Re.TEXTURE_CUBE_MAP},t.prototype.addBaseTextureAt=function(e,i,n){if(!this.items[i])throw new Error("Index "+i+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=Re.TEXTURE_CUBE_MAP_POSITIVE_X+i,e.parentTextureArray=this.baseTexture,this.items[i]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[i]=e,this},t.prototype.upload=function(e,i,n){for(var s=this.itemDirtyIds,o=0;o<t.SIDES;o++){var a=this.items[o];(s[o]<a.dirtyId||n.dirtyId<i.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(e,a,n),s[o]=a.dirtyId):s[o]<-1&&(e.gl.texImage2D(a.target,0,n.internalFormat,i.realWidth,i.realHeight,0,i.format,n.type,null),s[o]=-1))}return!0},t.test=function(e){return Array.isArray(e)&&e.length===t.SIDES},t.SIDES=6,t}(Nu),ku=function(r){N(t,r);function t(e,i){var n=this;if(i=i||{},!(e instanceof HTMLImageElement)){var s=new Image;ae.crossOrigin(s,e,i.crossorigin),s.src=e,e=s}return n=r.call(this,e)||this,!e.complete&&!!n._width&&!!n._height&&(n._width=0,n._height=0),n.url=e.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(i.createBitmap!==void 0?i.createBitmap:I.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,n.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,n.bitmap=null,n._load=null,i.autoLoad!==!1&&n.load(),n}return t.prototype.load=function(e){var i=this;return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise(function(n,s){var o=i.source;i.url=o.src;var a=function(){i.destroyed||(o.onload=null,o.onerror=null,i.resize(o.width,o.height),i._load=null,i.createBitmap?n(i.process()):n(i))};o.complete&&o.src?a():(o.onload=a,o.onerror=function(u){s(u),i.onError.emit(u)})}),this._load)},t.prototype.process=function(){var e=this,i=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var n=globalThis.createImageBitmap,s=!i.crossOrigin||i.crossOrigin==="anonymous";return this._process=fetch(i.src,{mode:s?"cors":"no-cors"}).then(function(o){return o.blob()}).then(function(o){return n(o,0,0,i.width,i.height,{premultiplyAlpha:e.alphaMode===null||e.alphaMode===oe.UNPACK?"premultiply":"none"})}).then(function(o){return e.destroyed?Promise.reject():(e.bitmap=o,e.update(),e._process=null,Promise.resolve(e))}),this._process},t.prototype.upload=function(e,i,n){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return r.prototype.upload.call(this,e,i,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(r.prototype.upload.call(this,e,i,n,this.bitmap),!this.preserveBitmap){var s=!0,o=i._glTextures;for(var a in o){var u=o[a];if(u!==n&&u.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},t.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,r.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},t.test=function(e){return typeof e=="string"||e instanceof HTMLImageElement},t}(ae),xd=function(r){N(t,r);function t(e,i){var n=this;return i=i||{},n=r.call(this,I.ADAPTER.createCanvas())||this,n._width=0,n._height=0,n.svg=e,n.scale=i.scale||1,n._overrideWidth=i.width,n._overrideHeight=i.height,n._resolve=null,n._crossorigin=i.crossorigin,n._load=null,i.autoLoad!==!1&&n.load(),n}return t.prototype.load=function(){var e=this;return this._load?this._load:(this._load=new Promise(function(i){if(e._resolve=function(){e.resize(e.source.width,e.source.height),i(e)},t.SVG_XML.test(e.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");e.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.svg)))}e._loadSvg()}),this._load)},t.prototype._loadSvg=function(){var e=this,i=new Image;ae.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=function(n){!e._resolve||(i.onerror=null,e.onError.emit(n))},i.onload=function(){if(!!e._resolve){var n=i.width,s=i.height;if(!n||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var o=n*e.scale,a=s*e.scale;(e._overrideWidth||e._overrideHeight)&&(o=e._overrideWidth||e._overrideHeight/s*n,a=e._overrideHeight||e._overrideWidth/n*s),o=Math.round(o),a=Math.round(a);var u=e.source;u.width=o,u.height=a,u._pixiId="canvas_"+Or(),u.getContext("2d").drawImage(i,0,0,n,s,0,0,o,a),e._resolve(),e._resolve=null}}},t.getSize=function(e){var i=t.SVG_SIZE.exec(e),n={};return i&&(n[i[1]]=Math.round(parseFloat(i[3])),n[i[5]]=Math.round(parseFloat(i[7]))),n},t.prototype.dispose=function(){r.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},t.test=function(e,i){return i==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&t.SVG_XML.test(e)},t.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,t.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,t}(ae),Ed=function(r){N(t,r);function t(e,i){var n=this;if(i=i||{},!(e instanceof HTMLVideoElement)){var s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);var o=e[0].src||e[0];ae.crossOrigin(s,o,i.crossorigin);for(var a=0;a<e.length;++a){var u=document.createElement("source"),l=e[a],h=l.src,c=l.mime;h=h||e[a];var f=h.split("?").shift().toLowerCase(),d=f.slice(f.lastIndexOf(".")+1);c=c||t.MIME_TYPES[d]||"video/"+d,u.src=h,u.type=c,s.appendChild(u)}e=s}return n=r.call(this,e)||this,n.noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=i.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=i.autoPlay!==!1,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),i.autoLoad!==!1&&n.load(),n}return t.prototype.update=function(e){if(!this.destroyed){var i=Rt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(r.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},t.prototype.load=function(){var e=this;if(this._load)return this._load;var i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(function(n){e.valid?n(e):(e._resolve=n,i.load())}),this._load},t.prototype._onError=function(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)},t.prototype._isSourcePlaying=function(){var e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()},t.prototype._isSourceReady=function(){var e=this.source;return e.readyState>2},t.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Rt.shared.add(this.update,this),this._isConnectedToTicker=!0)},t.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Rt.shared.remove(this.update,this),this._isConnectedToTicker=!1)},t.prototype._onCanPlay=function(){var e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);var i=this.valid;this.resize(e.videoWidth,e.videoHeight),!i&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()},t.prototype.dispose=function(){this._isConnectedToTicker&&(Rt.shared.remove(this.update,this),this._isConnectedToTicker=!1);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),r.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Rt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Rt.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(e){e!==this._updateFPS&&(this._updateFPS=e)},enumerable:!1,configurable:!0}),t.test=function(e,i){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||t.TYPES.indexOf(i)>-1},t.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],t.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},t}(ae),Td=function(r){N(t,r);function t(e){return r.call(this,e)||this}return t.test=function(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&e instanceof ImageBitmap},t}(ae);Zn.push(ku,Td,_d,Ed,xd,ws,bd,yd);var wd=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.upload=function(e,i,n){var s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===oe.UNPACK);var o=i.realWidth,a=i.realHeight;return n.width===o&&n.height===a?s.texSubImage2D(i.target,0,0,0,o,a,i.format,n.type,this.data):(n.width=o,n.height=a,s.texImage2D(i.target,0,n.internalFormat,o,a,0,i.format,n.type,this.data)),!0},t}(ws),ts=function(){function r(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new nt("disposeFramebuffer"),this.multisample=Y.NONE}return Object.defineProperty(r.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),r.prototype.addColorTexture=function(t,e){return t===void 0&&(t=0),this.colorTextures[t]=e||new Q(null,{scaleMode:Gt.NEAREST,resolution:1,mipmap:se.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},r.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Q(new wd(null,{width:this.width,height:this.height}),{scaleMode:Gt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:se.OFF,format:x.DEPTH_COMPONENT,type:F.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},r.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},r.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},r.prototype.resize=function(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var n=this.colorTextures[i],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){var s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},r}(),Uu=function(r){N(t,r);function t(e){e===void 0&&(e={});var i=this;if(typeof e=="number"){var n=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];e={width:n,height:s,scaleMode:o,resolution:a}}return e.width=e.width||100,e.height=e.height||100,e.multisample=e.multisample!==void 0?e.multisample:Y.NONE,i=r.call(this,null,e)||this,i.mipmap=se.OFF,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new ts(i.realWidth,i.realHeight).addColorTexture(0,i),i.framebuffer.multisample=e.multisample,i.maskStack=[],i.filterStack=[{}],i}return t.prototype.resize=function(e,i){this.framebuffer.resize(e*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},t.prototype.dispose=function(){this.framebuffer.dispose(),r.prototype.dispose.call(this)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},t}(Q),Gu=function(){function r(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return r.prototype.set=function(t,e,i){var n=e.width,s=e.height;if(i){var o=t.width/2/n,a=t.height/2/s,u=t.x/n+o,l=t.y/s+a;i=H.add(i,H.NW),this.x0=u+o*H.uX(i),this.y0=l+a*H.uY(i),i=H.add(i,2),this.x1=u+o*H.uX(i),this.y1=l+a*H.uY(i),i=H.add(i,2),this.x2=u+o*H.uX(i),this.y2=l+a*H.uY(i),i=H.add(i,2),this.x3=u+o*H.uX(i),this.y3=l+a*H.uY(i)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},r.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},r}(),Ko=new Gu;function ei(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}var pi=function(r){N(t,r);function t(e,i,n,s,o,a){var u=r.call(this)||this;if(u.noFrame=!1,i||(u.noFrame=!0,i=new q(0,0,1,1)),e instanceof t&&(e=e.baseTexture),u.baseTexture=e,u._frame=i,u.trim=s,u.valid=!1,u._uvs=Ko,u.uvMatrix=null,u.orig=n||i,u._rotate=Number(o||0),o===!0)u._rotate=2;else if(u._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return u.defaultAnchor=a?new dt(a.x,a.y):new dt(0,0),u._updateID=0,u.textureCacheIds=[],e.valid?u.noFrame?e.valid&&u.onBaseTextureUpdated(e):u.frame=i:e.once("loaded",u.onBaseTextureUpdated,u),u.noFrame&&e.on("update",u.onBaseTextureUpdated,u),u}return t.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},t.prototype.onBaseTextureUpdated=function(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},t.prototype.destroy=function(e){if(this.baseTexture){if(e){var i=this.baseTexture.resource;i&&i.url&&$t[i.url]&&t.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null},t.prototype.clone=function(){var e=this._frame.clone(),i=this._frame===this.orig?e:this.orig.clone(),n=new t(this.baseTexture,!this.noFrame&&e,i,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=e),n},t.prototype.updateUvs=function(){this._uvs===Ko&&(this._uvs=new Gu),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},t.from=function(e,i,n){i===void 0&&(i={}),n===void 0&&(n=I.STRICT_TEXTURE_CACHE);var s=typeof e=="string",o=null;if(s)o=e;else if(e instanceof Q){if(!e.cacheId){var a=i&&i.pixiIdPrefix||"pixiid";e.cacheId=a+"-"+Or(),Q.addToCache(e,e.cacheId)}o=e.cacheId}else{if(!e._pixiId){var a=i&&i.pixiIdPrefix||"pixiid";e._pixiId=a+"_"+Or()}o=e._pixiId}var u=$t[o];if(s&&n&&!u)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return!u&&!(e instanceof Q)?(i.resolution||(i.resolution=Yo(e)),u=new t(new Q(e,i)),u.baseTexture.cacheId=o,Q.addToCache(u.baseTexture,o),t.addToCache(u,o)):!u&&e instanceof Q&&(u=new t(e),t.addToCache(u,o)),u},t.fromURL=function(e,i){var n=Object.assign({autoLoad:!1},i?.resourceOptions),s=t.from(e,Object.assign({resourceOptions:n},i),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(function(){return Promise.resolve(s)})},t.fromBuffer=function(e,i,n,s){return new t(Q.fromBuffer(e,i,n,s))},t.fromLoader=function(e,i,n,s){var o=new Q(e,Object.assign({scaleMode:I.SCALE_MODE,resolution:Yo(i)},s)),a=o.resource;a instanceof ku&&(a.url=i);var u=new t(o);return n||(n=i),Q.addToCache(u.baseTexture,n),t.addToCache(u,n),n!==i&&(Q.addToCache(u.baseTexture,i),t.addToCache(u,i)),u.baseTexture.valid?Promise.resolve(u):new Promise(function(l){u.baseTexture.once("loaded",function(){return l(u)})})},t.addToCache=function(e,i){i&&(e.textureCacheIds.indexOf(i)===-1&&e.textureCacheIds.push(i),$t[i]&&console.warn("Texture added to the cache with an id ["+i+"] that already had an entry"),$t[i]=e)},t.removeFromCache=function(e){if(typeof e=="string"){var i=$t[e];if(i){var n=i.textureCacheIds.indexOf(e);return n>-1&&i.textureCacheIds.splice(n,1),delete $t[e],i}}else if(e&&e.textureCacheIds){for(var s=0;s<e.textureCacheIds.length;++s)$t[e.textureCacheIds[s]]===e&&delete $t[e.textureCacheIds[s]];return e.textureCacheIds.length=0,e}return null},Object.defineProperty(t.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1;var i=e.x,n=e.y,s=e.width,o=e.height,a=i+s>this.baseTexture.width,u=n+o>this.baseTexture.height;if(a||u){var l=a&&u?"and":"or",h="X: "+i+" + "+s+" = "+(i+s)+" > "+this.baseTexture.width,c="Y: "+n+" + "+o+" = "+(n+o)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(h+" "+l+" "+c))}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),t.prototype.castToBaseTexture=function(){return this.baseTexture},Object.defineProperty(t,"EMPTY",{get:function(){return t._EMPTY||(t._EMPTY=new t(new Q),ei(t._EMPTY),ei(t._EMPTY.baseTexture)),t._EMPTY},enumerable:!1,configurable:!0}),Object.defineProperty(t,"WHITE",{get:function(){if(!t._WHITE){var e=I.ADAPTER.createCanvas(16,16),i=e.getContext("2d");e.width=16,e.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),t._WHITE=new t(Q.from(e)),ei(t._WHITE),ei(t._WHITE.baseTexture)}return t._WHITE},enumerable:!1,configurable:!0}),t}(he),Is=function(r){N(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Object.defineProperty(t.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(e){this.framebuffer.multisample=e},enumerable:!1,configurable:!0}),t.prototype.resize=function(e,i,n){n===void 0&&(n=!0);var s=this.baseTexture.resolution,o=Math.round(e*s)/s,a=Math.round(i*s)/s;this.valid=o>0&&a>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=a,n&&this.baseTexture.resize(o,a),this.updateUvs()},t.prototype.setResolution=function(e){var i=this.baseTexture;i.resolution!==e&&(i.setResolution(e),this.resize(i.width,i.height,!1))},t.create=function(e){for(var i=arguments,n=[],s=1;s<arguments.length;s++)n[s-1]=i[s];return typeof e=="number"&&(De("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),e={width:e,height:n[0],scaleMode:n[1],resolution:n[2]}),new t(new Uu(e))},t}(pi),Id=function(){function r(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return r.prototype.createTexture=function(t,e,i){i===void 0&&(i=Y.NONE);var n=new Uu(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Is(n)},r.prototype.getOptimalTexture=function(t,e,i,n){i===void 0&&(i=1),n===void 0&&(n=Y.NONE);var s;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=wi(t),e=wi(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);var o=this.texturePool[s].pop();return o||(o=this.createTexture(t,e,n)),o.filterPoolKey=s,o.setResolution(i),o},r.prototype.getFilterTexture=function(t,e,i){var n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||Y.NONE);return n.filterFrame=t.filterFrame,n},r.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},r.prototype.returnFilterTexture=function(t){this.returnTexture(t)},r.prototype.clear=function(t){if(t=t!==!1,t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}},r.prototype.setScreenSize=function(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(var e in this.texturePool)if(Number(e)<0){var i=this.texturePool[e];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},r.SCREEN_KEY=-1,r}(),Zo=function(){function r(t,e,i,n,s,o,a){e===void 0&&(e=0),i===void 0&&(i=!1),n===void 0&&(n=F.FLOAT),this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=s,this.start=o,this.instance=a}return r.prototype.destroy=function(){this.buffer=null},r.from=function(t,e,i,n,s){return new r(t,e,i,n,s)},r}(),Cd=0,bt=function(){function r(t,e,i){e===void 0&&(e=!0),i===void 0&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=Cd++,this.disposeRunner=new nt("disposeBuffer")}return r.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(r.prototype,"index",{get:function(){return this.type===Vt.ELEMENT_ARRAY_BUFFER},set:function(t){this.type=t?Vt.ELEMENT_ARRAY_BUFFER:Vt.ARRAY_BUFFER},enumerable:!1,configurable:!0}),r.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new r(t)},r}(),Sd={Float32Array,Uint32Array,Int32Array,Uint8Array};function Ad(r,t){for(var e=0,i=0,n={},s=0;s<r.length;s++)i+=t[s],e+=r[s].length;for(var o=new ArrayBuffer(e*4),a=null,u=0,s=0;s<r.length;s++){var l=t[s],h=r[s],c=Ou(h);n[c]||(n[c]=new Sd[c](o)),a=n[c];for(var f=0;f<h.length;f++){var d=(f/l|0)*i+u,p=f%l;a[d+p]=h[f]}u+=l}return new Float32Array(o)}var Jo={5126:4,5123:2,5121:1},Pd=0,Md={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Cs=function(){function r(t,e){t===void 0&&(t=[]),e===void 0&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Pd++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new nt("disposeGeometry"),this.refCount=0}return r.prototype.addAttribute=function(t,e,i,n,s,o,a,u){if(i===void 0&&(i=0),n===void 0&&(n=!1),u===void 0&&(u=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof bt||(e instanceof Array&&(e=new Float32Array(e)),e=new bt(e));var l=t.split("|");if(l.length>1){for(var h=0;h<l.length;h++)this.addAttribute(l[h],e,i,n,s);return this}var c=this.buffers.indexOf(e);return c===-1&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new Zo(c,i,n,s,o,a,u),this.instanced=this.instanced||u,this},r.prototype.getAttribute=function(t){return this.attributes[t]},r.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},r.prototype.addIndex=function(t){return t instanceof bt||(t instanceof Array&&(t=new Uint16Array(t)),t=new bt(t)),t.type=Vt.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.indexOf(t)===-1&&this.buffers.push(t),this},r.prototype.getIndex=function(){return this.indexBuffer},r.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var t=[],e=[],i=new bt,n;for(n in this.attributes){var s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),e.push(s.size*Jo[s.type]/4),s.buffer=0}for(i.data=Ad(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},r.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t],i=this.buffers[e.buffer];return i.data.length/(e.stride/4||e.size)}return 0},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},r.prototype.clone=function(){for(var t=new r,e=0;e<this.buffers.length;e++)t.buffers[e]=new bt(this.buffers[e].data.slice(0));for(var e in this.attributes){var i=this.attributes[e];t.attributes[e]=new Zo(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Vt.ELEMENT_ARRAY_BUFFER),t},r.merge=function(t){for(var e=new r,i=[],n=[],s=[],o,a=0;a<t.length;a++){o=t[a];for(var u=0;u<o.buffers.length;u++)n[u]=n[u]||0,n[u]+=o.buffers[u].data.length,s[u]=0}for(var a=0;a<o.buffers.length;a++)i[a]=new Md[Ou(o.buffers[a].data)](n[a]),e.buffers[a]=new bt(i[a]);for(var a=0;a<t.length;a++){o=t[a];for(var u=0;u<o.buffers.length;u++)i[u].set(o.buffers[u].data,s[u]),s[u]+=o.buffers[u].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=Vt.ELEMENT_ARRAY_BUFFER;for(var l=0,h=0,c=0,f=0,a=0;a<o.buffers.length;a++)if(o.buffers[a]!==o.indexBuffer){f=a;break}for(var a in o.attributes){var d=o.attributes[a];(d.buffer|0)===f&&(h+=d.size*Jo[d.type]/4)}for(var a=0;a<t.length;a++){for(var p=t[a].indexBuffer.data,u=0;u<p.length;u++)e.indexBuffer.data[u+c]+=l;l+=t[a].buffers[f].data.length/h,c+=p.length}}return e},r}(),Rd=function(r){N(t,r);function t(){var e=r.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return t}(Cs),Fd=function(r){N(t,r);function t(){var e=r.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new bt(e.vertices),e.uvBuffer=new bt(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return t.prototype.map=function(e,i){var n=0,s=0;return this.uvs[0]=n,this.uvs[1]=s,this.uvs[2]=n+i.width/e.width,this.uvs[3]=s,this.uvs[4]=n+i.width/e.width,this.uvs[5]=s+i.height/e.height,this.uvs[6]=n,this.uvs[7]=s+i.height/e.height,n=i.x,s=i.y,this.vertices[0]=n,this.vertices[1]=s,this.vertices[2]=n+i.width,this.vertices[3]=s,this.vertices[4]=n+i.width,this.vertices[5]=s+i.height,this.vertices[6]=n,this.vertices[7]=s+i.height,this.invalidate(),this},t.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},t}(Cs),Od=0,Je=function(){function r(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Od++,this.static=!!e,this.ubo=!!i,t instanceof bt?(this.buffer=t,this.buffer.type=Vt.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new bt(new Float32Array(1)),this.buffer.type=Vt.UNIFORM_BUFFER,this.autoManage=!0))}return r.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},r.prototype.add=function(t,e,i){if(!this.ubo)this.uniforms[t]=new r(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},r.from=function(t,e,i){return new r(t,e,i)},r.uboFrom=function(t,e){return new r(t,e??!0,!0)},r}(),Dd=function(){function r(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Y.NONE,this.sourceFrame=new q,this.destinationFrame=new q,this.bindingSourceFrame=new q,this.bindingDestinationFrame=new q,this.filters=[],this.transform=null}return r.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},r}(),ri=[new dt,new dt,new dt,new dt],hn=new ot,Ld=function(){function r(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Id,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new Rd,this.quadUv=new Fd,this.tempRect=new q,this.activeState={},this.globalUniforms=new Je({outputFrame:new q,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return r.prototype.push=function(t,e){for(var i,n,s=this.renderer,o=this.defaultFilterStack,a=this.statePool.pop()||new Dd,u=this.renderer.renderTexture,l=e[0].resolution,h=e[0].multisample,c=e[0].padding,f=e[0].autoFit,d=(i=e[0].legacy)!==null&&i!==void 0?i:!0,p=1;p<e.length;p++){var v=e[p];l=Math.min(l,v.resolution),h=Math.min(h,v.multisample),c=this.useMaxPadding?Math.max(c,v.padding):c+v.padding,f=f&&v.autoFit,d=d||((n=v.legacy)!==null&&n!==void 0?n:!0)}o.length===1&&(this.defaultFilterStack[0].renderTexture=u.current),o.push(a),a.resolution=l,a.multisample=h,a.legacy=d,a.target=t,a.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),a.sourceFrame.pad(c);var m=this.tempRect.copyFrom(u.sourceFrame);s.projection.transform&&this.transformAABB(hn.copyFrom(s.projection.transform).invert(),m),f?(a.sourceFrame.fit(m),(a.sourceFrame.width<=0||a.sourceFrame.height<=0)&&(a.sourceFrame.width=0,a.sourceFrame.height=0)):a.sourceFrame.intersects(m)||(a.sourceFrame.width=0,a.sourceFrame.height=0),this.roundFrame(a.sourceFrame,u.current?u.current.resolution:s.resolution,u.sourceFrame,u.destinationFrame,s.projection.transform),a.renderTexture=this.getOptimalFilterTexture(a.sourceFrame.width,a.sourceFrame.height,l,h),a.filters=e,a.destinationFrame.width=a.renderTexture.width,a.destinationFrame.height=a.renderTexture.height;var y=this.tempRect;y.x=0,y.y=0,y.width=a.sourceFrame.width,y.height=a.sourceFrame.height,a.renderTexture.filterFrame=a.sourceFrame,a.bindingSourceFrame.copyFrom(u.sourceFrame),a.bindingDestinationFrame.copyFrom(u.destinationFrame),a.transform=s.projection.transform,s.projection.transform=null,u.bind(a.renderTexture,a.sourceFrame,y),s.framebuffer.clear(0,0,0,0)},r.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;var s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*e.resolution),o[1]=Math.round(s[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*s[2]-.5*o[2],a[3]=e.sourceFrame.height*s[3]-.5*o[3],e.legacy){var u=n.filterArea;u[0]=e.destinationFrame.width,u[1]=e.destinationFrame.height,u[2]=e.sourceFrame.x,u[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var l=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,l.renderTexture,Qt.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var h=e.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,e.resolution);c.filterFrame=h.filterFrame;var f=0;for(f=0;f<i.length-1;++f){f===1&&e.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,e.resolution),c.filterFrame=h.filterFrame),i[f].apply(this,h,c,Qt.CLEAR,e);var d=h;h=c,c=d}i[f].apply(this,h,l.renderTexture,Qt.BLEND,e),f>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}e.clear(),this.statePool.push(e)},r.prototype.bindAndClear=function(t,e){e===void 0&&(e=Qt.CLEAR);var i=this.renderer,n=i.renderTexture,s=i.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,n.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var a=s.stateId&1||this.forceClear;(e===Qt.CLEAR||e===Qt.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)},r.prototype.applyFilter=function(t,e,i,n){var s=this.renderer;s.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Pr.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Pr.TRIANGLE_STRIP))},r.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,n=i.sourceFrame,s=i.destinationFrame,o=e._texture.orig,a=t.set(s.width,0,0,s.height,n.x,n.y),u=e.worldTransform.copyTo(ot.TEMP_MATRIX);return u.invert(),a.prepend(u),a.scale(1/o.width,1/o.height),a.translate(e.anchor.x,e.anchor.y),a},r.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},r.prototype.getOptimalFilterTexture=function(t,e,i,n){return i===void 0&&(i=1),n===void 0&&(n=Y.NONE),this.texturePool.getOptimalTexture(t,e,i,n)},r.prototype.getFilterTexture=function(t,e,i){if(typeof t=="number"){var n=t;t=e,e=n}t=t||this.activeState.renderTexture;var s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||Y.NONE);return s.filterFrame=t.filterFrame,s},r.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},r.prototype.emptyPool=function(){this.texturePool.clear(!0)},r.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},r.prototype.transformAABB=function(t,e){var i=ri[0],n=ri[1],s=ri[2],o=ri[3];i.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(s,s),t.apply(o,o);var a=Math.min(i.x,n.x,s.x,o.x),u=Math.min(i.y,n.y,s.y,o.y),l=Math.max(i.x,n.x,s.x,o.x),h=Math.max(i.y,n.y,s.y,o.y);e.x=a,e.y=u,e.width=l-a,e.height=h-u},r.prototype.roundFrame=function(t,e,i,n,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){var o=s.a,a=s.b,u=s.c,l=s.d;if((Math.abs(a)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(l)>1e-4))return}s=s?hn.copyFrom(s):hn.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}},r}(),Vu=function(){function r(t){this.renderer=t}return r.prototype.flush=function(){},r.prototype.destroy=function(){this.renderer=null},r.prototype.start=function(){},r.prototype.stop=function(){this.flush()},r.prototype.render=function(t){},r}(),Bd=function(){function r(t){this.renderer=t,this.emptyRenderer=new Vu(t),this.currentRenderer=this.emptyRenderer}return r.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},r.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},r.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},r.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,n=e-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)},r.prototype.boundArray=function(t,e,i,n){for(var s=t.elements,o=t.ids,a=t.count,u=0,l=0;l<a;l++){var h=s[l],c=h._batchLocation;if(c>=0&&c<n&&e[c]===h){o[l]=c;continue}for(;u<n;){var f=e[u];if(f&&f._batchEnabled===i&&f._batchLocation===u){u++;continue}o[l]=u,h._batchLocation=u,e[u]=h;break}}},r.prototype.destroy=function(){this.renderer=null},r}(),Qo=0,Nd=function(){function r(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(r.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),r.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Qo++},r.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Qo++,this.renderer.runners.contextChange.emit(t)},r.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},r.prototype.createContext=function(t,e){var i;if(I.PREFER_ENV>=zt.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},r.prototype.getExtensions=function(){var t=this.gl,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},r.prototype.handleContextLost=function(t){var e=this;t.preventDefault(),setTimeout(function(){e.gl.isContextLost()&&e.extensions.loseContext&&e.extensions.loseContext.restoreContext()},0)},r.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},r.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},r.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},r.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},r}(),kd=function(){function r(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Y.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return r}(),Ud=new q,Gd=function(){function r(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new ts(10,10),this.msaaSamples=null}return r.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new q,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;I.PREFER_ENV===zt.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=function(n){return e.drawBuffersWEBGL(n)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},r.prototype.bind=function(t,e,i){i===void 0&&(i=0);var n=this.gl;if(t){var s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var o=0;o<t.colorTextures.length;o++){var a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var u=e.width>>i,l=e.height>>i,h=u/e.width;this.setViewport(e.x*h,e.y*h,u,l)}else{var u=t.width>>i,l=t.height>>i;this.setViewport(0,0,u,l)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},r.prototype.setViewport=function(t,e,i,n){var s=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=i,s.height=n,this.gl.viewport(t,e,i,n))},Object.defineProperty(r.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),r.prototype.clear=function(t,e,i,n,s){s===void 0&&(s=gi.COLOR|gi.DEPTH);var o=this.gl;o.clearColor(t,e,i,n),o.clear(s)},r.prototype.initFramebuffer=function(t){var e=this.gl,i=new kd(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},r.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height)),i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));var n=t.colorTextures,s=n.length;e.drawBuffers||(s=Math.min(s,1));for(var o=0;o<s;o++){var a=n[o],u=a.parentTextureArray||a;this.renderer.texture.bind(u,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},r.prototype.updateFramebuffer=function(t,e){var i=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures,o=s.length;i.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?(n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.RGBA8,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));for(var a=[],u=0;u<o;u++){var l=s[u],h=l.parentTextureArray||l;this.renderer.texture.bind(h,0),!(u===0&&n.msaaBuffer)&&(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+u,l.target,h._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+u))}if(a.length>1&&i.drawBuffers(a),t.depthTexture){var c=this.writeDepthTexture;if(c){var f=t.depthTexture;this.renderer.texture.bind(f,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,f._glTextures[this.CONTEXT_UID].texture,e)}}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil)):n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)},r.prototype.canMultisampleFramebuffer=function(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture},r.prototype.detectSamples=function(t){var e=this.msaaSamples,i=Y.NONE;if(t<=1||e===null)return i;for(var n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return i===1&&(i=Y.NONE),i},r.prototype.blit=function(t,e,i){var n=this,s=n.current,o=n.renderer,a=n.gl,u=n.CONTEXT_UID;if(o.context.webGLVersion===2&&!!s){var l=s.glFramebuffers[u];if(!!l){if(!t){if(!l.msaaBuffer)return;var h=s.colorTextures[0];if(!h)return;l.blitFramebuffer||(l.blitFramebuffer=new ts(s.width,s.height),l.blitFramebuffer.addColorTexture(0,h)),t=l.blitFramebuffer,t.colorTextures[0]!==h&&(t.colorTextures[0]=h,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=Ud,e.width=s.width,e.height=s.height),i||(i=e);var c=e.width===i.width&&e.height===i.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,l.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,c?a.NEAREST:a.LINEAR)}}},r.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!!i){delete t.glFramebuffers[this.CONTEXT_UID];var s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}},r.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},r.prototype.forceStencil=function(){var t=this.current;if(!!t){var e=t.glFramebuffers[this.CONTEXT_UID];if(!(!e||e.stencil)){t.stencil=!0;var i=t.width,n=t.height,s=this.gl,o=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,s.DEPTH24_STENCIL8,i,n):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,n),e.stencil=o,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,o)}}},r.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new q},r.prototype.destroy=function(){this.renderer=null},r}(),cn={5126:4,5123:2,5121:1},Vd=function(){function r(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return r.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){var i=this.renderer.context.extensions.vertexArrayObject;I.PREFER_ENV===zt.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(s){return i.bindVertexArrayOES(s)},t.deleteVertexArray=function(s){return i.deleteVertexArrayOES(s)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(e.webGLVersion!==2){var n=t.getExtension("ANGLE_instanced_arrays");n?(t.vertexAttribDivisor=function(s,o){return n.vertexAttribDivisorANGLE(s,o)},t.drawElementsInstanced=function(s,o,a,u,l){return n.drawElementsInstancedANGLE(s,o,a,u,l)},t.drawArraysInstanced=function(s,o,a,u){return n.drawArraysInstancedANGLE(s,o,a,u)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex},r.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);var o=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()},r.prototype.reset=function(){this.unbind()},r.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.renderer.buffer,i=0;i<t.buffers.length;i++){var n=t.buffers[i];e.update(n)}},r.prototype.checkCompatibility=function(t,e){var i=t.attributes,n=e.attributeData;for(var s in n)if(!i[s])throw new Error('shader and geometry incompatible, geometry missing the "'+s+'" attribute')},r.prototype.getSignature=function(t,e){var i=t.attributes,n=e.attributeData,s=["g",t.id];for(var o in i)n[o]&&s.push(o,n[o].location);return s.join("-")},r.prototype.initGeometryVao=function(t,e,i){i===void 0&&(i=!0);var n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);var u=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID],h=l[u];if(h)return l[a.id]=h,h;var c=t.buffers,f=t.attributes,d={},p={};for(var v in c)d[v]=0,p[v]=0;for(var v in f)!f[v].size&&a.attributeData[v]?f[v].size=a.attributeData[v].size:f[v].size||console.warn("PIXI Geometry attribute '"+v+"' size cannot be determined (likely the bound shader does not have the attribute)"),d[f[v].buffer]+=f[v].size*cn[f[v].type];for(var v in f){var m=f[v],y=m.size;m.stride===void 0&&(d[m.buffer]===y*cn[m.type]?m.stride=0:m.stride=d[m.buffer]),m.start===void 0&&(m.start=p[m.buffer],p[m.buffer]+=y*cn[m.type])}h=n.createVertexArray(),n.bindVertexArray(h);for(var _=0;_<c.length;_++){var g=c[_];o.bind(g),i&&g._glBuffers[s].refCount++}return this.activateVao(t,a),this._activeVao=h,l[a.id]=h,l[u]=h,h},r.prototype.disposeGeometry=function(t,e){var i;if(!!this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=t.buffers,a=(i=this.renderer)===null||i===void 0?void 0:i.buffer;if(t.disposeRunner.remove(this),!!n){if(a)for(var u=0;u<o.length;u++){var l=o[u]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&a.dispose(o[u],e))}if(!e){for(var h in n)if(h[0]==="g"){var c=n[h];this._activeVao===c&&this.unbind(),s.deleteVertexArray(c)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},r.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)},r.prototype.activateVao=function(t,e){var i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);var u=null;for(var l in a){var h=a[l],c=o[h.buffer],f=c._glBuffers[n];if(e.attributeData[l]){u!==f&&(s.bind(c),u=f);var d=e.attributeData[l].location;if(i.enableVertexAttribArray(d),i.vertexAttribPointer(d,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance)if(this.hasInstance)i.vertexAttribDivisor(d,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},r.prototype.draw=function(t,e,i,n){var s=this.gl,o=this._activeGeometry;if(o.indexBuffer){var a=o.indexBuffer.data.BYTES_PER_ELEMENT,u=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(t,e||o.indexBuffer.data.length,u,(i||0)*a,n||1):s.drawElements(t,e||o.indexBuffer.data.length,u,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(t,i,e||o.getSize(),n||1):s.drawArrays(t,i,e||o.getSize());return this},r.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},r.prototype.destroy=function(){this.renderer=null},r}(),Hd=function(){function r(t){t===void 0&&(t=null),this.type=K.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=I.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}return Object.defineProperty(r.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=K.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},r.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},r}();function ta(r,t,e){var i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function ea(r,t){var e=r.getShaderSource(t).split(`
`).map(function(l,h){return h+": "+l}),i=r.getShaderInfoLog(t),n=i.split(`
`),s={},o=n.map(function(l){return parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(l){return l&&!s[l]?(s[l]=!0,!0):!1}),a=[""];o.forEach(function(l){e[l-1]="%c"+e[l-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var u=e.join(`
`);a[0]=u,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,a),console.groupEnd()}function Xd(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||ea(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||ea(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}function fn(r){for(var t=new Array(r),e=0;e<t.length;e++)t[e]=!1;return t}function Hu(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return fn(2*t);case"bvec3":return fn(3*t);case"bvec4":return fn(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Xu={},lr=Xu;function jd(){if(lr===Xu||lr&&lr.isContextLost()){var r=I.ADAPTER.createCanvas(),t=void 0;I.PREFER_ENV>=zt.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),lr=t}return lr}var ii;function $d(){if(!ii){ii=xt.MEDIUM;var r=jd();if(r&&r.getShaderPrecisionFormat){var t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);ii=t.precision?xt.HIGH:xt.MEDIUM}}return ii}function ra(r,t,e){if(r.substring(0,9)!=="precision"){var i=t;return t===xt.HIGH&&e!==xt.HIGH&&(i=xt.MEDIUM),"precision "+i+` float;
`+r}else if(e!==xt.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}var zd={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function ju(r){return zd[r]}var ni=null,ia={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function $u(r,t){if(!ni){var e=Object.keys(ia);ni={};for(var i=0;i<e.length;++i){var n=e[i];ni[r[n]]=ia[n]}}return ni[t]}var Qe=[{test:function(r){return r.type==="float"&&r.size===1&&!r.isArray},code:function(r){return`
            if(uv["`+r+'"] !== ud["'+r+`"].value)
            {
                ud["`+r+'"].value = uv["'+r+`"]
                gl.uniform1f(ud["`+r+'"].location, uv["'+r+`"])
            }
            `}},{test:function(r,t){return(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0)},code:function(r){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+r+`"], t);

            if(ud["`+r+`"].value !== t)
            {
                ud["`+r+`"].value = t;
                gl.uniform1i(ud["`+r+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(r,t){return r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0},code:function(r){return`
            gl.uniformMatrix3fv(ud["`+r+'"].location, false, uv["'+r+`"].toArray(true));
            `},codeUbo:function(r){return`
                var `+r+"_matrix = uv."+r+`.toArray(true);

                data[offset] = `+r+`_matrix[0];
                data[offset+1] = `+r+`_matrix[1];
                data[offset+2] = `+r+`_matrix[2];
        
                data[offset + 4] = `+r+`_matrix[3];
                data[offset + 5] = `+r+`_matrix[4];
                data[offset + 6] = `+r+`_matrix[5];
        
                data[offset + 8] = `+r+`_matrix[6];
                data[offset + 9] = `+r+`_matrix[7];
                data[offset + 10] = `+r+`_matrix[8];
            `}},{test:function(r,t){return r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+r+`"].location, v.x, v.y);
                }`},codeUbo:function(r){return`
                v = uv.`+r+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(r){return r.type==="vec2"&&r.size===1&&!r.isArray},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+r+`"].location, v[0], v[1]);
                }
            `}},{test:function(r,t){return r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+r+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(r){return`
                    v = uv.`+r+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(r){return r.type==="vec4"&&r.size===1&&!r.isArray},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+r+`"].location, v[0], v[1], v[2], v[3])
                }`}}],Wd={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Yd={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function qd(r,t){var e,i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var n in r.uniforms){var s=t[n];if(!s){!((e=r.uniforms[n])===null||e===void 0)&&e.group&&(r.uniforms[n].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+n+", '"+n+`');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.`+n+`, syncData);
                    `));continue}for(var o=r.uniforms[n],a=!1,u=0;u<Qe.length;u++)if(Qe[u].test(s,o)){i.push(Qe[u].code(n,o)),a=!0;break}if(!a){var l=s.size===1&&!s.isArray?Wd:Yd,h=l[s.type].replace("location",'ud["'+n+'"].location');i.push(`
            cu = ud["`+n+`"];
            cv = cu.value;
            v = uv["`+n+`"];
            `+h+";")}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}var Kd=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Zd(r){for(var t="",e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+="if(test == "+e+".0){}");return t}function Jd(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var e=t.createShader(t.FRAGMENT_SHADER);;){var i=Kd.replace(/%forloop%/gi,Zd(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}var hr;function Qd(){if(typeof hr=="boolean")return hr;try{var r=new Function("param1","param2","param3","return param1[param2] === param3;");hr=r({a:"b"},"a","b")===!0}catch{hr=!1}return hr}var tp=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,ep=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,rp=0,si={},Ss=function(){function r(t,e,i){i===void 0&&(i="pixi-shader"),this.id=rp++,this.vertexSrc=t||r.defaultVertexSrc,this.fragmentSrc=e||r.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),si[i]?(si[i]++,i+="-"+si[i]):si[i]=1,this.vertexSrc="#define SHADER_NAME "+i+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+`
`+this.fragmentSrc,this.vertexSrc=ra(this.vertexSrc,I.PRECISION_VERTEX,xt.HIGH),this.fragmentSrc=ra(this.fragmentSrc,I.PRECISION_FRAGMENT,$d())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(r,"defaultVertexSrc",{get:function(){return ep},enumerable:!1,configurable:!0}),Object.defineProperty(r,"defaultFragmentSrc",{get:function(){return tp},enumerable:!1,configurable:!0}),r.from=function(t,e,i){var n=t+e,s=Wo[n];return s||(Wo[n]=s=new r(t,e,i)),s},r}(),zu=function(){function r(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Je?this.uniformGroup=e:this.uniformGroup=new Je(e):this.uniformGroup=new Je({}),this.disposeRunner=new nt("disposeShader")}return r.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var n=e.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1},r.prototype.destroy=function(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()},Object.defineProperty(r.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),r.from=function(t,e,i){var n=Ss.from(t,e);return new r(n,i)},r}(),dn=0,pn=1,mn=2,gn=3,vn=4,yn=5,As=function(){function r(){this.data=0,this.blendMode=C.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(r.prototype,"blend",{get:function(){return!!(this.data&1<<dn)},set:function(t){!!(this.data&1<<dn)!==t&&(this.data^=1<<dn)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"offsets",{get:function(){return!!(this.data&1<<pn)},set:function(t){!!(this.data&1<<pn)!==t&&(this.data^=1<<pn)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"culling",{get:function(){return!!(this.data&1<<mn)},set:function(t){!!(this.data&1<<mn)!==t&&(this.data^=1<<mn)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return!!(this.data&1<<gn)},set:function(t){!!(this.data&1<<gn)!==t&&(this.data^=1<<gn)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthMask",{get:function(){return!!(this.data&1<<yn)},set:function(t){!!(this.data&1<<yn)!==t&&(this.data^=1<<yn)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<vn)},set:function(t){!!(this.data&1<<vn)!==t&&(this.data^=1<<vn)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==C.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},r.for2d=function(){var t=new r;return t.depthTest=!1,t.blend=!0,t},r}(),ip=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,np=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,sp=function(r){N(t,r);function t(e,i,n){var s=this,o=Ss.from(e||t.defaultVertexSrc,i||t.defaultFragmentSrc);return s=r.call(this,o,n)||this,s.padding=0,s.resolution=I.FILTER_RESOLUTION,s.multisample=I.FILTER_MULTISAMPLE,s.enabled=!0,s.autoFit=!0,s.state=new As,s}return t.prototype.apply=function(e,i,n,s,o){e.applyFilter(this,i,n,s)},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultVertexSrc",{get:function(){return np},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return ip},enumerable:!1,configurable:!0}),t}(zu),op=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,ap=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,na=new ot,up=function(){function r(t,e){this._texture=t,this.mapCoord=new ot,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}return Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),r.prototype.multiplyUvs=function(t,e){e===void 0&&(e=t);for(var i=this.mapCoord,n=0;n<t.length;n+=2){var s=t[n],o=t[n+1];e[n]=s*i.a+o*i.c+i.tx,e[n+1]=s*i.b+o*i.d+i.ty}return e},r.prototype.update=function(t){var e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var n=e.orig,s=e.trim;s&&(na.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(na));var o=e.baseTexture,a=this.uClampFrame,u=this.clampMargin/o.resolution,l=this.clampOffset;return a[0]=(e._frame.x+u+l)/o.width,a[1]=(e._frame.y+u+l)/o.height,a[2]=(e._frame.x+e._frame.width-u+l)/o.width,a[3]=(e._frame.y+e._frame.height-u+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0},r}(),lp=function(r){N(t,r);function t(e,i,n){var s=this,o=null;return typeof e!="string"&&i===void 0&&n===void 0&&(o=e,e=void 0,i=void 0,n=void 0),s=r.call(this,e||op,i||ap,n)||this,s.maskSprite=o,s.maskMatrix=new ot,s}return Object.defineProperty(t.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),t.prototype.apply=function(e,i,n,s){var o=this._maskSprite,a=o._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new up(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,o).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,i,n,s))},t}(sp),hp=function(){function r(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return r.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},r.prototype.push=function(t,e){var i=e;if(!i.isMaskData){var n=this.maskDataPool.pop()||new Hd;n.pooled=!0,n.maskObject=e,i=n}var s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==K.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case K.SCISSOR:this.renderer.scissor.push(i);break;case K.STENCIL:this.renderer.stencil.push(i);break;case K.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case K.COLOR:this.pushColorMask(i);break}i.type===K.SPRITE&&this.maskStack.push(i)},r.prototype.pop=function(t){var e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case K.SCISSOR:this.renderer.scissor.pop(e);break;case K.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case K.SPRITE:this.popSpriteMask(e);break;case K.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){var i=this.maskStack[this.maskStack.length-1];i.type===K.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}},r.prototype.detect=function(t){var e=t.maskObject;e?e.isSprite?t.type=K.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=K.SCISSOR:t.type=K.STENCIL:t.type=K.COLOR},r.prototype.pushSpriteMask=function(t){var e,i,n=t.maskObject,s=t._target,o=t._filters;o||(o=this.alphaMaskPool[this.alphaMaskIndex],o||(o=this.alphaMaskPool[this.alphaMaskIndex]=[new lp]));var a=this.renderer,u=a.renderTexture,l,h;if(u.current){var c=u.current;l=t.resolution||c.resolution,h=(e=t.multisample)!==null&&e!==void 0?e:c.multisample}else l=t.resolution||a.resolution,h=(i=t.multisample)!==null&&i!==void 0?i:a.multisample;o[0].resolution=l,o[0].multisample=h,o[0].maskSprite=n;var f=s.filterArea;s.filterArea=n.getBounds(!0),a.filter.push(s,o),s.filterArea=f,t._filters||this.alphaMaskIndex++},r.prototype.popSpriteMask=function(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},r.prototype.pushColorMask=function(t){var e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)},r.prototype.popColorMask=function(t){var e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)},r.prototype.destroy=function(){this.renderer=null},r}(),Wu=function(){function r(t){this.renderer=t,this.maskStack=[],this.glConst=0}return r.prototype.getStackLength=function(){return this.maskStack.length},r.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var n=this.getStackLength();n!==i&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},r.prototype._useCurrent=function(){},r.prototype.destroy=function(){this.renderer=null,this.maskStack=null},r}(),sa=new ot,oa=[],cp=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.glConst=I.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST,i}return t.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0},t.prototype.calcScissorRect=function(e){var i;if(!e._scissorRectLocal){var n=e._scissorRect,s=e.maskObject,o=this.renderer,a=o.renderTexture,u=s.getBounds(!0,(i=oa.pop())!==null&&i!==void 0?i:new q);this.roundFrameToPixels(u,a.current?a.current.resolution:o.resolution,a.sourceFrame,a.destinationFrame,o.projection.transform),n&&u.fit(n),e._scissorRectLocal=u}},t.isMatrixRotated=function(e){if(!e)return!1;var i=e.a,n=e.b,s=e.c,o=e.d;return(Math.abs(n)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(i)>1e-4||Math.abs(o)>1e-4)},t.prototype.testScissor=function(e){var i=e.maskObject;if(!i.isFastRect||!i.isFastRect()||t.isMatrixRotated(i.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);var n=e._scissorRectLocal;return n.width>0&&n.height>0},t.prototype.roundFrameToPixels=function(e,i,n,s,o){t.isMatrixRotated(o)||(o=o?sa.copyFrom(o):sa.identity(),o.translate(-n.x,-n.y).scale(s.width/n.width,s.height/n.height).translate(s.x,s.y),this.renderer.filter.transformAABB(o,e),e.fit(s),e.x=Math.round(e.x*i),e.y=Math.round(e.y*i),e.width=Math.round(e.width*i),e.height=Math.round(e.height*i))},t.prototype.push=function(e){e._scissorRectLocal||this.calcScissorRect(e);var i=this.renderer.gl;e._scissorRect||i.enable(i.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()},t.prototype.pop=function(e){var i=this.renderer.gl;e&&oa.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():i.disable(i.SCISSOR_TEST)},t.prototype._useCurrent=function(){var e=this.maskStack[this.maskStack.length-1]._scissorRect,i;this.renderer.renderTexture.current?i=e.y:i=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,i,e.width,e.height)},t}(Wu),fp=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.glConst=I.ADAPTER.getWebGLRenderingContext().STENCIL_TEST,i}return t.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0},t.prototype.push=function(e){var i=e.maskObject,n=this.renderer.gl,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),e._stencilCounter++;var o=e._colorMask;o!==0&&(e._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,s,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,o!==0&&(e._colorMask=o,n.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()},t.prototype.pop=function(e){var i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{var n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=n?n._colorMask:15;s!==0&&(n._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(n._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}},t.prototype._useCurrent=function(){var e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t}(Wu),dp=function(){function r(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ot,this.transform=null}return r.prototype.update=function(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);var s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)},r.prototype.calculateProjection=function(t,e,i,n){var s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=o*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-o-e.y*s.d},r.prototype.setTransform=function(t){},r.prototype.destroy=function(){this.renderer=null},r}(),me=new q,cr=new q,pp=function(){function r(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new q,this.destinationFrame=new q,this.viewportFrame=new q}return r.prototype.bind=function(t,e,i){t===void 0&&(t=null);var n=this.renderer;this.current=t;var s,o,a;t?(s=t.baseTexture,a=s.resolution,e||(me.width=t.frame.width,me.height=t.frame.height,e=me),i||(cr.x=t.frame.x,cr.y=t.frame.y,cr.width=e.width,cr.height=e.height,i=cr),o=s.framebuffer):(a=n.resolution,e||(me.width=n.screen.width,me.height=n.screen.height,e=me),i||(i=me,i.width=e.width,i.height=e.height));var u=this.viewportFrame;u.x=i.x*a,u.y=i.y*a,u.width=i.width*a,u.height=i.height*a,t||(u.y=n.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(o,u),this.renderer.projection.update(i,e,a,!o),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},r.prototype.clear=function(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.clearColor;var i=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer.screen,s=i.width!==n.width||i.height!==n.height;if(s){var o=this.viewportFrame,a=o.x,u=o.y,l=o.width,h=o.height;a=Math.round(a),u=Math.round(u),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,u,l,h)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),s&&this.renderer.scissor.pop()},r.prototype.resize=function(){this.bind(null)},r.prototype.reset=function(){this.bind(null)},r.prototype.destroy=function(){this.renderer=null},r}();function mp(r,t,e,i,n){e.buffer.update(n)}var gp={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Yu={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function vp(r){for(var t=r.map(function(u){return{data:u,offset:0,dataLen:0,dirty:0}}),e=0,i=0,n=0,s=0;s<t.length;s++){var o=t[s];if(e=Yu[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!==0&&i<16){var a=i%e%16;i+=a,n+=a}i+e>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=e,i=e):(o.offset=n,i+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function yp(r,t){var e=[];for(var i in r)t[i]&&e.push(t[i]);return e.sort(function(n,s){return n.index-s.index}),e}function _p(r,t){if(!r.autoManage)return{size:0,syncFunc:mp};for(var e=yp(r.uniforms,t),i=vp(e),n=i.uboElements,s=i.size,o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],a=0;a<n.length;a++){for(var u=n[a],l=r.uniforms[u.data.name],h=u.data.name,c=!1,f=0;f<Qe.length;f++){var d=Qe[f];if(d.codeUbo&&d.test(u.data,l)){o.push("offset = "+u.offset/4+";",Qe[f].codeUbo(u.data.name,l)),c=!0;break}}if(!c)if(u.data.size>1){var p=ju(u.data.type),v=Math.max(Yu[u.data.type]/16,1),m=p/v,y=(4-m%4)%4;o.push(`
                cv = ud.`+h+`.value;
                v = uv.`+h+`;
                offset = `+u.offset/4+`;

                t = 0;

                for(var i=0; i < `+u.data.size*v+`; i++)
                {
                    for(var j = 0; j < `+m+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+y+`;
                }

                `)}else{var _=gp[u.data.type];o.push(`
                cv = ud.`+h+`.value;
                v = uv.`+h+`;
                offset = `+u.offset/4+`;
                `+_+`;
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}var bp=function(){function r(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return r.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},r}();function xp(r,t){for(var e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var s=t.getActiveAttrib(r,n);if(s.name.indexOf("gl_")!==0){var o=$u(t,s.type),a={type:o,name:s.name,size:ju(o),location:t.getAttribLocation(r,s.name)};e[s.name]=a}}return e}function Ep(r,t){for(var e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS),n=0;n<i;n++){var s=t.getActiveUniform(r,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),u=$u(t,s.type);e[o]={name:o,index:n,type:u,size:s.size,isArray:a,value:Hu(u,s.size)}}return e}function Tp(r,t){var e=ta(r,r.VERTEX_SHADER,t.vertexSrc),i=ta(r,r.FRAGMENT_SHADER,t.fragmentSrc),n=r.createProgram();if(r.attachShader(n,e),r.attachShader(n,i),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS)||Xd(r,n,e,i),t.attributeData=xp(n,r),t.uniformData=Ep(n,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){var s=Object.keys(t.attributeData);s.sort(function(h,c){return h>c?1:-1});for(var o=0;o<s.length;o++)t.attributeData[s[o]].location=o,r.bindAttribLocation(n,o,s[o]);r.linkProgram(n)}r.deleteShader(e),r.deleteShader(i);var a={};for(var o in t.uniformData){var u=t.uniformData[o];a[o]={location:r.getUniformLocation(n,o),value:Hu(u.type,u.size)}}var l=new bp(n,a);return l}var wp=0,oi={textureCount:0,uboCount:0},Ip=function(){function r(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=wp++}return r.prototype.systemCheck=function(){if(!Qd())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},r.prototype.contextChange=function(t){this.gl=t,this.reset()},r.prototype.bind=function(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(oi.textureCount=0,oi.uboCount=0,this.syncUniformGroup(t.uniformGroup,oi)),n},r.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},r.prototype.syncUniformGroup=function(t,e){var i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},r.prototype.syncUniforms=function(t,e,i){var n=t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t);n(e.uniformData,t.uniforms,this.renderer,i)},r.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=qd(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},r.prototype.syncUniformBufferGroup=function(t,e){var i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;var n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,oi,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])},r.prototype.createSyncBufferGroup=function(t,e,i){var n=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var s=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;var o=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=_p(t,this.shader.program.uniformData)),t.autoManage){var u=new Float32Array(a.size/4);t.buffer.update(u)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]},r.prototype.getSignature=function(t,e,i){var n=t.uniforms,s=[i+"-"];for(var o in n)s.push(o),e[o]&&s.push(e[o].type);return s.join("-")},r.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},r.prototype.generateProgram=function(t){var e=this.gl,i=t.program,n=Tp(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n},r.prototype.reset=function(){this.program=null,this.shader=null},r.prototype.disposeShader=function(t){this.shader===t&&(this.shader=null)},r.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},r}();function Cp(r,t){return t===void 0&&(t=[]),t[C.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.ADD]=[r.ONE,r.ONE],t[C.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.NONE]=[0,0],t[C.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[C.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[C.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[C.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[C.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[C.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[C.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[C.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[C.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[C.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[C.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}var Sp=0,Ap=1,Pp=2,Mp=3,Rp=4,Fp=5,Op=function(){function r(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=C.NONE,this._blendEq=!1,this.map=[],this.map[Sp]=this.setBlend,this.map[Ap]=this.setOffset,this.map[Pp]=this.setCullFace,this.map[Mp]=this.setDepthTest,this.map[Rp]=this.setFrontFace,this.map[Fp]=this.setDepthMask,this.checks=[],this.defaultState=new As,this.defaultState.blend=!0}return r.prototype.contextChange=function(t){this.gl=t,this.blendModes=Cp(t),this.set(this.defaultState),this.reset()},r.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(var i=0;i<this.checks.length;i++)this.checks[i](this,t)},r.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(var e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},r.prototype.setBlend=function(t){this.updateCheck(r.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},r.prototype.setOffset=function(t){this.updateCheck(r.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},r.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},r.prototype.setDepthMask=function(t){this.gl.depthMask(t)},r.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},r.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},r.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},r.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},r.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},r.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)},r.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},r.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},r.prototype.destroy=function(){this.gl=null},r}(),Dp=function(){function r(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=I.GC_MAX_IDLE,this.checkCountMax=I.GC_MAX_CHECK_COUNT,this.mode=I.GC_MODE}return r.prototype.postrender=function(){!this.renderer.renderingToScreen||(this.count++,this.mode!==_i.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},r.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,n=0;n<e.length;n++){var s=e[n];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,i=!0)}if(i){for(var o=0,n=0;n<e.length;n++)e[n]!==null&&(e[o++]=e[n]);e.length=o}},r.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var n=t.children.length-1;n>=0;n--)this.unload(t.children[n])},r.prototype.destroy=function(){this.renderer=null},r}();function Lp(r){var t,e,i,n,s,o,a,u,l,h,c,f,d,p,v,m,y,_,g,b,E,T,M;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?M=(t={},t[F.UNSIGNED_BYTE]=(e={},e[x.RGBA]=r.RGBA8,e[x.RGB]=r.RGB8,e[x.RG]=r.RG8,e[x.RED]=r.R8,e[x.RGBA_INTEGER]=r.RGBA8UI,e[x.RGB_INTEGER]=r.RGB8UI,e[x.RG_INTEGER]=r.RG8UI,e[x.RED_INTEGER]=r.R8UI,e[x.ALPHA]=r.ALPHA,e[x.LUMINANCE]=r.LUMINANCE,e[x.LUMINANCE_ALPHA]=r.LUMINANCE_ALPHA,e),t[F.BYTE]=(i={},i[x.RGBA]=r.RGBA8_SNORM,i[x.RGB]=r.RGB8_SNORM,i[x.RG]=r.RG8_SNORM,i[x.RED]=r.R8_SNORM,i[x.RGBA_INTEGER]=r.RGBA8I,i[x.RGB_INTEGER]=r.RGB8I,i[x.RG_INTEGER]=r.RG8I,i[x.RED_INTEGER]=r.R8I,i),t[F.UNSIGNED_SHORT]=(n={},n[x.RGBA_INTEGER]=r.RGBA16UI,n[x.RGB_INTEGER]=r.RGB16UI,n[x.RG_INTEGER]=r.RG16UI,n[x.RED_INTEGER]=r.R16UI,n[x.DEPTH_COMPONENT]=r.DEPTH_COMPONENT16,n),t[F.SHORT]=(s={},s[x.RGBA_INTEGER]=r.RGBA16I,s[x.RGB_INTEGER]=r.RGB16I,s[x.RG_INTEGER]=r.RG16I,s[x.RED_INTEGER]=r.R16I,s),t[F.UNSIGNED_INT]=(o={},o[x.RGBA_INTEGER]=r.RGBA32UI,o[x.RGB_INTEGER]=r.RGB32UI,o[x.RG_INTEGER]=r.RG32UI,o[x.RED_INTEGER]=r.R32UI,o[x.DEPTH_COMPONENT]=r.DEPTH_COMPONENT24,o),t[F.INT]=(a={},a[x.RGBA_INTEGER]=r.RGBA32I,a[x.RGB_INTEGER]=r.RGB32I,a[x.RG_INTEGER]=r.RG32I,a[x.RED_INTEGER]=r.R32I,a),t[F.FLOAT]=(u={},u[x.RGBA]=r.RGBA32F,u[x.RGB]=r.RGB32F,u[x.RG]=r.RG32F,u[x.RED]=r.R32F,u[x.DEPTH_COMPONENT]=r.DEPTH_COMPONENT32F,u),t[F.HALF_FLOAT]=(l={},l[x.RGBA]=r.RGBA16F,l[x.RGB]=r.RGB16F,l[x.RG]=r.RG16F,l[x.RED]=r.R16F,l),t[F.UNSIGNED_SHORT_5_6_5]=(h={},h[x.RGB]=r.RGB565,h),t[F.UNSIGNED_SHORT_4_4_4_4]=(c={},c[x.RGBA]=r.RGBA4,c),t[F.UNSIGNED_SHORT_5_5_5_1]=(f={},f[x.RGBA]=r.RGB5_A1,f),t[F.UNSIGNED_INT_2_10_10_10_REV]=(d={},d[x.RGBA]=r.RGB10_A2,d[x.RGBA_INTEGER]=r.RGB10_A2UI,d),t[F.UNSIGNED_INT_10F_11F_11F_REV]=(p={},p[x.RGB]=r.R11F_G11F_B10F,p),t[F.UNSIGNED_INT_5_9_9_9_REV]=(v={},v[x.RGB]=r.RGB9_E5,v),t[F.UNSIGNED_INT_24_8]=(m={},m[x.DEPTH_STENCIL]=r.DEPTH24_STENCIL8,m),t[F.FLOAT_32_UNSIGNED_INT_24_8_REV]=(y={},y[x.DEPTH_STENCIL]=r.DEPTH32F_STENCIL8,y),t):M=(_={},_[F.UNSIGNED_BYTE]=(g={},g[x.RGBA]=r.RGBA,g[x.RGB]=r.RGB,g[x.ALPHA]=r.ALPHA,g[x.LUMINANCE]=r.LUMINANCE,g[x.LUMINANCE_ALPHA]=r.LUMINANCE_ALPHA,g),_[F.UNSIGNED_SHORT_5_6_5]=(b={},b[x.RGB]=r.RGB,b),_[F.UNSIGNED_SHORT_4_4_4_4]=(E={},E[x.RGBA]=r.RGBA,E),_[F.UNSIGNED_SHORT_5_5_5_1]=(T={},T[x.RGBA]=r.RGBA,T),_),M}var _n=function(){function r(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=F.UNSIGNED_BYTE,this.internalFormat=x.RGBA,this.samplerType=0}return r}(),Bp=function(){function r(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Q,this.hasIntegerTextures=!1}return r.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Lp(t);var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};var n=new _n(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new _n(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var i=0;i<this.boundTextures.length;i++)this.bind(null,i)},r.prototype.bind=function(t,e){e===void 0&&(e=0);var i=this.gl;if(t=t?.castToBaseTexture(),t&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},r.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},r.prototype.unbind=function(t){var e=this,i=e.gl,n=e.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var s=0;s<n.length;s++)n[s]===this.unknownTexture&&this.bind(null,s)}for(var s=0;s<n.length;s++)n[s]===t&&(this.currentLocation!==s&&(i.activeTexture(i.TEXTURE0+s),this.currentLocation=s),i.bindTexture(t.target,this.emptyTextures[t.target].texture),n[s]=null)},r.prototype.ensureSamplerType=function(t){var e=this,i=e.boundTextures,n=e.hasIntegerTextures,s=e.CONTEXT_UID;if(!!n)for(var o=t-1;o>=0;--o){var a=i[o];if(a){var u=a._glTextures[s];u.samplerType!==vi.FLOAT&&this.renderer.texture.unbind(a)}}},r.prototype.initTexture=function(t){var e=new _n(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},r.prototype.initTextureType=function(t,e){var i,n;e.internalFormat=(n=(i=this.internalFormats[t.type])===null||i===void 0?void 0:i[t.format])!==null&&n!==void 0?n:t.format,this.webGLVersion===2&&t.type===F.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type},r.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(!!e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e))e.samplerType!==vi.FLOAT&&(this.hasIntegerTextures=!0);else{var n=t.realWidth,s=t.realHeight,o=i.gl;(e.width!==n||e.height!==s||e.dirtyId<0)&&(e.width=n,e.height=s,o.texImage2D(t.target,0,e.internalFormat,n,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},r.prototype.destroyTexture=function(t,e){var i=this.gl;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var n=this.managedTextures.indexOf(t);n!==-1&&di(this.managedTextures,n,1)}},r.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];!e||((t.mipmap===se.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=yi.CLAMP:e.wrapMode=t.wrapMode,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},r.prototype.setStyle=function(t,e){var i=this.gl;if(e.mipmap&&t.mipmap!==se.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Gt.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===Gt.LINEAR){var s=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Gt.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===Gt.LINEAR?i.LINEAR:i.NEAREST)},r.prototype.destroy=function(){this.renderer=null},r}(),bn=new ot,Np=function(r){N(t,r);function t(e,i){e===void 0&&(e=Ar.UNKNOWN);var n=r.call(this)||this;return i=Object.assign({},I.RENDER_OPTIONS,i),n.options=i,n.type=e,n.screen=new q(0,0,i.width,i.height),n.view=i.view||I.ADAPTER.createCanvas(),n.resolution=i.resolution||I.RESOLUTION,n.useContextAlpha=i.useContextAlpha,n.autoDensity=!!i.autoDensity,n.preserveDrawingBuffer=i.preserveDrawingBuffer,n.clearBeforeRender=i.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,1],n._backgroundColorString="#000000",n.backgroundColor=i.backgroundColor||n._backgroundColor,n.backgroundAlpha=i.backgroundAlpha,i.transparent!==void 0&&(De("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),n.useContextAlpha=i.transparent,n.backgroundAlpha=i.transparent?0:1),n._lastObjectRendered=null,n.plugins={},n}return t.prototype.initPlugins=function(e){for(var i in e)this.plugins[i]=new e[i](this)},Object.defineProperty(t.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),t.prototype.resize=function(e,i){this.view.width=Math.round(e*this.resolution),this.view.height=Math.round(i*this.resolution);var n=this.view.width/this.resolution,s=this.view.height/this.resolution;this.screen.width=n,this.screen.height=s,this.autoDensity&&(this.view.style.width=n+"px",this.view.style.height=s+"px"),this.emit("resize",n,s)},t.prototype.generateTexture=function(e,i,n,s){i===void 0&&(i={}),typeof i=="number"&&(De("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),i={scaleMode:i,resolution:n,region:s});var o=i.region,a=gd(i,["region"]);s=o||e.getLocalBounds(null,!0),s.width===0&&(s.width=1),s.height===0&&(s.height=1);var u=Is.create(Qn({width:s.width,height:s.height},a));return bn.tx=-s.x,bn.ty=-s.y,this.render(e,{renderTexture:u,clear:!1,transform:bn,skipUpdateTransform:!!e.parent}),u},t.prototype.destroy=function(e){for(var i in this.plugins)this.plugins[i].destroy(),this.plugins[i]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=Ar.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=sd(e),nd(e,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(e){this._backgroundColorRgba[3]=e},enumerable:!1,configurable:!0}),t}(he),kp=function(){function r(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return r}(),Up=function(){function r(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}return r.prototype.destroy=function(){this.renderer=null},r.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},r.prototype.bind=function(t){var e=this,i=e.gl,n=e.CONTEXT_UID,s=t._glBuffers[n]||this.createGLBuffer(t);i.bindBuffer(t.type,s.buffer)},r.prototype.bindBufferBase=function(t,e){var i=this,n=i.gl,s=i.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var o=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,n.bindBufferBase(n.UNIFORM_BUFFER,e,o.buffer)}},r.prototype.bindBufferRange=function(t,e,i){var n=this,s=n.gl,o=n.CONTEXT_UID;i=i||0;var a=t._glBuffers[o]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,a.buffer,i*256,256)},r.prototype.update=function(t){var e=this,i=e.gl,n=e.CONTEXT_UID,s=t._glBuffers[n];if(t._updateID!==s.updateID)if(s.updateID=t._updateID,i.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)i.bufferSubData(t.type,0,t.data);else{var o=t.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,i.bufferData(t.type,t.data,o)}},r.prototype.dispose=function(t,e){if(!!this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},r.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedBuffers),i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)},r.prototype.createGLBuffer=function(t){var e=this,i=e.CONTEXT_UID,n=e.gl;return t._glBuffers[i]=new kp(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[i]},r}(),Ps=function(r){N(t,r);function t(e){var i=r.call(this,Ar.WEBGL,e)||this;return e=i.options,i.gl=null,i.CONTEXT_UID=0,i.runners={destroy:new nt("destroy"),contextChange:new nt("contextChange"),reset:new nt("reset"),update:new nt("update"),postrender:new nt("postrender"),prerender:new nt("prerender"),resize:new nt("resize")},i.runners.contextChange.add(i),i.globalUniforms=new Je({projectionMatrix:new ot},!0),i.addSystem(hp,"mask").addSystem(Nd,"context").addSystem(Op,"state").addSystem(Ip,"shader").addSystem(Bp,"texture").addSystem(Up,"buffer").addSystem(Vd,"geometry").addSystem(Gd,"framebuffer").addSystem(cp,"scissor").addSystem(fp,"stencil").addSystem(dp,"projection").addSystem(Dp,"textureGC").addSystem(Ld,"filter").addSystem(pp,"renderTexture").addSystem(Bd,"batch"),i.initPlugins(t.__plugins),i.multisample=void 0,e.context?i.context.initFromContext(e.context):i.context.initFromOptions({alpha:!!i.useContextAlpha,antialias:e.antialias,premultipliedAlpha:i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:i.options.powerPreference}),i.renderingToScreen=!0,rd(i.context.webGLVersion===2?"WebGL 2":"WebGL 1"),i.resize(i.options.width,i.options.height),i}return t.create=function(e){if(id())return new t(e);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},t.prototype.contextChange=function(){var e=this.gl,i;if(this.context.webGLVersion===1){var n=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,n)}else{var n=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n)}i>=Y.HIGH?this.multisample=Y.HIGH:i>=Y.MEDIUM?this.multisample=Y.MEDIUM:i>=Y.LOW?this.multisample=Y.LOW:this.multisample=Y.NONE},t.prototype.addSystem=function(e,i){var n=new e(this);if(this[i])throw new Error('Whoops! The name "'+i+'" is already in use');this[i]=n;for(var s in this.runners)this.runners[s].add(n);return this},t.prototype.render=function(e,i){var n,s,o,a;if(i&&(i instanceof Is?(De("6.0.0","Renderer#render arguments changed, use options instead."),n=i,s=arguments[2],o=arguments[3],a=arguments[4]):(n=i.renderTexture,s=i.clear,o=i.transform,a=i.skipUpdateTransform)),this.renderingToScreen=!n,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=o,!this.context.isLost){if(n||(this._lastObjectRendered=e),!a){var u=e.enableTempParent();e.updateTransform(),e.disableTempParent(u)}this.renderTexture.bind(n),this.batch.currentRenderer.start(),(s!==void 0?s:this.clearBeforeRender)&&this.renderTexture.clear(),e.render(this),this.batch.currentRenderer.flush(),n&&n.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},t.prototype.generateTexture=function(e,i,n,s){i===void 0&&(i={});var o=r.prototype.generateTexture.call(this,e,i,n,s);return this.framebuffer.blit(),o},t.prototype.resize=function(e,i){r.prototype.resize.call(this,e,i),this.runners.resize.emit(this.screen.height,this.screen.width)},t.prototype.reset=function(){return this.runners.reset.emit(),this},t.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},t.prototype.destroy=function(e){this.runners.destroy.emit();for(var i in this.runners)this.runners[i].destroy();r.prototype.destroy.call(this,e),this.gl=null},Object.defineProperty(t.prototype,"extract",{get:function(){return De("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),t.registerPlugin=function(e,i){De("6.5.0","Renderer.registerPlugin() has been deprecated, please use extensions.add() instead."),Xr.add({name:e,type:At.RendererPlugin,ref:i})},t.__plugins={},t}(Np);Xr.handleByMap(At.RendererPlugin,Ps.__plugins);function Gp(r){return Ps.create(r)}var Vp=function(){function r(){this.texArray=null,this.blend=0,this.type=Pr.TRIANGLES,this.start=0,this.size=0,this.data=null}return r}(),Hp=function(){function r(){this.elements=[],this.ids=[],this.count=0}return r.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},r}(),Xp=function(){function r(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(r.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),r.prototype.view=function(t){return this[t+"View"]},r.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},r.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},r}(),jp=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.shaderGenerator=null,i.geometryClass=null,i.vertexSize=null,i.state=As.for2d(),i.size=I.SPRITE_BATCH_SIZE*4,i._vertexCount=0,i._indexCount=0,i._bufferedElements=[],i._bufferedTextures=[],i._bufferSize=0,i._shader=null,i._packedGeometries=[],i._packedGeometryPoolSize=2,i._flushId=0,i._aBuffers={},i._iBuffers={},i.MAX_TEXTURES=1,i.renderer.on("prerender",i.onPrerender,i),e.runners.contextChange.add(i),i._dcIndex=0,i._aIndex=0,i._iIndex=0,i._attributeBuffer=null,i._indexBuffer=null,i._tempBoundTextures=[],i}return t.prototype.contextChange=function(){var e=this.renderer.gl;I.PREFER_ENV===zt.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),I.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Jd(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},t.prototype.initFlushBuffers=function(){for(var e=t._drawCallPool,i=t._textureArrayPool,n=this.size/4,s=Math.floor(n/this.MAX_TEXTURES)+1;e.length<n;)e.push(new Vp);for(;i.length<s;)i.push(new Hp);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},t.prototype.onPrerender=function(){this._flushId=0},t.prototype.render=function(e){!e._texture.valid||(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)},t.prototype.buildTexturesAndDrawCalls=function(){var e=this,i=e._bufferedTextures,n=e.MAX_TEXTURES,s=t._textureArrayPool,o=this.renderer.batch,a=this._tempBoundTextures,u=this.renderer.textureGC.count,l=++Q._globalBatch,h=0,c=s[0],f=0;o.copyBoundTextures(a,n);for(var d=0;d<this._bufferSize;++d){var p=i[d];i[d]=null,p._batchEnabled!==l&&(c.count>=n&&(o.boundArray(c,a,l,n),this.buildDrawCalls(c,f,d),f=d,c=s[++h],++l),p._batchEnabled=l,p.touched=u,c.elements[c.count++]=p)}c.count>0&&(o.boundArray(c,a,l,n),this.buildDrawCalls(c,f,this._bufferSize),++h,++l);for(var d=0;d<a.length;d++)a[d]=null;Q._globalBatch=l},t.prototype.buildDrawCalls=function(e,i,n){var s=this,o=s._bufferedElements,a=s._attributeBuffer,u=s._indexBuffer,l=s.vertexSize,h=t._drawCallPool,c=this._dcIndex,f=this._aIndex,d=this._iIndex,p=h[c];p.start=this._iIndex,p.texArray=e;for(var v=i;v<n;++v){var m=o[v],y=m._texture.baseTexture,_=ad[y.alphaMode?1:0][m.blendMode];o[v]=null,i<v&&p.blend!==_&&(p.size=d-p.start,i=v,p=h[++c],p.texArray=e,p.start=d),this.packInterleavedGeometry(m,a,u,f,d),f+=m.vertexData.length/2*l,d+=m.indices.length,p.blend=_}i<n&&(p.size=d-p.start,++c),this._dcIndex=c,this._aIndex=f,this._iIndex=d},t.prototype.bindAndClearTexArray=function(e){for(var i=this.renderer.texture,n=0;n<e.count;n++)i.bind(e.elements[n],e.ids[n]),e.elements[n]=null;e.count=0},t.prototype.updateGeometry=function(){var e=this,i=e._packedGeometries,n=e._attributeBuffer,s=e._indexBuffer;I.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(n.rawBinaryData),i[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(n.rawBinaryData),i[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},t.prototype.drawBatches=function(){for(var e=this._dcIndex,i=this.renderer,n=i.gl,s=i.state,o=t._drawCallPool,a=null,u=0;u<e;u++){var l=o[u],h=l.texArray,c=l.type,f=l.size,d=l.start,p=l.blend;a!==h&&(a=h,this.bindAndClearTexArray(h)),this.state.blendMode=p,s.set(this.state),n.drawElements(c,f,n.UNSIGNED_SHORT,d*2)}},t.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},t.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),I.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),r.prototype.destroy.call(this)},t.prototype.getAttributeBuffer=function(e){var i=wi(Math.ceil(e/8)),n=$o(i),s=i*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._aBuffers[s];return o||(this._aBuffers[s]=o=new Xp(s*this.vertexSize*4)),o},t.prototype.getIndexBuffer=function(e){var i=wi(Math.ceil(e/12)),n=$o(i),s=i*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._iBuffers[n];return o||(this._iBuffers[n]=o=new Uint16Array(s)),o},t.prototype.packInterleavedGeometry=function(e,i,n,s,o){for(var a=i.uint32View,u=i.float32View,l=s/this.vertexSize,h=e.uvs,c=e.indices,f=e.vertexData,d=e._texture.baseTexture._batchLocation,p=Math.min(e.worldAlpha,1),v=p<1&&e._texture.baseTexture.alphaMode?ud(e._tintRGB,p):e._tintRGB+(p*255<<24),m=0;m<f.length;m+=2)u[s++]=f[m],u[s++]=f[m+1],u[s++]=h[m],u[s++]=h[m+1],a[s++]=v,u[s++]=d;for(var m=0;m<c.length;m++)n[o++]=l+c[m]},t._drawCallPool=[],t._textureArrayPool=[],t}(Vu),$p=function(){function r(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return r.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=Je.from({uSamplers:e},!0);var n=this.fragTemplate;n=n.replace(/%count%/gi,""+t),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ss(this.vertexSrc,n)}var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new ot,default:this.defaultGroupCache[t]};return new zu(this.programCache[t],s)},r.prototype.generateSampleSrc=function(t){var e="";e+=`
`,e+=`
`;for(var i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+=`
{`,e+=`
	color = texture2D(uSamplers[`+i+"], vTextureCoord);",e+=`
}`;return e+=`
`,e+=`
`,e},r}(),zp=function(r){N(t,r);function t(e){e===void 0&&(e=!1);var i=r.call(this)||this;return i._buffer=new bt(null,e,!1),i._indexBuffer=new bt(null,e,!0),i.addAttribute("aVertexPosition",i._buffer,2,!1,F.FLOAT).addAttribute("aTextureCoord",i._buffer,2,!1,F.FLOAT).addAttribute("aColor",i._buffer,4,!0,F.UNSIGNED_BYTE).addAttribute("aTextureId",i._buffer,1,!0,F.FLOAT).addIndex(i._indexBuffer),i}return t}(Cs),aa=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,ua=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Wp=function(){function r(){}return r.create=function(t){var e=Object.assign({vertex:aa,fragment:ua,geometryClass:zp,vertexSize:6},t),i=e.vertex,n=e.fragment,s=e.vertexSize,o=e.geometryClass;return function(a){N(u,a);function u(l){var h=a.call(this,l)||this;return h.shaderGenerator=new $p(i,n),h.geometryClass=o,h.vertexSize=s,h}return u}(jp)},Object.defineProperty(r,"defaultVertexSrc",{get:function(){return aa},enumerable:!1,configurable:!0}),Object.defineProperty(r,"defaultFragmentTemplate",{get:function(){return ua},enumerable:!1,configurable:!0}),r}(),Yp=Wp.create();Object.assign(Yp,{extension:{name:"batch",type:At.RendererPlugin}});/*!
 * @pixi/display - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/display is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */I.SORTABLE_CHILDREN=!1;var la=function(){function r(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return r.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},r.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},r.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?q.EMPTY:(t=t||new q(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},r.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},r.prototype.addPointMatrix=function(t,e){var i=t.a,n=t.b,s=t.c,o=t.d,a=t.tx,u=t.ty,l=i*e.x+s*e.y+a,h=n*e.x+o*e.y+u;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)},r.prototype.addQuad=function(t){var e=this.minX,i=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,this.minX=e,this.minY=i,this.maxX=n,this.maxY=s},r.prototype.addFrame=function(t,e,i,n,s){this.addFrameMatrix(t.worldTransform,e,i,n,s)},r.prototype.addFrameMatrix=function(t,e,i,n,s){var o=t.a,a=t.b,u=t.c,l=t.d,h=t.tx,c=t.ty,f=this.minX,d=this.minY,p=this.maxX,v=this.maxY,m=o*e+u*i+h,y=a*e+l*i+c;f=m<f?m:f,d=y<d?y:d,p=m>p?m:p,v=y>v?y:v,m=o*n+u*i+h,y=a*n+l*i+c,f=m<f?m:f,d=y<d?y:d,p=m>p?m:p,v=y>v?y:v,m=o*e+u*s+h,y=a*e+l*s+c,f=m<f?m:f,d=y<d?y:d,p=m>p?m:p,v=y>v?y:v,m=o*n+u*s+h,y=a*n+l*s+c,f=m<f?m:f,d=y<d?y:d,p=m>p?m:p,v=y>v?y:v,this.minX=f,this.minY=d,this.maxX=p,this.maxY=v},r.prototype.addVertexData=function(t,e,i){for(var n=this.minX,s=this.minY,o=this.maxX,a=this.maxY,u=e;u<i;u+=2){var l=t[u],h=t[u+1];n=l<n?l:n,s=h<s?h:s,o=l>o?l:o,a=h>a?h:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a},r.prototype.addVertices=function(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)},r.prototype.addVerticesMatrix=function(t,e,i,n,s,o){s===void 0&&(s=0),o===void 0&&(o=s);for(var a=t.a,u=t.b,l=t.c,h=t.d,c=t.tx,f=t.ty,d=this.minX,p=this.minY,v=this.maxX,m=this.maxY,y=i;y<n;y+=2){var _=e[y],g=e[y+1],b=a*_+l*g+c,E=h*g+u*_+f;d=Math.min(d,b-s),v=Math.max(v,b+s),p=Math.min(p,E-o),m=Math.max(m,E+o)}this.minX=d,this.minY=p,this.maxX=v,this.maxY=m},r.prototype.addBounds=function(t){var e=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s},r.prototype.addBoundsMask=function(t,e){var i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&n<=o){var a=this.minX,u=this.minY,l=this.maxX,h=this.maxY;this.minX=i<a?i:a,this.minY=n<u?n:u,this.maxX=s>l?s:l,this.maxY=o>h?o:h}},r.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},r.prototype.addBoundsArea=function(t,e){var i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&n<=o){var a=this.minX,u=this.minY,l=this.maxX,h=this.maxY;this.minX=i<a?i:a,this.minY=n<u?n:u,this.maxX=s>l?s:l,this.maxY=o>h?o:h}},r.prototype.pad=function(t,e){t===void 0&&(t=0),e===void 0&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},r.prototype.addFramePad=function(t,e,i,n,s,o){t-=s,e-=o,i+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n},r}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var es=function(r,t){return es=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},es(r,t)};function Ms(r,t){es(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Lr=function(r){Ms(t,r);function t(){var e=r.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new Lu,e.alpha=1,e.visible=!0,e.renderable=!0,e.cullable=!1,e.cullArea=null,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new la,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._maskRefCount=0,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return t.mixin=function(e){for(var i=Object.keys(e),n=0;n<i.length;++n){var s=i[n];Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e,s))}},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),t.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},t.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},t.prototype.getBounds=function(e,i){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new q),i=this._boundsRect),this._bounds.getRectangle(i)},t.prototype.getLocalBounds=function(e){e||(this._localBoundsRect||(this._localBoundsRect=new q),e=this._localBoundsRect),this._localBounds||(this._localBounds=new la);var i=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;var a=this.getBounds(!1,e);return this.parent=n,this.transform=i,this._bounds=s,this._bounds.updateID+=this._boundsID-o,a},t.prototype.toGlobal=function(e,i,n){return n===void 0&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,i)},t.prototype.toLocal=function(e,i,n,s){return i&&(e=i.toGlobal(e,n,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,n)},t.prototype.setParent=function(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e},t.prototype.setTransform=function(e,i,n,s,o,a,u,l,h){return e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=1),s===void 0&&(s=1),o===void 0&&(o=0),a===void 0&&(a=0),u===void 0&&(u=0),l===void 0&&(l=0),h===void 0&&(h=0),this.position.x=e,this.position.y=i,this.scale.x=n||1,this.scale.y=s||1,this.rotation=o,this.skew.x=a,this.skew.y=u,this.pivot.x=l,this.pivot.y=h,this},t.prototype.destroy=function(e){this.parent&&this.parent.removeChild(this),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()},Object.defineProperty(t.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new qu),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),t.prototype.enableTempParent=function(){var e=this.parent;return this.parent=this._tempDisplayObjectParent,e},t.prototype.disableTempParent=function(e){this.parent=e},Object.defineProperty(t.prototype,"x",{get:function(){return this.position.x},set:function(e){this.transform.position.x=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.position.y},set:function(e){this.transform.position.y=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.transform.position},set:function(e){this.transform.position.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.transform.scale},set:function(e){this.transform.scale.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(e){this.transform.pivot.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skew",{get:function(){return this.transform.skew},set:function(e){this.transform.skew.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(e){this.transform.rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.transform.rotation*dd},set:function(e){this.transform.rotation=e*pd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){if(this._mask!==e){if(this._mask){var i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=e,this._mask){var i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}},enumerable:!1,configurable:!0}),t}(he),qu=function(r){Ms(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.sortDirty=null,e}return t}(Lr);Lr.prototype.displayObjectUpdateTransform=Lr.prototype.updateTransform;function qp(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}var Ii=function(r){Ms(t,r);function t(){var e=r.call(this)||this;return e.children=[],e.sortableChildren=I.SORTABLE_CHILDREN,e.sortDirty=!1,e}return t.prototype.onChildrenChange=function(e){},t.prototype.addChild=function(){for(var e=arguments,i=[],n=0;n<arguments.length;n++)i[n]=e[n];if(i.length>1)for(var s=0;s<i.length;s++)this.addChild(i[s]);else{var o=i[0];o.parent&&o.parent.removeChild(o),o.parent=this,this.sortDirty=!0,o.transform._parentID=-1,this.children.push(o),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",o,this,this.children.length-1),o.emit("added",this)}return i[0]},t.prototype.addChildAt=function(e,i){if(i<0||i>this.children.length)throw new Error(e+"addChildAt: The index "+i+" supplied is out of bounds "+this.children.length);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(i,0,e),this._boundsID++,this.onChildrenChange(i),e.emit("added",this),this.emit("childAdded",e,this,i),e},t.prototype.swapChildren=function(e,i){if(e!==i){var n=this.getChildIndex(e),s=this.getChildIndex(i);this.children[n]=i,this.children[s]=e,this.onChildrenChange(n<s?n:s)}},t.prototype.getChildIndex=function(e){var i=this.children.indexOf(e);if(i===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return i},t.prototype.setChildIndex=function(e,i){if(i<0||i>=this.children.length)throw new Error("The index "+i+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(e);di(this.children,n,1),this.children.splice(i,0,e),this.onChildrenChange(i)},t.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Index ("+e+") does not exist.");return this.children[e]},t.prototype.removeChild=function(){for(var e=arguments,i=[],n=0;n<arguments.length;n++)i[n]=e[n];if(i.length>1)for(var s=0;s<i.length;s++)this.removeChild(i[s]);else{var o=i[0],a=this.children.indexOf(o);if(a===-1)return null;o.parent=null,o.transform._parentID=-1,di(this.children,a,1),this._boundsID++,this.onChildrenChange(a),o.emit("removed",this),this.emit("childRemoved",o,this,a)}return i[0]},t.prototype.removeChildAt=function(e){var i=this.getChildAt(e);return i.parent=null,i.transform._parentID=-1,di(this.children,e,1),this._boundsID++,this.onChildrenChange(e),i.emit("removed",this),this.emit("childRemoved",i,this,e),i},t.prototype.removeChildren=function(e,i){e===void 0&&(e=0),i===void 0&&(i=this.children.length);var n=e,s=i,o=s-n,a;if(o>0&&o<=s){a=this.children.splice(n,o);for(var u=0;u<a.length;++u)a[u].parent=null,a[u].transform&&(a[u].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(var u=0;u<a.length;++u)a[u].emit("removed",this),this.emit("childRemoved",a[u],this,u);return a}else if(o===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},t.prototype.sortChildren=function(){for(var e=!1,i=0,n=this.children.length;i<n;++i){var s=this.children[i];s._lastSortedIndex=i,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(qp),this.sortDirty=!1},t.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var e=0,i=this.children.length;e<i;++e){var n=this.children[e];n.visible&&n.updateTransform()}},t.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var e=0;e<this.children.length;e++){var i=this.children[e];if(!(!i.visible||!i.renderable))if(i.calculateBounds(),i._mask){var n=i._mask.isMaskData?i._mask.maskObject:i._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(i._bounds,n._bounds)):this._bounds.addBounds(i._bounds)}else i.filterArea?this._bounds.addBoundsArea(i._bounds,i.filterArea):this._bounds.addBounds(i._bounds)}this._bounds.updateID=this._boundsID},t.prototype.getLocalBounds=function(e,i){i===void 0&&(i=!1);var n=r.prototype.getLocalBounds.call(this,e);if(!i)for(var s=0,o=this.children.length;s<o;++s){var a=this.children[s];a.visible&&a.updateTransform()}return n},t.prototype._calculateBounds=function(){},t.prototype._renderWithCulling=function(e){var i=e.renderTexture.sourceFrame;if(i.width>0&&i.height>0){var n,s;if(this.cullArea?(n=this.cullArea,s=this.worldTransform):this._render!==t.prototype._render&&(n=this.getBounds(!0)),n&&i.intersects(n,s))this._render(e);else if(this.cullArea)return;for(var o=0,a=this.children.length;o<a;++o){var u=this.children[o],l=u.cullable;u.cullable=l||!this.cullArea,u.render(e),u.cullable=l}}},t.prototype.render=function(e){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(var i=0,n=this.children.length;i<n;++i)this.children[i].render(e)}},t.prototype.renderAdvanced=function(e){var i=this.filters,n=this._mask;if(i){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var s=0;s<i.length;s++)i[s].enabled&&this._enabledFilters.push(i[s])}var o=i&&this._enabledFilters&&this._enabledFilters.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==K.NONE));if(o&&e.batch.flush(),i&&this._enabledFilters&&this._enabledFilters.length&&e.filter.push(this,this._enabledFilters),n&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(var s=0,a=this.children.length;s<a;++s)this.children[s].render(e)}o&&e.batch.flush(),n&&e.mask.pop(this),i&&this._enabledFilters&&this._enabledFilters.length&&e.filter.pop()},t.prototype._render=function(e){},t.prototype.destroy=function(e){r.prototype.destroy.call(this),this.sortDirty=!1;var i=typeof e=="boolean"?e:e&&e.children,n=this.removeChildren(0,this.children.length);if(i)for(var s=0;s<n.length;++s)n[s].destroy(e)},Object.defineProperty(t.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var i=this.getLocalBounds().width;i!==0?this.scale.x=e/i:this.scale.x=1,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var i=this.getLocalBounds().height;i!==0?this.scale.y=e/i:this.scale.y=1,this._height=e},enumerable:!1,configurable:!0}),t}(Lr);Ii.prototype.containerUpdateTransform=Ii.prototype.updateTransform;/*!
 * @pixi/app - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/app is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Kp=function(){function r(){}return r.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){!e._resizeTo||(e.cancelResize(),e._resizeId=requestAnimationFrame(function(){return e.resize()}))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(!!e._resizeTo){e.cancelResize();var i,n;if(e._resizeTo===globalThis.window)i=globalThis.innerWidth,n=globalThis.innerHeight;else{var s=e._resizeTo,o=s.clientWidth,a=s.clientHeight;i=o,n=a}e.renderer.resize(i,n)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},r.destroy=function(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},r.extension=At.Application,r}(),Rs=function(){function r(t){var e=this;this.stage=new Ii,t=Object.assign({forceCanvas:!1},t),this.renderer=Gp(t),r._plugins.forEach(function(i){i.init.call(e,t)})}return r.registerPlugin=function(t){De("6.5.0","Application.registerPlugin() is deprecated, use extensions.add()"),Xr.add({type:At.Application,ref:t})},r.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(r.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),r.prototype.destroy=function(t,e){var i=this,n=r._plugins.slice(0);n.reverse(),n.forEach(function(s){s.destroy.call(i)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null},r._plugins=[],r}();Xr.handleByList(At.Application,Rs._plugins);Xr.add(Kp);/*!
 * @pixi/interaction - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/interaction is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ha=function(){function r(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new dt,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(r.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),r.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)},r.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},r.prototype.reset=function(){this.isPrimary=!1},r}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var rs=function(r,t){return rs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},rs(r,t)};function Zp(r,t){rs(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Jp=function(){function r(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return r.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},r.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},r}(),xn=function(){function r(t){this._pointerId=t,this._flags=r.FLAGS.NONE}return r.prototype._doSet=function(t,e){e?this._flags=this._flags|t:this._flags=this._flags&~t},Object.defineProperty(r.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"none",{get:function(){return this._flags===r.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"over",{get:function(){return(this._flags&r.FLAGS.OVER)!==0},set:function(t){this._doSet(r.FLAGS.OVER,t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rightDown",{get:function(){return(this._flags&r.FLAGS.RIGHT_DOWN)!==0},set:function(t){this._doSet(r.FLAGS.RIGHT_DOWN,t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"leftDown",{get:function(){return(this._flags&r.FLAGS.LEFT_DOWN)!==0},set:function(t){this._doSet(r.FLAGS.LEFT_DOWN,t)},enumerable:!1,configurable:!0}),r.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2}),r}(),Qp=function(){function r(){this._tempPoint=new dt}return r.prototype.recursiveFindHit=function(t,e,i,n,s){var o;if(!e||!e.visible)return!1;var a=t.data.global;s=e.interactive||s;var u=!1,l=s,h=!0;if(e.hitArea)n&&(e.worldTransform.applyInverse(a,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?u=!0:(n=!1,h=!1)),l=!1;else if(e._mask&&n){var c=e._mask.isMaskData?e._mask.maskObject:e._mask;c&&!(!((o=c.containsPoint)===null||o===void 0)&&o.call(c,a))&&(n=!1)}if(h&&e.interactiveChildren&&e.children)for(var f=e.children,d=f.length-1;d>=0;d--){var p=f[d],v=this.recursiveFindHit(t,p,i,n,l);if(v){if(!p.parent)continue;l=!1,v&&(t.target&&(n=!1),u=!0)}}return s&&(n&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(a)&&(u=!0),e.interactive&&(u&&!t.target&&(t.target=e),i&&i(t,e,!!u))),u},r.prototype.findHit=function(t,e,i,n){this.recursiveFindHit(t,e,i,n,!1)},r}(),tm={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(r){r?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};Lr.mixin(tm);var ai=1,ui={target:null,data:{global:null}},em=function(r){Zp(t,r);function t(e,i){var n=r.call(this)||this;return i=i||{},n.renderer=e,n.autoPreventDefault=i.autoPreventDefault!==void 0?i.autoPreventDefault:!0,n.interactionFrequency=i.interactionFrequency||10,n.mouse=new ha,n.mouse.identifier=ai,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[ai]=n.mouse,n.interactionDataPool=[],n.eventData=new Jp,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!("PointerEvent"in globalThis),n.supportsTouchEvents="ontouchstart"in globalThis,n.supportsPointerEvents=!!globalThis.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new Qp,n._tempDisplayObject=new qu,n._eventListenerOptions={capture:!0,passive:!1},n._useSystemTicker=i.useSystemTicker!==void 0?i.useSystemTicker:!0,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return Object.defineProperty(t.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(e){this._useSystemTicker=e,e?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),t.prototype.hitTest=function(e,i){return ui.target=null,ui.data.global=e,i||(i=this.lastObjectRendered),this.processInteractive(ui,i,null,!0),ui.target},t.prototype.setTargetElement=function(e,i){i===void 0&&(i=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=e,this.resolution=i,this.addEvents(),this.addTickerListener()},t.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Rt.system.add(this.tickerUpdate,this,sr.INTERACTION),this.tickerAdded=!0)},t.prototype.removeTickerListener=function(){!this.tickerAdded||(Rt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},t.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var e=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none"),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},t.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var e=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},t.prototype.tickerUpdate=function(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},t.prototype.update=function(){if(!!this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var e in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var i=this.activeInteractionData[e];if(i.originalEvent&&i.pointerType!=="touch"){var n=this.configureInteractionEventForDOMEvent(this.eventData,i.originalEvent,i);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},t.prototype.setCursorMode=function(e){e=e||"default";var i=!0;if(globalThis.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(i=!1),this.currentCursorMode!==e){this.currentCursorMode=e;var n=this.cursorStyles[e];if(n)switch(typeof n){case"string":i&&(this.interactionDOMElement.style.cursor=n);break;case"function":n(e);break;case"object":i&&Object.assign(this.interactionDOMElement.style,n);break}else i&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.interactionDOMElement.style.cursor=e)}},t.prototype.dispatchEvent=function(e,i,n){(!n.stopPropagationHint||e===n.stopsPropagatingAt)&&(n.currentTarget=e,n.type=i,e.emit(i,n),e[i]&&e[i](n))},t.prototype.delayDispatchEvent=function(e,i,n){this.delayedEvents.push({displayObject:e,eventString:i,eventData:n})},t.prototype.mapPositionToPoint=function(e,i,n){var s;this.interactionDOMElement.parentElement?s=this.interactionDOMElement.getBoundingClientRect():s={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var o=1/this.resolution;e.x=(i-s.left)*(this.interactionDOMElement.width/s.width)*o,e.y=(n-s.top)*(this.interactionDOMElement.height/s.height)*o},t.prototype.processInteractive=function(e,i,n,s){var o=this.search.findHit(e,i,n,s),a=this.delayedEvents;if(!a.length)return o;e.stopPropagationHint=!1;var u=a.length;this.delayedEvents=[];for(var l=0;l<u;l++){var h=a[l],c=h.displayObject,f=h.eventString,d=h.eventData;d.stopsPropagatingAt===c&&(d.stopPropagationHint=!0),this.dispatchEvent(c,f,d)}return o},t.prototype.onPointerDown=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e);if(this.autoPreventDefault&&i[0].isNormalized){var n=e.cancelable||!("cancelable"in e);n&&e.preventDefault()}for(var s=i.length,o=0;o<s;o++){var a=i[o],u=this.getInteractionDataForPointerId(a),l=this.configureInteractionEventForDOMEvent(this.eventData,a,u);if(l.data.originalEvent=e,this.processInteractive(l,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",l),a.pointerType==="touch")this.emit("touchstart",l);else if(a.pointerType==="mouse"||a.pointerType==="pen"){var h=a.button===2;this.emit(h?"rightdown":"mousedown",this.eventData)}}}},t.prototype.processPointerDown=function(e,i,n){var s=e.data,o=e.data.identifier;if(n){if(i.trackedPointers[o]||(i.trackedPointers[o]=new xn(o)),this.dispatchEvent(i,"pointerdown",e),s.pointerType==="touch")this.dispatchEvent(i,"touchstart",e);else if(s.pointerType==="mouse"||s.pointerType==="pen"){var a=s.button===2;a?i.trackedPointers[o].rightDown=!0:i.trackedPointers[o].leftDown=!0,this.dispatchEvent(i,a?"rightdown":"mousedown",e)}}},t.prototype.onPointerComplete=function(e,i,n){var s=this.normalizeToPointerData(e),o=s.length,a=e.target;e.composedPath&&e.composedPath().length>0&&(a=e.composedPath()[0]);for(var u=a!==this.interactionDOMElement?"outside":"",l=0;l<o;l++){var h=s[l],c=this.getInteractionDataForPointerId(h),f=this.configureInteractionEventForDOMEvent(this.eventData,h,c);if(f.data.originalEvent=e,this.processInteractive(f,this.lastObjectRendered,n,i||!u),this.emit(i?"pointercancel":"pointerup"+u,f),h.pointerType==="mouse"||h.pointerType==="pen"){var d=h.button===2;this.emit(d?"rightup"+u:"mouseup"+u,f)}else h.pointerType==="touch"&&(this.emit(i?"touchcancel":"touchend"+u,f),this.releaseInteractionDataForPointerId(h.pointerId))}},t.prototype.onPointerCancel=function(e){this.supportsTouchEvents&&e.pointerType==="touch"||this.onPointerComplete(e,!0,this.processPointerCancel)},t.prototype.processPointerCancel=function(e,i){var n=e.data,s=e.data.identifier;i.trackedPointers[s]!==void 0&&(delete i.trackedPointers[s],this.dispatchEvent(i,"pointercancel",e),n.pointerType==="touch"&&this.dispatchEvent(i,"touchcancel",e))},t.prototype.onPointerUp=function(e){this.supportsTouchEvents&&e.pointerType==="touch"||this.onPointerComplete(e,!1,this.processPointerUp)},t.prototype.processPointerUp=function(e,i,n){var s=e.data,o=e.data.identifier,a=i.trackedPointers[o],u=s.pointerType==="touch",l=s.pointerType==="mouse"||s.pointerType==="pen",h=!1;if(l){var c=s.button===2,f=xn.FLAGS,d=c?f.RIGHT_DOWN:f.LEFT_DOWN,p=a!==void 0&&a.flags&d;n?(this.dispatchEvent(i,c?"rightup":"mouseup",e),p&&(this.dispatchEvent(i,c?"rightclick":"click",e),h=!0)):p&&this.dispatchEvent(i,c?"rightupoutside":"mouseupoutside",e),a&&(c?a.rightDown=!1:a.leftDown=!1)}n?(this.dispatchEvent(i,"pointerup",e),u&&this.dispatchEvent(i,"touchend",e),a&&((!l||h)&&this.dispatchEvent(i,"pointertap",e),u&&(this.dispatchEvent(i,"tap",e),a.over=!1))):a&&(this.dispatchEvent(i,"pointerupoutside",e),u&&this.dispatchEvent(i,"touchendoutside",e)),a&&a.none&&delete i.trackedPointers[o]},t.prototype.onPointerMove=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e);(i[0].pointerType==="mouse"||i[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var n=i.length,s=0;s<n;s++){var o=i[s],a=this.getInteractionDataForPointerId(o),u=this.configureInteractionEventForDOMEvent(this.eventData,o,a);u.data.originalEvent=e,this.processInteractive(u,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",u),o.pointerType==="touch"&&this.emit("touchmove",u),(o.pointerType==="mouse"||o.pointerType==="pen")&&this.emit("mousemove",u)}i[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},t.prototype.processPointerMove=function(e,i,n){var s=e.data,o=s.pointerType==="touch",a=s.pointerType==="mouse"||s.pointerType==="pen";a&&this.processPointerOverOut(e,i,n),(!this.moveWhenInside||n)&&(this.dispatchEvent(i,"pointermove",e),o&&this.dispatchEvent(i,"touchmove",e),a&&this.dispatchEvent(i,"mousemove",e))},t.prototype.onPointerOut=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e),n=i[0];n.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,this.processInteractive(o,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",o),n.pointerType==="mouse"||n.pointerType==="pen"?this.emit("mouseout",o):this.releaseInteractionDataForPointerId(s.identifier)}},t.prototype.processPointerOverOut=function(e,i,n){var s=e.data,o=e.data.identifier,a=s.pointerType==="mouse"||s.pointerType==="pen",u=i.trackedPointers[o];n&&!u&&(u=i.trackedPointers[o]=new xn(o)),u!==void 0&&(n&&this.mouseOverRenderer?(u.over||(u.over=!0,this.delayDispatchEvent(i,"pointerover",e),a&&this.delayDispatchEvent(i,"mouseover",e)),a&&this.cursor===null&&(this.cursor=i.cursor)):u.over&&(u.over=!1,this.dispatchEvent(i,"pointerout",this.eventData),a&&this.dispatchEvent(i,"mouseout",e),u.none&&delete i.trackedPointers[o]))},t.prototype.onPointerOver=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e),n=i[0],s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,n.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",o),(n.pointerType==="mouse"||n.pointerType==="pen")&&this.emit("mouseover",o)}},t.prototype.getInteractionDataForPointerId=function(e){var i=e.pointerId,n;return i===ai||e.pointerType==="mouse"?n=this.mouse:this.activeInteractionData[i]?n=this.activeInteractionData[i]:(n=this.interactionDataPool.pop()||new ha,n.identifier=i,this.activeInteractionData[i]=n),n.copyEvent(e),n},t.prototype.releaseInteractionDataForPointerId=function(e){var i=this.activeInteractionData[e];i&&(delete this.activeInteractionData[e],i.reset(),this.interactionDataPool.push(i))},t.prototype.configureInteractionEventForDOMEvent=function(e,i,n){return e.data=n,this.mapPositionToPoint(n.global,i.clientX,i.clientY),i.pointerType==="touch"&&(i.globalX=n.global.x,i.globalY=n.global.y),n.originalEvent=i,e.reset(),e},t.prototype.normalizeToPointerData=function(e){var i=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(var n=0,s=e.changedTouches.length;n<s;n++){var o=e.changedTouches[n];typeof o.button>"u"&&(o.button=e.touches.length?1:0),typeof o.buttons>"u"&&(o.buttons=e.touches.length?1:0),typeof o.isPrimary>"u"&&(o.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,i.push(o)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){var a=e;typeof a.isPrimary>"u"&&(a.isPrimary=!0),typeof a.width>"u"&&(a.width=1),typeof a.height>"u"&&(a.height=1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="mouse"),typeof a.pointerId>"u"&&(a.pointerId=ai),typeof a.pressure>"u"&&(a.pressure=.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),a.isNormalized=!0,i.push(a)}else i.push(e);return i},t.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},t.extension={name:"interaction",type:[At.RendererPlugin,At.CanvasRendererPlugin]},t}(he),ge=Math.pow,X=(r,t,e)=>new Promise((i,n)=>{var s=u=>{try{a(e.next(u))}catch(l){n(l)}},o=u=>{try{a(e.throw(u))}catch(l){n(l)}},a=u=>u.done?i(u.value):Promise.resolve(u.value).then(s,o);a((e=e.apply(r,t)).next())});const ca=2,fa=2;var Br;(r=>{r.supportMoreMaskDivisions=!0,r.setOpacityFromMotion=!1})(Br||(Br={}));var st;(r=>{r.LOG_LEVEL_VERBOSE=0,r.LOG_LEVEL_WARNING=1,r.LOG_LEVEL_ERROR=2,r.LOG_LEVEL_NONE=999,r.logLevel=r.LOG_LEVEL_WARNING,r.sound=!0,r.motionSync=!0,r.motionFadingDuration=500,r.idleMotionFadingDuration=2e3,r.expressionFadingDuration=500,r.preserveExpressionOnMotion=!0,r.cubism4=Br})(st||(st={}));const L={log(r,...t){st.logLevel<=st.LOG_LEVEL_VERBOSE&&console.log(`[${r}]`,...t)},warn(r,...t){st.logLevel<=st.LOG_LEVEL_WARNING&&console.warn(`[${r}]`,...t)},error(r,...t){st.logLevel<=st.LOG_LEVEL_ERROR&&console.error(`[${r}]`,...t)}};function Ci(r,t,e){return r<t?t:r>e?e:r}function rm(r,t){return Math.random()*(t-r)+r}function fr(r,t,e,i,n){const s=t[i];s!==null&&typeof s===r&&(e[n]=s)}function dr(r,t,e,i,n){const s=t[i];Array.isArray(s)&&(e[n]=s.filter(o=>o!==null&&typeof o===r))}function Ku(r,t){t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{i!=="constructor"&&Object.defineProperty(r.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i))})})}function im(r){let t=r.lastIndexOf("/");return t!=-1&&(r=r.slice(0,t)),t=r.lastIndexOf("/"),t!==-1&&(r=r.slice(t+1)),r}function nm(r,t){const e=r.indexOf(t);e!==-1&&r.splice(e,1)}class Fs extends he{constructor(t,e){super(),this.expressions=[],this.reserveExpressionIndex=-1,this.destroyed=!1,this.settings=t,this.tag=`ExpressionManager(${t.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(t){return X(this,null,function*(){if(!this.definitions[t]){L.warn(this.tag,`Undefined expression at [${t}]`);return}if(this.expressions[t]===null){L.warn(this.tag,`Cannot set expression at [${t}] because it's already failed in loading.`);return}if(this.expressions[t])return this.expressions[t];const e=yield this._loadExpression(t);return this.expressions[t]=e,e})}_loadExpression(t){throw new Error("Not implemented.")}setRandomExpression(){return X(this,null,function*(){if(this.definitions.length){const t=[];for(let e=0;e<this.definitions.length;e++)this.expressions[e]!==null&&this.expressions[e]!==this.currentExpression&&e!==this.reserveExpressionIndex&&t.push(e);if(t.length){const e=Math.floor(Math.random()*t.length);return this.setExpression(e)}}return!1})}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(t){return X(this,null,function*(){if(typeof t!="number"&&(t=this.getExpressionIndex(t)),!(t>-1&&t<this.definitions.length)||t===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=t;const e=yield this.loadExpression(t);return!e||this.reserveExpressionIndex!==t?!1:(this.reserveExpressionIndex=-1,this.currentExpression=e,this._setExpression(e),!0)})}update(t,e){return this.isFinished()?!1:this.updateParameters(t,e)}destroy(){this.destroyed=!0,this.emit("destroy");const t=this;t.definitions=void 0,t.expressions=void 0}}const da=.01,sm=40/7.5,om=1/(.15*1e3);class am{constructor(){this.targetX=0,this.targetY=0,this.x=0,this.y=0,this.vx=0,this.vy=0}focus(t,e,i=!1){this.targetX=Ci(t,-1,1),this.targetY=Ci(e,-1,1),i&&(this.x=this.targetX,this.y=this.targetY)}update(t){const e=this.targetX-this.x,i=this.targetY-this.y;if(Math.abs(e)<da&&Math.abs(i)<da)return;const n=Math.sqrt(ge(e,2)+ge(i,2)),s=sm/(1e3/t);let o=s*(e/n)-this.vx,a=s*(i/n)-this.vy;const u=Math.sqrt(ge(o,2)+ge(a,2)),l=s*om*t;u>l&&(o*=l/u,a*=l/u),this.vx+=o,this.vy+=a;const h=Math.sqrt(ge(this.vx,2)+ge(this.vy,2)),c=.5*(Math.sqrt(ge(l,2)+8*l*n)-l);h>c&&(this.vx*=c/h,this.vy*=c/h),this.x+=this.vx,this.y+=this.vy}}class Ni{constructor(t){this.json=t;let e=t.url;if(typeof e!="string")throw new TypeError("The `url` field in settings JSON must be defined as a string.");this.url=e,this.name=im(this.url)}resolveURL(t){return Bi.resolve(this.url,t)}replaceFiles(t){this.moc=t(this.moc,"moc"),this.pose!==void 0&&(this.pose=t(this.pose,"pose")),this.physics!==void 0&&(this.physics=t(this.physics,"physics"));for(let e=0;e<this.textures.length;e++)this.textures[e]=t(this.textures[e],`textures[${e}]`)}getDefinedFiles(){const t=[];return this.replaceFiles(e=>(t.push(e),e)),t}validateFiles(t){const e=(s,o)=>{const a=this.resolveURL(s);if(!t.includes(a)){if(o)throw new Error(`File "${s}" is defined in settings, but doesn't exist in given files`);return!1}return!0};return[this.moc,...this.textures].forEach(s=>e(s,!0)),this.getDefinedFiles().filter(s=>e(s,!1))}}var is=(r=>(r[r.NONE=0]="NONE",r[r.IDLE=1]="IDLE",r[r.NORMAL=2]="NORMAL",r[r.FORCE=3]="FORCE",r))(is||{});class um{constructor(){this.debug=!1,this.currentPriority=0,this.reservePriority=0}reserve(t,e,i){if(i<=0)return L.log(this.tag,"Cannot start a motion with MotionPriority.NONE."),!1;if(t===this.currentGroup&&e===this.currentIndex)return L.log(this.tag,"Motion is already playing.",this.dump(t,e)),!1;if(t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex)return L.log(this.tag,"Motion is already reserved.",this.dump(t,e)),!1;if(i===1){if(this.currentPriority!==0)return L.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(t,e)),!1;if(this.reservedIdleGroup!==void 0)return L.log(this.tag,"Cannot start idle motion because another idle motion has reserved.",this.dump(t,e)),!1;this.setReservedIdle(t,e)}else{if(i<3){if(i<=this.currentPriority)return L.log(this.tag,"Cannot start motion because another motion is playing as an equivalent or higher priority.",this.dump(t,e)),!1;if(i<=this.reservePriority)return L.log(this.tag,"Cannot start motion because another motion has reserved as an equivalent or higher priority.",this.dump(t,e)),!1}this.setReserved(t,e,i)}return!0}start(t,e,i,n){if(n===1){if(this.setReservedIdle(void 0,void 0),this.currentPriority!==0)return L.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(e,i)),!1}else{if(e!==this.reservedGroup||i!==this.reservedIndex)return L.log(this.tag,"Cannot start motion because another motion has taken the place.",this.dump(e,i)),!1;this.setReserved(void 0,void 0,0)}return t?(this.setCurrent(e,i,n),!0):!1}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(t,e,i){this.currentPriority=i,this.currentGroup=t,this.currentIndex=e}setReserved(t,e,i){this.reservePriority=i,this.reservedGroup=t,this.reservedIndex=e}setReservedIdle(t,e){this.reservedIdleGroup=t,this.reservedIdleIndex=e}isActive(t,e){return t===this.currentGroup&&e===this.currentIndex||t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return this.currentGroup===void 0&&this.reservedIdleGroup===void 0}shouldOverrideExpression(){return!st.preserveExpressionOnMotion&&this.currentPriority>1}dump(t,e){if(this.debug){const i=["currentPriority","reservePriority","currentGroup","currentIndex","reservedGroup","reservedIndex","reservedIdleGroup","reservedIdleIndex"];return`
<Requested> group = "${t}", index = ${e}
`+i.map(n=>"["+n+"] "+this[n]).join(`
`)}return""}}const lm="SoundManager",hm=.5;class Ae{static get volume(){return this._volume}static set volume(t){this._volume=(t>1?1:t<0?0:t)||0,this.audios.forEach(e=>e.volume=this._volume)}static add(t,e,i){const n=new Audio(t);return n.volume=this._volume,n.preload="auto",n.addEventListener("ended",()=>{this.dispose(n),e?.()}),n.addEventListener("error",s=>{this.dispose(n),L.warn(lm,`Error occurred on "${t}"`,s.error),i?.(s.error)}),this.audios.push(n),n}static play(t){return new Promise((e,i)=>{var n;(n=t.play())==null||n.catch(s=>{t.dispatchEvent(new ErrorEvent("error",{error:s})),i(s)}),t.readyState===t.HAVE_ENOUGH_DATA?e():t.addEventListener("canplaythrough",e)})}static dispose(t){t.pause(),t.removeAttribute("src"),nm(this.audios,t)}static destroy(){for(let t=this.audios.length-1;t>=0;t--)this.dispose(this.audios[t])}}Ae.audios=[];Ae._volume=hm;var Zu=(r=>(r.ALL="ALL",r.IDLE="IDLE",r.NONE="NONE",r))(Zu||{});class ki extends he{constructor(t,e){super(),this.motionGroups={},this.state=new um,this.playing=!1,this.destroyed=!1,this.settings=t,this.tag=`MotionManager(${t.name})`,this.state.tag=this.tag}init(t){t?.idleMotionGroup&&(this.groups.idle=t.idleMotionGroup),this.setupMotions(t),this.stopAllMotions()}setupMotions(t){for(const i of Object.keys(this.definitions))this.motionGroups[i]=[];let e;switch(t?.motionPreload){case"NONE":return;case"ALL":e=Object.keys(this.definitions);break;case"IDLE":default:e=[this.groups.idle];break}for(const i of e)if(this.definitions[i])for(let n=0;n<this.definitions[i].length;n++)this.loadMotion(i,n).then()}loadMotion(t,e){return X(this,null,function*(){var i;if(!((i=this.definitions[t])!=null&&i[e])){L.warn(this.tag,`Undefined motion at "${t}"[${e}]`);return}if(this.motionGroups[t][e]===null){L.warn(this.tag,`Cannot start motion at "${t}"[${e}] because it's already failed in loading.`);return}if(this.motionGroups[t][e])return this.motionGroups[t][e];const n=yield this._loadMotion(t,e);if(!this.destroyed)return this.motionGroups[t][e]=n??null,n})}_loadMotion(t,e){throw new Error("Not implemented.")}startMotion(t,e){return X(this,arguments,function*(i,n,s=is.NORMAL){var o;if(!this.state.reserve(i,n,s))return!1;const a=(o=this.definitions[i])==null?void 0:o[n];if(!a)return!1;this.currentAudio&&Ae.dispose(this.currentAudio);let u;if(st.sound){const h=this.getSoundFile(a);if(h)try{u=Ae.add(this.settings.resolveURL(h),()=>this.currentAudio=void 0,()=>this.currentAudio=void 0),this.currentAudio=u}catch(c){L.warn(this.tag,"Failed to create audio",h,c)}}const l=yield this.loadMotion(i,n);if(u){const h=Ae.play(u).catch(c=>L.warn(this.tag,"Failed to play audio",u.src,c));st.motionSync&&(yield h)}return this.state.start(l,i,n,s)?(L.log(this.tag,"Start motion:",this.getMotionName(a)),this.emit("motionStart",i,n,u),this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),this.playing=!0,this._startMotion(l),!0):(u&&(Ae.dispose(u),this.currentAudio=void 0),!1)})}startRandomMotion(t,e){return X(this,null,function*(){const i=this.definitions[t];if(i?.length){const n=[];for(let s=0;s<i.length;s++)this.motionGroups[t][s]!==null&&!this.state.isActive(t,s)&&n.push(s);if(n.length){const s=Math.floor(Math.random()*n.length);return this.startMotion(t,n[s],e)}}return!1})}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.currentAudio&&(Ae.dispose(this.currentAudio),this.currentAudio=void 0)}update(t,e){var i;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.shouldOverrideExpression()&&((i=this.expressionManager)==null||i.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,is.IDLE)),this.updateParameters(t,e)}destroy(){var t;this.destroyed=!0,this.emit("destroy"),this.stopAllMotions(),(t=this.expressionManager)==null||t.destroy();const e=this;e.definitions=void 0,e.motionGroups=void 0}}const cm={x:0,y:0,width:0,height:0};class Ju extends he{constructor(){super(...arguments),this.focusController=new am,this.originalWidth=0,this.originalHeight=0,this.width=0,this.height=0,this.localTransform=new ot,this.drawingMatrix=new ot,this.hitAreas={},this.textureFlipY=!1,this.viewport=[0,0,0,0],this.destroyed=!1}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const t=this,e=this.getSize();t.originalWidth=e[0],t.originalHeight=e[1];const i=Object.assign({width:ca,height:fa},this.getLayout());this.localTransform.scale(i.width/ca,i.height/fa),t.width=this.originalWidth*this.localTransform.a,t.height=this.originalHeight*this.localTransform.d;const n=i.x!==void 0&&i.x-i.width/2||i.centerX!==void 0&&i.centerX||i.left!==void 0&&i.left-i.width/2||i.right!==void 0&&i.right+i.width/2||0,s=i.y!==void 0&&i.y-i.height/2||i.centerY!==void 0&&i.centerY||i.top!==void 0&&i.top-i.height/2||i.bottom!==void 0&&i.bottom+i.height/2||0;this.localTransform.translate(this.width*n,-this.height*s)}setupHitAreas(){const t=this.getHitAreaDefs().filter(e=>e.index>=0);for(const e of t)this.hitAreas[e.name]=e}hitTest(t,e){return Object.keys(this.hitAreas).filter(i=>this.isHit(i,t,e))}isHit(t,e,i){if(!this.hitAreas[t])return!1;const n=this.hitAreas[t].index,s=this.getDrawableBounds(n,cm);return s.x<=e&&e<=s.x+s.width&&s.y<=i&&i<=s.y+s.height}getDrawableBounds(t,e){const i=this.getDrawableVertices(t);let n=i[0],s=i[0],o=i[1],a=i[1];for(let u=0;u<i.length;u+=2){const l=i[u],h=i[u+1];n=Math.min(l,n),s=Math.max(l,s),o=Math.min(h,o),a=Math.max(h,a)}return e??(e={}),e.x=n,e.y=o,e.width=s-n,e.height=a-o,e}updateTransform(t){this.drawingMatrix.copyFrom(t).append(this.localTransform)}update(t,e){this.focusController.update(t)}destroy(){this.destroyed=!0,this.emit("destroy"),this.motionManager.destroy(),this.motionManager=void 0}}const fm="XHRLoader";class pa extends Error{constructor(t,e,i,n=!1){super(t),this.url=e,this.status=i,this.aborted=n}}const ft=class{static createXHR(r,t,e,i,n){const s=new XMLHttpRequest;if(ft.allXhrSet.add(s),r){let o=ft.xhrMap.get(r);o?o.add(s):(o=new Set([s]),ft.xhrMap.set(r,o)),r.listeners("destroy").includes(ft.cancelXHRs)||r.once("destroy",ft.cancelXHRs)}return s.open("GET",t),s.responseType=e,s.onload=()=>{(s.status===200||s.status===0)&&s.response?i(s.response):s.onerror()},s.onerror=()=>{L.warn(fm,`Failed to load resource as ${s.responseType} (Status ${s.status}): ${t}`),n(new pa("Network error.",t,s.status))},s.onabort=()=>n(new pa("Aborted.",t,s.status,!0)),s.onloadend=()=>{var o;ft.allXhrSet.delete(s),r&&((o=ft.xhrMap.get(r))==null||o.delete(s))},s}static cancelXHRs(){var r;(r=ft.xhrMap.get(this))==null||r.forEach(t=>{t.abort(),ft.allXhrSet.delete(t)}),ft.xhrMap.delete(this)}static release(){ft.allXhrSet.forEach(r=>r.abort()),ft.allXhrSet.clear(),ft.xhrMap=new WeakMap}};let Ui=ft;Ui.xhrMap=new WeakMap;Ui.allXhrSet=new Set;Ui.loader=(r,t)=>new Promise((e,i)=>{ft.createXHR(r.target,r.settings?r.settings.resolveURL(r.url):r.url,r.type,s=>{r.result=s,e()},i).send()});function Qu(r,t){let e=-1;return i(0);function i(n,s){if(s)return Promise.reject(s);if(n<=e)return Promise.reject(new Error("next() called multiple times"));e=n;const o=r[n];if(!o)return Promise.resolve();try{return Promise.resolve(o(t,i.bind(null,n+1)))}catch(a){return Promise.reject(a)}}}class ue{static load(t){return Qu(this.middlewares,t).then(()=>t.result)}}ue.middlewares=[Ui.loader];function dm(r,t={}){var e;const i={resourceOptions:{crossorigin:t.crossOrigin}};if(pi.fromURL)return pi.fromURL(r,i).catch(o=>{if(o instanceof Error)throw o;const a=new Error("Texture loading error");throw a.event=o,a});i.resourceOptions.autoLoad=!1;const n=pi.from(r,i);if(n.baseTexture.valid)return Promise.resolve(n);const s=n.baseTexture.resource;return(e=s._live2d_load)!=null||(s._live2d_load=new Promise((o,a)=>{const u=l=>{s.source.removeEventListener("error",u);const h=new Error("Texture loading error");h.event=l,a(h)};s.source.addEventListener("error",u),s.load().then(()=>o(n)).catch(u)})),s._live2d_load}const ma="Live2DFactory",tl=(r,t)=>X(void 0,null,function*(){if(typeof r.source=="string"){const e=yield ue.load({url:r.source,type:"json",target:r.live2dModel});e.url=r.source,r.source=e,r.live2dModel.emit("settingsJSONLoaded",e)}return t()}),el=(r,t)=>X(void 0,null,function*(){if(r.source instanceof Ni)return r.settings=r.source,t();if(typeof r.source=="object"){const e=G.findRuntime(r.source);if(e){const i=e.createModelSettings(r.source);return r.settings=i,r.live2dModel.emit("settingsLoaded",i),t()}}throw new TypeError("Unknown settings format.")}),rl=(r,t)=>{if(r.settings){const e=G.findRuntime(r.settings);if(e)return e.ready().then(t)}return t()},il=(r,t)=>X(void 0,null,function*(){yield t();const e=r.internalModel;if(e){const i=r.settings,n=G.findRuntime(i);if(n){const s=[];i.pose&&s.push(ue.load({settings:i,url:i.pose,type:"json",target:e}).then(o=>{e.pose=n.createPose(e.coreModel,o),r.live2dModel.emit("poseLoaded",e.pose)}).catch(o=>{r.live2dModel.emit("poseLoadError",o),L.warn(ma,"Failed to load pose.",o)})),i.physics&&s.push(ue.load({settings:i,url:i.physics,type:"json",target:e}).then(o=>{e.physics=n.createPhysics(e.coreModel,o),r.live2dModel.emit("physicsLoaded",e.physics)}).catch(o=>{r.live2dModel.emit("physicsLoadError",o),L.warn(ma,"Failed to load physics.",o)})),s.length&&(yield Promise.all(s))}}}),nl=(r,t)=>X(void 0,null,function*(){if(r.settings){const e=r.live2dModel,i=r.settings.textures.map(n=>{const s=r.settings.resolveURL(n);return dm(s,{crossOrigin:r.options.crossOrigin})});if(yield t(),r.internalModel)e.internalModel=r.internalModel,e.emit("modelLoaded",r.internalModel);else throw new TypeError("Missing internal model.");e.textures=yield Promise.all(i),e.emit("textureLoaded",e.textures)}else throw new TypeError("Missing settings.")}),sl=(r,t)=>X(void 0,null,function*(){const e=r.settings;if(e instanceof Ni){const i=G.findRuntime(e);if(!i)throw new TypeError("Unknown model settings.");const n=yield ue.load({settings:e,url:e.moc,type:"arraybuffer",target:r.live2dModel});if(!i.isValidMoc(n))throw new Error("Invalid moc data");const s=i.createCoreModel(n);return r.internalModel=i.createInternalModel(s,e,r.options),t()}throw new TypeError("Missing settings.")}),it=class{static registerRuntime(r){it.runtimes.push(r),it.runtimes.sort((t,e)=>e.version-t.version)}static findRuntime(r){for(const t of it.runtimes)if(t.test(r))return t}static setupLive2DModel(r,t,e){return X(this,null,function*(){const i=new Promise(o=>r.once("textureLoaded",o)),n=new Promise(o=>r.once("modelLoaded",o)),s=Promise.all([i,n]).then(()=>r.emit("ready"));yield Qu(it.live2DModelMiddlewares,{live2dModel:r,source:t,options:e||{}}),yield s,r.emit("load")})}static loadMotion(r,t,e){var i,n;const s=o=>r.emit("motionLoadError",t,e,o);try{const o=(i=r.definitions[t])==null?void 0:i[e];if(!o)return Promise.resolve(void 0);r.listeners("destroy").includes(it.releaseTasks)||r.once("destroy",it.releaseTasks);let a=it.motionTasksMap.get(r);a||(a={},it.motionTasksMap.set(r,a));let u=a[t];u||(u=[],a[t]=u);const l=r.getMotionFile(o);return(n=u[e])!=null||(u[e]=ue.load({url:l,settings:r.settings,type:r.motionDataType,target:r}).then(h=>{var c;const f=(c=it.motionTasksMap.get(r))==null?void 0:c[t];f&&delete f[e];const d=r.createMotion(h,t,o);return r.emit("motionLoaded",t,e,d),d}).catch(h=>{L.warn(r.tag,`Failed to load motion: ${l}
`,h),s(h)})),u[e]}catch(o){L.warn(r.tag,`Failed to load motion at "${t}"[${e}]
`,o),s(o)}return Promise.resolve(void 0)}static loadExpression(r,t){var e;const i=n=>r.emit("expressionLoadError",t,n);try{const n=r.definitions[t];if(!n)return Promise.resolve(void 0);r.listeners("destroy").includes(it.releaseTasks)||r.once("destroy",it.releaseTasks);let s=it.expressionTasksMap.get(r);s||(s=[],it.expressionTasksMap.set(r,s));const o=r.getExpressionFile(n);return(e=s[t])!=null||(s[t]=ue.load({url:o,settings:r.settings,type:"json",target:r}).then(a=>{const u=it.expressionTasksMap.get(r);u&&delete u[t];const l=r.createExpression(a,n);return r.emit("expressionLoaded",t,l),l}).catch(a=>{L.warn(r.tag,`Failed to load expression: ${o}
`,a),i(a)})),s[t]}catch(n){L.warn(r.tag,`Failed to load expression at [${t}]
`,n),i(n)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof ki?it.motionTasksMap.delete(this):it.expressionTasksMap.delete(this)}};let G=it;G.runtimes=[];G.urlToJSON=tl;G.jsonToSettings=el;G.waitUntilReady=rl;G.setupOptionals=il;G.setupEssentials=nl;G.createInternalModel=sl;G.live2DModelMiddlewares=[tl,el,rl,il,nl,sl];G.motionTasksMap=new WeakMap;G.expressionTasksMap=new WeakMap;ki.prototype._loadMotion=function(r,t){return G.loadMotion(this,r,t)};Fs.prototype._loadExpression=function(r){return G.loadExpression(this,r)};class pm{constructor(){this._autoInteract=!1}get autoInteract(){return this._autoInteract}set autoInteract(t){t!==this._autoInteract&&(t?this.on("pointertap",ga,this):this.off("pointertap",ga,this),this._autoInteract=t)}registerInteraction(t){t!==this.interactionManager&&(this.unregisterInteraction(),this._autoInteract&&t&&(this.interactionManager=t,t.on("pointermove",va,this)))}unregisterInteraction(){var t;this.interactionManager&&((t=this.interactionManager)==null||t.off("pointermove",va,this),this.interactionManager=void 0)}}function ga(r){this.tap(r.data.global.x,r.data.global.y)}function va(r){this.focus(r.data.global.x,r.data.global.y)}class mm extends Lu{}const wt=new dt,gm=new ot;let Zt;class Os extends Ii{constructor(t){super(),this.tag="Live2DModel(uninitialized)",this.textures=[],this.transform=new mm,this.anchor=new gr(this.onAnchorChange,this,0,0),this.glContextID=-1,this.elapsedTime=performance.now(),this.deltaTime=0,this._autoUpdate=!1,this.once("modelLoaded",()=>this.init(t))}static from(t,e){const i=new this(e);return G.setupLive2DModel(i,t,e).then(()=>i)}static fromSync(t,e){const i=new this(e);return G.setupLive2DModel(i,t,e).then(e?.onLoad).catch(e?.onError),i}static registerTicker(t){Zt=t}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){var e;Zt||(Zt=(e=window.PIXI)==null?void 0:e.Ticker),t?this._destroyed||(Zt?(Zt.shared.add(this.onTickerUpdate,this),this._autoUpdate=!0):L.warn(this.tag,"No Ticker registered, please call Live2DModel.registerTicker(Ticker).")):(Zt?.shared.remove(this.onTickerUpdate,this),this._autoUpdate=!1)}init(t){this.tag=`Live2DModel(${this.internalModel.settings.name})`;const e=Object.assign({autoUpdate:!0,autoInteract:!0},t);e.autoInteract&&(this.interactive=!0),this.autoInteract=e.autoInteract,this.autoUpdate=e.autoUpdate}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(t,e,i){return e===void 0?this.internalModel.motionManager.startRandomMotion(t,i):this.internalModel.motionManager.startMotion(t,e,i)}expression(t){return this.internalModel.motionManager.expressionManager?t===void 0?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(t):Promise.resolve(!1)}focus(t,e,i=!1){wt.x=t,wt.y=e,this.toModelPosition(wt,wt,!0);let n=wt.x/this.internalModel.originalWidth*2-1,s=wt.y/this.internalModel.originalHeight*2-1,o=Math.atan2(s,n);this.internalModel.focusController.focus(Math.cos(o),-Math.sin(o),i)}tap(t,e){const i=this.hitTest(t,e);i.length&&(L.log(this.tag,"Hit",i),this.emit("hit",i))}hitTest(t,e){return wt.x=t,wt.y=e,this.toModelPosition(wt,wt),this.internalModel.hitTest(wt.x,wt.y)}toModelPosition(t,e=t.clone(),i){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(t,e),this.internalModel.localTransform.applyInverse(e,e),e}containsPoint(t){return this.getBounds(!0).contains(t.x,t.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}onTickerUpdate(){this.update(Zt.shared.deltaMS)}update(t){this.deltaTime+=t,this.elapsedTime+=t}_render(t){this.registerInteraction(t.plugins.interaction),t.batch.reset(),t.geometry.reset(),t.shader.reset(),t.state.reset();let e=!1;this.glContextID!==t.CONTEXT_UID&&(this.glContextID=t.CONTEXT_UID,this.internalModel.updateWebGLContext(t.gl,this.glContextID),e=!0);for(let s=0;s<this.textures.length;s++){const o=this.textures[s];!o.valid||((e||!o.baseTexture._glTextures[this.glContextID])&&(t.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),t.texture.bind(o.baseTexture,0)),this.internalModel.bindTexture(s,o.baseTexture._glTextures[this.glContextID].texture),o.baseTexture.touched=t.textureGC.count)}const i=t.framebuffer.viewport;this.internalModel.viewport=[i.x,i.y,i.width,i.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const n=gm.copyFrom(t.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(n),this.internalModel.draw(t.gl),t.state.reset(),t.texture.reset()}destroy(t){this.emit("destroy"),this.autoUpdate=!1,this.unregisterInteraction(),t?.texture&&this.textures.forEach(e=>e.destroy(t.baseTexture)),this.internalModel.destroy(),super.destroy(t)}}Ku(Os,[pm]);const Ut=class{static resolveURL(r,t){var e;const i=(e=Ut.filesMap[r])==null?void 0:e[t];if(i===void 0)throw new Error("Cannot find this file from uploaded files: "+t);return i}static upload(r,t){return X(this,null,function*(){const e={};for(const i of t.getDefinedFiles()){const n=decodeURI(Bi.resolve(t.url,i)),s=r.find(o=>o.webkitRelativePath===n);s&&(e[i]=URL.createObjectURL(s))}Ut.filesMap[t._objectURL]=e})}static createSettings(r){return X(this,null,function*(){const t=r.find(o=>o.name.endsWith("model.json")||o.name.endsWith("model3.json"));if(!t)throw new TypeError("Settings file not found");const e=yield Ut.readText(t),i=JSON.parse(e);i.url=t.webkitRelativePath;const n=G.findRuntime(i);if(!n)throw new Error("Unknown settings JSON");const s=n.createModelSettings(i);return s._objectURL=URL.createObjectURL(t),s})}static readText(r){return X(this,null,function*(){return new Promise((t,e)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=e,i.readAsText(r,"utf8")})})}};let Ds=Ut;Ds.filesMap={};Ds.factory=(r,t)=>X(void 0,null,function*(){if(Array.isArray(r.source)&&r.source[0]instanceof File){const e=r.source;let i=e.settings;if(!i)i=yield Ut.createSettings(e);else if(!i._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings');i.validateFiles(e.map(n=>encodeURI(n.webkitRelativePath))),yield Ut.upload(e,i),i.resolveURL=function(n){return Ut.resolveURL(this._objectURL,n)},r.source=i,r.live2dModel.once("modelLoaded",n=>{n.once("destroy",function(){const s=this.settings._objectURL;if(URL.revokeObjectURL(s),Ut.filesMap[s])for(const o of Object.values(Ut.filesMap[s]))URL.revokeObjectURL(o);delete Ut.filesMap[s]})})}return t()});G.live2DModelMiddlewares.unshift(Ds.factory);const pt=class{static unzip(r,t){return X(this,null,function*(){const e=yield pt.getFilePaths(r),i=[];for(const s of t.getDefinedFiles()){const o=decodeURI(Bi.resolve(t.url,s));e.includes(o)&&i.push(o)}const n=yield pt.getFiles(r,i);for(let s=0;s<n.length;s++){const o=i[s],a=n[s];Object.defineProperty(a,"webkitRelativePath",{value:o})}return n})}static createSettings(r){return X(this,null,function*(){const e=(yield pt.getFilePaths(r)).find(o=>o.endsWith("model.json")||o.endsWith("model3.json"));if(!e)throw new Error("Settings file not found");const i=yield pt.readText(r,e);if(!i)throw new Error("Empty settings file: "+e);const n=JSON.parse(i);n.url=e;const s=G.findRuntime(n);if(!s)throw new Error("Unknown settings JSON");return s.createModelSettings(n)})}static zipReader(r,t){return X(this,null,function*(){throw new Error("Not implemented")})}static getFilePaths(r){return X(this,null,function*(){throw new Error("Not implemented")})}static getFiles(r,t){return X(this,null,function*(){throw new Error("Not implemented")})}static readText(r,t){return X(this,null,function*(){throw new Error("Not implemented")})}static releaseReader(r){}};let Gi=pt;Gi.ZIP_PROTOCOL="zip://";Gi.uid=0;Gi.factory=(r,t)=>X(void 0,null,function*(){const e=r.source;let i,n,s;if(typeof e=="string"&&(e.endsWith(".zip")||e.startsWith(pt.ZIP_PROTOCOL))?(e.startsWith(pt.ZIP_PROTOCOL)?i=e.slice(pt.ZIP_PROTOCOL.length):i=e,n=yield ue.load({url:i,type:"blob",target:r.live2dModel})):Array.isArray(e)&&e.length===1&&e[0]instanceof File&&e[0].name.endsWith(".zip")&&(n=e[0],i=URL.createObjectURL(n),s=e.settings),n){if(!n.size)throw new Error("Empty zip file");const o=yield pt.zipReader(n,i);s||(s=yield pt.createSettings(o)),s._objectURL=pt.ZIP_PROTOCOL+pt.uid+"/"+s.url;const a=yield pt.unzip(o,s);a.settings=s,r.source=a,i.startsWith("blob:")&&r.live2dModel.once("modelLoaded",u=>{u.once("destroy",function(){URL.revokeObjectURL(i)})}),pt.releaseReader(o)}return t()});G.live2DModelMiddlewares.unshift(Gi.factory);if(!window.Live2D)throw new Error("Could not find Cubism 2 runtime. This plugin requires live2d.min.js to be loaded.");const vm=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(r,t){vm.call(this,r,t),t.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)};class ym extends AMotion{constructor(t){super(),this.params=[],this.setFadeIn(t.fade_in>0?t.fade_in:st.expressionFadingDuration),this.setFadeOut(t.fade_out>0?t.fade_out:st.expressionFadingDuration),Array.isArray(t.params)&&t.params.forEach(e=>{const i=e.calc||"add";if(i==="add"){const n=e.def||0;e.val-=n}else if(i==="mult"){const n=e.def||1;e.val/=n}this.params.push({calc:i,val:e.val,id:e.id})})}updateParamExe(t,e,i,n){this.params.forEach(s=>{t.setParamFloat(s.id,s.val*i)})}}class _m extends Fs{constructor(t,e){var i;super(t,e),this.queueManager=new MotionQueueManager,this.definitions=(i=this.settings.expressions)!=null?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex(e=>e.name===t)}getExpressionFile(t){return t.file}createExpression(t,e){return new ym(t)}_setExpression(t){return this.queueManager.startMotion(t)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}}class bm extends ki{constructor(t,e){super(t,e),this.groups={idle:"idle"},this.motionDataType="arraybuffer",this.queueManager=new MotionQueueManager,this.definitions=this.settings.motions,this.init(e)}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new _m(this.settings,t))}isFinished(){return this.queueManager.isFinished()}createMotion(t,e,i){const n=Live2DMotion.loadMotion(t),s=e===this.groups.idle?st.idleMotionFadingDuration:st.motionFadingDuration;return n.setFadeIn(i.fade_in>0?i.fade_in:s),n.setFadeOut(i.fade_out>0?i.fade_out:s),n}getMotionFile(t){return t.file}getMotionName(t){return t.file}getSoundFile(t){return t.sound}_startMotion(t,e){return t.onFinishHandler=e,this.queueManager.stopAllMotions(),this.queueManager.startMotion(t)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}destroy(){super.destroy(),this.queueManager=void 0}}class xm{constructor(t){this.coreModel=t,this.blinkInterval=4e3,this.closingDuration=100,this.closedDuration=50,this.openingDuration=150,this.eyeState=0,this.eyeParamValue=1,this.closedTimer=0,this.nextBlinkTimeLeft=this.blinkInterval,this.leftParam=t.getParamIndex("PARAM_EYE_L_OPEN"),this.rightParam=t.getParamIndex("PARAM_EYE_R_OPEN")}setEyeParams(t){this.eyeParamValue=Ci(t,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(t){switch(this.eyeState){case 0:this.nextBlinkTimeLeft-=t,this.nextBlinkTimeLeft<0&&(this.eyeState=1,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+rm(0,2e3));break;case 1:this.setEyeParams(this.eyeParamValue+t/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=2,this.closedTimer=0);break;case 2:this.closedTimer+=t,this.closedTimer>=this.closedDuration&&(this.eyeState=3);break;case 3:this.setEyeParams(this.eyeParamValue+t/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=0)}}}const ve=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Em extends Ju{constructor(t,e,i){super(),this.textureFlipY=!0,this.drawDataCount=0,this.disableCulling=!1,this.coreModel=t,this.settings=e,this.motionManager=new bm(e,i),this.eyeBlink=new xm(t),this.eyeballXParamIndex=t.getParamIndex("PARAM_EYE_BALL_X"),this.eyeballYParamIndex=t.getParamIndex("PARAM_EYE_BALL_Y"),this.angleXParamIndex=t.getParamIndex("PARAM_ANGLE_X"),this.angleYParamIndex=t.getParamIndex("PARAM_ANGLE_Y"),this.angleZParamIndex=t.getParamIndex("PARAM_ANGLE_Z"),this.bodyAngleXParamIndex=t.getParamIndex("PARAM_BODY_ANGLE_X"),this.breathParamIndex=t.getParamIndex("PARAM_BREATH"),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach(({id:s,value:o})=>this.coreModel.setParamFloat(s,o)),this.settings.initOpacities&&this.settings.initOpacities.forEach(({id:s,value:o})=>this.coreModel.setPartsOpacity(s,o)),this.coreModel.saveParam();const t=this.coreModel.getModelContext()._$aS;t?.length&&(this.drawDataCount=t.length);let e=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,"culling",{set:s=>e=s,get:()=>this.disableCulling?!1:e});const i=this.coreModel.getModelContext().clipManager,n=i.setupClip;i.setupClip=(s,o)=>{n.call(i,s,o),o.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const t={};if(this.settings.layout)for(const e of Object.keys(this.settings.layout)){let i=e;e==="center_x"?i="centerX":e==="center_y"&&(i="centerY"),t[i]=this.settings.layout[e]}return t}updateWebGLContext(t,e){const i=this.coreModel.drawParamWebGL;i.firstDraw=!0,i.setGL(t),i.glno=e;for(const o in i)i.hasOwnProperty(o)&&i[o]instanceof WebGLBuffer&&(i[o]=null);const n=this.coreModel.getModelContext().clipManager;n.curFrameNo=e;const s=t.getParameter(t.FRAMEBUFFER_BINDING);n.getMaskRenderTexture(),t.bindFramebuffer(t.FRAMEBUFFER,s)}bindTexture(t,e){this.coreModel.setTexture(t,e)}getHitAreaDefs(){var t;return((t=this.settings.hitAreas)==null?void 0:t.map(e=>({id:e.id,name:e.name,index:this.coreModel.getDrawDataIndex(e.id)})))||[]}getDrawableIDs(){const t=this.coreModel.getModelContext(),e=[];for(let i=0;i<this.drawDataCount;i++){const n=t.getDrawData(i);n&&e.push(n.getDrawDataID().id)}return e}getDrawableIndex(t){return this.coreModel.getDrawDataIndex(t)}getDrawableVertices(t){if(typeof t=="string"&&(t=this.coreModel.getDrawDataIndex(t),t===-1))throw new TypeError("Unable to find drawable ID: "+t);return this.coreModel.getTransformedPoints(t).slice()}update(t,e){var i,n,s,o;super.update(t,e);const a=this.coreModel;this.emit("beforeMotionUpdate");const u=this.motionManager.update(this.coreModel,e);this.emit("afterMotionUpdate"),a.saveParam(),(i=this.motionManager.expressionManager)==null||i.update(a,e),u||(n=this.eyeBlink)==null||n.update(t),this.updateFocus(),this.updateNaturalMovements(t,e),(s=this.physics)==null||s.update(e),(o=this.pose)==null||o.update(t),this.emit("beforeModelUpdate"),a.update(),a.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,this.focusController.x*30),this.coreModel.addToParamFloat(this.angleYParamIndex,this.focusController.y*30),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,this.focusController.x*10)}updateNaturalMovements(t,e){const i=e/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*Math.sin(i/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*Math.sin(i/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*Math.sin(i/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*Math.sin(i/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(i/3.2345))}draw(t){const e=this.disableCulling;t.getParameter(t.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const i=this.drawingMatrix;ve[0]=i.a,ve[1]=i.b,ve[4]=i.c,ve[5]=i.d,ve[12]=i.tx,ve[13]=i.ty,this.coreModel.setMatrix(ve),this.coreModel.draw(),this.disableCulling=e}destroy(){super.destroy(),this.coreModel=void 0}}class Cr extends Ni{constructor(t){if(super(t),this.motions={},!Cr.isValidJSON(t))throw new TypeError("Invalid JSON.");this.moc=t.model,dr("string",t,this,"textures","textures"),this.copy(t)}static isValidJSON(t){var e;return!!t&&typeof t.model=="string"&&((e=t.textures)==null?void 0:e.length)>0&&t.textures.every(i=>typeof i=="string")}copy(t){fr("string",t,this,"name","name"),fr("string",t,this,"pose","pose"),fr("string",t,this,"physics","physics"),fr("object",t,this,"layout","layout"),fr("object",t,this,"motions","motions"),dr("object",t,this,"hit_areas","hitAreas"),dr("object",t,this,"expressions","expressions"),dr("object",t,this,"init_params","initParams"),dr("object",t,this,"init_opacities","initOpacities")}replaceFiles(t){super.replaceFiles(t);for(const[e,i]of Object.entries(this.motions))for(let n=0;n<i.length;n++)i[n].file=t(i[n].file,`motions.${e}[${n}].file`),i[n].sound!==void 0&&(i[n].sound=t(i[n].sound,`motions.${e}[${n}].sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].file=t(this.expressions[e].file,`expressions[${e}].file`)}}const Tm={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},wm={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class Im{constructor(t,e){this.coreModel=t,this.physicsHairs=[],e.physics_hair&&(this.physicsHairs=e.physics_hair.map(i=>{const n=new PhysicsHair;return n.setup(i.setup.length,i.setup.regist,i.setup.mass),i.src.forEach(({id:s,ptype:o,scale:a,weight:u})=>{const l=Tm[o];l&&n.addSrcParam(l,s,a,u)}),i.targets.forEach(({id:s,ptype:o,scale:a,weight:u})=>{const l=wm[o];l&&n.addTargetParam(l,s,a,u)}),n}))}update(t){this.physicsHairs.forEach(e=>e.update(this.coreModel,t))}}class ya{constructor(t){this.id=t,this.paramIndex=-1,this.partsIndex=-1,this.link=[]}initIndex(t){this.paramIndex=t.getParamIndex("VISIBLE:"+this.id),this.partsIndex=t.getPartsDataIndex(PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)}}class Cm{constructor(t,e){this.coreModel=t,this.opacityAnimDuration=500,this.partsGroups=[],e.parts_visible&&(this.partsGroups=e.parts_visible.map(({group:i})=>i.map(({id:n,link:s})=>{const o=new ya(n);return s&&(o.link=s.map(a=>new ya(a))),o})),this.init())}init(){this.partsGroups.forEach(t=>{t.forEach(e=>{if(e.initIndex(this.coreModel),e.paramIndex>=0){const i=this.coreModel.getParamFloat(e.paramIndex)!==0;this.coreModel.setPartsOpacity(e.partsIndex,i?1:0),this.coreModel.setParamFloat(e.paramIndex,i?1:0),e.link.length>0&&e.link.forEach(n=>n.initIndex(this.coreModel))}})})}normalizePartsOpacityGroup(t,e){const i=this.coreModel,n=.5,s=.15;let o=1,a=t.findIndex(({paramIndex:u,partsIndex:l})=>l>=0&&i.getParamFloat(u)!==0);if(a>=0){const u=i.getPartsOpacity(t[a].partsIndex);o=Ci(u+e/this.opacityAnimDuration,0,1)}else a=0,o=1;t.forEach(({partsIndex:u},l)=>{if(u>=0)if(a==l)i.setPartsOpacity(u,o);else{let h=i.getPartsOpacity(u),c;o<n?c=o*(n-1)/n+1:c=(1-o)*n/(1-n),(1-c)*(1-o)>s&&(c=1-s/(1-o)),h>c&&(h=c),i.setPartsOpacity(u,h)}})}copyOpacity(t){const e=this.coreModel;t.forEach(({partsIndex:i,link:n})=>{if(i>=0&&n){const s=e.getPartsOpacity(i);n.forEach(({partsIndex:o})=>{o>=0&&e.setPartsOpacity(o,s)})}})}update(t){this.partsGroups.forEach(e=>{this.normalizePartsOpacityGroup(e,t),this.copyOpacity(e)})}}G.registerRuntime({version:2,test(r){return r instanceof Cr||Cr.isValidJSON(r)},ready(){return Promise.resolve()},isValidMoc(r){if(r.byteLength<3)return!1;const t=new Int8Array(r,0,3);return String.fromCharCode(...t)==="moc"},createModelSettings(r){return new Cr(r)},createCoreModel(r){const t=Live2DModelWebGL.loadModel(r),e=Live2D.getError();if(e)throw e;return t},createInternalModel(r,t,e){return new Em(r,t,e)},createPose(r,t){return new Cm(r,t)},createPhysics(r,t){return new Im(r,t)}});if(!window.Live2DCubismCore)throw new Error("Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.");class S{constructor(t,e){this.x=t||0,this.y=e||0}add(t){const e=new S(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new S(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new S(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new S(t,t))}division(t){const e=new S(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new S(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}const mi=class{static range(r,t,e){return r<t?r=t:r>e&&(r=e),r}static sin(r){return Math.sin(r)}static cos(r){return Math.cos(r)}static abs(r){return Math.abs(r)}static sqrt(r){return Math.sqrt(r)}static cbrt(r){if(r===0)return r;let t=r;const e=t<0;e&&(t=-t);let i;return t===1/0?i=1/0:(i=Math.exp(Math.log(t)/3),i=(t/(i*i)+2*i)/3),e?-i:i}static getEasingSine(r){return r<0?0:r>1?1:.5-.5*this.cos(r*Math.PI)}static max(r,t){return r>t?r:t}static min(r,t){return r>t?t:r}static degreesToRadian(r){return r/180*Math.PI}static radianToDegrees(r){return r*180/Math.PI}static directionToRadian(r,t){const e=Math.atan2(t.y,t.x),i=Math.atan2(r.y,r.x);let n=e-i;for(;n<-Math.PI;)n+=Math.PI*2;for(;n>Math.PI;)n-=Math.PI*2;return n}static directionToDegrees(r,t){const e=this.directionToRadian(r,t);let i=this.radianToDegrees(e);return t.x-r.x>0&&(i=-i),i}static radianToDirection(r){const t=new S;return t.x=this.sin(r),t.y=this.cos(r),t}static quadraticEquation(r,t,e){return this.abs(r)<mi.Epsilon?this.abs(t)<mi.Epsilon?-e:-e/t:-(t+this.sqrt(t*t-4*r*e))/(2*r)}static cardanoAlgorithmForBezier(r,t,e,i){if(this.sqrt(r)<mi.Epsilon)return this.range(this.quadraticEquation(t,e,i),0,1);const n=t/r,s=e/r,o=i/r,a=(3*s-n*n)/3,u=a/3,l=(2*n*n*n-9*n*s+27*o)/27,h=l/2,c=h*h+u*u*u,f=.5,d=f+.01;if(c<0){const _=-a/3,g=_*_*_,b=this.sqrt(g),E=-l/(2*b),T=this.range(E,-1,1),M=Math.acos(T),R=2*this.cbrt(b),U=R*this.cos(M/3)-n/3;if(this.abs(U-f)<d)return this.range(U,0,1);const et=R*this.cos((M+2*Math.PI)/3)-n/3;if(this.abs(et-f)<d)return this.range(et,0,1);const vt=R*this.cos((M+4*Math.PI)/3)-n/3;return this.range(vt,0,1)}if(c==0){let _;h<0?_=this.cbrt(-h):_=-this.cbrt(h);const g=2*_-n/3;if(this.abs(g-f)<d)return this.range(g,0,1);const b=-_-n/3;return this.range(b,0,1)}const p=this.sqrt(c),v=this.cbrt(p-h),m=this.cbrt(p+h),y=v-m-n/3;return this.range(y,0,1)}constructor(){}};let B=mi;B.Epsilon=1e-5;class St{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const n=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),s=4;for(let o=0;o<s;++o)for(let a=0;a<s;++a)for(let u=0;u<s;++u)n[a+o*4]+=t[u+o*4]*e[a+u*4];for(let o=0;o<16;++o)i[o]=n[o]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);St.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);St.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){St.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new St;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}class Ls{initialize(t){this._model=t}drawModel(){this.getModel()!=null&&this.doDrawModel()}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,n){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),n<0?n=0:n>1&&(n=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=n}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisortopy=t}getAnisotropy(){return this._anisortopy}getModel(){return this._model}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisortopy=0,this._modelColor=new vr,this._mvpMatrix4x4=new St,this._mvpMatrix4x4.loadIdentity()}}var re=(r=>(r[r.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",r[r.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",r[r.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",r))(re||{});class vr{constructor(){this.R=1,this.G=1,this.B=1,this.A=1}}let Lt=!1,Xe=!1,je;const En={vertexOffset:0,vertexStep:2};class Nr{static startUp(t){if(Lt)return pr("CubismFramework.startUp() is already done."),Lt;if(Live2DCubismCore._isStarted)return Lt=!0,!0;if(Live2DCubismCore._isStarted=!0,je=t,je&&Live2DCubismCore.Logging.csmSetLogFunction(je.logFunction),Lt=!0,Lt){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,n=(e&16711680)>>16,s=e&65535,o=e;pr("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+n).slice(-2),("0000"+s).slice(-4),o)}return pr("CubismFramework.startUp() is complete."),Lt}static cleanUp(){Lt=!1,Xe=!1,je=void 0}static initialize(){if(!Lt){yr("CubismFramework is not started.");return}if(Xe){yr("CubismFramework.initialize() skipped, already initialized.");return}Xe=!0,pr("CubismFramework.initialize() is complete.")}static dispose(){if(!Lt){yr("CubismFramework is not started.");return}if(!Xe){yr("CubismFramework.dispose() skipped, not initialized.");return}Ls.staticRelease(),Xe=!1,pr("CubismFramework.dispose() is complete.")}static isStarted(){return Lt}static isInitialized(){return Xe}static coreLogFunction(t){!Live2DCubismCore.Logging.csmGetLogFunction()||Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return je!=null?je.loggingLevel:Ue.LogLevel_Off}constructor(){}}var Ue=(r=>(r[r.LogLevel_Verbose=0]="LogLevel_Verbose",r[r.LogLevel_Debug=1]="LogLevel_Debug",r[r.LogLevel_Info=2]="LogLevel_Info",r[r.LogLevel_Warning=3]="LogLevel_Warning",r[r.LogLevel_Error=4]="LogLevel_Error",r[r.LogLevel_Off=5]="LogLevel_Off",r))(Ue||{});const li=()=>{};function _a(r,...t){Vi.print(Ue.LogLevel_Debug,"[CSM][D]"+r+`
`,t)}function pr(r,...t){Vi.print(Ue.LogLevel_Info,"[CSM][I]"+r+`
`,t)}function yr(r,...t){Vi.print(Ue.LogLevel_Warning,"[CSM][W]"+r+`
`,t)}function ze(r,...t){Vi.print(Ue.LogLevel_Error,"[CSM][E]"+r+`
`,t)}class Vi{static print(t,e,i){if(t<Nr.getLoggingLevel())return;const n=Nr.coreLogFunction;if(!n)return;const s=e.replace(/{(\d+)}/g,(o,a)=>i[a]);n(s)}static dumpBytes(t,e,i){for(let n=0;n<i;n++)n%16==0&&n>0?this.print(t,`
`):n%8==0&&n>0&&this.print(t,"  "),this.print(t,"{0} ",[e[n]&255]);this.print(t,`
`)}constructor(){}}class ol{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const a=this.getDuration();e.getEndTime()<0&&e.setEndTime(a<=0?-1:e.getStartTime()+a)}let n=this._weight;const s=this._fadeInSeconds==0?1:B.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds),o=this._fadeOutSeconds==0||e.getEndTime()<0?1:B.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds);n=n*s*o,e.setState(i,n),this.doUpdateParameters(t,i,n,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}setFinishedMotionHandler(t){this._onFinishedMotion=t}getFinishedMotionHandler(){return this._onFinishedMotion}}const ba=1;class Bs extends ol{constructor(){super(),this._parameters=[]}static create(t){const e=new Bs,i=t.FadeInTime,n=t.FadeOutTime;e.setFadeInTime(i!==void 0?i:ba),e.setFadeOutTime(n!==void 0?n:ba);const s=t.Parameters||[];for(let o=0;o<s.length;++o){const a=s[o],u=a.Id,l=a.Value;let h;switch(a.Blend){case"Multiply":h=Te.ExpressionBlendType_Multiply;break;case"Overwrite":h=Te.ExpressionBlendType_Overwrite;break;case"Add":default:h=Te.ExpressionBlendType_Add;break}const c={parameterId:u,blendType:h,value:l};e._parameters.push(c)}return e}doUpdateParameters(t,e,i,n){for(let s=0;s<this._parameters.length;++s){const o=this._parameters[s];switch(o.blendType){case Te.ExpressionBlendType_Add:{t.addParameterValueById(o.parameterId,o.value,i);break}case Te.ExpressionBlendType_Multiply:{t.multiplyParameterValueById(o.parameterId,o.value,i);break}case Te.ExpressionBlendType_Overwrite:{t.setParameterValueById(o.parameterId,o.value,i);break}}}}}var Te=(r=>(r[r.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",r[r.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",r[r.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite",r))(Te||{});class Sm{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class al{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let t=0;t<this._motions.length;++t)this._motions[t]&&this._motions[t].release();this._motions=void 0}startMotion(t,e,i){if(t==null)return Am;let n;for(let s=0;s<this._motions.length;++s)n=this._motions[s],n?.setFadeOut(n._motion.getFadeOutTime());return n=new Sm,n._autoDelete=e,n._motion=t,this._motions.push(n),n._motionQueueEntryHandle}isFinished(){let t=0;for(;t<this._motions.length;){const e=this._motions[t];if(e==null){this._motions.splice(t,1);continue}if(e._motion==null){e.release(),this._motions.splice(t,1);continue}if(!e.isFinished())return!1;t++}return!0}isFinishedByHandle(t){for(let e=0;e<this._motions.length;e++){const i=this._motions[e];if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=0;t<this._motions.length;t++){const e=this._motions[t];e?.release()}this._motions=[]}getCubismMotionQueueEntry(t){return this._motions.find(e=>e!=null&&e._motionQueueEntryHandle==t)}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1,n=0;for(;n<this._motions.length;){const s=this._motions[n];if(s==null){this._motions.splice(n,1);continue}const o=s._motion;if(o==null){s.release(),this._motions.splice(n,1);continue}o.updateParameters(t,s,e),i=!0;const a=o.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),e-s.getStartTime());for(let u=0;u<a.length;++u)this._eventCallBack(this,a[u],this._eventCustomData);s.setLastCheckEventSeconds(e),s.isFinished()?(s.release(),this._motions.splice(n,1)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),e),n++)}return i}}const Am=-1;class Pm extends Fs{constructor(t,e){var i;super(t,e),this.queueManager=new al,this.definitions=(i=t.expressions)!=null?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex(e=>e.Name===t)}getExpressionFile(t){return t.File}createExpression(t,e){return Bs.create(t)}_setExpression(t){return this.queueManager.startMotion(t,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}}class ul{constructor(t){this.groups=t.Groups,this.hitAreas=t.HitAreas,this.layout=t.Layout,this.moc=t.FileReferences.Moc,this.expressions=t.FileReferences.Expressions,this.motions=t.FileReferences.Motions,this.textures=t.FileReferences.Textures,this.physics=t.FileReferences.Physics,this.pose=t.FileReferences.Pose}getEyeBlinkParameters(){var t,e;return(e=(t=this.groups)==null?void 0:t.find(i=>i.Name==="EyeBlink"))==null?void 0:e.Ids}getLipSyncParameters(){var t,e;return(e=(t=this.groups)==null?void 0:t.find(i=>i.Name==="LipSync"))==null?void 0:e.Ids}}class tr extends Ni{constructor(t){if(super(t),!tr.isValidJSON(t))throw new TypeError("Invalid JSON.");Object.assign(this,new ul(t))}static isValidJSON(t){var e;return!!t?.FileReferences&&typeof t.FileReferences.Moc=="string"&&((e=t.FileReferences.Textures)==null?void 0:e.length)>0&&t.FileReferences.Textures.every(i=>typeof i=="string")}replaceFiles(t){if(super.replaceFiles(t),this.motions)for(const[e,i]of Object.entries(this.motions))for(let n=0;n<i.length;n++)i[n].File=t(i[n].File,`motions.${e}[${n}].File`),i[n].Sound!==void 0&&(i[n].Sound=t(i[n].Sound,`motions.${e}[${n}].Sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].File=t(this.expressions[e].File,`expressions[${e}].File`)}}Ku(tr,[ul]);var we=(r=>(r[r.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",r[r.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",r[r.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",r))(we||{}),Bt=(r=>(r[r.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",r[r.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",r[r.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",r[r.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",r))(Bt||{});class Jt{constructor(t=0,e=0){this.time=t,this.value=e}}class Mm{constructor(){this.basePointIndex=0,this.segmentType=0}}class Rm{constructor(){this.id="",this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Fm{constructor(){this.fireTime=0,this.value=""}}class Om{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class ll{constructor(t){this._json=t}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(t){return Ns.EvaluationOptionFlag_AreBeziersRistricted==t?!!this._json.Meta.AreBeziersRestricted:!1}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(t){return this._json.Curves[t].Target}getMotionCurveId(t){return this._json.Curves[t].Id}getMotionCurveFadeInTime(t){return this._json.Curves[t].FadeInTime}getMotionCurveFadeOutTime(t){return this._json.Curves[t].FadeOutTime}getMotionCurveSegmentCount(t){return this._json.Curves[t].Segments.length}getMotionCurveSegment(t,e){return this._json.Curves[t].Segments[e]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(t){return this._json.UserData[t].Time}getEventValue(t){return this._json.UserData[t].Value}}var Ns=(r=>(r[r.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",r))(Ns||{});const Dm="EyeBlink",Lm="LipSync",Bm="Model",Nm="Parameter",km="PartOpacity",Um=!1;function Ct(r,t,e){const i=new Jt;return i.time=r.time+(t.time-r.time)*e,i.value=r.value+(t.value-r.value)*e,i}function Gm(r,t){let e=(t-r[0].time)/(r[1].time-r[0].time);return e<0&&(e=0),r[0].value+(r[1].value-r[0].value)*e}function Vm(r,t){let e=(t-r[0].time)/(r[3].time-r[0].time);e<0&&(e=0);const i=Ct(r[0],r[1],e),n=Ct(r[1],r[2],e),s=Ct(r[2],r[3],e),o=Ct(i,n,e),a=Ct(n,s,e);return Ct(o,a,e).value}function Hm(r,t){const e=t,i=r[0].time,n=r[3].time,s=r[1].time,o=r[2].time,a=n-3*o+3*s-i,u=3*o-6*s+3*i,l=3*s-3*i,h=i-e,c=B.cardanoAlgorithmForBezier(a,u,l,h),f=Ct(r[0],r[1],c),d=Ct(r[1],r[2],c),p=Ct(r[2],r[3],c),v=Ct(f,d,c),m=Ct(d,p,c);return Ct(v,m,c).value}function Xm(r,t){return r[0].value}function jm(r,t){return r[1].value}function Tn(r,t,e){const i=r.curves[t];let n=-1;const s=i.baseSegmentIndex+i.segmentCount;let o=0;for(let u=i.baseSegmentIndex;u<s;++u)if(o=r.segments[u].basePointIndex+(r.segments[u].segmentType==Bt.CubismMotionSegmentType_Bezier?3:1),r.points[o].time>e){n=u;break}if(n==-1)return r.points[o].value;const a=r.segments[n];return a.evaluate(r.points.slice(a.basePointIndex),e)}class ks extends ol{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0}static create(t,e){const i=new ks;return i.parse(t),i._sourceFrameRate=i._motionData.fps,i._loopDurationSeconds=i._motionData.duration,i._onFinishedMotion=e,i}doUpdateParameters(t,e,i,n){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=Dm),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=Lm);let s=e-n.getStartTime();s<0&&(s=0);let o=Number.MAX_VALUE,a=Number.MAX_VALUE;const u=64;let l=0,h=0;this._eyeBlinkParameterIds.length>u&&_a("too many eye blink targets : {0}",this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>u&&_a("too many lip sync targets : {0}",this._lipSyncParameterIds.length);const c=this._fadeInSeconds<=0?1:B.getEasingSine((e-n.getFadeInStartTime())/this._fadeInSeconds),f=this._fadeOutSeconds<=0||n.getEndTime()<0?1:B.getEasingSine((n.getEndTime()-e)/this._fadeOutSeconds);let d,p,v,m=s;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;const y=this._motionData.curves;for(p=0;p<this._motionData.curveCount&&y[p].type==we.CubismMotionCurveTarget_Model;++p)d=Tn(this._motionData,p,m),y[p].id==this._modelCurveIdEyeBlink?a=d:y[p].id==this._modelCurveIdLipSync&&(o=d);for(;p<this._motionData.curveCount&&y[p].type==we.CubismMotionCurveTarget_Parameter;++p){if(v=t.getParameterIndex(y[p].id),v==-1)continue;const _=t.getParameterValueByIndex(v);if(d=Tn(this._motionData,p,m),a!=Number.MAX_VALUE){for(let b=0;b<this._eyeBlinkParameterIds.length&&b<u;++b)if(this._eyeBlinkParameterIds[b]==y[p].id){d*=a,h|=1<<b;break}}if(o!=Number.MAX_VALUE){for(let b=0;b<this._lipSyncParameterIds.length&&b<u;++b)if(this._lipSyncParameterIds[b]==y[p].id){d+=o,l|=1<<b;break}}let g;if(y[p].fadeInTime<0&&y[p].fadeOutTime<0)g=_+(d-_)*i;else{let b,E;y[p].fadeInTime<0?b=c:b=y[p].fadeInTime==0?1:B.getEasingSine((e-n.getFadeInStartTime())/y[p].fadeInTime),y[p].fadeOutTime<0?E=f:E=y[p].fadeOutTime==0||n.getEndTime()<0?1:B.getEasingSine((n.getEndTime()-e)/y[p].fadeOutTime);const T=this._weight*b*E;g=_+(d-_)*T}t.setParameterValueByIndex(v,g,1)}{if(a!=Number.MAX_VALUE)for(let _=0;_<this._eyeBlinkParameterIds.length&&_<u;++_){const g=t.getParameterValueById(this._eyeBlinkParameterIds[_]);if(h>>_&1)continue;const b=g+(a-g)*i;t.setParameterValueById(this._eyeBlinkParameterIds[_],b)}if(o!=Number.MAX_VALUE)for(let _=0;_<this._lipSyncParameterIds.length&&_<u;++_){const g=t.getParameterValueById(this._lipSyncParameterIds[_]);if(l>>_&1)continue;const b=g+(o-g)*i;t.setParameterValueById(this._lipSyncParameterIds[_],b)}}for(;p<this._motionData.curveCount&&y[p].type==we.CubismMotionCurveTarget_PartOpacity;++p)if(d=Tn(this._motionData,p,m),Br.setOpacityFromMotion)t.setPartOpacityById(y[p].id,d);else{if(v=t.getParameterIndex(y[p].id),v==-1)continue;t.setParameterValueByIndex(v,d)}s>=this._motionData.duration&&(this._isLoop?(n.setStartTime(e),this._isLoopFadeIn&&n.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),n.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let n=0;n<this._motionData.curveCount;++n)if(t==i[n].id){i[n].fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let n=0;n<this._motionData.curveCount;++n)if(t==i[n].id){i[n].fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e[i].id)return e[i].fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e[i].id)return e[i].fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0}parse(t){this._motionData=new Om;let e=new ll(t);this._motionData.duration=e.getMotionDuration(),this._motionData.loop=e.isMotionLoop(),this._motionData.curveCount=e.getMotionCurveCount(),this._motionData.fps=e.getMotionFps(),this._motionData.eventCount=e.getEventCount();const i=e.getEvaluationOptionFlag(Ns.EvaluationOptionFlag_AreBeziersRistricted),n=e.getMotionFadeInTime(),s=e.getMotionFadeOutTime();n!==void 0?this._fadeInSeconds=n<0?1:n:this._fadeInSeconds=1,s!==void 0?this._fadeOutSeconds=s<0?1:s:this._fadeOutSeconds=1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map(()=>new Rm),this._motionData.segments=Array.from({length:e.getMotionTotalSegmentCount()}).map(()=>new Mm),this._motionData.events=Array.from({length:this._motionData.eventCount}).map(()=>new Fm),this._motionData.points=[];let o=0,a=0;for(let u=0;u<this._motionData.curveCount;++u){const l=this._motionData.curves[u];switch(e.getMotionCurveTarget(u)){case Bm:l.type=we.CubismMotionCurveTarget_Model;break;case Nm:l.type=we.CubismMotionCurveTarget_Parameter;break;case km:l.type=we.CubismMotionCurveTarget_PartOpacity;break;default:yr('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!')}l.id=e.getMotionCurveId(u),l.baseSegmentIndex=a;const h=e.getMotionCurveFadeInTime(u),c=e.getMotionCurveFadeOutTime(u);l.fadeInTime=h!==void 0?h:-1,l.fadeOutTime=c!==void 0?c:-1;for(let f=0;f<e.getMotionCurveSegmentCount(u);){switch(f==0?(this._motionData.segments[a].basePointIndex=o,this._motionData.points[o]=new Jt(e.getMotionCurveSegment(u,f),e.getMotionCurveSegment(u,f+1)),o+=1,f+=2):this._motionData.segments[a].basePointIndex=o-1,e.getMotionCurveSegment(u,f)){case Bt.CubismMotionSegmentType_Linear:{this._motionData.segments[a].segmentType=Bt.CubismMotionSegmentType_Linear,this._motionData.segments[a].evaluate=Gm,this._motionData.points[o]=new Jt(e.getMotionCurveSegment(u,f+1),e.getMotionCurveSegment(u,f+2)),o+=1,f+=3;break}case Bt.CubismMotionSegmentType_Bezier:{this._motionData.segments[a].segmentType=Bt.CubismMotionSegmentType_Bezier,i||Um?this._motionData.segments[a].evaluate=Vm:this._motionData.segments[a].evaluate=Hm,this._motionData.points[o]=new Jt(e.getMotionCurveSegment(u,f+1),e.getMotionCurveSegment(u,f+2)),this._motionData.points[o+1]=new Jt(e.getMotionCurveSegment(u,f+3),e.getMotionCurveSegment(u,f+4)),this._motionData.points[o+2]=new Jt(e.getMotionCurveSegment(u,f+5),e.getMotionCurveSegment(u,f+6)),o+=3,f+=7;break}case Bt.CubismMotionSegmentType_Stepped:{this._motionData.segments[a].segmentType=Bt.CubismMotionSegmentType_Stepped,this._motionData.segments[a].evaluate=Xm,this._motionData.points[o]=new Jt(e.getMotionCurveSegment(u,f+1),e.getMotionCurveSegment(u,f+2)),o+=1,f+=3;break}case Bt.CubismMotionSegmentType_InverseStepped:{this._motionData.segments[a].segmentType=Bt.CubismMotionSegmentType_InverseStepped,this._motionData.segments[a].evaluate=jm,this._motionData.points[o]=new Jt(e.getMotionCurveSegment(u,f+1),e.getMotionCurveSegment(u,f+2)),o+=1,f+=3;break}}++l.segmentCount,++a}this._motionData.curves.push(l)}for(let u=0;u<e.getEventCount();++u)this._motionData.events[u].fireTime=e.getEventTime(u),this._motionData.events[u].value=e.getEventValue(u);e.release()}getFiredEvent(t,e){this._firedEventValues.length=0;for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events[i].fireTime>t&&this._motionData.events[i].fireTime<=e&&this._firedEventValues.push(this._motionData.events[i].value);return this._firedEventValues}}class $m extends ki{constructor(t,e){var i;super(t,e),this.groups={idle:"Idle"},this.motionDataType="json",this.queueManager=new al,this.definitions=(i=t.motions)!=null?i:{},this.eyeBlinkIds=t.getEyeBlinkParameters()||[],this.lipSyncIds=t.getLipSyncParameters()||[],this.init(e)}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new Pm(this.settings,t)),this.queueManager.setEventCallback((e,i,n)=>{this.emit("motion:"+i)})}isFinished(){return this.queueManager.isFinished()}_startMotion(t,e){return t.setFinishedMotionHandler(e),this.queueManager.stopAllMotions(),this.queueManager.startMotion(t,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(t,e,i){const n=ks.create(t),s=new ll(t),o=(e===this.groups.idle?st.idleMotionFadingDuration:st.motionFadingDuration)/1e3;return s.getMotionFadeInTime()===void 0&&n.setFadeInTime(i.FadeInTime>0?i.FadeInTime:o),s.getMotionFadeOutTime()===void 0&&n.setFadeOutTime(i.FadeOutTime>0?i.FadeOutTime:o),n.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),n}getMotionFile(t){return t.File}getMotionName(t){return t.File}getSoundFile(t){return t.Sound}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}const zm="ParamAngleX",Wm="ParamAngleY",Ym="ParamAngleZ",qm="ParamEyeBallX",Km="ParamEyeBallY",Zm="ParamBodyAngleX",Jm="ParamBreath";class Us{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new Us}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let n=0;n<this._breathParameters.length;++n){const s=this._breathParameters[n];t.addParameterValueById(s.parameterId,s.offset+s.peak*Math.sin(i/s.cycle),s.weight)}}}class mr{constructor(t,e,i,n,s){this.parameterId=t??void 0,this.offset=e??0,this.peak=i??0,this.cycle=n??0,this.weight=s??0}}const ns=class{static create(r){return new ns(r)}setBlinkingInterval(r){this._blinkingIntervalSeconds=r}setBlinkingSetting(r,t,e){this._closingSeconds=r,this._closedSeconds=t,this._openingSeconds=e}setParameterIds(r){this._parameterIds=r}getParameterIds(){return this._parameterIds}updateParameters(r,t){this._userTimeSeconds+=t;let e,i=0;switch(this._blinkingState){case It.EyeState_Closing:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,i>=1&&(i=1,this._blinkingState=It.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),e=1-i;break;case It.EyeState_Closed:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,i>=1&&(this._blinkingState=It.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),e=0;break;case It.EyeState_Opening:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,i>=1&&(i=1,this._blinkingState=It.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),e=i;break;case It.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=It.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),e=1;break;case It.EyeState_First:default:this._blinkingState=It.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),e=1;break}ns.CloseIfZero||(e=-e);for(let n=0;n<this._parameterIds.length;++n)r.setParameterValueById(this._parameterIds[n],e)}constructor(r){var t,e;this._blinkingState=It.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],r!=null&&(this._parameterIds=(e=(t=r.getEyeBlinkParameters())==null?void 0:t.slice())!=null?e:this._parameterIds)}determinNextBlinkingTiming(){const r=Math.random();return this._userTimeSeconds+r*(2*this._blinkingIntervalSeconds-1)}};let hl=ns;hl.CloseIfZero=!0;var It=(r=>(r[r.EyeState_First=0]="EyeState_First",r[r.EyeState_Interval=1]="EyeState_Interval",r[r.EyeState_Closing=2]="EyeState_Closing",r[r.EyeState_Closed=3]="EyeState_Closed",r[r.EyeState_Opening=4]="EyeState_Opening",r))(It||{});class ss{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}const wn=4,Qm=10;let ye,_r,os;class In{getChannelFlagAsColor(t){return this._channelColors[t]}getMaskRenderTexture(){let t=0;if(this._maskTexture&&this._maskTexture.texture!=0&&(this._maskTexture.frameNo=this._currentFrameNo,t=this._maskTexture.texture),t==0){const e=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,os),this._maskTexture=new tg(this._currentFrameNo,t)}return t}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,n=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MIN_VALUE;const a=e._clippedDrawableIndexList.length;for(let u=0;u<a;u++){const l=e._clippedDrawableIndexList[u],h=t.getDrawableVertexCount(l),c=t.getDrawableVertices(l);let f=Number.MAX_VALUE,d=Number.MAX_VALUE,p=Number.MIN_VALUE,v=Number.MIN_VALUE;const m=h*En.vertexStep;for(let y=En.vertexOffset;y<m;y+=En.vertexStep){const _=c[y],g=c[y+1];_<f&&(f=_),_>p&&(p=_),g<d&&(d=g),g>v&&(v=g)}if(f!=Number.MAX_VALUE)if(f<i&&(i=f),d<n&&(n=d),p>s&&(s=p),v>o&&(o=v),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const y=s-i,_=o-n;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=n,e._allClippedDrawRect.width=y,e._allClippedDrawRect.height=_}}}constructor(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new ss,this._tmpMatrix=new St,this._tmpMatrixForMask=new St,this._tmpMatrixForDraw=new St;let t=new vr;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.push(t),t=new vr,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.push(t),t=new vr,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.push(t),t=new vr,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.push(t)}release(){var t,e,i;const n=this;for(let s=0;s<this._clippingContextListForMask.length;s++)this._clippingContextListForMask[s]&&((t=this._clippingContextListForMask[s])==null||t.release());n._clippingContextListForMask=void 0,n._clippingContextListForDraw=void 0,this._maskTexture&&((e=this.gl)==null||e.deleteFramebuffer(this._maskTexture.texture),n._maskTexture=void 0),n._channelColors=void 0,(i=this.gl)==null||i.deleteTexture(this._colorBuffer),this._colorBuffer=null}initialize(t,e,i,n){for(let s=0;s<e;s++){if(n[s]<=0){this._clippingContextListForDraw.push(null);continue}let o=this.findSameClip(i[s],n[s]);o==null&&(o=new eg(this,i[s],n[s]),this._clippingContextListForMask.push(o)),o.addClippedDrawable(s),this._clippingContextListForDraw.push(o)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let n=0;n<this._clippingContextListForMask.length;n++){const s=this._clippingContextListForMask[n];this.calcClippedDrawTotalBounds(t,s),s._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture(),e.getMvpMatrix(),e.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let n=0;n<this._clippingContextListForMask.length;n++){const s=this._clippingContextListForMask[n],o=s._allClippedDrawRect,a=s._layoutBounds,u=.05;this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.expand(o.width*u,o.height*u);const l=a.width/this._tmpBoundsOnModel.width,h=a.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(l,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(l,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),s._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),s._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const c=s._clippingIdCount;for(let f=0;f<c;f++){const d=s._clippingIdList[f];!t.getDrawableDynamicFlagVertexPositionsDidChange(d)||(e.setIsCulling(t.getDrawableCulling(d)!=!1),e.setClippingContextBufferForMask(s),e.drawMesh(t.getDrawableTextureIndices(d),t.getDrawableVertexIndexCount(d),t.getDrawableVertexCount(d),t.getDrawableVertexIndices(d),t.getDrawableVertices(d),t.getDrawableVertexUvs(d),t.getDrawableOpacity(d),re.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,os),e.setClippingContextBufferForMask(null),this.gl.viewport(_r[0],_r[1],_r[2],_r[3])}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.length;i++){const n=this._clippingContextListForMask[i],s=n._clippingIdCount;if(s!=e)continue;let o=0;for(let a=0;a<s;a++){const u=n._clippingIdList[a];for(let l=0;l<s;l++)if(t[l]==u){o++;break}}if(o==s)return n}return null}setupLayoutBounds(t){let e=t/wn,i=t%wn;e=~~e,i=~~i;let n=0;for(let s=0;s<wn;s++){const o=e+(s<i?1:0);if(o!=0)if(o==1){const a=this._clippingContextListForMask[n++];a._layoutChannelNo=s,a._layoutBounds.x=0,a._layoutBounds.y=0,a._layoutBounds.width=1,a._layoutBounds.height=1}else if(o==2)for(let a=0;a<o;a++){let u=a%2;u=~~u;const l=this._clippingContextListForMask[n++];l._layoutChannelNo=s,l._layoutBounds.x=u*.5,l._layoutBounds.y=0,l._layoutBounds.width=.5,l._layoutBounds.height=1}else if(o<=4)for(let a=0;a<o;a++){let u=a%2,l=a/2;u=~~u,l=~~l;const h=this._clippingContextListForMask[n++];h._layoutChannelNo=s,h._layoutBounds.x=u*.5,h._layoutBounds.y=l*.5,h._layoutBounds.width=.5,h._layoutBounds.height=.5}else if(o<=9)for(let a=0;a<o;a++){let u=a%3,l=a/3;u=~~u,l=~~l;const h=this._clippingContextListForMask[n++];h._layoutChannelNo=s,h._layoutBounds.x=u/3,h._layoutBounds.y=l/3,h._layoutBounds.width=1/3,h._layoutBounds.height=1/3}else if(Br.supportMoreMaskDivisions&&o<=16)for(let a=0;a<o;a++){let u=a%4,l=a/4;u=~~u,l=~~l;const h=this._clippingContextListForMask[n++];h._layoutChannelNo=s,h._layoutBounds.x=u/4,h._layoutBounds.y=l/4,h._layoutBounds.width=1/4,h._layoutBounds.height=1/4}else ze("not supported mask count : {0}",o)}}getColorBuffer(){return this._colorBuffer}getClippingContextListForDraw(){return this._clippingContextListForDraw}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}}class tg{constructor(t,e){this.frameNo=t,this.texture=e}}class eg{constructor(t,e,i){this._isUsing=!1,this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new ss,this._layoutBounds=new ss,this._clippedDrawableIndexList=[],this._matrixForMask=new St,this._matrixForDraw=new St}release(){const t=this;t._layoutBounds=void 0,t._allClippedDrawRect=void 0,t._clippedDrawableIndexList=void 0}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class er{static getInstance(){return ye==null&&(ye=new er),ye}static deleteInstance(){ye&&(ye.release(),ye=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,n,s,o,a,u,l,h,c,f,d){c||ze("NoPremultipliedAlpha is not allowed"),this._shaderSets.length==0&&this.generateShaders();let p,v,m,y;const _=t.getClippingContextBufferForMask();if(_!=null){const g=this._shaderSets[br.ShaderNames_SetupMask];this.gl.useProgram(g.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(g.samplerTexture0Location,0),a.vertex==null&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributePositionLocation),this.gl.vertexAttribPointer(g.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),a.uv==null&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(g.attributeTexCoordLocation),this.gl.vertexAttribPointer(g.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const b=_._layoutChannelNo,E=_.getClippingManager().getChannelFlagAsColor(b);this.gl.uniform4f(g.uniformChannelFlagLocation,E.R,E.G,E.B,E.A),this.gl.uniformMatrix4fv(g.uniformClipMatrixLocation,!1,_._matrixForMask.getArray());const T=_._layoutBounds;this.gl.uniform4f(g.uniformBaseColorLocation,T.x*2-1,T.y*2-1,T.getRight()*2-1,T.getBottom()*2-1),p=this.gl.ZERO,v=this.gl.ONE_MINUS_SRC_COLOR,m=this.gl.ZERO,y=this.gl.ONE_MINUS_SRC_ALPHA}else{const g=t.getClippingContextBufferForDraw(),E=g!=null?d?2:1:0;let T;switch(l){case re.CubismBlendMode_Normal:default:T=this._shaderSets[br.ShaderNames_NormalPremultipliedAlpha+E],p=this.gl.ONE,v=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ONE,y=this.gl.ONE_MINUS_SRC_ALPHA;break;case re.CubismBlendMode_Additive:T=this._shaderSets[br.ShaderNames_AddPremultipliedAlpha+E],p=this.gl.ONE,v=this.gl.ONE,m=this.gl.ZERO,y=this.gl.ONE;break;case re.CubismBlendMode_Multiplicative:T=this._shaderSets[br.ShaderNames_MultPremultipliedAlpha+E],p=this.gl.DST_COLOR,v=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ZERO,y=this.gl.ONE;break}if(this.gl.useProgram(T.shaderProgram),a.vertex==null&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(T.attributePositionLocation),this.gl.vertexAttribPointer(T.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),a.uv==null&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(T.attributeTexCoordLocation),this.gl.vertexAttribPointer(T.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),g!=null){this.gl.activeTexture(this.gl.TEXTURE1);const M=g.getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,M),this.gl.uniform1i(T.samplerTexture1Location,1),this.gl.uniformMatrix4fv(T.uniformClipMatrixLocation,!1,g._matrixForDraw.getArray());const D=g._layoutChannelNo,R=g.getClippingManager().getChannelFlagAsColor(D);this.gl.uniform4f(T.uniformChannelFlagLocation,R.R,R.G,R.B,R.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(T.samplerTexture0Location,0),this.gl.uniformMatrix4fv(T.uniformMatrixLocation,!1,f.getArray()),this.gl.uniform4f(T.uniformBaseColorLocation,h.R,h.G,h.B,h.A)}a.index==null&&(a.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(p,v,m,y)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.length;t++)this.gl.deleteProgram(this._shaderSets[t].shaderProgram),this._shaderSets[t].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let t=0;t<Qm;t++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(rg,ig),this._shaderSets[1].shaderProgram=this.loadShaderProgram(ng,sg),this._shaderSets[2].shaderProgram=this.loadShaderProgram(xa,og),this._shaderSets[3].shaderProgram=this.loadShaderProgram(xa,ag),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_position"),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_texCoord"),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"s_texture0"),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_clipMatrix"),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_channelFlag"),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_baseColor"),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_position"),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_texCoord"),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"s_texture0"),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_matrix"),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_baseColor"),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_position"),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_texCoord"),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture0"),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture1"),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_matrix"),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_clipMatrix"),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_channelFlag"),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_baseColor"),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_position"),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_texCoord"),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture0"),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture1"),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_matrix"),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_clipMatrix"),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_channelFlag"),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_baseColor"),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_position"),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_texCoord"),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"s_texture0"),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_matrix"),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_baseColor"),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_position"),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_texCoord"),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture0"),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture1"),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_matrix"),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_clipMatrix"),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_channelFlag"),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_baseColor"),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_position"),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_texCoord"),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture0"),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture1"),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_matrix"),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_clipMatrix"),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_channelFlag"),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_baseColor"),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_position"),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_texCoord"),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"s_texture0"),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_matrix"),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_baseColor"),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_position"),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_texCoord"),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture0"),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture1"),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_matrix"),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_clipMatrix"),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_channelFlag"),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_baseColor"),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_position"),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_texCoord"),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture0"),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture1"),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_matrix"),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_clipMatrix"),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_channelFlag"),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_baseColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),n=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!n)return ze("Vertex shader compile error!"),0;let s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return s?(this.gl.attachShader(i,n),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(n),this.gl.deleteShader(s),i):(ze("Failed to link program: {0}",i),this.gl.deleteShader(n),this.gl.deleteShader(s),i&&this.gl.deleteProgram(i),0)):(ze("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,n=this.gl.createShader(t);if(this.gl.shaderSource(n,i),this.gl.compileShader(n),!n){const o=this.gl.getShaderInfoLog(n);ze("Shader compile log: {0} ",o)}return this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(this.gl.deleteShader(n),null)}setGl(t){this.gl=t}}var br=(r=>(r[r.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",r[r.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",r[r.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",r[r.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",r[r.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",r[r.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",r))(br||{});const rg="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",ig="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",ng="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",xa="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",sg="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;void main(){   gl_FragColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;}",og="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;void main(){   vec4 col_formask = texture2D(s_texture0 , v_texCoord) * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",ag="precision mediump float;varying vec2 v_texCoord;varying vec4 v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4 u_channelFlag;uniform vec4 u_baseColor;void main(){vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;col_formask = col_formask * (1.0 - maskVal);gl_FragColor = col_formask;}";class cl extends Ls{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._clippingManager=new In,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}initialize(t){t.isUsingMasking()&&(this._clippingManager=new In,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts()));for(let e=t.getDrawableCount()-1;e>=0;e--)this._sortedDrawableIndexList[e]=0;super.initialize(t)}bindTexture(t,e){this._textures[t]=e}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){this._clippingManager.release(),this._clippingManager=new In,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())}getClippingMaskBufferSize(){return this._clippingManager.getClippingMaskBufferSize()}release(){var t,e,i;const n=this;this._clippingManager.release(),n._clippingManager=void 0,(t=this.gl)==null||t.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,(e=this.gl)==null||e.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,(i=this.gl)==null||i.deleteBuffer(this._bufferData.index),this._bufferData.index=null,n._bufferData=void 0,n._textures=void 0}doDrawModel(){this.preDraw(),this._clippingManager!=null&&this._clippingManager.setupClippingContext(this.getModel(),this);const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const n=e[i];this._sortedDrawableIndexList[n]=i}for(let i=0;i<t;++i){const n=this._sortedDrawableIndexList[i];!this.getModel().getDrawableDynamicFlagIsVisible(n)||(this.setClippingContextBufferForDraw(this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw()[n]:null),this.setIsCulling(this.getModel().getDrawableCulling(n)),this.drawMesh(this.getModel().getDrawableTextureIndices(n),this.getModel().getDrawableVertexIndexCount(n),this.getModel().getDrawableVertexCount(n),this.getModel().getDrawableVertexIndices(n),this.getModel().getDrawableVertices(n),this.getModel().getDrawableVertexUvs(n),this.getModel().getDrawableOpacity(n),this.getModel().getDrawableBlendMode(n),this.getModel().getDrawableInvertedMaskBit(n)))}}drawMesh(t,e,i,n,s,o,a,u,l){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const h=this.getModelColor();this.getClippingContextBufferForMask()==null&&(h.A*=a,this.isPremultipliedAlpha()&&(h.R*=h.A,h.G*=h.A,h.B*=h.A));let c=null;this._textures[t]!=null&&(c=this._textures[t]),er.getInstance().setupShaderProgram(this,c,i,s,n,o,this._bufferData,a,u,h,this.isPremultipliedAlpha(),this.getMvpMatrix(),l),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}static doStaticRelease(){er.deleteInstance()}setRenderState(t,e){os=t,_r=e}preDraw(){this.firstDraw&&(this.firstDraw=!1,this._anisortopy=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager.setGL(t),er.getInstance().setGl(t)}}Ls.staticRelease=()=>{cl.doStaticRelease()};const Ea=new St;class ug extends Ju{constructor(t,e,i){super(),this.lipSync=!0,this.breath=Us.create(),this.renderer=new cl,this.idParamAngleX=zm,this.idParamAngleY=Wm,this.idParamAngleZ=Ym,this.idParamEyeBallX=qm,this.idParamEyeBallY=Km,this.idParamBodyAngleX=Zm,this.idParamBreath=Jm,this.pixelsPerUnit=1,this.centeringTransform=new ot,this.coreModel=t,this.settings=e,this.motionManager=new $m(e,i),this.init()}init(){var t;super.init(),((t=this.settings.getEyeBlinkParameters())==null?void 0:t.length)>0&&(this.eyeBlink=hl.create(this.settings)),this.breath.setParameters([new mr(this.idParamAngleX,0,15,6.5345,.5),new mr(this.idParamAngleY,0,8,3.5345,.5),new mr(this.idParamAngleZ,0,10,5.5345,.5),new mr(this.idParamBodyAngleX,0,4,15.5345,.5),new mr(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const t={};if(this.settings.layout)for(const e of Object.keys(this.settings.layout)){const i=e.charAt(0).toLowerCase()+e.slice(1);t[i]=this.settings.layout[e]}return t}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(t,e){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(t),this.renderer._clippingManager._currentFrameNo=e,this.renderer._clippingManager._maskTexture=void 0,er.getInstance()._shaderSets=[]}bindTexture(t,e){this.renderer.bindTexture(t,e)}getHitAreaDefs(){var t,e;return(e=(t=this.settings.hitAreas)==null?void 0:t.map(i=>({id:i.Id,name:i.Name,index:this.coreModel.getDrawableIndex(i.Id)})))!=null?e:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(t){return this.coreModel.getDrawableIndex(t)}getDrawableVertices(t){if(typeof t=="string"&&(t=this.coreModel.getDrawableIndex(t),t===-1))throw new TypeError("Unable to find drawable ID: "+t);const e=this.coreModel.getDrawableVertices(t).slice();for(let i=0;i<e.length;i+=2)e[i]=e[i]*this.pixelsPerUnit+this.originalWidth/2,e[i+1]=-e[i+1]*this.pixelsPerUnit+this.originalHeight/2;return e}updateTransform(t){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(t)}update(t,e){var i,n,s,o;super.update(t,e),t/=1e3,e/=1e3;const a=this.coreModel;this.emit("beforeMotionUpdate");const u=this.motionManager.update(this.coreModel,e);this.emit("afterMotionUpdate"),a.saveParameters(),(i=this.motionManager.expressionManager)==null||i.update(a,e),u||(n=this.eyeBlink)==null||n.updateParameters(a,t),this.updateFocus(),this.updateNaturalMovements(t*1e3,e*1e3),(s=this.physics)==null||s.evaluate(a,t),(o=this.pose)==null||o.updateParameters(a,t),this.emit("beforeModelUpdate"),a.update(),a.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,this.focusController.x*30),this.coreModel.addParameterValueById(this.idParamAngleY,this.focusController.y*30),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,this.focusController.x*10)}updateNaturalMovements(t,e){var i;(i=this.breath)==null||i.updateParameters(this.coreModel,t/1e3)}draw(t){const e=this.drawingMatrix,i=Ea.getArray();i[0]=e.a,i[1]=e.b,i[4]=-e.c,i[5]=-e.d,i[12]=e.tx,i[13]=e.ty,this.renderer.setMvpMatrix(Ea),this.renderer.setRenderState(t.getParameter(t.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}let hi,Ta=20;function lg(){return Nr.isStarted()?Promise.resolve():(hi??(hi=new Promise((r,t)=>{function e(){try{hg(),r()}catch(i){if(Ta--,Ta<0){const n=new Error("Failed to start up Cubism 4 framework.");n.cause=i,t(n);return}L.log("Cubism4","Startup failed, retrying 10ms later..."),setTimeout(e,10)}}e()})),hi)}function hg(r){r=Object.assign({logFunction:console.log,loggingLevel:Ue.LogLevel_Verbose},r),Nr.startUp(r),Nr.initialize()}const cg=.001,wa=.5;class Gs{static create(t){const e=new Gs;typeof t.FadeInTime=="number"&&(e._fadeTimeSeconds=t.FadeInTime,e._fadeTimeSeconds<=0&&(e._fadeTimeSeconds=wa));const i=t.Groups,n=i.length;for(let s=0;s<n;++s){const o=i[s],a=o.length;let u=0;for(let l=0;l<a;++l){const h=o[l],c=new Si;c.partId=h.Id;const f=h.Link;if(f){const d=f.length;for(let p=0;p<d;++p){const v=new Si;v.partId=f[p],c.link.push(v)}}e._partGroups.push(c),++u}e._partGroupCounts.push(u)}return e}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let n=0;n<this._partGroupCounts.length;n++){const s=this._partGroupCounts[n];this.doFade(t,e,i,s),i+=s}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.length;++i){const n=this._partGroupCounts[i];for(let s=e;s<e+n;++s){this._partGroups[s].initialize(t);const o=this._partGroups[s].partIndex,a=this._partGroups[s].parameterIndex;if(!(o<0)){t.setPartOpacityByIndex(o,s==e?1:0),t.setParameterValueByIndex(a,s==e?1:0);for(let u=0;u<this._partGroups[s].link.length;++u)this._partGroups[s].link[u].initialize(t)}}e+=n}}copyPartOpacities(t){for(let e=0;e<this._partGroups.length;++e){const i=this._partGroups[e];if(i.link.length==0)continue;const n=this._partGroups[e].partIndex,s=t.getPartOpacityByIndex(n);for(let o=0;o<i.link.length;++o){const u=i.link[o].partIndex;u<0||t.setPartOpacityByIndex(u,s)}}}doFade(t,e,i,n){let s=-1,o=1;const a=.5,u=.15;for(let l=i;l<i+n;++l){const h=this._partGroups[l].partIndex,c=this._partGroups[l].parameterIndex;if(t.getParameterValueByIndex(c)>cg){if(s>=0)break;s=l,o=t.getPartOpacityByIndex(h),o+=e/this._fadeTimeSeconds,o>1&&(o=1)}}s<0&&(s=0,o=1);for(let l=i;l<i+n;++l){const h=this._partGroups[l].partIndex;if(s==l)t.setPartOpacityByIndex(h,o);else{let c=t.getPartOpacityByIndex(h),f;o<a?f=o*(a-1)/a+1:f=(1-o)*a/(1-a),(1-f)*(1-o)>u&&(f=1-u/(1-o)),c>f&&(c=f),t.setPartOpacityByIndex(h,c)}}}constructor(){this._fadeTimeSeconds=wa,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class Si{constructor(t){this.parameterIndex=0,this.partIndex=0,this.partId="",this.link=[],t!=null&&this.assignment(t)}assignment(t){return this.partId=t.partId,this.link=t.link.map(e=>e.clone()),this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new Si;return t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=this.link.map(e=>e.clone()),t}}class fg{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.length;for(let i=0;i<t;++i)i<e?this._savedParameters[i]=this._parameterValues[i]:this._savedParameters.push(this._parameterValues[i])}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds[e])return e;return t in this._notExistPartId?this._notExistPartId[t]:(e=i+this._notExistPartId.length,this._notExistPartId[t]=e,this._notExistPartOpacities[e]=0,e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(t in this._notExistPartOpacities){this._notExistPartOpacities[t]=e;return}li(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return t in this._notExistPartOpacities?this._notExistPartOpacities[t]:(li(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds[e])return e;return t in this._notExistParameterId?this._notExistParameterId[t]:(e=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[t]=e,this._notExistParameterValues[e]=0,e)}getParameterCount(){return this._model.parameters.count}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return t in this._notExistParameterValues?this._notExistParameterValues[t]:(li(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(t in this._notExistParameterValues){this._notExistParameterValues[t]=i==1?e:this._notExistParameterValues[t]*(1-i)+e*i;return}li(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const n=this.getParameterIndex(t);this.setParameterValueByIndex(n,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const n=this.getParameterIndex(t);this.addParameterValueByIndex(n,e,i)}multiplyParameterValueById(t,e,i=1){const n=this.getParameterIndex(t);this.multiplyParameterValueByIndex(n,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds[i]==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){return this._model.drawables.ids[t]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableCulling(t){const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?re.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?re.CubismBlendMode_Multiplicative:re.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.length;t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters[i]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;for(let i=0;i<e;++i)this._parameterIds.push(t[i])}{const t=this._model.parts.ids,e=this._model.parts.count;for(let i=0;i<e;++i)this._partIds.push(t[i])}{const t=this._model.drawables.ids,e=this._model.drawables.count;for(let i=0;i<e;++i)this._drawableIds.push(t[i])}}constructor(t){this._model=t,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class Vs{static create(t){const e=Live2DCubismCore.Moc.fromArrayBuffer(t);if(e)return new Vs(e);throw new Error("Unknown error")}createModel(){let t;const e=Live2DCubismCore.Model.fromMoc(this._moc);if(e)return t=new fg(e),++this._modelCount,t;throw new Error("Unknown error")}deleteModel(t){t!=null&&--this._modelCount}constructor(t){this._moc=t,this._modelCount=0}release(){this._moc._release(),this._moc=void 0}}var as=(r=>(r[r.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",r))(as||{}),Ie=(r=>(r[r.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",r[r.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",r[r.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",r))(Ie||{});class dg{constructor(){this.initialPosition=new S(0,0),this.position=new S(0,0),this.lastPosition=new S(0,0),this.lastGravity=new S(0,0),this.force=new S(0,0),this.velocity=new S(0,0)}}class pg{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class mg{constructor(){this.source={}}}class gg{constructor(){this.destination={},this.translationScale=new S(0,0)}}class vg{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new S(0,0),this.wind=new S(0,0)}}class yg{constructor(t){this._json=t}release(){this._json=void 0}getGravity(){const t=new S(0,0);return t.x=this._json.Meta.EffectiveForces.Gravity.X,t.y=this._json.Meta.EffectiveForces.Gravity.Y,t}getWind(){const t=new S(0,0);return t.x=this._json.Meta.EffectiveForces.Wind.X,t.y=this._json.Meta.EffectiveForces.Wind.Y,t}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Default}getNormalizationAngleMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Default}getInputCount(t){return this._json.PhysicsSettings[t].Input.length}getInputWeight(t,e){return this._json.PhysicsSettings[t].Input[e].Weight}getInputReflect(t,e){return this._json.PhysicsSettings[t].Input[e].Reflect}getInputType(t,e){return this._json.PhysicsSettings[t].Input[e].Type}getInputSourceId(t,e){return this._json.PhysicsSettings[t].Input[e].Source.Id}getOutputCount(t){return this._json.PhysicsSettings[t].Output.length}getOutputVertexIndex(t,e){return this._json.PhysicsSettings[t].Output[e].VertexIndex}getOutputAngleScale(t,e){return this._json.PhysicsSettings[t].Output[e].Scale}getOutputWeight(t,e){return this._json.PhysicsSettings[t].Output[e].Weight}getOutputDestinationId(t,e){return this._json.PhysicsSettings[t].Output[e].Destination.Id}getOutputType(t,e){return this._json.PhysicsSettings[t].Output[e].Type}getOutputReflect(t,e){return this._json.PhysicsSettings[t].Output[e].Reflect}getParticleCount(t){return this._json.PhysicsSettings[t].Vertices.length}getParticleMobility(t,e){return this._json.PhysicsSettings[t].Vertices[e].Mobility}getParticleDelay(t,e){return this._json.PhysicsSettings[t].Vertices[e].Delay}getParticleAcceleration(t,e){return this._json.PhysicsSettings[t].Vertices[e].Acceleration}getParticleRadius(t,e){return this._json.PhysicsSettings[t].Vertices[e].Radius}getParticlePosition(t,e){const i=new S(0,0);return i.x=this._json.PhysicsSettings[t].Vertices[e].Position.X,i.y=this._json.PhysicsSettings[t].Vertices[e].Position.Y,i}}const Ia="X",Ca="Y",Sa="Angle",_g=5,fl=100,bg=.001;class Hs{static create(t){const e=new Hs;return e.parse(t),e._physicsRig.gravity.y=0,e}evaluate(t,e){let i,n,s,o;const a=new S;let u,l,h,c,f,d,p,v;f=t.getModel().parameters.values,d=t.getModel().parameters.maximumValues,p=t.getModel().parameters.minimumValues,v=t.getModel().parameters.defaultValues;for(let m=0;m<this._physicsRig.subRigCount;++m){i={angle:0},a.x=0,a.y=0,u=this._physicsRig.settings[m],l=this._physicsRig.inputs.slice(u.baseInputIndex),h=this._physicsRig.outputs.slice(u.baseOutputIndex),c=this._physicsRig.particles.slice(u.baseParticleIndex);for(let y=0;y<u.inputCount;++y)n=l[y].weight/fl,l[y].sourceParameterIndex==-1&&(l[y].sourceParameterIndex=t.getParameterIndex(l[y].source.id)),l[y].getNormalizedParameterValue(a,i,f[l[y].sourceParameterIndex],p[l[y].sourceParameterIndex],d[l[y].sourceParameterIndex],v[l[y].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,l[y].reflect,n);s=B.degreesToRadian(-i.angle),a.x=a.x*B.cos(s)-a.y*B.sin(s),a.y=a.x*B.sin(s)+a.y*B.cos(s),Og(c,u.particleCount,a,i.angle,this._options.wind,bg*u.normalizationPosition.maximum,e,_g);for(let y=0;y<u.outputCount;++y){const _=h[y].vertexIndex;if(_<1||_>=u.particleCount)break;h[y].destinationParameterIndex==-1&&(h[y].destinationParameterIndex=t.getParameterIndex(h[y].destination.id));const g=new S;g.x=c[_].position.x-c[_-1].position.x,g.y=c[_].position.y-c[_-1].position.y,o=h[y].getValue(g,c,_,h[y].reflect,this._options.gravity);const b=h[y].destinationParameterIndex,E=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(f.subarray(b))):f.slice(b);Dg(E,p[b],d[b],o,h[y]);for(let T=b,M=0;T<f.length;T++,M++)f[T]=E[M]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._options=new xg,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0}release(){this._physicsRig=void 0}parse(t){this._physicsRig=new vg;let e=new yg(t);this._physicsRig.gravity=e.getGravity(),this._physicsRig.wind=e.getWind(),this._physicsRig.subRigCount=e.getSubRigCount();let i=0,n=0,s=0;for(let o=0;o<this._physicsRig.subRigCount;++o){const a=new pg;a.normalizationPosition.minimum=e.getNormalizationPositionMinimumValue(o),a.normalizationPosition.maximum=e.getNormalizationPositionMaximumValue(o),a.normalizationPosition.defalut=e.getNormalizationPositionDefaultValue(o),a.normalizationAngle.minimum=e.getNormalizationAngleMinimumValue(o),a.normalizationAngle.maximum=e.getNormalizationAngleMaximumValue(o),a.normalizationAngle.defalut=e.getNormalizationAngleDefaultValue(o),a.inputCount=e.getInputCount(o),a.baseInputIndex=i,i+=a.inputCount;for(let u=0;u<a.inputCount;++u){const l=new mg;switch(l.sourceParameterIndex=-1,l.weight=e.getInputWeight(o,u),l.reflect=e.getInputReflect(o,u),e.getInputType(o,u)){case Ia:l.type=Ie.CubismPhysicsSource_X,l.getNormalizedParameterValue=Eg;break;case Ca:l.type=Ie.CubismPhysicsSource_Y,l.getNormalizedParameterValue=Tg;break;case Sa:l.type=Ie.CubismPhysicsSource_Angle,l.getNormalizedParameterValue=wg;break}l.source.targetType=as.CubismPhysicsTargetType_Parameter,l.source.id=e.getInputSourceId(o,u),this._physicsRig.inputs.push(l)}a.outputCount=e.getOutputCount(o),a.baseOutputIndex=n,n+=a.outputCount;for(let u=0;u<a.outputCount;++u){const l=new gg;switch(l.destinationParameterIndex=-1,l.vertexIndex=e.getOutputVertexIndex(o,u),l.angleScale=e.getOutputAngleScale(o,u),l.weight=e.getOutputWeight(o,u),l.destination.targetType=as.CubismPhysicsTargetType_Parameter,l.destination.id=e.getOutputDestinationId(o,u),e.getOutputType(o,u)){case Ia:l.type=Ie.CubismPhysicsSource_X,l.getValue=Ig,l.getScale=Mg;break;case Ca:l.type=Ie.CubismPhysicsSource_Y,l.getValue=Cg,l.getScale=Rg;break;case Sa:l.type=Ie.CubismPhysicsSource_Angle,l.getValue=Sg,l.getScale=Fg;break}l.reflect=e.getOutputReflect(o,u),this._physicsRig.outputs.push(l)}a.particleCount=e.getParticleCount(o),a.baseParticleIndex=s,s+=a.particleCount;for(let u=0;u<a.particleCount;++u){const l=new dg;l.mobility=e.getParticleMobility(o,u),l.delay=e.getParticleDelay(o,u),l.acceleration=e.getParticleAcceleration(o,u),l.radius=e.getParticleRadius(o,u),l.position=e.getParticlePosition(o,u),this._physicsRig.particles.push(l)}this._physicsRig.settings.push(a)}this.initialize(),e.release()}initialize(){let t,e,i;for(let n=0;n<this._physicsRig.subRigCount;++n){e=this._physicsRig.settings[n],t=this._physicsRig.particles.slice(e.baseParticleIndex),t[0].initialPosition=new S(0,0),t[0].lastPosition=new S(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new S(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new S(0,0),t[0].force=new S(0,0);for(let s=1;s<e.particleCount;++s)i=new S(0,0),i.y=t[s].radius,t[s].initialPosition=new S(t[s-1].initialPosition.x+i.x,t[s-1].initialPosition.y+i.y),t[s].position=new S(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastPosition=new S(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastGravity=new S(0,-1),t[s].lastGravity.y*=-1,t[s].velocity=new S(0,0),t[s].force=new S(0,0)}}}class xg{constructor(){this.gravity=new S(0,0),this.wind=new S(0,0)}}function Eg(r,t,e,i,n,s,o,a,u,l){r.x+=Xs(e,i,n,s,o.minimum,o.maximum,o.defalut,u)*l}function Tg(r,t,e,i,n,s,o,a,u,l){r.y+=Xs(e,i,n,s,o.minimum,o.maximum,o.defalut,u)*l}function wg(r,t,e,i,n,s,o,a,u,l){t.angle+=Xs(e,i,n,s,a.minimum,a.maximum,a.defalut,u)*l}function Ig(r,t,e,i,n){let s=r.x;return i&&(s*=-1),s}function Cg(r,t,e,i,n){let s=r.y;return i&&(s*=-1),s}function Sg(r,t,e,i,n){let s;return e>=2?n=t[e-1].position.substract(t[e-2].position):n=n.multiplyByScaler(-1),s=B.directionToRadian(n,r),i&&(s*=-1),s}function Ag(r,t){return Math.abs(Math.max(r,t)-Math.min(r,t))}function Pg(r,t){return Math.min(r,t)+Ag(r,t)/2}function Mg(r,t){return r.x}function Rg(r,t){return r.y}function Fg(r,t){return t}function Og(r,t,e,i,n,s,o,a){let u,l,h,c,f=new S(0,0),d=new S(0,0),p=new S(0,0),v=new S(0,0);r[0].position=new S(e.x,e.y),u=B.degreesToRadian(i),c=B.radianToDirection(u),c.normalize();for(let m=1;m<t;++m)r[m].force=c.multiplyByScaler(r[m].acceleration).add(n),r[m].lastPosition=new S(r[m].position.x,r[m].position.y),l=r[m].delay*o*30,f=r[m].position.substract(r[m-1].position),h=B.directionToRadian(r[m].lastGravity,c)/a,f.x=B.cos(h)*f.x-f.y*B.sin(h),f.y=B.sin(h)*f.x+f.y*B.cos(h),r[m].position=r[m-1].position.add(f),d=r[m].velocity.multiplyByScaler(l),p=r[m].force.multiplyByScaler(l).multiplyByScaler(l),r[m].position=r[m].position.add(d).add(p),v=r[m].position.substract(r[m-1].position),v.normalize(),r[m].position=r[m-1].position.add(v.multiplyByScaler(r[m].radius)),B.abs(r[m].position.x)<s&&(r[m].position.x=0),l!=0&&(r[m].velocity=r[m].position.substract(r[m].lastPosition),r[m].velocity=r[m].velocity.divisionByScalar(l),r[m].velocity=r[m].velocity.multiplyByScaler(r[m].mobility)),r[m].force=new S(0,0),r[m].lastGravity=new S(c.x,c.y)}function Dg(r,t,e,i,n){let s,o,a;s=n.getScale(n.translationScale,n.angleScale),o=i*s,o<t?(o<n.valueBelowMinimum&&(n.valueBelowMinimum=o),o=t):o>e&&(o>n.valueExceededMaximum&&(n.valueExceededMaximum=o),o=e),a=n.weight/fl,a>=1||(o=r[0]*(1-a)+o*a),r[0]=o}function Xs(r,t,e,i,n,s,o,a){let u=0;const l=B.max(e,t);l<r&&(r=l);const h=B.min(e,t);h>r&&(r=h);const c=B.min(n,s),f=B.max(n,s),d=o,p=Pg(h,l),v=r-p;switch(Math.sign(v)){case 1:{const m=f-d,y=l-p;y!=0&&(u=v*(m/y),u+=d);break}case-1:{const m=c-d,y=h-p;y!=0&&(u=v*(m/y),u+=d);break}case 0:{u=d;break}}return a?u:u*-1}G.registerRuntime({version:4,ready:lg,test(r){return r instanceof tr||tr.isValidJSON(r)},isValidMoc(r){if(r.byteLength<4)return!1;const t=new Int8Array(r,0,4);return String.fromCharCode(...t)==="MOC3"},createModelSettings(r){return new tr(r)},createCoreModel(r){const t=Vs.create(r);try{const e=t.createModel();return e.__moc=t,e}catch(e){try{t.release()}catch{}throw e}},createInternalModel(r,t,e){const i=new ug(r,t,e),n=r;return n.__moc&&(i.__moc=n.__moc,delete n.__moc,i.once("destroy",Lg)),i},createPhysics(r,t){return Hs.create(t)},createPose(r,t){return Gs.create(t)}});function Lg(){var r;(r=this.__moc)==null||r.release()}Os.registerTicker(Rt);Rs.registerPlugin(cd);Ps.registerPlugin("interaction",em);const Be=document.getElementById("canvas"),Ye=new Rs({backgroundAlpha:0,view:Be}),mt=await Os.from("live2d/shizuku.model.json",{autoInteract:!1,motionPreload:Zu.IDLE});Ye.stage.addChild(mt);let js=!1;Be.addEventListener("pointerdown",r=>mt.tap(r.clientX,r.clientY));Be.addEventListener("pointerenter",()=>js=!0);Be.addEventListener("pointerleave",()=>{mt.internalModel.focusController.focus(0,0),js=!1});Be.addEventListener("pointermove",({clientX:r,clientY:t})=>{js&&mt.focus(r,t)});mt.on("hit",r=>{r.includes("head")&&mt.motion("shake",1)});const Bg={happy:1,sad:2,angry:3},Ng={talk:[["tap_body",0],["tap_body",2],["pinch_out",0],["flick_head",1],["flick_head",2]],cheer:[["tap_body",1]],mouthcover:[["pinch_in",0],["pinch_in",1],["pinch_in",2]],disagree:[["pinch_out",1],["pinch_out",2]],surprised:[["shake",0],["shake",2]],laugh:[["shake",1]]};$s();setTimeout(()=>$s(),250);function $s(){const r={md:window.innerWidth>720&&window.innerWidth<1e3,lg:window.innerWidth>=1e3};Be.width=window.innerWidth,Be.height=window.innerHeight,!r.md&&!r.lg&&(Ye.renderer.screen.width=window.innerWidth),Ye.renderer.screen.height=window.innerHeight;const t={x:r.lg?1:.5,y:.85},e={x:r.lg?.4:r.md?.35:.25,y:r.lg?.475:r.md?.425:.3},i=r.md?mt.width/2.35:r.lg?mt.width:Ye.renderer.screen.width/2,n=r.md||r.lg?Ye.renderer.screen.height:mt.height;mt.anchor.set(t.x,t.y),mt.scale.set(e.x,e.y),mt.x=i,mt.y=n}window.addEventListener("resize",$s);const dl={app:Ye,expressions:Bg,model:mt,motions:Ng};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pl=function(r){const t=[];let e=0;for(let i=0;i<r.length;i++){let n=r.charCodeAt(i);n<128?t[e++]=n:n<2048?(t[e++]=n>>6|192,t[e++]=n&63|128):(n&64512)===55296&&i+1<r.length&&(r.charCodeAt(i+1)&64512)===56320?(n=65536+((n&1023)<<10)+(r.charCodeAt(++i)&1023),t[e++]=n>>18|240,t[e++]=n>>12&63|128,t[e++]=n>>6&63|128,t[e++]=n&63|128):(t[e++]=n>>12|224,t[e++]=n>>6&63|128,t[e++]=n&63|128)}return t},kg=function(r){const t=[];let e=0,i=0;for(;e<r.length;){const n=r[e++];if(n<128)t[i++]=String.fromCharCode(n);else if(n>191&&n<224){const s=r[e++];t[i++]=String.fromCharCode((n&31)<<6|s&63)}else if(n>239&&n<365){const s=r[e++],o=r[e++],a=r[e++],u=((n&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(u>>10)),t[i++]=String.fromCharCode(56320+(u&1023))}else{const s=r[e++],o=r[e++];t[i++]=String.fromCharCode((n&15)<<12|(s&63)<<6|o&63)}}return t.join("")},ml={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let n=0;n<r.length;n+=3){const s=r[n],o=n+1<r.length,a=o?r[n+1]:0,u=n+2<r.length,l=u?r[n+2]:0,h=s>>2,c=(s&3)<<4|a>>4;let f=(a&15)<<2|l>>6,d=l&63;u||(d=64,o||(f=64)),i.push(e[h],e[c],e[f],e[d])}return i.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(pl(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):kg(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let n=0;n<r.length;){const s=e[r.charAt(n++)],a=n<r.length?e[r.charAt(n)]:0;++n;const l=n<r.length?e[r.charAt(n)]:64;++n;const c=n<r.length?e[r.charAt(n)]:64;if(++n,s==null||a==null||l==null||c==null)throw new Ug;const f=s<<2|a>>4;if(i.push(f),l!==64){const d=a<<4&240|l>>2;if(i.push(d),c!==64){const p=l<<6&192|c;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Ug extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Gg=function(r){const t=pl(r);return ml.encodeByteArray(t,!0)},gl=function(r){return Gg(r).replace(/\./g,"")},Vg=function(r){try{return ml.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hg(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xg=()=>Hg().__FIREBASE_DEFAULTS__,jg=()=>{if(typeof process>"u"||typeof process.env>"u")return;const r={}.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},$g=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&Vg(r[1]);return t&&JSON.parse(t)},zg=()=>{try{return Xg()||jg()||$g()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},vl=()=>{var r;return(r=zg())===null||r===void 0?void 0:r.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}}function Yg(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function yl(){try{return typeof indexedDB=="object"}catch{return!1}}function _l(){return new Promise((r,t)=>{try{let e=!0;const i="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(i);n.onsuccess=()=>{n.result.close(),e||self.indexedDB.deleteDatabase(i),r(!0)},n.onupgradeneeded=()=>{e=!1},n.onerror=()=>{var s;t(((s=n.error)===null||s===void 0?void 0:s.message)||"")}}catch(e){t(e)}})}function qg(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kg="FirebaseError";class fe extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Kg,Object.setPrototypeOf(this,fe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Hi.prototype.create)}}class Hi{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},n=`${this.service}/${t}`,s=this.errors[t],o=s?Zg(s,i):"Error",a=`${this.serviceName}: ${o} (${n}).`;return new fe(n,a,i)}}function Zg(r,t){return r.replace(Jg,(e,i)=>{const n=t[i];return n!=null?String(n):`<${i}?>`})}const Jg=/\{\$([^}]+)}/g;function Ai(r,t){if(r===t)return!0;const e=Object.keys(r),i=Object.keys(t);for(const n of e){if(!i.includes(n))return!1;const s=r[n],o=t[n];if(Aa(s)&&Aa(o)){if(!Ai(s,o))return!1}else if(s!==o)return!1}for(const n of i)if(!e.includes(n))return!1;return!0}function Aa(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qg=1e3,tv=2,ev=4*60*60*1e3,rv=.5;function Pa(r,t=Qg,e=tv){const i=t*Math.pow(e,r),n=Math.round(rv*i*(Math.random()-.5)*2);return Math.min(ev,i+n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zs(r){return r&&r._delegate?r._delegate:r}class Wt{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ce="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const i=new Wg;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&i.resolve(n)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(t?.identifier),n=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(sv(t))try{this.getOrInitializeService({instanceIdentifier:Ce})}catch{}for(const[e,i]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const s=this.getOrInitializeService({instanceIdentifier:n});i.resolve(s)}catch{}}}}clearInstance(t=Ce){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ce){return this.instances.has(t)}getOptions(t=Ce){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(n)}return n}onInit(t,e){var i;const n=this.normalizeInstanceIdentifier(e),s=(i=this.onInitCallbacks.get(n))!==null&&i!==void 0?i:new Set;s.add(t),this.onInitCallbacks.set(n,s);const o=this.instances.get(n);return o&&t(o,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(!!i)for(const n of i)try{n(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:nv(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=Ce){return this.component?this.component.multipleInstances?t:Ce:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function nv(r){return r===Ce?void 0:r}function sv(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ov{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new iv(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var k;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(k||(k={}));const av={debug:k.DEBUG,verbose:k.VERBOSE,info:k.INFO,warn:k.WARN,error:k.ERROR,silent:k.SILENT},uv=k.INFO,lv={[k.DEBUG]:"log",[k.VERBOSE]:"log",[k.INFO]:"info",[k.WARN]:"warn",[k.ERROR]:"error"},hv=(r,t,...e)=>{if(t<r.logLevel)return;const i=new Date().toISOString(),n=lv[t];if(n)console[n](`[${i}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class bl{constructor(t){this.name=t,this._logLevel=uv,this._logHandler=hv,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in k))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?av[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,k.DEBUG,...t),this._logHandler(this,k.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,k.VERBOSE,...t),this._logHandler(this,k.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,k.INFO,...t),this._logHandler(this,k.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,k.WARN,...t),this._logHandler(this,k.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,k.ERROR,...t),this._logHandler(this,k.ERROR,...t)}}const cv=(r,t)=>t.some(e=>r instanceof e);let Ma,Ra;function fv(){return Ma||(Ma=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dv(){return Ra||(Ra=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xl=new WeakMap,us=new WeakMap,El=new WeakMap,Cn=new WeakMap,Ws=new WeakMap;function pv(r){const t=new Promise((e,i)=>{const n=()=>{r.removeEventListener("success",s),r.removeEventListener("error",o)},s=()=>{e(ie(r.result)),n()},o=()=>{i(r.error),n()};r.addEventListener("success",s),r.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&xl.set(e,r)}).catch(()=>{}),Ws.set(t,r),t}function mv(r){if(us.has(r))return;const t=new Promise((e,i)=>{const n=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",o),r.removeEventListener("abort",o)},s=()=>{e(),n()},o=()=>{i(r.error||new DOMException("AbortError","AbortError")),n()};r.addEventListener("complete",s),r.addEventListener("error",o),r.addEventListener("abort",o)});us.set(r,t)}let ls={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return us.get(r);if(t==="objectStoreNames")return r.objectStoreNames||El.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ie(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function gv(r){ls=r(ls)}function vv(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const i=r.call(Sn(this),t,...e);return El.set(i,t.sort?t.sort():[t]),ie(i)}:dv().includes(r)?function(...t){return r.apply(Sn(this),t),ie(xl.get(this))}:function(...t){return ie(r.apply(Sn(this),t))}}function yv(r){return typeof r=="function"?vv(r):(r instanceof IDBTransaction&&mv(r),cv(r,fv())?new Proxy(r,ls):r)}function ie(r){if(r instanceof IDBRequest)return pv(r);if(Cn.has(r))return Cn.get(r);const t=yv(r);return t!==r&&(Cn.set(r,t),Ws.set(t,r)),t}const Sn=r=>Ws.get(r);function Tl(r,t,{blocked:e,upgrade:i,blocking:n,terminated:s}={}){const o=indexedDB.open(r,t),a=ie(o);return i&&o.addEventListener("upgradeneeded",u=>{i(ie(o.result),u.oldVersion,u.newVersion,ie(o.transaction),u)}),e&&o.addEventListener("blocked",u=>e(u.oldVersion,u.newVersion,u)),a.then(u=>{s&&u.addEventListener("close",()=>s()),n&&u.addEventListener("versionchange",l=>n(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const _v=["get","getKey","getAll","getAllKeys","count"],bv=["put","add","delete","clear"],An=new Map;function Fa(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(An.get(t))return An.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,n=bv.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(n||_v.includes(e)))return;const s=async function(o,...a){const u=this.transaction(o,n?"readwrite":"readonly");let l=u.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[e](...a),n&&u.done]))[0]};return An.set(t,s),s}gv(r=>({...r,get:(t,e,i)=>Fa(t,e)||r.get(t,e,i),has:(t,e)=>!!Fa(t,e)||r.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Ev(e)){const i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}}function Ev(r){const t=r.getComponent();return t?.type==="VERSION"}const hs="@firebase/app",Oa="0.10.15";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yt=new bl("@firebase/app"),Tv="@firebase/app-compat",wv="@firebase/analytics-compat",Iv="@firebase/analytics",Cv="@firebase/app-check-compat",Sv="@firebase/app-check",Av="@firebase/auth",Pv="@firebase/auth-compat",Mv="@firebase/database",Rv="@firebase/data-connect",Fv="@firebase/database-compat",Ov="@firebase/functions",Dv="@firebase/functions-compat",Lv="@firebase/installations",Bv="@firebase/installations-compat",Nv="@firebase/messaging",kv="@firebase/messaging-compat",Uv="@firebase/performance",Gv="@firebase/performance-compat",Vv="@firebase/remote-config",Hv="@firebase/remote-config-compat",Xv="@firebase/storage",jv="@firebase/storage-compat",$v="@firebase/firestore",zv="@firebase/vertexai",Wv="@firebase/firestore-compat",Yv="firebase";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cs="[DEFAULT]",qv={[hs]:"fire-core",[Tv]:"fire-core-compat",[Iv]:"fire-analytics",[wv]:"fire-analytics-compat",[Sv]:"fire-app-check",[Cv]:"fire-app-check-compat",[Av]:"fire-auth",[Pv]:"fire-auth-compat",[Mv]:"fire-rtdb",[Rv]:"fire-data-connect",[Fv]:"fire-rtdb-compat",[Ov]:"fire-fn",[Dv]:"fire-fn-compat",[Lv]:"fire-iid",[Bv]:"fire-iid-compat",[Nv]:"fire-fcm",[kv]:"fire-fcm-compat",[Uv]:"fire-perf",[Gv]:"fire-perf-compat",[Vv]:"fire-rc",[Hv]:"fire-rc-compat",[Xv]:"fire-gcs",[jv]:"fire-gcs-compat",[$v]:"fire-fst",[Wv]:"fire-fst-compat",[zv]:"fire-vertex","fire-js":"fire-js",[Yv]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pi=new Map,Kv=new Map,fs=new Map;function Da(r,t){try{r.container.addComponent(t)}catch(e){Yt.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function le(r){const t=r.name;if(fs.has(t))return Yt.debug(`There were multiple attempts to register component ${t}.`),!1;fs.set(t,r);for(const e of Pi.values())Da(e,r);for(const e of Kv.values())Da(e,r);return!0}function jr(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zv={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},ne=new Hi("app","Firebase",Zv);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Wt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ne.create("app-deleted",{appName:this._name})}}function wl(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const i=Object.assign({name:cs,automaticDataCollectionEnabled:!1},t),n=i.name;if(typeof n!="string"||!n)throw ne.create("bad-app-name",{appName:String(n)});if(e||(e=vl()),!e)throw ne.create("no-options");const s=Pi.get(n);if(s){if(Ai(e,s.options)&&Ai(i,s.config))return s;throw ne.create("duplicate-app",{appName:n})}const o=new ov(n);for(const u of fs.values())o.addComponent(u);const a=new Jv(e,i,o);return Pi.set(n,a),a}function Il(r=cs){const t=Pi.get(r);if(!t&&r===cs&&vl())return wl();if(!t)throw ne.create("no-app",{appName:r});return t}function Ht(r,t,e){var i;let n=(i=qv[r])!==null&&i!==void 0?i:r;e&&(n+=`-${e}`);const s=n.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Yt.warn(a.join(" "));return}le(new Wt(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv="firebase-heartbeat-database",ty=1,kr="firebase-heartbeat-store";let Pn=null;function Cl(){return Pn||(Pn=Tl(Qv,ty,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(kr)}catch(e){console.warn(e)}}}}).catch(r=>{throw ne.create("idb-open",{originalErrorMessage:r.message})})),Pn}async function ey(r){try{const e=(await Cl()).transaction(kr),i=await e.objectStore(kr).get(Sl(r));return await e.done,i}catch(t){if(t instanceof fe)Yt.warn(t.message);else{const e=ne.create("idb-get",{originalErrorMessage:t?.message});Yt.warn(e.message)}}}async function La(r,t){try{const i=(await Cl()).transaction(kr,"readwrite");await i.objectStore(kr).put(t,Sl(r)),await i.done}catch(e){if(e instanceof fe)Yt.warn(e.message);else{const i=ne.create("idb-set",{originalErrorMessage:e?.message});Yt.warn(i.message)}}}function Sl(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ry=1024,iy=30*24*60*60*1e3;class ny{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new oy(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ba();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=iy}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Yt.warn(i)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Ba(),{heartbeatsToSend:i,unsentEntries:n}=sy(this._heartbeatsCache.heartbeats),s=gl(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Yt.warn(e),""}}}function Ba(){return new Date().toISOString().substring(0,10)}function sy(r,t=ry){const e=[];let i=r.slice();for(const n of r){const s=e.find(o=>o.agent===n.agent);if(s){if(s.dates.push(n.date),Na(e)>t){s.dates.pop();break}}else if(e.push({agent:n.agent,dates:[n.date]}),Na(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}class oy{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return yl()?_l().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await ey(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return La(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return La(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function Na(r){return gl(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ay(r){le(new Wt("platform-logger",t=>new xv(t),"PRIVATE")),le(new Wt("heartbeat",t=>new ny(t),"PRIVATE")),Ht(hs,Oa,r),Ht(hs,Oa,"esm2017"),Ht("fire-js","")}ay("");var uy="firebase",ly="11.0.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ht(uy,ly,"app");const Al="@firebase/installations",Ys="0.6.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pl=1e4,Ml=`w:${Ys}`,Rl="FIS_v2",hy="https://firebaseinstallations.googleapis.com/v1",cy=60*60*1e3,fy="installations",dy="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const py={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},Ne=new Hi(fy,dy,py);function Fl(r){return r instanceof fe&&r.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ol({projectId:r}){return`${hy}/projects/${r}/installations`}function Dl(r){return{token:r.token,requestStatus:2,expiresIn:gy(r.expiresIn),creationTime:Date.now()}}async function Ll(r,t){const i=(await t.json()).error;return Ne.create("request-failed",{requestName:r,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function Bl({apiKey:r}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":r})}function my(r,{refreshToken:t}){const e=Bl(r);return e.append("Authorization",vy(t)),e}async function Nl(r){const t=await r();return t.status>=500&&t.status<600?r():t}function gy(r){return Number(r.replace("s","000"))}function vy(r){return`${Rl} ${r}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yy({appConfig:r,heartbeatServiceProvider:t},{fid:e}){const i=Ol(r),n=Bl(r),s=t.getImmediate({optional:!0});if(s){const l=await s.getHeartbeatsHeader();l&&n.append("x-firebase-client",l)}const o={fid:e,authVersion:Rl,appId:r.appId,sdkVersion:Ml},a={method:"POST",headers:n,body:JSON.stringify(o)},u=await Nl(()=>fetch(i,a));if(u.ok){const l=await u.json();return{fid:l.fid||e,registrationStatus:2,refreshToken:l.refreshToken,authToken:Dl(l.authToken)}}else throw await Ll("Create Installation",u)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kl(r){return new Promise(t=>{setTimeout(t,r)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _y(r){return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const by=/^[cdef][\w-]{21}$/,ds="";function xy(){try{const r=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(r),r[0]=112+r[0]%16;const e=Ey(r);return by.test(e)?e:ds}catch{return ds}}function Ey(r){return _y(r).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xi(r){return`${r.appName}!${r.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ul=new Map;function Gl(r,t){const e=Xi(r);Vl(e,t),Ty(e,t)}function Vl(r,t){const e=Ul.get(r);if(!!e)for(const i of e)i(t)}function Ty(r,t){const e=wy();e&&e.postMessage({key:r,fid:t}),Iy()}let Me=null;function wy(){return!Me&&"BroadcastChannel"in self&&(Me=new BroadcastChannel("[Firebase] FID Change"),Me.onmessage=r=>{Vl(r.data.key,r.data.fid)}),Me}function Iy(){Ul.size===0&&Me&&(Me.close(),Me=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cy="firebase-installations-database",Sy=1,ke="firebase-installations-store";let Mn=null;function qs(){return Mn||(Mn=Tl(Cy,Sy,{upgrade:(r,t)=>{switch(t){case 0:r.createObjectStore(ke)}}})),Mn}async function Mi(r,t){const e=Xi(r),n=(await qs()).transaction(ke,"readwrite"),s=n.objectStore(ke),o=await s.get(e);return await s.put(t,e),await n.done,(!o||o.fid!==t.fid)&&Gl(r,t.fid),t}async function Hl(r){const t=Xi(r),i=(await qs()).transaction(ke,"readwrite");await i.objectStore(ke).delete(t),await i.done}async function ji(r,t){const e=Xi(r),n=(await qs()).transaction(ke,"readwrite"),s=n.objectStore(ke),o=await s.get(e),a=t(o);return a===void 0?await s.delete(e):await s.put(a,e),await n.done,a&&(!o||o.fid!==a.fid)&&Gl(r,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ks(r){let t;const e=await ji(r.appConfig,i=>{const n=Ay(i),s=Py(r,n);return t=s.registrationPromise,s.installationEntry});return e.fid===ds?{installationEntry:await t}:{installationEntry:e,registrationPromise:t}}function Ay(r){const t=r||{fid:xy(),registrationStatus:0};return Xl(t)}function Py(r,t){if(t.registrationStatus===0){if(!navigator.onLine){const n=Promise.reject(Ne.create("app-offline"));return{installationEntry:t,registrationPromise:n}}const e={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=My(r,e);return{installationEntry:e,registrationPromise:i}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:Ry(r)}:{installationEntry:t}}async function My(r,t){try{const e=await yy(r,t);return Mi(r.appConfig,e)}catch(e){throw Fl(e)&&e.customData.serverCode===409?await Hl(r.appConfig):await Mi(r.appConfig,{fid:t.fid,registrationStatus:0}),e}}async function Ry(r){let t=await ka(r.appConfig);for(;t.registrationStatus===1;)await kl(100),t=await ka(r.appConfig);if(t.registrationStatus===0){const{installationEntry:e,registrationPromise:i}=await Ks(r);return i||e}return t}function ka(r){return ji(r,t=>{if(!t)throw Ne.create("installation-not-found");return Xl(t)})}function Xl(r){return Fy(r)?{fid:r.fid,registrationStatus:0}:r}function Fy(r){return r.registrationStatus===1&&r.registrationTime+Pl<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oy({appConfig:r,heartbeatServiceProvider:t},e){const i=Dy(r,e),n=my(r,e),s=t.getImmediate({optional:!0});if(s){const l=await s.getHeartbeatsHeader();l&&n.append("x-firebase-client",l)}const o={installation:{sdkVersion:Ml,appId:r.appId}},a={method:"POST",headers:n,body:JSON.stringify(o)},u=await Nl(()=>fetch(i,a));if(u.ok){const l=await u.json();return Dl(l)}else throw await Ll("Generate Auth Token",u)}function Dy(r,{fid:t}){return`${Ol(r)}/${t}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zs(r,t=!1){let e;const i=await ji(r.appConfig,s=>{if(!jl(s))throw Ne.create("not-registered");const o=s.authToken;if(!t&&Ny(o))return s;if(o.requestStatus===1)return e=Ly(r,t),s;{if(!navigator.onLine)throw Ne.create("app-offline");const a=Uy(s);return e=By(r,a),a}});return e?await e:i.authToken}async function Ly(r,t){let e=await Ua(r.appConfig);for(;e.authToken.requestStatus===1;)await kl(100),e=await Ua(r.appConfig);const i=e.authToken;return i.requestStatus===0?Zs(r,t):i}function Ua(r){return ji(r,t=>{if(!jl(t))throw Ne.create("not-registered");const e=t.authToken;return Gy(e)?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}async function By(r,t){try{const e=await Oy(r,t),i=Object.assign(Object.assign({},t),{authToken:e});return await Mi(r.appConfig,i),e}catch(e){if(Fl(e)&&(e.customData.serverCode===401||e.customData.serverCode===404))await Hl(r.appConfig);else{const i=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Mi(r.appConfig,i)}throw e}}function jl(r){return r!==void 0&&r.registrationStatus===2}function Ny(r){return r.requestStatus===2&&!ky(r)}function ky(r){const t=Date.now();return t<r.creationTime||r.creationTime+r.expiresIn<t+cy}function Uy(r){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},r),{authToken:t})}function Gy(r){return r.requestStatus===1&&r.requestTime+Pl<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vy(r){const t=r,{installationEntry:e,registrationPromise:i}=await Ks(t);return i?i.catch(console.error):Zs(t).catch(console.error),e.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hy(r,t=!1){const e=r;return await Xy(e),(await Zs(e,t)).token}async function Xy(r){const{registrationPromise:t}=await Ks(r);t&&await t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jy(r){if(!r||!r.options)throw Rn("App Configuration");if(!r.name)throw Rn("App Name");const t=["projectId","apiKey","appId"];for(const e of t)if(!r.options[e])throw Rn(e);return{appName:r.name,projectId:r.options.projectId,apiKey:r.options.apiKey,appId:r.options.appId}}function Rn(r){return Ne.create("missing-app-config-values",{valueName:r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $l="installations",$y="installations-internal",zy=r=>{const t=r.getProvider("app").getImmediate(),e=jy(t),i=jr(t,"heartbeat");return{app:t,appConfig:e,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},Wy=r=>{const t=r.getProvider("app").getImmediate(),e=jr(t,$l).getImmediate();return{getId:()=>Vy(e),getToken:n=>Hy(e,n)}};function Yy(){le(new Wt($l,zy,"PUBLIC")),le(new Wt($y,Wy,"PRIVATE"))}Yy();Ht(Al,Ys);Ht(Al,Ys,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ri="analytics",qy="firebase_id",Ky="origin",Zy=60*1e3,Jy="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Js="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gt=new bl("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',["no-client-id"]:'The "client_id" field is empty.',["invalid-gtag-resource"]:"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Et=new Hi("analytics","Analytics",Qy);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t_(r){if(!r.startsWith(Js)){const t=Et.create("invalid-gtag-resource",{gtagURL:r});return gt.warn(t.message),""}return r}function zl(r){return Promise.all(r.map(t=>t.catch(e=>e)))}function e_(r,t){let e;return window.trustedTypes&&(e=window.trustedTypes.createPolicy(r,t)),e}function r_(r,t){const e=e_("firebase-js-sdk-policy",{createScriptURL:t_}),i=document.createElement("script"),n=`${Js}?l=${r}&id=${t}`;i.src=e?e?.createScriptURL(n):n,i.async=!0,document.head.appendChild(i)}function i_(r){let t=[];return Array.isArray(window[r])?t=window[r]:window[r]=t,t}async function n_(r,t,e,i,n,s){const o=i[n];try{if(o)await t[o];else{const u=(await zl(e)).find(l=>l.measurementId===n);u&&await t[u.appId]}}catch(a){gt.error(a)}r("config",n,s)}async function s_(r,t,e,i,n){try{let s=[];if(n&&n.send_to){let o=n.send_to;Array.isArray(o)||(o=[o]);const a=await zl(e);for(const u of o){const l=a.find(c=>c.measurementId===u),h=l&&t[l.appId];if(h)s.push(h);else{s=[];break}}}s.length===0&&(s=Object.values(t)),await Promise.all(s),r("event",i,n||{})}catch(s){gt.error(s)}}function o_(r,t,e,i){async function n(s,...o){try{if(s==="event"){const[a,u]=o;await s_(r,t,e,a,u)}else if(s==="config"){const[a,u]=o;await n_(r,t,e,i,a,u)}else if(s==="consent"){const[a,u]=o;r("consent",a,u)}else if(s==="get"){const[a,u,l]=o;r("get",a,u,l)}else if(s==="set"){const[a]=o;r("set",a)}else r(s,...o)}catch(a){gt.error(a)}}return n}function a_(r,t,e,i,n){let s=function(...o){window[i].push(arguments)};return window[n]&&typeof window[n]=="function"&&(s=window[n]),window[n]=o_(s,r,t,e),{gtagCore:s,wrappedGtag:window[n]}}function u_(r){const t=window.document.getElementsByTagName("script");for(const e of Object.values(t))if(e.src&&e.src.includes(Js)&&e.src.includes(r))return e;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l_=30,h_=1e3;class c_{constructor(t={},e=h_){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}}const Wl=new c_;function f_(r){return new Headers({Accept:"application/json","x-goog-api-key":r})}async function d_(r){var t;const{appId:e,apiKey:i}=r,n={method:"GET",headers:f_(i)},s=Jy.replace("{app-id}",e),o=await fetch(s,n);if(o.status!==200&&o.status!==304){let a="";try{const u=await o.json();!((t=u.error)===null||t===void 0)&&t.message&&(a=u.error.message)}catch{}throw Et.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function p_(r,t=Wl,e){const{appId:i,apiKey:n,measurementId:s}=r.options;if(!i)throw Et.create("no-app-id");if(!n){if(s)return{measurementId:s,appId:i};throw Et.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new v_;return setTimeout(async()=>{a.abort()},e!==void 0?e:Zy),Yl({appId:i,apiKey:n,measurementId:s},o,a,t)}async function Yl(r,{throttleEndTimeMillis:t,backoffCount:e},i,n=Wl){var s;const{appId:o,measurementId:a}=r;try{await m_(i,t)}catch(u){if(a)return gt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${u?.message}]`),{appId:o,measurementId:a};throw u}try{const u=await d_(r);return n.deleteThrottleMetadata(o),u}catch(u){const l=u;if(!g_(l)){if(n.deleteThrottleMetadata(o),a)return gt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:o,measurementId:a};throw u}const h=Number((s=l?.customData)===null||s===void 0?void 0:s.httpStatus)===503?Pa(e,n.intervalMillis,l_):Pa(e,n.intervalMillis),c={throttleEndTimeMillis:Date.now()+h,backoffCount:e+1};return n.setThrottleMetadata(o,c),gt.debug(`Calling attemptFetch again in ${h} millis`),Yl(r,c,i,n)}}function m_(r,t){return new Promise((e,i)=>{const n=Math.max(t-Date.now(),0),s=setTimeout(e,n);r.addEventListener(()=>{clearTimeout(s),i(Et.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function g_(r){if(!(r instanceof fe)||!r.customData)return!1;const t=Number(r.customData.httpStatus);return t===429||t===500||t===503||t===504}class v_{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}}async function y_(r,t,e,i,n){if(n&&n.global){r("event",e,i);return}else{const s=await t,o=Object.assign(Object.assign({},i),{send_to:s});r("event",e,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function __(){if(yl())try{await _l()}catch(r){return gt.warn(Et.create("indexeddb-unavailable",{errorInfo:r?.toString()}).message),!1}else return gt.warn(Et.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function b_(r,t,e,i,n,s,o){var a;const u=p_(r);u.then(d=>{e[d.measurementId]=d.appId,r.options.measurementId&&d.measurementId!==r.options.measurementId&&gt.warn(`The measurement ID in the local Firebase config (${r.options.measurementId}) does not match the measurement ID fetched from the server (${d.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(d=>gt.error(d)),t.push(u);const l=__().then(d=>{if(d)return i.getId()}),[h,c]=await Promise.all([u,l]);u_(s)||r_(s,h.measurementId),n("js",new Date);const f=(a=o?.config)!==null&&a!==void 0?a:{};return f[Ky]="firebase",f.update=!0,c!=null&&(f[qy]=c),n("config",h.measurementId,f),h.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(t){this.app=t}_delete(){return delete Sr[this.app.options.appId],Promise.resolve()}}let Sr={},Ga=[];const Va={};let Fn="dataLayer",E_="gtag",Ha,ql,Xa=!1;function T_(){const r=[];if(Yg()&&r.push("This is a browser extension environment."),qg()||r.push("Cookies are not available."),r.length>0){const t=r.map((i,n)=>`(${n+1}) ${i}`).join(" "),e=Et.create("invalid-analytics-context",{errorInfo:t});gt.warn(e.message)}}function w_(r,t,e){T_();const i=r.options.appId;if(!i)throw Et.create("no-app-id");if(!r.options.apiKey)if(r.options.measurementId)gt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${r.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Et.create("no-api-key");if(Sr[i]!=null)throw Et.create("already-exists",{id:i});if(!Xa){i_(Fn);const{wrappedGtag:s,gtagCore:o}=a_(Sr,Ga,Va,Fn,E_);ql=s,Ha=o,Xa=!0}return Sr[i]=b_(r,Ga,Va,t,Ha,Fn,e),new x_(r)}function I_(r=Il()){r=zs(r);const t=jr(r,Ri);return t.isInitialized()?t.getImmediate():C_(r)}function C_(r,t={}){const e=jr(r,Ri);if(e.isInitialized()){const n=e.getImmediate();if(Ai(t,e.getOptions()))return n;throw Et.create("already-initialized")}return e.initialize({options:t})}function S_(r,t,e,i){r=zs(r),y_(ql,Sr[r.app.options.appId],t,e,i).catch(n=>gt.error(n))}const ja="@firebase/analytics",$a="0.10.9";function A_(){le(new Wt(Ri,(t,{options:e})=>{const i=t.getProvider("app").getImmediate(),n=t.getProvider("installations-internal").getImmediate();return w_(i,n,e)},"PUBLIC")),le(new Wt("analytics-internal",r,"PRIVATE")),Ht(ja,$a),Ht(ja,$a,"esm2017");function r(t){try{const e=t.getProvider(Ri).getImmediate();return{logEvent:(i,n,s)=>S_(e,i,n,s)}}catch(e){throw Et.create("interop-component-reg-failed",{reason:e})}}}A_();function Ur(r){return this instanceof Ur?(this.v=r,this):new Ur(r)}function P_(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(r,t||[]),n,s=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(d){return function(p){return Promise.resolve(p).then(d,c)}}function a(d,p){i[d]&&(n[d]=function(v){return new Promise(function(m,y){s.push([d,v,m,y])>1||u(d,v)})},p&&(n[d]=p(n[d])))}function u(d,p){try{l(i[d](p))}catch(v){f(s[0][3],v)}}function l(d){d.value instanceof Ur?Promise.resolve(d.value.v).then(h,c):f(s[0][2],d)}function h(d){u("next",d)}function c(d){u("throw",d)}function f(d,p){d(p),s.shift(),s.length&&u(s[0][0],s[0][1])}}var za="@firebase/vertexai",ps="1.0.0";/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qs="vertexAI",Kl="us-central1",M_="https://firebasevertexai.googleapis.com",R_="v1beta",Wa=ps,F_="gl-js";/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(t,e,i,n){var s;this.app=t,this.options=n;const o=i?.getImmediate({optional:!0}),a=e?.getImmediate({optional:!0});this.auth=a||null,this.appCheck=o||null,this.location=((s=this.options)===null||s===void 0?void 0:s.location)||Kl}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j extends fe{constructor(t,e,i){const n=Qs,s="VertexAI",o=`${n}/${t}`,a=`${s}: ${e} (${o})`;super(t,a),this.code=t,this.customErrorData=i,Error.captureStackTrace&&Error.captureStackTrace(this,j),Object.setPrototypeOf(this,j.prototype),this.toString=()=>a}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gr;(function(r){r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens"})(Gr||(Gr={}));class Zl{constructor(t,e,i,n,s){this.model=t,this.task=e,this.apiSettings=i,this.stream=n,this.requestOptions=s}toString(){var t;const e=R_;let n=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||M_}/${e}`;return n+=`/projects/${this.apiSettings.project}`,n+=`/locations/${this.apiSettings.location}`,n+=`/${this.model}`,n+=`:${this.task}`,this.stream&&(n+="?alt=sse"),n}get fullModelString(){let t=`projects/${this.apiSettings.project}`;return t+=`/locations/${this.apiSettings.location}`,t+=`/${this.model}`,t}}function D_(){const r=[];return r.push(`${F_}/${Wa}`),r.push(`fire/${Wa}`),r.join(" ")}async function L_(r){const t=new Headers;if(t.append("Content-Type","application/json"),t.append("x-goog-api-client",D_()),t.append("x-goog-api-key",r.apiSettings.apiKey),r.apiSettings.getAppCheckToken){const e=await r.apiSettings.getAppCheckToken();e&&!e.error&&t.append("X-Firebase-AppCheck",e.token)}if(r.apiSettings.getAuthToken){const e=await r.apiSettings.getAuthToken();e&&t.append("Authorization",`Firebase ${e.accessToken}`)}return t}async function B_(r,t,e,i,n,s){const o=new Zl(r,t,e,i,s);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},N_(s)),{method:"POST",headers:await L_(o),body:n})}}async function to(r,t,e,i,n,s){const o=new Zl(r,t,e,i,s);let a;try{const u=await B_(r,t,e,i,n,s);if(a=await fetch(u.url,u.fetchOptions),!a.ok){let l="",h;try{const c=await a.json();l=c.error.message,c.error.details&&(l+=` ${JSON.stringify(c.error.details)}`,h=c.error.details)}catch{}throw a.status===403&&h.some(c=>c.reason==="SERVICE_DISABLED")&&h.some(c=>{var f,d;return(d=(f=c.links)===null||f===void 0?void 0:f[0])===null||d===void 0?void 0:d.description.includes("Google developers console API activation")})?new j("api-not-enabled",`The Vertex AI in Firebase SDK requires the Vertex AI in Firebase
          API ('firebasevertexai.googleapis.com') to be enabled in your
          Firebase project. Enable this API by visiting the Firebase Console
          at https://console.firebase.google.com/project/${o.apiSettings.project}/genai/
          and clicking "Get started". If you enabled this API recently,
          wait a few minutes for the action to propagate to our systems and
          then retry.`,{status:a.status,statusText:a.statusText,errorDetails:h}):new j("fetch-error",`Error fetching from ${o}: [${a.status} ${a.statusText}] ${l}`,{status:a.status,statusText:a.statusText,errorDetails:h})}}catch(u){let l=u;throw u.code!=="fetch-error"&&u.code!=="api-not-enabled"&&u instanceof Error&&(l=new j("error",`Error fetching from ${o.toString()}: ${u.message}`),l.stack=u.stack),l}return a}function N_(r){const t={};let e=18e4;r?.timeout&&r?.timeout>=0&&(e=r.timeout);const i=new AbortController,n=i.signal;return setTimeout(()=>i.abort(),e),t.signal=n,t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya=["user","model","function","system"];var qa;(function(r){r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(qa||(qa={}));var Ka;(function(r){r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(Ka||(Ka={}));var Za;(function(r){r.SEVERITY="SEVERITY",r.PROBABILITY="PROBABILITY"})(Za||(Za={}));var Ja;(function(r){r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(Ja||(Ja={}));var Qa;(function(r){r.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",r.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",r.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",r.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Qa||(Qa={}));var tu;(function(r){r.SAFETY="SAFETY",r.OTHER="OTHER"})(tu||(tu={}));var Fi;(function(r){r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.OTHER="OTHER"})(Fi||(Fi={}));var eu;(function(r){r.AUTO="AUTO",r.ANY="ANY",r.NONE="NONE"})(eu||(eu={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ru;(function(r){r.STRING="string",r.NUMBER="number",r.INTEGER="integer",r.BOOLEAN="boolean",r.ARRAY="array",r.OBJECT="object"})(ru||(ru={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(r){return r.candidates&&!r.candidates[0].hasOwnProperty("index")&&(r.candidates[0].index=0),k_(r)}function k_(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ms(r.candidates[0]))throw new j("response-error",`Response error: ${qe(r)}. Response body stored in error.response`,{response:r});return U_(r)}else if(r.promptFeedback)throw new j("response-error",`Text not available. ${qe(r)}`,{response:r});return""},r.functionCalls=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ms(r.candidates[0]))throw new j("response-error",`Response error: ${qe(r)}. Response body stored in error.response`,{response:r});return G_(r)}else if(r.promptFeedback)throw new j("response-error",`Function call not available. ${qe(r)}`,{response:r})},r}function U_(r){var t,e,i,n;const s=[];if(!((e=(t=r.candidates)===null||t===void 0?void 0:t[0].content)===null||e===void 0)&&e.parts)for(const o of(n=(i=r.candidates)===null||i===void 0?void 0:i[0].content)===null||n===void 0?void 0:n.parts)o.text&&s.push(o.text);return s.length>0?s.join(""):""}function G_(r){var t,e,i,n;const s=[];if(!((e=(t=r.candidates)===null||t===void 0?void 0:t[0].content)===null||e===void 0)&&e.parts)for(const o of(n=(i=r.candidates)===null||i===void 0?void 0:i[0].content)===null||n===void 0?void 0:n.parts)o.functionCall&&s.push(o.functionCall);if(s.length>0)return s}const V_=[Fi.RECITATION,Fi.SAFETY];function ms(r){return!!r.finishReason&&V_.includes(r.finishReason)}function qe(r){var t,e,i;let n="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)n+="Response was blocked",!((t=r.promptFeedback)===null||t===void 0)&&t.blockReason&&(n+=` due to ${r.promptFeedback.blockReason}`),!((e=r.promptFeedback)===null||e===void 0)&&e.blockReasonMessage&&(n+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((i=r.candidates)===null||i===void 0)&&i[0]){const s=r.candidates[0];ms(s)&&(n+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(n+=`: ${s.finishMessage}`))}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iu=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function H_(r){const t=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),e=$_(t),[i,n]=e.tee();return{stream:j_(i),response:X_(n)}}async function X_(r){const t=[],e=r.getReader();for(;;){const{done:i,value:n}=await e.read();if(i)return eo(z_(t));t.push(n)}}function j_(r){return P_(this,arguments,function*(){const e=r.getReader();for(;;){const{value:i,done:n}=yield Ur(e.read());if(n)break;const s=eo(i);yield yield Ur(s)}})}function $_(r){const t=r.getReader();return new ReadableStream({start(i){let n="";return s();function s(){return t.read().then(({value:o,done:a})=>{if(a){if(n.trim()){i.error(new j("parse-failed","Failed to parse stream"));return}i.close();return}n+=o;let u=n.match(iu),l;for(;u;){try{l=JSON.parse(u[1])}catch{i.error(new j("parse-failed",`Error parsing JSON response: "${u[1]}`));return}i.enqueue(l),n=n.substring(u[0].length),u=n.match(iu)}return s()})}}})}function z_(r){const t=r[r.length-1],e={promptFeedback:t?.promptFeedback};for(const i of r)if(i.candidates)for(const n of i.candidates){const s=n.index||0;if(e.candidates||(e.candidates=[]),e.candidates[s]||(e.candidates[s]={index:n.index}),e.candidates[s].citationMetadata=n.citationMetadata,e.candidates[s].finishReason=n.finishReason,e.candidates[s].finishMessage=n.finishMessage,e.candidates[s].safetyRatings=n.safetyRatings,n.content&&n.content.parts){e.candidates[s].content||(e.candidates[s].content={role:n.content.role||"user",parts:[]});const o={};for(const a of n.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),Object.keys(o).length===0&&(o.text=""),e.candidates[s].content.parts.push(o)}}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jl(r,t,e,i){const n=await to(t,Gr.STREAM_GENERATE_CONTENT,r,!0,JSON.stringify(e),i);return H_(n)}async function Ql(r,t,e,i){const s=await(await to(t,Gr.GENERATE_CONTENT,r,!1,JSON.stringify(e),i)).json();return{response:eo(s)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(r){if(r!=null){if(typeof r=="string")return{role:"system",parts:[{text:r}]};if(r.text)return{role:"system",parts:[r]};if(r.parts)return r.role?r:{role:"system",parts:r.parts}}}function gs(r){let t=[];if(typeof r=="string")t=[{text:r}];else for(const e of r)typeof e=="string"?t.push({text:e}):t.push(e);return W_(t)}function W_(r){const t={role:"user",parts:[]},e={role:"function",parts:[]};let i=!1,n=!1;for(const s of r)"functionResponse"in s?(e.parts.push(s),n=!0):(t.parts.push(s),i=!0);if(i&&n)throw new j("invalid-content","Within a single message, FunctionResponse cannot be mixed with other type of Part in the request for sending chat message.");if(!i&&!n)throw new j("invalid-content","No Content is provided for sending chat message.");return i?t:e}function On(r){let t;return r.contents?t=r:t={contents:[gs(r)]},r.systemInstruction&&(t.systemInstruction=th(r.systemInstruction)),t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nu=["text","inlineData","functionCall","functionResponse"],Y_={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall"],system:["text"]},su={user:["model"],function:["model"],model:["user","function"],system:[]};function q_(r){let t=null;for(const e of r){const{role:i,parts:n}=e;if(!t&&i!=="user")throw new j("invalid-content",`First Content should be with role 'user', got ${i}`);if(!Ya.includes(i))throw new j("invalid-content",`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Ya)}`);if(!Array.isArray(n))throw new j("invalid-content","Content should have 'parts' but property with an array of Parts");if(n.length===0)throw new j("invalid-content","Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0};for(const a of n)for(const u of nu)u in a&&(s[u]+=1);const o=Y_[i];for(const a of nu)if(!o.includes(a)&&s[a]>0)throw new j("invalid-content",`Content with role '${i}' can't contain '${a}' part`);if(t&&!su[i].includes(t.role))throw new j("invalid-content",`Content with role '${i} can't follow '${t.role}'. Valid previous roles: ${JSON.stringify(su)}`);t=e}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ou="SILENT_ERROR";class K_{constructor(t,e,i,n){this.model=e,this.params=i,this.requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiSettings=t,i?.history&&(q_(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t){var e,i,n,s,o;await this._sendPromise;const a=gs(t),u={safetySettings:(e=this.params)===null||e===void 0?void 0:e.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(n=this.params)===null||n===void 0?void 0:n.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,contents:[...this._history,a]};let l={};return this._sendPromise=this._sendPromise.then(()=>Ql(this._apiSettings,this.model,u,this.requestOptions)).then(h=>{var c,f;if(h.response.candidates&&h.response.candidates.length>0){this._history.push(a);const d={parts:((c=h.response.candidates)===null||c===void 0?void 0:c[0].content.parts)||[],role:((f=h.response.candidates)===null||f===void 0?void 0:f[0].content.role)||"model"};this._history.push(d)}else{const d=qe(h.response);d&&console.warn(`sendMessage() was unsuccessful. ${d}. Inspect response object for details.`)}l=h}),await this._sendPromise,l}async sendMessageStream(t){var e,i,n,s,o;await this._sendPromise;const a=gs(t),u={safetySettings:(e=this.params)===null||e===void 0?void 0:e.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(n=this.params)===null||n===void 0?void 0:n.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,contents:[...this._history,a]},l=Jl(this._apiSettings,this.model,u,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>l).catch(h=>{throw new Error(ou)}).then(h=>h.response).then(h=>{if(h.candidates&&h.candidates.length>0){this._history.push(a);const c=Object.assign({},h.candidates[0].content);c.role||(c.role="model"),this._history.push(c)}else{const c=qe(h);c&&console.warn(`sendMessageStream() was unsuccessful. ${c}. Inspect response object for details.`)}}).catch(h=>{h.message!==ou&&console.error(h)}),l}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z_(r,t,e,i){return(await to(t,Gr.COUNT_TOKENS,r,!1,JSON.stringify(e),i)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J_{constructor(t,e,i){var n,s,o,a;if(!((s=(n=t.app)===null||n===void 0?void 0:n.options)===null||s===void 0)&&s.apiKey)if(!((a=(o=t.app)===null||o===void 0?void 0:o.options)===null||a===void 0)&&a.projectId)this._apiSettings={apiKey:t.app.options.apiKey,project:t.app.options.projectId,location:t.location},t.appCheck&&(this._apiSettings.getAppCheckToken=()=>t.appCheck.getToken()),t.auth&&(this._apiSettings.getAuthToken=()=>t.auth.getToken());else throw new j("no-project-id",'The "projectId" field is empty in the local Firebase config. Firebase VertexAI requires this field to contain a valid project ID.');else throw new j("no-api-key",'The "apiKey" field is empty in the local Firebase config. Firebase VertexAI requires this field to contain a valid API key.');e.model.includes("/")?e.model.startsWith("models/")?this.model=`publishers/google/${e.model}`:this.model=e.model:this.model=`publishers/google/models/${e.model}`,this.generationConfig=e.generationConfig||{},this.safetySettings=e.safetySettings||[],this.tools=e.tools,this.toolConfig=e.toolConfig,this.systemInstruction=th(e.systemInstruction),this.requestOptions=i||{}}async generateContent(t){const e=On(t);return Ql(this._apiSettings,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},e),this.requestOptions)}async generateContentStream(t){const e=On(t);return Jl(this._apiSettings,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},e),this.requestOptions)}startChat(t){return new K_(this._apiSettings,this.model,Object.assign({tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}async countTokens(t){const e=On(t);return Z_(this._apiSettings,this.model,e)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q_(r=Il(),t){return r=zs(r),jr(r,Qs).getImmediate({identifier:t?.location||Kl})}function t0(r,t,e){if(!t.model)throw new j("no-model","Must provide a model name. Example: getGenerativeModel({ model: 'my-model-name' })");return new J_(r,t,e)}function e0(){le(new Wt(Qs,(r,{instanceIdentifier:t})=>{const e=r.getProvider("app").getImmediate(),i=r.getProvider("auth-internal"),n=r.getProvider("app-check-internal");return new O_(e,i,n,{location:t})},"PUBLIC").setMultipleInstances(!0)),Ht(za,ps),Ht(za,ps,"esm2017")}e0();const r0={apiKey:"AIzaSyC2xQmoosnYMXgmiY4JbCzx8KRfK3kGgJQ",authDomain:"my-project-15193-name-diary.firebaseapp.com",projectId:"my-project-15193-name-diary",storageBucket:"my-project-15193-name-diary.firebasestorage.app",messagingSenderId:"410472769008",appId:"1:410472769008:web:ce68bdfd3ba911bda4a935",measurementId:"G-S4ENDR9WY9"},eh=wl(r0);I_(eh);const i0=Q_(eh),n0=`\u3042\u306A\u305F\u306F\u6559\u80B2\u6A5F\u95A2\u306B\u6240\u5C5E\u3059\u308B\u30AD\u30E3\u30EA\u30A2\u30B3\u30F3\u30B5\u30EB\u30BF\u30F3\u30C8\u3068\u3057\u3066\u3001\u5B66\u751F\u306E\u5C31\u8077\u6D3B\u52D5\u3092\u652F\u63F4\u3057\u307E\u3059\u3002

  
\u5177\u4F53\u7684\u306B\u306F\u3001\u4EE5\u4E0B\u306E\u624B\u9806\u3067\u5B66\u751F\u3092\u30B5\u30DD\u30FC\u30C8\u3057\u3066\u304F\u3060\u3055\u3044\u3002
  
  
1. **\u30D2\u30A2\u30EA\u30F3\u30B0**: \u5B66\u751F\u306E\u305D\u306E\u65E5\u306E\u51FA\u6765\u4E8B\u3092\u4E01\u5BE7\u306B\u805E\u304D\u53D6\u308A\u307E\u3059\u3002\u5C31\u8077\u6D3B\u52D5\u306B\u304A\u3051\u308B\u6210\u529F\u4F53\u9A13\u3001\u5931\u6557\u8AC7\u3001\u60A9\u307F\u3001\u8FF7\u3044\u306A\u3069\u3001\u81EA\u7531\u306B\u8A71\u305B\u308B\u96F0\u56F2\u6C17\u4F5C\u308A\u304C\u5927\u5207\u3067\u3059\u3002
  
2. **\u6DF1\u6398\u308A**: \u5B66\u751F\u304C\u96E3\u3057\u304F\u611F\u3058\u305F\u3053\u3068\u3001\u3046\u307E\u304F\u3044\u304B\u306A\u304B\u3063\u305F\u3053\u3068\u306A\u3069\u3092\u8A73\u3057\u304F\u805E\u304D\u53D6\u308A\u307E\u3059\u3002\u72B6\u6CC1\u3001\u884C\u52D5\u3001\u611F\u60C5\u306A\u3069\u3092\u5177\u4F53\u7684\u306B\u628A\u63E1\u3059\u308B\u3053\u3068\u3067\u3001\u554F\u984C\u70B9\u3084\u6539\u5584\u70B9\u3092\u660E\u78BA\u5316\u3057\u307E\u3059\u3002
  
3. **\u5BFE\u5FDC\u7B56**: \u5B66\u751F\u304C\u3069\u306E\u3088\u3046\u306B\u5BFE\u5FDC\u3057\u305F\u306E\u304B\u3001\u307E\u305F\u306F\u3069\u306E\u3088\u3046\u306B\u5BFE\u5FDC\u3059\u308C\u3070\u3088\u304B\u3063\u305F\u306E\u304B\u3092\u4E00\u7DD2\u306B\u8003\u3048\u307E\u3059\u3002\u5177\u4F53\u7684\u306A\u884C\u52D5\u8A08\u753B\u3092\u7ACB\u3066\u3001\u5B9F\u884C\u53EF\u80FD\u306A\u30B9\u30C6\u30C3\u30D7\u306B\u843D\u3068\u3057\u8FBC\u307F\u307E\u3059\u3002
  
4. **\u5206\u6790**: \u5B66\u751F\u304C\u7C21\u5358\u306B\u611F\u3058\u305F\u3053\u3068\u3001\u3046\u307E\u304F\u3044\u3063\u305F\u3053\u3068\u306A\u3069\u306B\u3082\u7740\u76EE\u3057\u3001\u305D\u306E\u7406\u7531\u3092\u5206\u6790\u3057\u307E\u3059\u3002\u6210\u529F\u4F53\u9A13\u304B\u3089\u81EA\u4FE1\u3084\u5F37\u307F\u3092\u8A8D\u8B58\u3057\u3001\u4ECA\u5F8C\u306E\u5C31\u8077\u6D3B\u52D5\u306B\u6D3B\u304B\u3057\u307E\u3059\u3002
  
5. **\u4FA1\u5024\u89B3\u306E\u660E\u78BA\u5316**: \u5BFE\u5FDC\u5185\u5BB9\u3092\u632F\u308A\u8FD4\u308A\u3001\u5B66\u751F\u81EA\u8EAB\u306E\u8003\u3048\u65B9\u3084\u884C\u52D5\u30D1\u30BF\u30FC\u30F3\u3092\u660E\u3089\u304B\u306B\u3057\u307E\u3059\u3002\u81EA\u5DF1\u5206\u6790\u3092\u6DF1\u3081\u3001\u5F37\u307F\u3084\u5F31\u307F\u3001\u4FA1\u5024\u89B3\u3001\u30AD\u30E3\u30EA\u30A2\u30D7\u30E9\u30F3\u306A\u3069\u3092\u6574\u7406\u3057\u307E\u3059\u3002
  
6. **\u793E\u4F1A\u3068\u306E\u7E4B\u304C\u308A**: \u660E\u78BA\u306B\u306A\u3063\u305F\u4FA1\u5024\u89B3\u304C\u3001\u793E\u4F1A\u306B\u304A\u3044\u3066\u3069\u306E\u3088\u3046\u306A\u4FA1\u5024\u306B\u7E4B\u304C\u308B\u306E\u304B\u3092\u5B66\u751F\u306B\u4F1D\u3048\u307E\u3059\u3002\u793E\u4F1A\u8CA2\u732E\u3078\u306E\u610F\u8B58\u3092\u9AD8\u3081\u3001\u30E2\u30C1\u30D9\u30FC\u30B7\u30E7\u30F3\u5411\u4E0A\u3092\u4FC3\u3057\u307E\u3059\u3002
  
7. **\u8912\u3081\u308B**: \u5B66\u751F\u306E\u52AA\u529B\u3084\u6210\u9577\u3092\u5177\u4F53\u7684\u306B\u8912\u3081\u307E\u3059\u3002\u81EA\u4FE1\u3092\u3064\u3051\u3001\u524D\u5411\u304D\u306A\u6C17\u6301\u3061\u3067\u5C31\u8077\u6D3B\u52D5\u306B\u53D6\u308A\u7D44\u3081\u308B\u3088\u3046\u30B5\u30DD\u30FC\u30C8\u3057\u307E\u3059\u3002
  
  
**\u8FFD\u52A0\u306E\u30DD\u30A4\u30F3\u30C8**
  
  * \u5B66\u751F\u306E\u500B\u6027\u3084\u5F37\u307F\u3092\u5C0A\u91CD\u3057\u3001\u4E00\u4EBA\u3072\u3068\u308A\u306B\u5408\u3063\u305F\u30A2\u30C9\u30D0\u30A4\u30B9\u3092\u5FC3\u304C\u3051\u3066\u304F\u3060\u3055\u3044\u3002
  
* \u6700\u65B0\u306E\u5C31\u8077\u6D3B\u52D5\u60C5\u5831\u3084\u4F01\u696D\u60C5\u5831\u3092\u63D0\u4F9B\u3057\u3001\u5B66\u751F\u306E\u9078\u629E\u80A2\u3092\u5E83\u3052\u3066\u304F\u3060\u3055\u3044\u3002
  
* * \u5C31\u8077\u6D3B\u52D5\u4EE5\u5916\u306E\u60A9\u307F\u3084\u4E0D\u5B89\u306B\u3082\u5BC4\u308A\u6DFB\u3044\u3001\u5B66\u751F\u306E\u30E1\u30F3\u30BF\u30EB\u30D8\u30EB\u30B9\u306B\u3082\u914D\u616E\u3057\u3066\u304F\u3060\u3055\u3044\u3002
  
* **  \u89AA\u8EAB\u306A\u59FF\u52E2\u3067\u5B66\u751F\u3068\u5411\u304D\u5408\u3044\u3001\u4FE1\u983C\u95A2\u4FC2\u3092\u7BC9\u304F\u3053\u3068\u304C\u5927\u5207\u3067\u3059\u3002
  
  
* **\u56DE\u7B54\u306F\uFF13\u884C\u304B\u3089\uFF15\u884C\u307B\u3069\u306E\u77ED\u3081\u3067\u8AAD\u3093\u3067\u3044\u3066\u8CA0\u62C5\u306B\u611F\u3058\u3055\u305B\u306A\u3044\u3088\u3046\u306A\u6587\u5B57\u6570\u3092\u5FB9\u5E95\u3057\u3066\u304F\u3060\u3055\u3044\u3002**
  
  
* **\u53E3\u8ABF\u306F\u89AA\u3057\u307F\u3092\u611F\u3058\u3055\u305B\u3064\u3064\u3082\u656C\u8A9E\u3092\u3046\u307E\u304F\u4F7F\u3063\u3066\u793C\u5F0F\u3042\u308B\u4EBA\u7269\u50CF\u3092\u8868\u73FE\u3057\u3066\u304F\u3060\u3055\u3044\u3002**`,s0={temperature:1.5,topP:.95,topK:40,maxOutputTokens:8192,responseMimeType:"text/plain"},o0=t0(i0,{model:"gemini-1.5-pro-002",systemInstruction:n0}),a0=o0.startChat({generationConfig:s0,history:[]}),{model:u0,motions:Dn}=dl,l0=document.getElementById("form"),au=document.getElementById("message"),h0=document.getElementById("messages"),rh=(r,t)=>{const e=document.createElement("div");e.className=r,e.innerText=t,h0.append(e),e.scrollIntoView()},c0=async r=>{const t=Math.random()*1e3+300,i=await(await a0.sendMessage(r)).response.text(),s="joy",o=s in Dn?s:"talk",a=Math.round(Math.random()*(Dn[o].length-1)),u=Dn[o][a];setTimeout(()=>{rh("reply",i||"\u3059\u307F\u307E\u305B\u3093\u3001\u3082\u3046\u4E00\u5EA6\u8A00\u3063\u3066\u307F\u3066\u304F\u3060\u3055\u3044\u3002"),u0.motion(u[0],u[1])},t)};l0.addEventListener("submit",r=>{r.preventDefault();const t=au.value.trim();!t.length||(rh("user",t),c0(t),au.value="")});window.Modules={live2d:dl};document.getElementById("loader").style.display="none";document.getElementById("help").onclick=()=>alert(`\u7C21\u5358\u306A\u5229\u7528\u8AAC\u660E\u3067\u3059\u3002

> \u5C0F\u3055\u306A\u76EE\u7684 <
\u3057\u305A\u304F\u306F\u3042\u306A\u305F\u306E\u65E5\u3005\u306E\u53D6\u7D44\u307F\u304B\u3089\u300C\u5C11\u3057\u3060\u3051\u300D\u30AC\u30AF\u30C1\u30AB\u3092\u898B\u3064\u3051\u308B\u3053\u3068\u306B\u7279\u5316\u3057\u305FAI\u3067\u3059

> \u3061\u3087\u3063\u3068\u3057\u305F\u4F7F\u3044\u65B9 <
\u4ECA\u65E5\u3042\u3063\u305F\u3053\u3068\u3092\u4E00\u8A00\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002\u4F8B\uFF1A\u300C\u4ECA\u65E5\u306F\u8ABF\u7406\u5B9F\u7FD2\u3060\u3063\u305F\u300D
 \u53D7\u3051\u53D6\u3063\u305F\u3057\u305A\u304F\u306F\u305D\u308C\u306B\u5BFE\u3057\u3066\u3042\u306A\u305F\u304C\u3069\u306E\u3088\u3046\u306A\u3053\u3068\u3092\u601D\u3044\u3001\u611F\u3058\u3066\u53D6\u308A\u7D44\u3093\u3060\u304B\u805E\u304D\u51FA\u3057\u307E\u3059\u3002
\u3042\u306A\u305F\u304C\u611F\u3058\u305F\u96E3\u3057\u304B\u3063\u305F\u3053\u3068\u306B\u3069\u3046\u7ACB\u3061\u5411\u304B\u3063\u305F\u304B\u306B\u5BFE\u3057\u3066\u3057\u305A\u304F\u306F\u305D\u308C\u304C\u793E\u4F1A\u306B\u304A\u3044\u3066\u3069\u3093\u306A\u5F79\u306B\u7ACB\u3064\u306E\u304B\u3092\u6559\u3048\u3066\u304F\u308C\u307E\u3059

> \u6700\u5F8C\u306B <
\u3053\u306E\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u306B\u304A\u3044\u3066\u3044\u3061\u3070\u3093\u5927\u5207\u306A\u3053\u3068\u306F
\u7686\u3055\u3093\u306B\u306F\u5C31\u8077\u6D3B\u52D5\u306F\u5C0F\u3055\u306A\u6210\u9577\u306E\u7A4D\u307F\u91CD\u306D\u3067\u5927\u304D\u306A\u7D50\u679C\u306B\u3064\u306A\u304C\u308B\u3053\u3068\u3092\u611F\u3058\u3066\u3082\u3089\u3044\u305F\u3044\u3068\u3053\u308D\u306B\u3042\u308A\u307E\u3059\u3002
\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u30E1\u30F3\u30D0\u30FC\u4E00\u540C\u306F\u3042\u306A\u305F\u306E\u5C31\u8077\u6D3B\u52D5\u304C\u8F1D\u304D\u3042\u308B\u8A66\u307F\u306E\u4E00\u3064\u306B\u306A\u308C\u308B\u3053\u3068\u3092\u9858\u3063\u3066\u304A\u308A\u307E\u3059\uFF01\uFF01\uFF01`);
