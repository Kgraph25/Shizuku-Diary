(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();/*!
 * @pixi/constants - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var sr;(function(r){r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2"})(sr||(sr={}));var Yn;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS"})(Yn||(Yn={}));var So;(function(r){r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL"})(So||(So={}));var H;(function(r){r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR"})(H||(H={}));var Kn;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Kn||(Kn={}));var U;(function(r){r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(U||(U={}));var ii;(function(r){r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(ii||(ii={}));var et;(function(r){r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT"})(et||(et={}));var Ro;(function(r){r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT"})(Ro||(Ro={}));var Ue;(function(r){r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR"})(Ue||(Ue={}));var Mo;(function(r){r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(Mo||(Mo={}));var br;(function(r){r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL"})(br||(br={}));var Ar;(function(r){r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"})(Ar||(Ar={}));var mr;(function(r){r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT"})(mr||(mr={}));var Oo;(function(r){r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL"})(Oo||(Oo={}));var ge;(function(r){r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp"})(ge||(ge={}));var xt;(function(r){r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR"})(xt||(xt={}));var zc;(function(r){r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA"})(zc||(zc={}));var bt;(function(r){r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH"})(bt||(bt={}));var Ve;(function(r){r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"})(Ve||(Ve={}));/*!
 * @pixi/settings - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var c_={createCanvas:function(r,t){var e=document.createElement("canvas");return e.width=r,e.height=t,e},getWebGLRenderingContext:function(){return WebGLRenderingContext},getNavigator:function(){return navigator},getBaseUrl:function(){var r;return(r=document.baseURI)!==null&&r!==void 0?r:window.location.href},fetch:function(r,t){return fetch(r,t)}},Ja=/iPhone/i,Xc=/iPod/i,Wc=/iPad/i,qc=/\biOS-universal(?:.+)Mac\b/i,Qa=/\bAndroid(?:.+)Mobile\b/i,Yc=/Android/i,Ai=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Hs=/Silk/i,Ke=/Windows Phone/i,Kc=/\bWindows(?:.+)ARM\b/i,Jc=/BlackBerry/i,Qc=/BB10/i,Zc=/Opera Mini/i,td=/\b(CriOS|Chrome)(?:.+)Mobile/i,ed=/Mobile(?:.+)Firefox\b/i,rd=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function d_(r){return function(t){return t.test(r)}}function f_(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var n=d_(e),s={apple:{phone:n(Ja)&&!n(Ke),ipod:n(Xc),tablet:!n(Ja)&&(n(Wc)||rd(t))&&!n(Ke),universal:n(qc),device:(n(Ja)||n(Xc)||n(Wc)||n(qc)||rd(t))&&!n(Ke)},amazon:{phone:n(Ai),tablet:!n(Ai)&&n(Hs),device:n(Ai)||n(Hs)},android:{phone:!n(Ke)&&n(Ai)||!n(Ke)&&n(Qa),tablet:!n(Ke)&&!n(Ai)&&!n(Qa)&&(n(Hs)||n(Yc)),device:!n(Ke)&&(n(Ai)||n(Hs)||n(Qa)||n(Yc))||n(/\bokhttp\b/i)},windows:{phone:n(Ke),tablet:n(Kc),device:n(Ke)||n(Kc)},other:{blackberry:n(Jc),blackberry10:n(Qc),opera:n(Zc),firefox:n(ed),chrome:n(td),device:n(Jc)||n(Qc)||n(Zc)||n(ed)||n(td)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}var ti=f_(globalThis.navigator);function p_(){return!ti.apple.device}function m_(r){var t=!0;if(ti.tablet||ti.phone){if(ti.apple.device){var e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(e){var i=parseInt(e[1],10);i<11&&(t=!1)}}if(ti.android.device){var e=navigator.userAgent.match(/Android\s([0-9.]*)/);if(e){var i=parseInt(e[1],10);i<7&&(t=!1)}}}return t?r:4}var j={ADAPTER:c_,MIPMAP_TEXTURES:br.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:bt.NONE,SPRITE_MAX_TEXTURES:m_(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,antialias:!1,preserveDrawingBuffer:!1},GC_MODE:Oo.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:Mo.CLAMP,SCALE_MODE:Ue.LINEAR,PRECISION_VERTEX:ge.HIGH,PRECISION_FRAGMENT:ti.apple.device?ge.HIGH:ge.MEDIUM,CAN_UPLOAD_SAME_BUFFER:p_(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},Bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function g_(r){var t=r.default;if(typeof t=="function"){var e=function(){return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),e}var Lp={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(l,h,c){this.fn=l,this.context=h,this.once=c||!1}function s(l,h,c,p,m){if(typeof c!="function")throw new TypeError("The listener must be a function");var g=new n(c,p||l,m),_=e?e+h:h;return l._events[_]?l._events[_].fn?l._events[_]=[l._events[_],g]:l._events[_].push(g):(l._events[_]=g,l._eventsCount++),l}function o(l,h){--l._eventsCount===0?l._events=new i:delete l._events[h]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],c,p;if(this._eventsCount===0)return h;for(p in c=this._events)t.call(c,p)&&h.push(e?p.slice(1):p);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(c)):h},a.prototype.listeners=function(h){var c=e?e+h:h,p=this._events[c];if(!p)return[];if(p.fn)return[p.fn];for(var m=0,g=p.length,_=new Array(g);m<g;m++)_[m]=p[m].fn;return _},a.prototype.listenerCount=function(h){var c=e?e+h:h,p=this._events[c];return p?p.fn?1:p.length:0},a.prototype.emit=function(h,c,p,m,g,_){var A=e?e+h:h;if(!this._events[A])return!1;var y=this._events[A],S=arguments.length,M,x;if(y.fn){switch(y.once&&this.removeListener(h,y.fn,void 0,!0),S){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,p),!0;case 4:return y.fn.call(y.context,c,p,m),!0;case 5:return y.fn.call(y.context,c,p,m,g),!0;case 6:return y.fn.call(y.context,c,p,m,g,_),!0}for(x=1,M=new Array(S-1);x<S;x++)M[x-1]=arguments[x];y.fn.apply(y.context,M)}else{var F=y.length,B;for(x=0;x<F;x++)switch(y[x].once&&this.removeListener(h,y[x].fn,void 0,!0),S){case 1:y[x].fn.call(y[x].context);break;case 2:y[x].fn.call(y[x].context,c);break;case 3:y[x].fn.call(y[x].context,c,p);break;case 4:y[x].fn.call(y[x].context,c,p,m);break;default:if(!M)for(B=1,M=new Array(S-1);B<S;B++)M[B-1]=arguments[B];y[x].fn.apply(y[x].context,M)}}return!0},a.prototype.on=function(h,c,p){return s(this,h,c,p,!1)},a.prototype.once=function(h,c,p){return s(this,h,c,p,!0)},a.prototype.removeListener=function(h,c,p,m){var g=e?e+h:h;if(!this._events[g])return this;if(!c)return o(this,g),this;var _=this._events[g];if(_.fn)_.fn===c&&(!m||_.once)&&(!p||_.context===p)&&o(this,g);else{for(var A=0,y=[],S=_.length;A<S;A++)(_[A].fn!==c||m&&!_[A].once||p&&_[A].context!==p)&&y.push(_[A]);y.length?this._events[g]=y.length===1?y[0]:y:o(this,g)}return this},a.prototype.removeAllListeners=function(h){var c;return h?(c=e?e+h:h,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,r.exports=a})(Lp);const Or=Lp.exports;var Np={exports:{}};Np.exports=la;Np.exports.default=la;function la(r,t,e){e=e||2;var i=t&&t.length,n=i?t[0]*e:r.length,s=kp(r,0,n,e,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,h,c,p,m,g;if(i&&(s=T_(r,t,s,e)),r.length>80*e){a=h=r[0],l=c=r[1];for(var _=e;_<n;_+=e)p=r[_],m=r[_+1],p<a&&(a=p),m<l&&(l=m),p>h&&(h=p),m>c&&(c=m);g=Math.max(h-a,c-l),g=g!==0?32767/g:0}return Jn(s,o,e,a,l,g,0),o}function kp(r,t,e,i,n){var s,o;if(n===Hu(r,t,e,i)>0)for(s=t;s<e;s+=i)o=id(s,r[s],r[s+1],o);else for(s=e-i;s>=t;s-=i)o=id(s,r[s],r[s+1],o);return o&&ha(o,o.next)&&(Zn(o),o=o.next),o}function hi(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(ha(e,e.next)||vt(e.prev,e,e.next)===0)){if(Zn(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Jn(r,t,e,i,n,s,o){if(!!r){!o&&s&&C_(r,i,n,s);for(var a=r,l,h;r.prev!==r.next;){if(l=r.prev,h=r.next,s?__(r,i,n,s):v_(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(h.i/e|0),Zn(r),r=h.next,a=h.next;continue}if(r=h,r===a){o?o===1?(r=y_(hi(r),t,e),Jn(r,t,e,i,n,s,2)):o===2&&E_(r,t,e,i,n,s):Jn(hi(r),t,e,i,n,s,1);break}}}}function v_(r){var t=r.prev,e=r,i=r.next;if(vt(t,e,i)>=0)return!1;for(var n=t.x,s=e.x,o=i.x,a=t.y,l=e.y,h=i.y,c=n<s?n<o?n:o:s<o?s:o,p=a<l?a<h?a:h:l<h?l:h,m=n>s?n>o?n:o:s>o?s:o,g=a>l?a>h?a:h:l>h?l:h,_=i.next;_!==t;){if(_.x>=c&&_.x<=m&&_.y>=p&&_.y<=g&&Li(n,a,s,l,o,h,_.x,_.y)&&vt(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function __(r,t,e,i){var n=r.prev,s=r,o=r.next;if(vt(n,s,o)>=0)return!1;for(var a=n.x,l=s.x,h=o.x,c=n.y,p=s.y,m=o.y,g=a<l?a<h?a:h:l<h?l:h,_=c<p?c<m?c:m:p<m?p:m,A=a>l?a>h?a:h:l>h?l:h,y=c>p?c>m?c:m:p>m?p:m,S=Gu(g,_,t,e,i),M=Gu(A,y,t,e,i),x=r.prevZ,F=r.nextZ;x&&x.z>=S&&F&&F.z<=M;){if(x.x>=g&&x.x<=A&&x.y>=_&&x.y<=y&&x!==n&&x!==o&&Li(a,c,l,p,h,m,x.x,x.y)&&vt(x.prev,x,x.next)>=0||(x=x.prevZ,F.x>=g&&F.x<=A&&F.y>=_&&F.y<=y&&F!==n&&F!==o&&Li(a,c,l,p,h,m,F.x,F.y)&&vt(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;x&&x.z>=S;){if(x.x>=g&&x.x<=A&&x.y>=_&&x.y<=y&&x!==n&&x!==o&&Li(a,c,l,p,h,m,x.x,x.y)&&vt(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;F&&F.z<=M;){if(F.x>=g&&F.x<=A&&F.y>=_&&F.y<=y&&F!==n&&F!==o&&Li(a,c,l,p,h,m,F.x,F.y)&&vt(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function y_(r,t,e){var i=r;do{var n=i.prev,s=i.next.next;!ha(n,s)&&Bp(n,i,i.next,s)&&Qn(n,s)&&Qn(s,n)&&(t.push(n.i/e|0),t.push(i.i/e|0),t.push(s.i/e|0),Zn(i),Zn(i.next),i=r=s),i=i.next}while(i!==r);return hi(i)}function E_(r,t,e,i,n,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&S_(o,a)){var l=Up(o,a);o=hi(o,o.next),l=hi(l,l.next),Jn(o,t,e,i,n,s,0),Jn(l,t,e,i,n,s,0);return}a=a.next}o=o.next}while(o!==r)}function T_(r,t,e,i){var n=[],s,o,a,l,h;for(s=0,o=t.length;s<o;s++)a=t[s]*i,l=s<o-1?t[s+1]*i:r.length,h=kp(r,a,l,i,!1),h===h.next&&(h.steiner=!0),n.push(P_(h));for(n.sort(I_),s=0;s<n.length;s++)e=w_(n[s],e);return e}function I_(r,t){return r.x-t.x}function w_(r,t){var e=b_(r,t);if(!e)return t;var i=Up(e,r);return hi(i,i.next),hi(e,e.next)}function b_(r,t){var e=t,i=r.x,n=r.y,s=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var a=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>s&&(s=a,o=e.x<e.next.x?e:e.next,a===i))return o}e=e.next}while(e!==t);if(!o)return null;var l=o,h=o.x,c=o.y,p=1/0,m;e=o;do i>=e.x&&e.x>=h&&i!==e.x&&Li(n<c?i:s,n,h,c,n<c?s:i,n,e.x,e.y)&&(m=Math.abs(n-e.y)/(i-e.x),Qn(e,r)&&(m<p||m===p&&(e.x>o.x||e.x===o.x&&A_(o,e)))&&(o=e,p=m)),e=e.next;while(e!==l);return o}function A_(r,t){return vt(r.prev,r,t.prev)<0&&vt(t.next,r,r.next)<0}function C_(r,t,e,i){var n=r;do n.z===0&&(n.z=Gu(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,x_(n)}function x_(r){var t,e,i,n,s,o,a,l,h=1;do{for(e=r,r=null,s=null,o=0;e;){for(o++,i=e,a=0,t=0;t<h&&(a++,i=i.nextZ,!!i);t++);for(l=h;a>0||l>0&&i;)a!==0&&(l===0||!i||e.z<=i.z)?(n=e,e=e.nextZ,a--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;e=i}s.nextZ=null,h*=2}while(o>1);return r}function Gu(r,t,e,i,n){return r=(r-e)*n|0,t=(t-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function P_(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Li(r,t,e,i,n,s,o,a){return(n-o)*(t-a)>=(r-o)*(s-a)&&(r-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(s-a)>=(n-o)*(i-a)}function S_(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!R_(r,t)&&(Qn(r,t)&&Qn(t,r)&&M_(r,t)&&(vt(r.prev,r,t.prev)||vt(r,t.prev,t))||ha(r,t)&&vt(r.prev,r,r.next)>0&&vt(t.prev,t,t.next)>0)}function vt(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function ha(r,t){return r.x===t.x&&r.y===t.y}function Bp(r,t,e,i){var n=zs(vt(r,t,e)),s=zs(vt(r,t,i)),o=zs(vt(e,i,r)),a=zs(vt(e,i,t));return!!(n!==s&&o!==a||n===0&&$s(r,e,t)||s===0&&$s(r,i,t)||o===0&&$s(e,r,i)||a===0&&$s(e,t,i))}function $s(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function zs(r){return r>0?1:r<0?-1:0}function R_(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&Bp(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Qn(r,t){return vt(r.prev,r,r.next)<0?vt(r,t,r.next)>=0&&vt(r,r.prev,t)>=0:vt(r,t,r.prev)<0||vt(r,r.next,t)<0}function M_(r,t){var e=r,i=!1,n=(r.x+t.x)/2,s=(r.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function Up(r,t){var e=new ju(r.i,r.x,r.y),i=new ju(t.i,t.x,t.y),n=r.next,s=t.prev;return r.next=t,t.prev=r,e.next=n,n.prev=e,i.next=e,e.prev=i,s.next=i,i.prev=s,i}function id(r,t,e,i){var n=new ju(r,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Zn(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function ju(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}la.deviation=function(r,t,e,i){var n=t&&t.length,s=n?t[0]*e:r.length,o=Math.abs(Hu(r,0,s,e));if(n)for(var a=0,l=t.length;a<l;a++){var h=t[a]*e,c=a<l-1?t[a+1]*e:r.length;o-=Math.abs(Hu(r,h,c,e))}var p=0;for(a=0;a<i.length;a+=3){var m=i[a]*e,g=i[a+1]*e,_=i[a+2]*e;p+=Math.abs((r[m]-r[_])*(r[g+1]-r[m+1])-(r[m]-r[g])*(r[_+1]-r[m+1]))}return o===0&&p===0?0:Math.abs((p-o)/o)};function Hu(r,t,e,i){for(var n=0,s=t,o=e-i;s<e;s+=i)n+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return n}la.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var o=0;o<t;o++)e.vertices.push(r[n][s][o]);n>0&&(i+=r[n-1].length,e.holes.push(i))}return e};var $u={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */(function(r,t){(function(e){var i=t&&!t.nodeType&&t,n=r&&!r.nodeType&&r,s=typeof Bn=="object"&&Bn;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,l=36,h=1,c=26,p=38,m=700,g=72,_=128,A="-",y=/^xn--/,S=/[^\x20-\x7E]/,M=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},F=l-h,B=Math.floor,N=String.fromCharCode,b;function E(V){throw new RangeError(x[V])}function T(V,W){for(var q=V.length,Y=[];q--;)Y[q]=W(V[q]);return Y}function w(V,W){var q=V.split("@"),Y="";q.length>1&&(Y=q[0]+"@",V=q[1]),V=V.replace(M,".");var ft=V.split("."),It=T(ft,W).join(".");return Y+It}function C(V){for(var W=[],q=0,Y=V.length,ft,It;q<Y;)ft=V.charCodeAt(q++),ft>=55296&&ft<=56319&&q<Y?(It=V.charCodeAt(q++),(It&64512)==56320?W.push(((ft&1023)<<10)+(It&1023)+65536):(W.push(ft),q--)):W.push(ft);return W}function P(V){return T(V,function(W){var q="";return W>65535&&(W-=65536,q+=N(W>>>10&1023|55296),W=56320|W&1023),q+=N(W),q}).join("")}function I(V){return V-48<10?V-22:V-65<26?V-65:V-97<26?V-97:l}function lt(V,W){return V+22+75*(V<26)-((W!=0)<<5)}function Tt(V,W,q){var Y=0;for(V=q?B(V/m):V>>1,V+=B(V/W);V>F*c>>1;Y+=l)V=B(V/F);return B(Y+(F+1)*V/(V+p))}function re(V){var W=[],q=V.length,Y,ft=0,It=_,St=g,Rt,fe,_e,le,wt,Wt,ie,ye,Ae;for(Rt=V.lastIndexOf(A),Rt<0&&(Rt=0),fe=0;fe<Rt;++fe)V.charCodeAt(fe)>=128&&E("not-basic"),W.push(V.charCodeAt(fe));for(_e=Rt>0?Rt+1:0;_e<q;){for(le=ft,wt=1,Wt=l;_e>=q&&E("invalid-input"),ie=I(V.charCodeAt(_e++)),(ie>=l||ie>B((a-ft)/wt))&&E("overflow"),ft+=ie*wt,ye=Wt<=St?h:Wt>=St+c?c:Wt-St,!(ie<ye);Wt+=l)Ae=l-ye,wt>B(a/Ae)&&E("overflow"),wt*=Ae;Y=W.length+1,St=Tt(ft-le,Y,le==0),B(ft/Y)>a-It&&E("overflow"),It+=B(ft/Y),ft%=Y,W.splice(ft++,0,It)}return P(W)}function ue(V){var W,q,Y,ft,It,St,Rt,fe,_e,le,wt,Wt=[],ie,ye,Ae,Ei;for(V=C(V),ie=V.length,W=_,q=0,It=g,St=0;St<ie;++St)wt=V[St],wt<128&&Wt.push(N(wt));for(Y=ft=Wt.length,ft&&Wt.push(A);Y<ie;){for(Rt=a,St=0;St<ie;++St)wt=V[St],wt>=W&&wt<Rt&&(Rt=wt);for(ye=Y+1,Rt-W>B((a-q)/ye)&&E("overflow"),q+=(Rt-W)*ye,W=Rt,St=0;St<ie;++St)if(wt=V[St],wt<W&&++q>a&&E("overflow"),wt==W){for(fe=q,_e=l;le=_e<=It?h:_e>=It+c?c:_e-It,!(fe<le);_e+=l)Ei=fe-le,Ae=l-le,Wt.push(N(lt(le+Ei%Ae,0))),fe=B(Ei/Ae);Wt.push(N(lt(fe,0))),It=Tt(q,ye,Y==ft),q=0,++Y}++q,++W}return Wt.join("")}function We(V){return w(V,function(W){return y.test(W)?re(W.slice(4).toLowerCase()):W})}function ur(V){return w(V,function(W){return S.test(W)?"xn--"+ue(W):W})}if(o={version:"1.4.1",ucs2:{decode:C,encode:P},decode:re,encode:ue,toASCII:ur,toUnicode:We},i&&n)if(r.exports==i)n.exports=o;else for(b in o)o.hasOwnProperty(b)&&(i[b]=o[b]);else e.punycode=o})(Bn)})($u,$u.exports);var O_=Error,F_=EvalError,D_=RangeError,L_=ReferenceError,Vp=SyntaxError,ms=TypeError,N_=URIError,k_=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var s=Object.getOwnPropertySymbols(t);if(s.length!==1||s[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==n||o.enumerable!==!0)return!1}return!0},nd=typeof Symbol<"u"&&Symbol,B_=k_,U_=function(){return typeof nd!="function"||typeof Symbol!="function"||typeof nd("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:B_()},Za={__proto__:null,foo:{}},V_=Object,G_=function(){return{__proto__:Za}.foo===Za.foo&&!(Za instanceof V_)},j_="Function.prototype.bind called on incompatible ",H_=Object.prototype.toString,$_=Math.max,z_="[object Function]",sd=function(t,e){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var s=0;s<e.length;s+=1)i[s+t.length]=e[s];return i},X_=function(t,e){for(var i=[],n=e||0,s=0;n<t.length;n+=1,s+=1)i[s]=t[n];return i},W_=function(r,t){for(var e="",i=0;i<r.length;i+=1)e+=r[i],i+1<r.length&&(e+=t);return e},q_=function(t){var e=this;if(typeof e!="function"||H_.apply(e)!==z_)throw new TypeError(j_+e);for(var i=X_(arguments,1),n,s=function(){if(this instanceof n){var c=e.apply(this,sd(i,arguments));return Object(c)===c?c:this}return e.apply(t,sd(i,arguments))},o=$_(0,e.length-i.length),a=[],l=0;l<o;l++)a[l]="$"+l;if(n=Function("binder","return function ("+W_(a,",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var h=function(){};h.prototype=e.prototype,n.prototype=new h,h.prototype=null}return n},Y_=q_,Ll=Function.prototype.bind||Y_,K_=Function.prototype.call,J_=Object.prototype.hasOwnProperty,Q_=Ll,Z_=Q_.call(K_,J_),J,ty=O_,ey=F_,ry=D_,iy=L_,Wi=Vp,ki=ms,ny=N_,Gp=Function,tu=function(r){try{return Gp('"use strict"; return ('+r+").constructor;")()}catch{}},ni=Object.getOwnPropertyDescriptor;if(ni)try{ni({},"")}catch{ni=null}var eu=function(){throw new ki},sy=ni?function(){try{return arguments.callee,eu}catch{try{return ni(arguments,"callee").get}catch{return eu}}}():eu,Ci=U_(),oy=G_(),Ft=Object.getPrototypeOf||(oy?function(r){return r.__proto__}:null),Ri={},ay=typeof Uint8Array>"u"||!Ft?J:Ft(Uint8Array),si={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?J:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?J:ArrayBuffer,"%ArrayIteratorPrototype%":Ci&&Ft?Ft([][Symbol.iterator]()):J,"%AsyncFromSyncIteratorPrototype%":J,"%AsyncFunction%":Ri,"%AsyncGenerator%":Ri,"%AsyncGeneratorFunction%":Ri,"%AsyncIteratorPrototype%":Ri,"%Atomics%":typeof Atomics>"u"?J:Atomics,"%BigInt%":typeof BigInt>"u"?J:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?J:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?J:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?J:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":ty,"%eval%":eval,"%EvalError%":ey,"%Float32Array%":typeof Float32Array>"u"?J:Float32Array,"%Float64Array%":typeof Float64Array>"u"?J:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?J:FinalizationRegistry,"%Function%":Gp,"%GeneratorFunction%":Ri,"%Int8Array%":typeof Int8Array>"u"?J:Int8Array,"%Int16Array%":typeof Int16Array>"u"?J:Int16Array,"%Int32Array%":typeof Int32Array>"u"?J:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ci&&Ft?Ft(Ft([][Symbol.iterator]())):J,"%JSON%":typeof JSON=="object"?JSON:J,"%Map%":typeof Map>"u"?J:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ci||!Ft?J:Ft(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?J:Promise,"%Proxy%":typeof Proxy>"u"?J:Proxy,"%RangeError%":ry,"%ReferenceError%":iy,"%Reflect%":typeof Reflect>"u"?J:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?J:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ci||!Ft?J:Ft(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?J:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ci&&Ft?Ft(""[Symbol.iterator]()):J,"%Symbol%":Ci?Symbol:J,"%SyntaxError%":Wi,"%ThrowTypeError%":sy,"%TypedArray%":ay,"%TypeError%":ki,"%Uint8Array%":typeof Uint8Array>"u"?J:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?J:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?J:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?J:Uint32Array,"%URIError%":ny,"%WeakMap%":typeof WeakMap>"u"?J:WeakMap,"%WeakRef%":typeof WeakRef>"u"?J:WeakRef,"%WeakSet%":typeof WeakSet>"u"?J:WeakSet};if(Ft)try{null.error}catch(r){var uy=Ft(Ft(r));si["%Error.prototype%"]=uy}var ly=function r(t){var e;if(t==="%AsyncFunction%")e=tu("async function () {}");else if(t==="%GeneratorFunction%")e=tu("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=tu("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=r("%AsyncGenerator%");n&&Ft&&(e=Ft(n.prototype))}return si[t]=e,e},od={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},gs=Ll,Fo=Z_,hy=gs.call(Function.call,Array.prototype.concat),cy=gs.call(Function.apply,Array.prototype.splice),ad=gs.call(Function.call,String.prototype.replace),Do=gs.call(Function.call,String.prototype.slice),dy=gs.call(Function.call,RegExp.prototype.exec),fy=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,py=/\\(\\)?/g,my=function(t){var e=Do(t,0,1),i=Do(t,-1);if(e==="%"&&i!=="%")throw new Wi("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new Wi("invalid intrinsic syntax, expected opening `%`");var n=[];return ad(t,fy,function(s,o,a,l){n[n.length]=a?ad(l,py,"$1"):o||s}),n},gy=function(t,e){var i=t,n;if(Fo(od,i)&&(n=od[i],i="%"+n[0]+"%"),Fo(si,i)){var s=si[i];if(s===Ri&&(s=ly(i)),typeof s>"u"&&!e)throw new ki("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:s}}throw new Wi("intrinsic "+t+" does not exist!")},nn=function(t,e){if(typeof t!="string"||t.length===0)throw new ki("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new ki('"allowMissing" argument must be a boolean');if(dy(/^%?[^%]*%?$/,t)===null)throw new Wi("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=my(t),n=i.length>0?i[0]:"",s=gy("%"+n+"%",e),o=s.name,a=s.value,l=!1,h=s.alias;h&&(n=h[0],cy(i,hy([0,1],h)));for(var c=1,p=!0;c<i.length;c+=1){var m=i[c],g=Do(m,0,1),_=Do(m,-1);if((g==='"'||g==="'"||g==="`"||_==='"'||_==="'"||_==="`")&&g!==_)throw new Wi("property names with quotes must have matching quotes");if((m==="constructor"||!p)&&(l=!0),n+="."+m,o="%"+n+"%",Fo(si,o))a=si[o];else if(a!=null){if(!(m in a)){if(!e)throw new ki("base intrinsic for "+t+" exists, but the property is not available.");return}if(ni&&c+1>=i.length){var A=ni(a,m);p=!!A,p&&"get"in A&&!("originalValue"in A.get)?a=A.get:a=a[m]}else p=Fo(a,m),a=a[m];p&&!l&&(si[o]=a)}}return a},jp={exports:{}},ru,ud;function Nl(){if(ud)return ru;ud=1;var r=nn,t=r("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return ru=t,ru}var vy=nn,go=vy("%Object.getOwnPropertyDescriptor%",!0);if(go)try{go([],"length")}catch{go=null}var Hp=go,ld=Nl(),_y=Vp,xi=ms,hd=Hp,yy=function(t,e,i){if(!t||typeof t!="object"&&typeof t!="function")throw new xi("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new xi("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new xi("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new xi("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new xi("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new xi("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,l=!!hd&&hd(t,e);if(ld)ld(t,e,{configurable:o===null&&l?l.configurable:!o,enumerable:n===null&&l?l.enumerable:!n,value:i,writable:s===null&&l?l.writable:!s});else if(a||!n&&!s&&!o)t[e]=i;else throw new _y("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},zu=Nl(),$p=function(){return!!zu};$p.hasArrayLengthDefineBug=function(){if(!zu)return null;try{return zu([],"length",{value:1}).length!==1}catch{return!0}};var Ey=$p,Ty=nn,cd=yy,Iy=Ey(),dd=Hp,fd=ms,wy=Ty("%Math.floor%"),by=function(t,e){if(typeof t!="function")throw new fd("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||wy(e)!==e)throw new fd("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,s=!0;if("length"in t&&dd){var o=dd(t,"length");o&&!o.configurable&&(n=!1),o&&!o.writable&&(s=!1)}return(n||s||!i)&&(Iy?cd(t,"length",e,!0,!0):cd(t,"length",e)),t};(function(r){var t=Ll,e=nn,i=by,n=ms,s=e("%Function.prototype.apply%"),o=e("%Function.prototype.call%"),a=e("%Reflect.apply%",!0)||t.call(o,s),l=Nl(),h=e("%Math.max%");r.exports=function(m){if(typeof m!="function")throw new n("a function is required");var g=a(t,o,arguments);return i(g,1+h(0,m.length-(arguments.length-1)),!0)};var c=function(){return a(t,s,arguments)};l?l(r.exports,"apply",{value:c}):r.exports.apply=c})(jp);var zp=nn,Xp=jp.exports,Ay=Xp(zp("String.prototype.indexOf")),Cy=function(t,e){var i=zp(t,!!e);return typeof i=="function"&&Ay(t,".prototype.")>-1?Xp(i):i};const xy={},Py=Object.freeze(Object.defineProperty({__proto__:null,default:xy},Symbol.toStringTag,{value:"Module"})),Sy=g_(Py);var kl=typeof Map=="function"&&Map.prototype,iu=Object.getOwnPropertyDescriptor&&kl?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Lo=kl&&iu&&typeof iu.get=="function"?iu.get:null,pd=kl&&Map.prototype.forEach,Bl=typeof Set=="function"&&Set.prototype,nu=Object.getOwnPropertyDescriptor&&Bl?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,No=Bl&&nu&&typeof nu.get=="function"?nu.get:null,md=Bl&&Set.prototype.forEach,Ry=typeof WeakMap=="function"&&WeakMap.prototype,Un=Ry?WeakMap.prototype.has:null,My=typeof WeakSet=="function"&&WeakSet.prototype,Vn=My?WeakSet.prototype.has:null,Oy=typeof WeakRef=="function"&&WeakRef.prototype,gd=Oy?WeakRef.prototype.deref:null,Fy=Boolean.prototype.valueOf,Dy=Object.prototype.toString,Ly=Function.prototype.toString,Ny=String.prototype.match,Ul=String.prototype.slice,Er=String.prototype.replace,ky=String.prototype.toUpperCase,vd=String.prototype.toLowerCase,Wp=RegExp.prototype.test,_d=Array.prototype.concat,ke=Array.prototype.join,By=Array.prototype.slice,yd=Math.floor,Xu=typeof BigInt=="function"?BigInt.prototype.valueOf:null,su=Object.getOwnPropertySymbols,Wu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,qi=typeof Symbol=="function"&&typeof Symbol.iterator=="object",te=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===qi?"object":"symbol")?Symbol.toStringTag:null,qp=Object.prototype.propertyIsEnumerable,Ed=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Td(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Wp.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-yd(-r):yd(r);if(i!==r){var n=String(i),s=Ul.call(t,n.length+1);return Er.call(n,e,"$&_")+"."+Er.call(Er.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Er.call(t,e,"$&_")}var qu=Sy,Id=qu.custom,wd=Kp(Id)?Id:null,Uy=function r(t,e,i,n){var s=e||{};if(gr(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(gr(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=gr(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(gr(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(gr(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Qp(t,s);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var l=String(t);return a?Td(t,l):l}if(typeof t=="bigint"){var h=String(t)+"n";return a?Td(t,h):h}var c=typeof s.depth>"u"?5:s.depth;if(typeof i>"u"&&(i=0),i>=c&&c>0&&typeof t=="object")return Yu(t)?"[Array]":"[Object]";var p=i0(s,i);if(typeof n>"u")n=[];else if(Jp(n,t)>=0)return"[Circular]";function m(I,lt,Tt){if(lt&&(n=By.call(n),n.push(lt)),Tt){var re={depth:s.depth};return gr(s,"quoteStyle")&&(re.quoteStyle=s.quoteStyle),r(I,re,i+1,n)}return r(I,s,i+1,n)}if(typeof t=="function"&&!bd(t)){var g=qy(t),_=Xs(t,m);return"[Function"+(g?": "+g:" (anonymous)")+"]"+(_.length>0?" { "+ke.call(_,", ")+" }":"")}if(Kp(t)){var A=qi?Er.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Wu.call(t);return typeof t=="object"&&!qi?wn(A):A}if(t0(t)){for(var y="<"+vd.call(String(t.nodeName)),S=t.attributes||[],M=0;M<S.length;M++)y+=" "+S[M].name+"="+Yp(Vy(S[M].value),"double",s);return y+=">",t.childNodes&&t.childNodes.length&&(y+="..."),y+="</"+vd.call(String(t.nodeName))+">",y}if(Yu(t)){if(t.length===0)return"[]";var x=Xs(t,m);return p&&!r0(x)?"["+Ku(x,p)+"]":"[ "+ke.call(x,", ")+" ]"}if(jy(t)){var F=Xs(t,m);return!("cause"in Error.prototype)&&"cause"in t&&!qp.call(t,"cause")?"{ ["+String(t)+"] "+ke.call(_d.call("[cause]: "+m(t.cause),F),", ")+" }":F.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+ke.call(F,", ")+" }"}if(typeof t=="object"&&o){if(wd&&typeof t[wd]=="function"&&qu)return qu(t,{depth:c-i});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Yy(t)){var B=[];return pd&&pd.call(t,function(I,lt){B.push(m(lt,t,!0)+" => "+m(I,t))}),Ad("Map",Lo.call(t),B,p)}if(Qy(t)){var N=[];return md&&md.call(t,function(I){N.push(m(I,t))}),Ad("Set",No.call(t),N,p)}if(Ky(t))return ou("WeakMap");if(Zy(t))return ou("WeakSet");if(Jy(t))return ou("WeakRef");if($y(t))return wn(m(Number(t)));if(Xy(t))return wn(m(Xu.call(t)));if(zy(t))return wn(Fy.call(t));if(Hy(t))return wn(m(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof Bn<"u"&&t===Bn)return"{ [object globalThis] }";if(!Gy(t)&&!bd(t)){var b=Xs(t,m),E=Ed?Ed(t)===Object.prototype:t instanceof Object||t.constructor===Object,T=t instanceof Object?"":"null prototype",w=!E&&te&&Object(t)===t&&te in t?Ul.call(Fr(t),8,-1):T?"Object":"",C=E||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",P=C+(w||T?"["+ke.call(_d.call([],w||[],T||[]),": ")+"] ":"");return b.length===0?P+"{}":p?P+"{"+Ku(b,p)+"}":P+"{ "+ke.call(b,", ")+" }"}return String(t)};function Yp(r,t,e){var i=(e.quoteStyle||t)==="double"?'"':"'";return i+r+i}function Vy(r){return Er.call(String(r),/"/g,"&quot;")}function Yu(r){return Fr(r)==="[object Array]"&&(!te||!(typeof r=="object"&&te in r))}function Gy(r){return Fr(r)==="[object Date]"&&(!te||!(typeof r=="object"&&te in r))}function bd(r){return Fr(r)==="[object RegExp]"&&(!te||!(typeof r=="object"&&te in r))}function jy(r){return Fr(r)==="[object Error]"&&(!te||!(typeof r=="object"&&te in r))}function Hy(r){return Fr(r)==="[object String]"&&(!te||!(typeof r=="object"&&te in r))}function $y(r){return Fr(r)==="[object Number]"&&(!te||!(typeof r=="object"&&te in r))}function zy(r){return Fr(r)==="[object Boolean]"&&(!te||!(typeof r=="object"&&te in r))}function Kp(r){if(qi)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!Wu)return!1;try{return Wu.call(r),!0}catch{}return!1}function Xy(r){if(!r||typeof r!="object"||!Xu)return!1;try{return Xu.call(r),!0}catch{}return!1}var Wy=Object.prototype.hasOwnProperty||function(r){return r in this};function gr(r,t){return Wy.call(r,t)}function Fr(r){return Dy.call(r)}function qy(r){if(r.name)return r.name;var t=Ny.call(Ly.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function Jp(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function Yy(r){if(!Lo||!r||typeof r!="object")return!1;try{Lo.call(r);try{No.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Ky(r){if(!Un||!r||typeof r!="object")return!1;try{Un.call(r,Un);try{Vn.call(r,Vn)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Jy(r){if(!gd||!r||typeof r!="object")return!1;try{return gd.call(r),!0}catch{}return!1}function Qy(r){if(!No||!r||typeof r!="object")return!1;try{No.call(r);try{Lo.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function Zy(r){if(!Vn||!r||typeof r!="object")return!1;try{Vn.call(r,Vn);try{Un.call(r,Un)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function t0(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Qp(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return Qp(Ul.call(r,0,t.maxStringLength),t)+i}var n=Er.call(Er.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,e0);return Yp(n,"single",t)}function e0(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+ky.call(t.toString(16))}function wn(r){return"Object("+r+")"}function ou(r){return r+" { ? }"}function Ad(r,t,e,i){var n=i?Ku(e,i):ke.call(e,", ");return r+" ("+t+") {"+n+"}"}function r0(r){for(var t=0;t<r.length;t++)if(Jp(r[t],`
`)>=0)return!1;return!0}function i0(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=ke.call(Array(r.indent+1)," ");else return null;return{base:e,prev:ke.call(Array(t+1),e)}}function Ku(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+ke.call(r,","+e)+`
`+t.prev}function Xs(r,t){var e=Yu(r),i=[];if(e){i.length=r.length;for(var n=0;n<r.length;n++)i[n]=gr(r,n)?t(r[n],r):""}var s=typeof su=="function"?su(r):[],o;if(qi){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in r)!gr(r,l)||e&&String(Number(l))===l&&l<r.length||qi&&o["$"+l]instanceof Symbol||(Wp.call(/[^\w$]/,l)?i.push(t(l,r)+": "+t(r[l],r)):i.push(l+": "+t(r[l],r)));if(typeof su=="function")for(var h=0;h<s.length;h++)qp.call(r,s[h])&&i.push("["+t(s[h])+"]: "+t(r[s[h]],r));return i}var Zp=nn,sn=Cy,n0=Uy,s0=ms,Ws=Zp("%WeakMap%",!0),qs=Zp("%Map%",!0),o0=sn("WeakMap.prototype.get",!0),a0=sn("WeakMap.prototype.set",!0),u0=sn("WeakMap.prototype.has",!0),l0=sn("Map.prototype.get",!0),h0=sn("Map.prototype.set",!0),c0=sn("Map.prototype.has",!0),Vl=function(r,t){for(var e=r,i;(i=e.next)!==null;e=i)if(i.key===t)return e.next=i.next,i.next=r.next,r.next=i,i},d0=function(r,t){var e=Vl(r,t);return e&&e.value},f0=function(r,t,e){var i=Vl(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},p0=function(r,t){return!!Vl(r,t)},m0=function(){var t,e,i,n={assert:function(s){if(!n.has(s))throw new s0("Side channel does not contain "+n0(s))},get:function(s){if(Ws&&s&&(typeof s=="object"||typeof s=="function")){if(t)return o0(t,s)}else if(qs){if(e)return l0(e,s)}else if(i)return d0(i,s)},has:function(s){if(Ws&&s&&(typeof s=="object"||typeof s=="function")){if(t)return u0(t,s)}else if(qs){if(e)return c0(e,s)}else if(i)return p0(i,s);return!1},set:function(s,o){Ws&&s&&(typeof s=="object"||typeof s=="function")?(t||(t=new Ws),a0(t,s,o)):qs?(e||(e=new qs),h0(e,s,o)):(i||(i={key:{},next:null}),f0(i,s,o))}};return n},g0=String.prototype.replace,v0=/%20/g,au={RFC1738:"RFC1738",RFC3986:"RFC3986"},Gl={default:au.RFC3986,formatters:{RFC1738:function(r){return g0.call(r,v0,"+")},RFC3986:function(r){return String(r)}},RFC1738:au.RFC1738,RFC3986:au.RFC3986},_0=Gl,uu=Object.prototype.hasOwnProperty,Qr=Array.isArray,Fe=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r}(),y0=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(Qr(i)){for(var n=[],s=0;s<i.length;++s)typeof i[s]<"u"&&n.push(i[s]);e.obj[e.prop]=n}}},tm=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(i[n]=t[n]);return i},E0=function r(t,e,i){if(!e)return t;if(typeof e!="object"){if(Qr(t))t.push(e);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!uu.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var n=t;return Qr(t)&&!Qr(e)&&(n=tm(t,i)),Qr(t)&&Qr(e)?(e.forEach(function(s,o){if(uu.call(t,o)){var a=t[o];a&&typeof a=="object"&&s&&typeof s=="object"?t[o]=r(a,s,i):t.push(s)}else t[o]=s}),t):Object.keys(e).reduce(function(s,o){var a=e[o];return uu.call(s,o)?s[o]=r(s[o],a,i):s[o]=a,s},n)},T0=function(t,e){return Object.keys(e).reduce(function(i,n){return i[n]=e[n],i},t)},I0=function(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},lu=1024,w0=function(t,e,i,n,s){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),i==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(g){return"%26%23"+parseInt(g.slice(2),16)+"%3B"});for(var a="",l=0;l<o.length;l+=lu){for(var h=o.length>=lu?o.slice(l,l+lu):o,c=[],p=0;p<h.length;++p){var m=h.charCodeAt(p);if(m===45||m===46||m===95||m===126||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122||s===_0.RFC1738&&(m===40||m===41)){c[c.length]=h.charAt(p);continue}if(m<128){c[c.length]=Fe[m];continue}if(m<2048){c[c.length]=Fe[192|m>>6]+Fe[128|m&63];continue}if(m<55296||m>=57344){c[c.length]=Fe[224|m>>12]+Fe[128|m>>6&63]+Fe[128|m&63];continue}p+=1,m=65536+((m&1023)<<10|h.charCodeAt(p)&1023),c[c.length]=Fe[240|m>>18]+Fe[128|m>>12&63]+Fe[128|m>>6&63]+Fe[128|m&63]}a+=c.join("")}return a},b0=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],n=0;n<e.length;++n)for(var s=e[n],o=s.obj[s.prop],a=Object.keys(o),l=0;l<a.length;++l){var h=a[l],c=o[h];typeof c=="object"&&c!==null&&i.indexOf(c)===-1&&(e.push({obj:o,prop:h}),i.push(c))}return y0(e),t},A0=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},C0=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},x0=function(t,e){return[].concat(t,e)},P0=function(t,e){if(Qr(t)){for(var i=[],n=0;n<t.length;n+=1)i.push(e(t[n]));return i}return e(t)},em={arrayToObject:tm,assign:T0,combine:x0,compact:b0,decode:I0,encode:w0,isBuffer:C0,isRegExp:A0,maybeMap:P0,merge:E0},rm=m0,vo=em,Gn=Gl,S0=Object.prototype.hasOwnProperty,im={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Ne=Array.isArray,R0=Array.prototype.push,nm=function(r,t){R0.apply(r,Ne(t)?t:[t])},M0=Date.prototype.toISOString,Cd=Gn.default,Mt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:vo.encode,encodeValuesOnly:!1,format:Cd,formatter:Gn.formatters[Cd],indices:!1,serializeDate:function(t){return M0.call(t)},skipNulls:!1,strictNullHandling:!1},O0=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},hu={},F0=function r(t,e,i,n,s,o,a,l,h,c,p,m,g,_,A,y,S,M){for(var x=t,F=M,B=0,N=!1;(F=F.get(hu))!==void 0&&!N;){var b=F.get(t);if(B+=1,typeof b<"u"){if(b===B)throw new RangeError("Cyclic object value");N=!0}typeof F.get(hu)>"u"&&(B=0)}if(typeof c=="function"?x=c(e,x):x instanceof Date?x=g(x):i==="comma"&&Ne(x)&&(x=vo.maybeMap(x,function(V){return V instanceof Date?g(V):V})),x===null){if(o)return h&&!y?h(e,Mt.encoder,S,"key",_):e;x=""}if(O0(x)||vo.isBuffer(x)){if(h){var E=y?e:h(e,Mt.encoder,S,"key",_);return[A(E)+"="+A(h(x,Mt.encoder,S,"value",_))]}return[A(e)+"="+A(String(x))]}var T=[];if(typeof x>"u")return T;var w;if(i==="comma"&&Ne(x))y&&h&&(x=vo.maybeMap(x,h)),w=[{value:x.length>0?x.join(",")||null:void 0}];else if(Ne(c))w=c;else{var C=Object.keys(x);w=p?C.sort(p):C}var P=l?e.replace(/\./g,"%2E"):e,I=n&&Ne(x)&&x.length===1?P+"[]":P;if(s&&Ne(x)&&x.length===0)return I+"[]";for(var lt=0;lt<w.length;++lt){var Tt=w[lt],re=typeof Tt=="object"&&typeof Tt.value<"u"?Tt.value:x[Tt];if(!(a&&re===null)){var ue=m&&l?Tt.replace(/\./g,"%2E"):Tt,We=Ne(x)?typeof i=="function"?i(I,ue):I:I+(m?"."+ue:"["+ue+"]");M.set(t,B);var ur=rm();ur.set(hu,M),nm(T,r(re,We,i,n,s,o,a,l,i==="comma"&&y&&Ne(x)?null:h,c,p,m,g,_,A,y,S,ur))}}return T},D0=function(t){if(!t)return Mt;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||Mt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=Gn.default;if(typeof t.format<"u"){if(!S0.call(Gn.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var n=Gn.formatters[i],s=Mt.filter;(typeof t.filter=="function"||Ne(t.filter))&&(s=t.filter);var o;if(t.arrayFormat in im?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=Mt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:Mt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Mt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Mt.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Mt.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Mt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Mt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Mt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Mt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Mt.encodeValuesOnly,filter:s,format:i,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Mt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Mt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Mt.strictNullHandling}},L0=function(r,t){var e=r,i=D0(t),n,s;typeof i.filter=="function"?(s=i.filter,e=s("",e)):Ne(i.filter)&&(s=i.filter,n=s);var o=[];if(typeof e!="object"||e===null)return"";var a=im[i.arrayFormat],l=a==="comma"&&i.commaRoundTrip;n||(n=Object.keys(e)),i.sort&&n.sort(i.sort);for(var h=rm(),c=0;c<n.length;++c){var p=n[c];i.skipNulls&&e[p]===null||nm(o,F0(e[p],p,a,l,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,h))}var m=o.join(i.delimiter),g=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?g+="utf8=%26%2310003%3B&":g+="utf8=%E2%9C%93&"),m.length>0?g+m:""},Yi=em,Ju=Object.prototype.hasOwnProperty,N0=Array.isArray,yt={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Yi.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},k0=function(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},sm=function(r,t){return r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1?r.split(","):r},B0="utf8=%26%2310003%3B",U0="utf8=%E2%9C%93",V0=function(t,e){var i={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;n=n.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=n.split(e.delimiter,s),a=-1,l,h=e.charset;if(e.charsetSentinel)for(l=0;l<o.length;++l)o[l].indexOf("utf8=")===0&&(o[l]===U0?h="utf-8":o[l]===B0&&(h="iso-8859-1"),a=l,l=o.length);for(l=0;l<o.length;++l)if(l!==a){var c=o[l],p=c.indexOf("]="),m=p===-1?c.indexOf("="):p+1,g,_;m===-1?(g=e.decoder(c,yt.decoder,h,"key"),_=e.strictNullHandling?null:""):(g=e.decoder(c.slice(0,m),yt.decoder,h,"key"),_=Yi.maybeMap(sm(c.slice(m+1),e),function(y){return e.decoder(y,yt.decoder,h,"value")})),_&&e.interpretNumericEntities&&h==="iso-8859-1"&&(_=k0(_)),c.indexOf("[]=")>-1&&(_=N0(_)?[_]:_);var A=Ju.call(i,g);A&&e.duplicates==="combine"?i[g]=Yi.combine(i[g],_):(!A||e.duplicates==="last")&&(i[g]=_)}return i},G0=function(r,t,e,i){for(var n=i?t:sm(t,e),s=r.length-1;s>=0;--s){var o,a=r[s];if(a==="[]"&&e.parseArrays)o=e.allowEmptyArrays&&(n===""||e.strictNullHandling&&n===null)?[]:[].concat(n);else{o=e.plainObjects?Object.create(null):{};var l=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,h=e.decodeDotInKeys?l.replace(/%2E/g,"."):l,c=parseInt(h,10);!e.parseArrays&&h===""?o={0:n}:!isNaN(c)&&a!==h&&String(c)===h&&c>=0&&e.parseArrays&&c<=e.arrayLimit?(o=[],o[c]=n):h!=="__proto__"&&(o[h]=n)}n=o}return n},j0=function(t,e,i,n){if(!!t){var s=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=i.depth>0&&o.exec(s),h=l?s.slice(0,l.index):s,c=[];if(h){if(!i.plainObjects&&Ju.call(Object.prototype,h)&&!i.allowPrototypes)return;c.push(h)}for(var p=0;i.depth>0&&(l=a.exec(s))!==null&&p<i.depth;){if(p+=1,!i.plainObjects&&Ju.call(Object.prototype,l[1].slice(1,-1))&&!i.allowPrototypes)return;c.push(l[1])}if(l){if(i.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+i.depth+" and strictDepth is true");c.push("["+s.slice(l.index)+"]")}return G0(c,e,i,n)}},H0=function(t){if(!t)return yt;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?yt.charset:t.charset,i=typeof t.duplicates>"u"?yt.duplicates:t.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:yt.allowDots:!!t.allowDots;return{allowDots:n,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:yt.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:yt.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:yt.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:yt.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:yt.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:yt.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:yt.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:yt.decoder,delimiter:typeof t.delimiter=="string"||Yi.isRegExp(t.delimiter)?t.delimiter:yt.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:yt.depth,duplicates:i,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:yt.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:yt.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:yt.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:yt.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:yt.strictNullHandling}},$0=function(r,t){var e=H0(t);if(r===""||r===null||typeof r>"u")return e.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?V0(r,e):r,n=e.plainObjects?Object.create(null):{},s=Object.keys(i),o=0;o<s.length;++o){var a=s[o],l=j0(a,i[a],e,typeof r=="string");n=Yi.merge(n,l,e)}return e.allowSparse===!0?n:Yi.compact(n)},z0=L0,X0=$0,W0=Gl,q0={formats:W0,parse:X0,stringify:z0},Y0=$u.exports;function Me(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var K0=/^([a-z0-9.+-]+:)/i,J0=/:[0-9]*$/,Q0=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,Z0=["<",">",'"',"`"," ","\r",`
`,"	"],tE=["{","}","|","\\","^","`"].concat(Z0),Qu=["'"].concat(tE),xd=["%","/","?",";","#"].concat(Qu),Pd=["/","?","#"],eE=255,Sd=/^[+a-z0-9A-Z_-]{0,63}$/,rE=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,iE={javascript:!0,"javascript:":!0},Zu={javascript:!0,"javascript:":!0},Bi={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},tl=q0;function ca(r,t,e){if(r&&typeof r=="object"&&r instanceof Me)return r;var i=new Me;return i.parse(r,t,e),i}Me.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),n=i!==-1&&i<r.indexOf("#")?"?":"#",s=r.split(n),o=/\\/g;s[0]=s[0].replace(o,"/"),r=s.join(n);var a=r;if(a=a.trim(),!e&&r.split("#").length===1){var l=Q0.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],t?this.query=tl.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=K0.exec(a);if(h){h=h[0];var c=h.toLowerCase();this.protocol=c,a=a.substr(h.length)}if(e||h||a.match(/^\/\/[^@/]+@[^@/]+/)){var p=a.substr(0,2)==="//";p&&!(h&&Zu[h])&&(a=a.substr(2),this.slashes=!0)}if(!Zu[h]&&(p||h&&!Bi[h])){for(var m=-1,g=0;g<Pd.length;g++){var _=a.indexOf(Pd[g]);_!==-1&&(m===-1||_<m)&&(m=_)}var A,y;m===-1?y=a.lastIndexOf("@"):y=a.lastIndexOf("@",m),y!==-1&&(A=a.slice(0,y),a=a.slice(y+1),this.auth=decodeURIComponent(A)),m=-1;for(var g=0;g<xd.length;g++){var _=a.indexOf(xd[g]);_!==-1&&(m===-1||_<m)&&(m=_)}m===-1&&(m=a.length),this.host=a.slice(0,m),a=a.slice(m),this.parseHost(),this.hostname=this.hostname||"";var S=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!S)for(var M=this.hostname.split(/\./),g=0,x=M.length;g<x;g++){var F=M[g];if(!!F&&!F.match(Sd)){for(var B="",N=0,b=F.length;N<b;N++)F.charCodeAt(N)>127?B+="x":B+=F[N];if(!B.match(Sd)){var E=M.slice(0,g),T=M.slice(g+1),w=F.match(rE);w&&(E.push(w[1]),T.unshift(w[2])),T.length&&(a="/"+T.join(".")+a),this.hostname=E.join(".");break}}}this.hostname.length>eE?this.hostname="":this.hostname=this.hostname.toLowerCase(),S||(this.hostname=Y0.toASCII(this.hostname));var C=this.port?":"+this.port:"",P=this.hostname||"";this.host=P+C,this.href+=this.host,S&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!iE[c])for(var g=0,x=Qu.length;g<x;g++){var I=Qu[g];if(a.indexOf(I)!==-1){var lt=encodeURIComponent(I);lt===I&&(lt=escape(I)),a=a.split(I).join(lt)}}var Tt=a.indexOf("#");Tt!==-1&&(this.hash=a.substr(Tt),a=a.slice(0,Tt));var re=a.indexOf("?");if(re!==-1?(this.search=a.substr(re),this.query=a.substr(re+1),t&&(this.query=tl.parse(this.query)),a=a.slice(0,re)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Bi[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var C=this.pathname||"",ue=this.search||"";this.path=C+ue}return this.href=this.format(),this};function nE(r){return typeof r=="string"&&(r=ca(r)),r instanceof Me?r.format():Me.prototype.format.call(r)}Me.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",n=!1,s="";this.host?n=r+this.host:this.hostname&&(n=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=tl.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Bi[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),t+n+e+o+i};function sE(r,t){return ca(r,!1,!0).resolve(t)}Me.prototype.resolve=function(r){return this.resolveObject(ca(r,!1,!0)).format()};Me.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new Me;t.parse(r,!1,!0),r=t}for(var e=new Me,i=Object.keys(this),n=0;n<i.length;n++){var s=i[n];e[s]=this[s]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(e[l]=r[l])}return Bi[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!Bi[r.protocol]){for(var h=Object.keys(r),c=0;c<h.length;c++){var p=h[c];e[p]=r[p]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!Zu[r.protocol]){for(var x=(r.pathname||"").split("/");x.length&&!(r.host=x.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),x[0]!==""&&x.unshift(""),x.length<2&&x.unshift(""),e.pathname=x.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var m=e.pathname||"",g=e.search||"";e.path=m+g}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var _=e.pathname&&e.pathname.charAt(0)==="/",A=r.host||r.pathname&&r.pathname.charAt(0)==="/",y=A||_||e.host&&r.pathname,S=y,M=e.pathname&&e.pathname.split("/")||[],x=r.pathname&&r.pathname.split("/")||[],F=e.protocol&&!Bi[e.protocol];if(F&&(e.hostname="",e.port=null,e.host&&(M[0]===""?M[0]=e.host:M.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(x[0]===""?x[0]=r.host:x.unshift(r.host)),r.host=null),y=y&&(x[0]===""||M[0]==="")),A)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,M=x;else if(x.length)M||(M=[]),M.pop(),M=M.concat(x),e.search=r.search,e.query=r.query;else if(r.search!=null){if(F){e.host=M.shift(),e.hostname=e.host;var B=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;B&&(e.auth=B.shift(),e.hostname=B.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!M.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var N=M.slice(-1)[0],b=(e.host||r.host||M.length>1)&&(N==="."||N==="..")||N==="",E=0,T=M.length;T>=0;T--)N=M[T],N==="."?M.splice(T,1):N===".."?(M.splice(T,1),E++):E&&(M.splice(T,1),E--);if(!y&&!S)for(;E--;E)M.unshift("..");y&&M[0]!==""&&(!M[0]||M[0].charAt(0)!=="/")&&M.unshift(""),b&&M.join("/").substr(-1)!=="/"&&M.push("");var w=M[0]===""||M[0]&&M[0].charAt(0)==="/";if(F){e.hostname=w?"":M.length?M.shift():"",e.host=e.hostname;var B=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;B&&(e.auth=B.shift(),e.hostname=B.shift(),e.host=e.hostname)}return y=y||e.host&&M.length,y&&!w&&M.unshift(""),M.length>0?e.pathname=M.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};Me.prototype.parseHost=function(){var r=this.host,t=J0.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};var oE=ca,aE=sE,uE=nE;/*!
 * @pixi/utils - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/utils is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var da={parse:oE,format:uE,resolve:aE};j.RETINA_PREFIX=/@([0-9\.]+)x/;j.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Rd=!1,Md="6.5.10";function lE(r){var t;if(!Rd){if(j.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){var e=[`
 %c %c %c PixiJS `+Md+" - \u2730 "+r+` \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(t=globalThis.console).log.apply(t,e)}else globalThis.console&&globalThis.console.log("PixiJS "+Md+" - "+r+" - http://www.pixijs.com/");Rd=!0}}var cu;function hE(){return typeof cu>"u"&&(cu=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:j.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!j.ADAPTER.getWebGLRenderingContext())return!1;var e=j.ADAPTER.createCanvas(),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),n=!!(i&&i.getContextAttributes().stencil);if(i){var s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,n}catch{return!1}}()),cu}function cE(r,t){return t===void 0&&(t=[]),t[0]=(r>>16&255)/255,t[1]=(r>>8&255)/255,t[2]=(r&255)/255,t}function dE(r){var t=r.toString(16);return t="000000".substring(0,6-t.length)+t,"#"+t}function fE(){for(var r=[],t=[],e=0;e<32;e++)r[e]=e,t[e]=e;r[H.NORMAL_NPM]=H.NORMAL,r[H.ADD_NPM]=H.ADD,r[H.SCREEN_NPM]=H.SCREEN,t[H.NORMAL]=H.NORMAL_NPM,t[H.ADD]=H.ADD_NPM,t[H.SCREEN]=H.SCREEN_NPM;var i=[];return i.push(t),i.push(r),i}var pE=fE();function mE(r,t){if(t===1)return(t*255<<24)+r;if(t===0)return 0;var e=r>>16&255,i=r>>8&255,n=r&255;return e=e*t+.5|0,i=i*t+.5|0,n=n*t+.5|0,(t*255<<24)+(e<<16)+(i<<8)+n}function om(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function ko(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Od(r){return!(r&r-1)&&!!r}function Fd(r){var t=(r>65535?1:0)<<4;r>>>=t;var e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function _o(r,t,e){var i=r.length,n;if(!(t>=i||e===0)){e=t+e>i?i-t:e;var s=i-e;for(n=t;n<s;++n)r[n]=r[n+e];r.length=s}}var gE=0;function ts(){return++gE}var Dd={};function oi(r,t,e){if(e===void 0&&(e=3),!Dd[t]){var i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+r):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t+`
Deprecated since v`+r),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+r),console.warn(i))),Dd[t]=!0}}var Ld={},Je=Object.create(null),Br=Object.create(null);(function(){function r(t,e,i){this.canvas=j.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=i||j.RESOLUTION,this.resize(t,e)}return r.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},r.prototype.resize=function(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)},r.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(r.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0}),r})();var Ys;function vE(r,t){if(t===void 0&&(t=globalThis.location),r.indexOf("data:")===0)return"";t=t||globalThis.location,Ys||(Ys=document.createElement("a")),Ys.href=r;var e=da.parse(Ys.href),i=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!i||e.protocol!==t.protocol?"anonymous":""}function Nd(r,t){var e=j.RETINA_PREFIX.exec(r);return e?parseFloat(e[1]):t!==void 0?t:1}/*!
 * @pixi/extensions - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/extensions is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var jn=function(){return jn=Object.assign||function(t){for(var e=arguments,i,n=1,s=arguments.length;n<s;n++){i=e[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},jn.apply(this,arguments)},be;(function(r){r.Application="application",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Loader="loader",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser"})(be||(be={}));var kd=function(r){if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");var t=typeof r.extension!="object"?{type:r.extension}:r.extension;r=jn(jn({},t),{ref:r})}if(typeof r=="object")r=jn({},r);else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},vs={_addHandlers:null,_removeHandlers:null,_queue:{},remove:function(){for(var r=arguments,t=this,e=[],i=0;i<arguments.length;i++)e[i]=r[i];return e.map(kd).forEach(function(n){n.type.forEach(function(s){var o,a;return(a=(o=t._removeHandlers)[s])===null||a===void 0?void 0:a.call(o,n)})}),this},add:function(){for(var r=arguments,t=this,e=[],i=0;i<arguments.length;i++)e[i]=r[i];return e.map(kd).forEach(function(n){n.type.forEach(function(s){var o=t._addHandlers,a=t._queue;o[s]?o[s](n):(a[s]=a[s]||[],a[s].push(n))})}),this},handle:function(r,t,e){var i=this._addHandlers=this._addHandlers||{},n=this._removeHandlers=this._removeHandlers||{};if(i[r]||n[r])throw new Error("Extension type "+r+" already has a handler");i[r]=t,n[r]=e;var s=this._queue;return s[r]&&(s[r].forEach(function(o){return t(o)}),delete s[r]),this},handleByMap:function(r,t){return this.handle(r,function(e){t[e.name]=e.ref},function(e){delete t[e.name]})},handleByList:function(r,t){return this.handle(r,function(e){var i,n;t.includes(e.ref)||(t.push(e.ref),r===be.Loader&&((n=(i=e.ref).add)===null||n===void 0||n.call(i)))},function(e){var i=t.indexOf(e.ref);i!==-1&&t.splice(i,1)})}};/*!
 * @pixi/runner - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/runner is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var jt=function(){function r(t){this.items=[],this._name=t,this._aliasCount=0}return r.prototype.emit=function(t,e,i,n,s,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");var h=this,c=h.name,p=h.items;this._aliasCount++;for(var m=0,g=p.length;m<g;m++)p[m][c](t,e,i,n,s,o,a,l);return p===this.items&&this._aliasCount--,this},r.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},r.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},r.prototype.remove=function(t){var e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},r.prototype.contains=function(t){return this.items.indexOf(t)!==-1},r.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},r.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(r.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),r}();Object.defineProperties(jt.prototype,{dispatch:{value:jt.prototype.emit},run:{value:jt.prototype.emit}});/*!
 * @pixi/ticker - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */j.TARGET_FPMS=.06;var Ki;(function(r){r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY"})(Ki||(Ki={}));var du=function(){function r(t,e,i,n){e===void 0&&(e=null),i===void 0&&(i=0),n===void 0&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}return r.prototype.match=function(t,e){return e===void 0&&(e=null),this.fn===t&&this.context===e},r.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},r.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},r.prototype.destroy=function(t){t===void 0&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},r}(),xe=function(){function r(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new du(null,null,1/0),this.deltaMS=1/j.TARGET_FPMS,this.elapsedMS=1/j.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&t._requestId===null&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return r.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},r.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},r.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},r.prototype.add=function(t,e,i){return i===void 0&&(i=Ki.NORMAL),this._addListener(new du(t,e,i))},r.prototype.addOnce=function(t,e,i){return i===void 0&&(i=Ki.NORMAL),this._addListener(new du(t,e,i,!0))},r.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this},r.prototype.remove=function(t,e){for(var i=this._head.next;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(r.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),r.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},r.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},r.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},r.prototype.update=function(t){t===void 0&&(t=performance.now());var e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*j.TARGET_FPMS;for(var n=this._head,s=n.next;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(r.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,j.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(t===0)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(r,"shared",{get:function(){if(!r._shared){var t=r._shared=new r;t.autoStart=!0,t._protected=!0}return r._shared},enumerable:!1,configurable:!0}),Object.defineProperty(r,"system",{get:function(){if(!r._system){var t=r._system=new r;t.autoStart=!0,t._protected=!0}return r._system},enumerable:!1,configurable:!0}),r}(),_E=function(){function r(){}return r.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,Ki.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?xe.shared:new xe,t.autoStart&&this.start()},r.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},r.extension=be.Application,r}();/*!
 * @pixi/math - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/math is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var yE=Math.PI*2,EE=180/Math.PI,TE=Math.PI/180,el;(function(r){r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC"})(el||(el={}));var ae=function(){function r(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},r.prototype.copyTo=function(t){return t.set(this.x,this.y),t},r.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},r.prototype.set=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x=t,this.y=e,this},r.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},r}(),Ks=[new ae,new ae,new ae,new ae],At=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=el.RECT}return Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(r,"EMPTY",{get:function(){return new r(0,0,0,0)},enumerable:!1,configurable:!0}),r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},r.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},r.prototype.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},r.prototype.intersects=function(t,e){if(!e){var i=this.x<t.x?t.x:this.x,n=this.right>t.right?t.right:this.right;if(n<=i)return!1;var s=this.y<t.y?t.y:this.y,o=this.bottom>t.bottom?t.bottom:this.bottom;return o>s}var a=this.left,l=this.right,h=this.top,c=this.bottom;if(l<=a||c<=h)return!1;var p=Ks[0].set(t.left,t.top),m=Ks[1].set(t.left,t.bottom),g=Ks[2].set(t.right,t.top),_=Ks[3].set(t.right,t.bottom);if(g.x<=p.x||m.y<=p.y)return!1;var A=Math.sign(e.a*e.d-e.b*e.c);if(A===0||(e.apply(p,p),e.apply(m,m),e.apply(g,g),e.apply(_,_),Math.max(p.x,m.x,g.x,_.x)<=a||Math.min(p.x,m.x,g.x,_.x)>=l||Math.max(p.y,m.y,g.y,_.y)<=h||Math.min(p.y,m.y,g.y,_.y)>=c))return!1;var y=A*(m.y-p.y),S=A*(p.x-m.x),M=y*a+S*h,x=y*l+S*h,F=y*a+S*c,B=y*l+S*c;if(Math.max(M,x,F,B)<=y*p.x+S*p.y||Math.min(M,x,F,B)>=y*_.x+S*_.y)return!1;var N=A*(p.y-g.y),b=A*(g.x-p.x),E=N*a+b*h,T=N*l+b*h,w=N*a+b*c,C=N*l+b*c;return!(Math.max(E,T,w,C)<=N*p.x+b*p.y||Math.min(E,T,w,C)>=N*_.x+b*_.y)},r.prototype.pad=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this},r.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(s-n,0),this},r.prototype.ceil=function(t,e){t===void 0&&(t=1),e===void 0&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this},r.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=s-n,this},r.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},r}(),On=function(){function r(t,e,i,n){i===void 0&&(i=0),n===void 0&&(n=0),this._x=i,this._y=n,this.cb=t,this.scope=e}return r.prototype.clone=function(t,e){return t===void 0&&(t=this.cb),e===void 0&&(e=this.scope),new r(t,e,this._x,this._y)},r.prototype.set=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this},r.prototype.copyFrom=function(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},r.prototype.copyTo=function(t){return t.set(this._x,this._y),t},r.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},r.prototype.toString=function(){return"[@pixi/math:ObservablePoint x="+0+" y="+0+" scope="+this.scope+"]"},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),r}(),Xt=function(){function r(t,e,i,n,s,o){t===void 0&&(t=1),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=1),s===void 0&&(s=0),o===void 0&&(o=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o}return r.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},r.prototype.set=function(t,e,i,n,s,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=o,this},r.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},r.prototype.apply=function(t,e){e=e||new ae;var i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e},r.prototype.applyInverse=function(t,e){e=e||new ae;var i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},r.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},r.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},r.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},r.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},r.prototype.setTransform=function(t,e,i,n,s,o,a,l,h){return this.a=Math.cos(a+h)*s,this.b=Math.sin(a+h)*s,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this},r.prototype.prepend=function(t){var e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){var i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},r.prototype.decompose=function(t){var e=this.a,i=this.b,n=this.c,s=this.d,o=t.pivot,a=-Math.atan2(-n,s),l=Math.atan2(i,e),h=Math.abs(a+l);return h<1e-5||Math.abs(yE-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*i+o.y*s),t},r.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,s=this.tx,o=t*n-e*i;return this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*s)/o,this.ty=-(t*this.ty-e*s)/o,this},r.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},r.prototype.clone=function(){var t=new r;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},r.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},r.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},r.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(r,"IDENTITY",{get:function(){return new r},enumerable:!1,configurable:!0}),Object.defineProperty(r,"TEMP_MATRIX",{get:function(){return new r},enumerable:!1,configurable:!0}),r}(),Hr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],$r=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],zr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Xr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rl=[],am=[],Js=Math.sign;function IE(){for(var r=0;r<16;r++){var t=[];rl.push(t);for(var e=0;e<16;e++)for(var i=Js(Hr[r]*Hr[e]+zr[r]*$r[e]),n=Js($r[r]*Hr[e]+Xr[r]*$r[e]),s=Js(Hr[r]*zr[e]+zr[r]*Xr[e]),o=Js($r[r]*zr[e]+Xr[r]*Xr[e]),a=0;a<16;a++)if(Hr[a]===i&&$r[a]===n&&zr[a]===s&&Xr[a]===o){t.push(a);break}}for(var r=0;r<16;r++){var l=new Xt;l.set(Hr[r],$r[r],zr[r],Xr[r],0,0),am.push(l)}}IE();var pt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(r){return Hr[r]},uY:function(r){return $r[r]},vX:function(r){return zr[r]},vY:function(r){return Xr[r]},inv:function(r){return r&8?r&15:-r&7},add:function(r,t){return rl[r][t]},sub:function(r,t){return rl[r][pt.inv(t)]},rotate180:function(r){return r^4},isVertical:function(r){return(r&3)===2},byDirection:function(r,t){return Math.abs(r)*2<=Math.abs(t)?t>=0?pt.S:pt.N:Math.abs(t)*2<=Math.abs(r)?r>0?pt.E:pt.W:t>0?r>0?pt.SE:pt.SW:r>0?pt.NE:pt.NW},matrixAppendRotationInv:function(r,t,e,i){e===void 0&&(e=0),i===void 0&&(i=0);var n=am[pt.inv(t)];n.tx=e,n.ty=i,r.append(n)}},um=function(){function r(){this.worldTransform=new Xt,this.localTransform=new Xt,this.position=new On(this.onChange,this,0,0),this.scale=new On(this.onChange,this,1,1),this.pivot=new On(this.onChange,this,0,0),this.skew=new On(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return r.prototype.onChange=function(){this._localID++},r.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},r.prototype.toString=function(){return"[@pixi/math:Transform "+("position=("+this.position.x+", "+this.position.y+") ")+("rotation="+this.rotation+" ")+("scale=("+this.scale.x+", "+this.scale.y+") ")+("skew=("+this.skew.x+", "+this.skew.y+") ")+"]"},r.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},r.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,n=this.worldTransform;n.a=e.a*i.a+e.b*i.c,n.b=e.a*i.b+e.b*i.d,n.c=e.c*i.a+e.d*i.c,n.d=e.c*i.b+e.d*i.d,n.tx=e.tx*i.a+e.ty*i.c+i.tx,n.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},r.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),r.IDENTITY=new r,r}();/*!
 * @pixi/core - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/core is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */j.PREFER_ENV=ti.any?sr.WEBGL:sr.WEBGL2;j.STRICT_TEXTURE_CACHE=!1;var il=[];function lm(r,t){if(!r)return null;var e="";if(typeof r=="string"){var i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(var n=il.length-1;n>=0;--n){var s=il[n];if(s.test&&s.test(r,e))return new s(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var nl=function(r,t){return nl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},nl(r,t)};function ut(r,t){nl(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var sl=function(){return sl=Object.assign||function(t){for(var e=arguments,i,n=1,s=arguments.length;n<s;n++){i=e[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},sl.apply(this,arguments)};function wE(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}var es=function(){function r(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new jt("setRealSize"),this.onUpdate=new jt("update"),this.onError=new jt("onError")}return r.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},r.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},r.prototype.resize=function(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(r.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),r.prototype.update=function(){this.destroyed||this.onUpdate.emit()},r.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),r.prototype.style=function(t,e,i){return!1},r.prototype.dispose=function(){},r.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},r.test=function(t,e){return!1},r}(),jl=function(r){ut(t,r);function t(e,i){var n=this,s=i||{},o=s.width,a=s.height;if(!o||!a)throw new Error("BufferResource width or height invalid");return n=r.call(this,o,a)||this,n.data=e,n}return t.prototype.upload=function(e,i,n){var s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ar.UNPACK);var o=i.realWidth,a=i.realHeight;return n.width===o&&n.height===a?s.texSubImage2D(i.target,0,0,0,o,a,i.format,n.type,this.data):(n.width=o,n.height=a,s.texImage2D(i.target,0,n.internalFormat,o,a,0,i.format,n.type,this.data)),!0},t.prototype.dispose=function(){this.data=null},t.test=function(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array},t}(es),bE={scaleMode:Ue.NEAREST,format:U.RGBA,alphaMode:Ar.NPM},Ot=function(r){ut(t,r);function t(e,i){e===void 0&&(e=null),i===void 0&&(i=null);var n=r.call(this)||this;i=i||{};var s=i.alphaMode,o=i.mipmap,a=i.anisotropicLevel,l=i.scaleMode,h=i.width,c=i.height,p=i.wrapMode,m=i.format,g=i.type,_=i.target,A=i.resolution,y=i.resourceOptions;return e&&!(e instanceof es)&&(e=lm(e,y),e.internal=!0),n.resolution=A||j.RESOLUTION,n.width=Math.round((h||0)*n.resolution)/n.resolution,n.height=Math.round((c||0)*n.resolution)/n.resolution,n._mipmap=o!==void 0?o:j.MIPMAP_TEXTURES,n.anisotropicLevel=a!==void 0?a:j.ANISOTROPIC_LEVEL,n._wrapMode=p||j.WRAP_MODE,n._scaleMode=l!==void 0?l:j.SCALE_MODE,n.format=m||U.RGBA,n.type=g||et.UNSIGNED_BYTE,n.target=_||ii.TEXTURE_2D,n.alphaMode=s!==void 0?s:Ar.UNPACK,n.uid=ts(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=h>0&&c>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(e),n}return Object.defineProperty(t.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mipmap",{get:function(){return this._mipmap},set:function(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),t.prototype.setStyle=function(e,i){var n;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,n=!0),i!==void 0&&i!==this.mipmap&&(this.mipmap=i,n=!0),n&&this.dirtyStyleId++,this},t.prototype.setSize=function(e,i,n){return n=n||this.resolution,this.setRealSize(e*n,i*n,n)},t.prototype.setRealSize=function(e,i,n){return this.resolution=n||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(i)/this.resolution,this._refreshPOT(),this.update(),this},t.prototype._refreshPOT=function(){this.isPowerOfTwo=Od(this.realWidth)&&Od(this.realHeight)},t.prototype.setResolution=function(e){var i=this.resolution;return i===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*i)/e,this.height=Math.round(this.height*i)/e,this.emit("update",this)),this._refreshPOT(),this)},t.prototype.setResource=function(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this},t.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},t.prototype.onError=function(e){this.emit("error",this,e)},t.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Br[this.cacheId],delete Je[this.cacheId],this.cacheId=null),this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},t.prototype.dispose=function(){this.emit("dispose",this)},t.prototype.castToBaseTexture=function(){return this},t.from=function(e,i,n){n===void 0&&(n=j.STRICT_TEXTURE_CACHE);var s=typeof e=="string",o=null;if(s)o=e;else{if(!e._pixiId){var a=i&&i.pixiIdPrefix||"pixiid";e._pixiId=a+"_"+ts()}o=e._pixiId}var l=Br[o];if(s&&n&&!l)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return l||(l=new t(e,i),l.cacheId=o,t.addToCache(l,o)),l},t.fromBuffer=function(e,i,n,s){e=e||new Float32Array(i*n*4);var o=new jl(e,{width:i,height:n}),a=e instanceof Float32Array?et.FLOAT:et.UNSIGNED_BYTE;return new t(o,Object.assign({},bE,s||{width:i,height:n,type:a}))},t.addToCache=function(e,i){i&&(e.textureCacheIds.indexOf(i)===-1&&e.textureCacheIds.push(i),Br[i]&&console.warn("BaseTexture added to the cache with an id ["+i+"] that already had an entry"),Br[i]=e)},t.removeFromCache=function(e){if(typeof e=="string"){var i=Br[e];if(i){var n=i.textureCacheIds.indexOf(e);return n>-1&&i.textureCacheIds.splice(n,1),delete Br[e],i}}else if(e&&e.textureCacheIds){for(var s=0;s<e.textureCacheIds.length;++s)delete Br[e.textureCacheIds[s]];return e.textureCacheIds.length=0,e}return null},t._globalBatch=0,t}(Or),hm=function(r){ut(t,r);function t(e,i){var n=this,s=i||{},o=s.width,a=s.height;n=r.call(this,o,a)||this,n.items=[],n.itemDirtyIds=[];for(var l=0;l<e;l++){var h=new Ot;n.items.push(h),n.itemDirtyIds.push(-2)}return n.length=e,n._load=null,n.baseTexture=null,n}return t.prototype.initFromArray=function(e,i){for(var n=0;n<this.length;n++)!e[n]||(e[n].castToBaseTexture?this.addBaseTextureAt(e[n].castToBaseTexture(),n):e[n]instanceof es?this.addResourceAt(e[n],n):this.addResourceAt(lm(e[n],i),n))},t.prototype.dispose=function(){for(var e=0,i=this.length;e<i;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},t.prototype.addResourceAt=function(e,i){if(!this.items[i])throw new Error("Index "+i+" is out of bounds");return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[i].setResource(e),this},t.prototype.bind=function(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");r.prototype.bind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)},t.prototype.unbind=function(e){r.prototype.unbind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)},t.prototype.load=function(){var e=this;if(this._load)return this._load;var i=this.items.map(function(s){return s.resource}).filter(function(s){return s}),n=i.map(function(s){return s.load()});return this._load=Promise.all(n).then(function(){var s=e.items[0],o=s.realWidth,a=s.realHeight;return e.resize(o,a),Promise.resolve(e)}),this._load},t}(es),AE=function(r){ut(t,r);function t(e,i){var n=this,s=i||{},o=s.width,a=s.height,l,h;return Array.isArray(e)?(l=e,h=e.length):h=e,n=r.call(this,h,{width:o,height:a})||this,l&&n.initFromArray(l,i),n}return t.prototype.addBaseTextureAt=function(e,i){if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this},t.prototype.bind=function(e){r.prototype.bind.call(this,e),e.target=ii.TEXTURE_2D_ARRAY},t.prototype.upload=function(e,i,n){var s=this,o=s.length,a=s.itemDirtyIds,l=s.items,h=e.gl;n.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,o,0,i.format,n.type,null);for(var c=0;c<o;c++){var p=l[c];a[c]<p.dirtyId&&(a[c]=p.dirtyId,p.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,c,p.resource.width,p.resource.height,1,i.format,n.type,p.resource.source))}return!0},t}(hm),Cr=function(r){ut(t,r);function t(e){var i=this,n=e,s=n.naturalWidth||n.videoWidth||n.width,o=n.naturalHeight||n.videoHeight||n.height;return i=r.call(this,s,o)||this,i.source=e,i.noSubImage=!1,i}return t.crossOrigin=function(e,i,n){n===void 0&&i.indexOf("data:")!==0?e.crossOrigin=vE(i):n!==!1&&(e.crossOrigin=typeof n=="string"?n:"anonymous")},t.prototype.upload=function(e,i,n,s){var o=e.gl,a=i.realWidth,l=i.realHeight;if(s=s||this.source,s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ar.UNPACK),!this.noSubImage&&i.target===o.TEXTURE_2D&&n.width===a&&n.height===l?o.texSubImage2D(o.TEXTURE_2D,0,0,0,i.format,n.type,s):(n.width=a,n.height=l,o.texImage2D(i.target,0,n.internalFormat,i.format,n.type,s)),!0},t.prototype.update=function(){if(!this.destroyed){var e=this.source,i=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;this.resize(i,n),r.prototype.update.call(this)}},t.prototype.dispose=function(){this.source=null},t}(es),CE=function(r){ut(t,r);function t(e){return r.call(this,e)||this}return t.test=function(e){var i=globalThis.OffscreenCanvas;return i&&e instanceof i?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement},t}(Cr),xE=function(r){ut(t,r);function t(e,i){var n=this,s=i||{},o=s.width,a=s.height,l=s.autoLoad,h=s.linkBaseTexture;if(e&&e.length!==t.SIDES)throw new Error("Invalid length. Got "+e.length+", expected 6");n=r.call(this,6,{width:o,height:a})||this;for(var c=0;c<t.SIDES;c++)n.items[c].target=ii.TEXTURE_CUBE_MAP_POSITIVE_X+c;return n.linkBaseTexture=h!==!1,e&&n.initFromArray(e,i),l!==!1&&n.load(),n}return t.prototype.bind=function(e){r.prototype.bind.call(this,e),e.target=ii.TEXTURE_CUBE_MAP},t.prototype.addBaseTextureAt=function(e,i,n){if(!this.items[i])throw new Error("Index "+i+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,i);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=ii.TEXTURE_CUBE_MAP_POSITIVE_X+i,e.parentTextureArray=this.baseTexture,this.items[i]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[i]=e,this},t.prototype.upload=function(e,i,n){for(var s=this.itemDirtyIds,o=0;o<t.SIDES;o++){var a=this.items[o];(s[o]<a.dirtyId||n.dirtyId<i.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(e,a,n),s[o]=a.dirtyId):s[o]<-1&&(e.gl.texImage2D(a.target,0,n.internalFormat,i.realWidth,i.realHeight,0,i.format,n.type,null),s[o]=-1))}return!0},t.test=function(e){return Array.isArray(e)&&e.length===t.SIDES},t.SIDES=6,t}(hm),cm=function(r){ut(t,r);function t(e,i){var n=this;if(i=i||{},!(e instanceof HTMLImageElement)){var s=new Image;Cr.crossOrigin(s,e,i.crossorigin),s.src=e,e=s}return n=r.call(this,e)||this,!e.complete&&!!n._width&&!!n._height&&(n._width=0,n._height=0),n.url=e.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(i.createBitmap!==void 0?i.createBitmap:j.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,n.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,n.bitmap=null,n._load=null,i.autoLoad!==!1&&n.load(),n}return t.prototype.load=function(e){var i=this;return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise(function(n,s){var o=i.source;i.url=o.src;var a=function(){i.destroyed||(o.onload=null,o.onerror=null,i.resize(o.width,o.height),i._load=null,i.createBitmap?n(i.process()):n(i))};o.complete&&o.src?a():(o.onload=a,o.onerror=function(l){s(l),i.onError.emit(l)})}),this._load)},t.prototype.process=function(){var e=this,i=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);var n=globalThis.createImageBitmap,s=!i.crossOrigin||i.crossOrigin==="anonymous";return this._process=fetch(i.src,{mode:s?"cors":"no-cors"}).then(function(o){return o.blob()}).then(function(o){return n(o,0,0,i.width,i.height,{premultiplyAlpha:e.alphaMode===null||e.alphaMode===Ar.UNPACK?"premultiply":"none"})}).then(function(o){return e.destroyed?Promise.reject():(e.bitmap=o,e.update(),e._process=null,Promise.resolve(e))}),this._process},t.prototype.upload=function(e,i,n){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return r.prototype.upload.call(this,e,i,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(r.prototype.upload.call(this,e,i,n,this.bitmap),!this.preserveBitmap){var s=!0,o=i._glTextures;for(var a in o){var l=o[a];if(l!==n&&l.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},t.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,r.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},t.test=function(e){return typeof e=="string"||e instanceof HTMLImageElement},t}(Cr),PE=function(r){ut(t,r);function t(e,i){var n=this;return i=i||{},n=r.call(this,j.ADAPTER.createCanvas())||this,n._width=0,n._height=0,n.svg=e,n.scale=i.scale||1,n._overrideWidth=i.width,n._overrideHeight=i.height,n._resolve=null,n._crossorigin=i.crossorigin,n._load=null,i.autoLoad!==!1&&n.load(),n}return t.prototype.load=function(){var e=this;return this._load?this._load:(this._load=new Promise(function(i){if(e._resolve=function(){e.resize(e.source.width,e.source.height),i(e)},t.SVG_XML.test(e.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");e.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.svg)))}e._loadSvg()}),this._load)},t.prototype._loadSvg=function(){var e=this,i=new Image;Cr.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=function(n){!e._resolve||(i.onerror=null,e.onError.emit(n))},i.onload=function(){if(!!e._resolve){var n=i.width,s=i.height;if(!n||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var o=n*e.scale,a=s*e.scale;(e._overrideWidth||e._overrideHeight)&&(o=e._overrideWidth||e._overrideHeight/s*n,a=e._overrideHeight||e._overrideWidth/n*s),o=Math.round(o),a=Math.round(a);var l=e.source;l.width=o,l.height=a,l._pixiId="canvas_"+ts(),l.getContext("2d").drawImage(i,0,0,n,s,0,0,o,a),e._resolve(),e._resolve=null}}},t.getSize=function(e){var i=t.SVG_SIZE.exec(e),n={};return i&&(n[i[1]]=Math.round(parseFloat(i[3])),n[i[5]]=Math.round(parseFloat(i[7]))),n},t.prototype.dispose=function(){r.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},t.test=function(e,i){return i==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&t.SVG_XML.test(e)},t.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,t.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,t}(Cr),SE=function(r){ut(t,r);function t(e,i){var n=this;if(i=i||{},!(e instanceof HTMLVideoElement)){var s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);var o=e[0].src||e[0];Cr.crossOrigin(s,o,i.crossorigin);for(var a=0;a<e.length;++a){var l=document.createElement("source"),h=e[a],c=h.src,p=h.mime;c=c||e[a];var m=c.split("?").shift().toLowerCase(),g=m.slice(m.lastIndexOf(".")+1);p=p||t.MIME_TYPES[g]||"video/"+g,l.src=c,l.type=p,s.appendChild(l)}e=s}return n=r.call(this,e)||this,n.noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=i.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=i.autoPlay!==!1,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),i.autoLoad!==!1&&n.load(),n}return t.prototype.update=function(e){if(!this.destroyed){var i=xe.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(r.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},t.prototype.load=function(){var e=this;if(this._load)return this._load;var i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(function(n){e.valid?n(e):(e._resolve=n,i.load())}),this._load},t.prototype._onError=function(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)},t.prototype._isSourcePlaying=function(){var e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()},t.prototype._isSourceReady=function(){var e=this.source;return e.readyState>2},t.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(xe.shared.add(this.update,this),this._isConnectedToTicker=!0)},t.prototype._onPlayStop=function(){this._isConnectedToTicker&&(xe.shared.remove(this.update,this),this._isConnectedToTicker=!1)},t.prototype._onCanPlay=function(){var e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);var i=this.valid;this.resize(e.videoWidth,e.videoHeight),!i&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()},t.prototype.dispose=function(){this._isConnectedToTicker&&(xe.shared.remove(this.update,this),this._isConnectedToTicker=!1);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),r.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(xe.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(xe.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(e){e!==this._updateFPS&&(this._updateFPS=e)},enumerable:!1,configurable:!0}),t.test=function(e,i){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||t.TYPES.indexOf(i)>-1},t.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],t.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},t}(Cr),RE=function(r){ut(t,r);function t(e){return r.call(this,e)||this}return t.test=function(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&e instanceof ImageBitmap},t}(Cr);il.push(cm,RE,CE,SE,PE,jl,xE,AE);var ME=function(r){ut(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.upload=function(e,i,n){var s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ar.UNPACK);var o=i.realWidth,a=i.realHeight;return n.width===o&&n.height===a?s.texSubImage2D(i.target,0,0,0,o,a,i.format,n.type,this.data):(n.width=o,n.height=a,s.texImage2D(i.target,0,n.internalFormat,o,a,0,i.format,n.type,this.data)),!0},t}(jl),ol=function(){function r(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new jt("disposeFramebuffer"),this.multisample=bt.NONE}return Object.defineProperty(r.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),r.prototype.addColorTexture=function(t,e){return t===void 0&&(t=0),this.colorTextures[t]=e||new Ot(null,{scaleMode:Ue.NEAREST,resolution:1,mipmap:br.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},r.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Ot(new ME(null,{width:this.width,height:this.height}),{scaleMode:Ue.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:br.OFF,format:U.DEPTH_COMPONENT,type:et.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},r.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},r.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},r.prototype.resize=function(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var n=this.colorTextures[i],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){var s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},r}(),dm=function(r){ut(t,r);function t(e){e===void 0&&(e={});var i=this;if(typeof e=="number"){var n=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];e={width:n,height:s,scaleMode:o,resolution:a}}return e.width=e.width||100,e.height=e.height||100,e.multisample=e.multisample!==void 0?e.multisample:bt.NONE,i=r.call(this,null,e)||this,i.mipmap=br.OFF,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new ol(i.realWidth,i.realHeight).addColorTexture(0,i),i.framebuffer.multisample=e.multisample,i.maskStack=[],i.filterStack=[{}],i}return t.prototype.resize=function(e,i){this.framebuffer.resize(e*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},t.prototype.dispose=function(){this.framebuffer.dispose(),r.prototype.dispose.call(this)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},t}(Ot),fm=function(){function r(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return r.prototype.set=function(t,e,i){var n=e.width,s=e.height;if(i){var o=t.width/2/n,a=t.height/2/s,l=t.x/n+o,h=t.y/s+a;i=pt.add(i,pt.NW),this.x0=l+o*pt.uX(i),this.y0=h+a*pt.uY(i),i=pt.add(i,2),this.x1=l+o*pt.uX(i),this.y1=h+a*pt.uY(i),i=pt.add(i,2),this.x2=l+o*pt.uX(i),this.y2=h+a*pt.uY(i),i=pt.add(i,2),this.x3=l+o*pt.uX(i),this.y3=h+a*pt.uY(i)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},r.prototype.toString=function(){return"[@pixi/core:TextureUvs "+("x0="+this.x0+" y0="+this.y0+" ")+("x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" ")+("y2="+this.y2+" x3="+this.x3+" y3="+this.y3)+"]"},r}(),Bd=new fm;function Qs(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}var yo=function(r){ut(t,r);function t(e,i,n,s,o,a){var l=r.call(this)||this;if(l.noFrame=!1,i||(l.noFrame=!0,i=new At(0,0,1,1)),e instanceof t&&(e=e.baseTexture),l.baseTexture=e,l._frame=i,l.trim=s,l.valid=!1,l._uvs=Bd,l.uvMatrix=null,l.orig=n||i,l._rotate=Number(o||0),o===!0)l._rotate=2;else if(l._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return l.defaultAnchor=a?new ae(a.x,a.y):new ae(0,0),l._updateID=0,l.textureCacheIds=[],e.valid?l.noFrame?e.valid&&l.onBaseTextureUpdated(e):l.frame=i:e.once("loaded",l.onBaseTextureUpdated,l),l.noFrame&&e.on("update",l.onBaseTextureUpdated,l),l}return t.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},t.prototype.onBaseTextureUpdated=function(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},t.prototype.destroy=function(e){if(this.baseTexture){if(e){var i=this.baseTexture.resource;i&&i.url&&Je[i.url]&&t.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null},t.prototype.clone=function(){var e=this._frame.clone(),i=this._frame===this.orig?e:this.orig.clone(),n=new t(this.baseTexture,!this.noFrame&&e,i,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=e),n},t.prototype.updateUvs=function(){this._uvs===Bd&&(this._uvs=new fm),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},t.from=function(e,i,n){i===void 0&&(i={}),n===void 0&&(n=j.STRICT_TEXTURE_CACHE);var s=typeof e=="string",o=null;if(s)o=e;else if(e instanceof Ot){if(!e.cacheId){var a=i&&i.pixiIdPrefix||"pixiid";e.cacheId=a+"-"+ts(),Ot.addToCache(e,e.cacheId)}o=e.cacheId}else{if(!e._pixiId){var a=i&&i.pixiIdPrefix||"pixiid";e._pixiId=a+"_"+ts()}o=e._pixiId}var l=Je[o];if(s&&n&&!l)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return!l&&!(e instanceof Ot)?(i.resolution||(i.resolution=Nd(e)),l=new t(new Ot(e,i)),l.baseTexture.cacheId=o,Ot.addToCache(l.baseTexture,o),t.addToCache(l,o)):!l&&e instanceof Ot&&(l=new t(e),t.addToCache(l,o)),l},t.fromURL=function(e,i){var n=Object.assign({autoLoad:!1},i?.resourceOptions),s=t.from(e,Object.assign({resourceOptions:n},i),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(function(){return Promise.resolve(s)})},t.fromBuffer=function(e,i,n,s){return new t(Ot.fromBuffer(e,i,n,s))},t.fromLoader=function(e,i,n,s){var o=new Ot(e,Object.assign({scaleMode:j.SCALE_MODE,resolution:Nd(i)},s)),a=o.resource;a instanceof cm&&(a.url=i);var l=new t(o);return n||(n=i),Ot.addToCache(l.baseTexture,n),t.addToCache(l,n),n!==i&&(Ot.addToCache(l.baseTexture,i),t.addToCache(l,i)),l.baseTexture.valid?Promise.resolve(l):new Promise(function(h){l.baseTexture.once("loaded",function(){return h(l)})})},t.addToCache=function(e,i){i&&(e.textureCacheIds.indexOf(i)===-1&&e.textureCacheIds.push(i),Je[i]&&console.warn("Texture added to the cache with an id ["+i+"] that already had an entry"),Je[i]=e)},t.removeFromCache=function(e){if(typeof e=="string"){var i=Je[e];if(i){var n=i.textureCacheIds.indexOf(e);return n>-1&&i.textureCacheIds.splice(n,1),delete Je[e],i}}else if(e&&e.textureCacheIds){for(var s=0;s<e.textureCacheIds.length;++s)Je[e.textureCacheIds[s]]===e&&delete Je[e.textureCacheIds[s]];return e.textureCacheIds.length=0,e}return null},Object.defineProperty(t.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1;var i=e.x,n=e.y,s=e.width,o=e.height,a=i+s>this.baseTexture.width,l=n+o>this.baseTexture.height;if(a||l){var h=a&&l?"and":"or",c="X: "+i+" + "+s+" = "+(i+s)+" > "+this.baseTexture.width,p="Y: "+n+" + "+o+" = "+(n+o)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(c+" "+h+" "+p))}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),t.prototype.castToBaseTexture=function(){return this.baseTexture},Object.defineProperty(t,"EMPTY",{get:function(){return t._EMPTY||(t._EMPTY=new t(new Ot),Qs(t._EMPTY),Qs(t._EMPTY.baseTexture)),t._EMPTY},enumerable:!1,configurable:!0}),Object.defineProperty(t,"WHITE",{get:function(){if(!t._WHITE){var e=j.ADAPTER.createCanvas(16,16),i=e.getContext("2d");e.width=16,e.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),t._WHITE=new t(Ot.from(e)),Qs(t._WHITE),Qs(t._WHITE.baseTexture)}return t._WHITE},enumerable:!1,configurable:!0}),t}(Or),Hl=function(r){ut(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Object.defineProperty(t.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(e){this.framebuffer.multisample=e},enumerable:!1,configurable:!0}),t.prototype.resize=function(e,i,n){n===void 0&&(n=!0);var s=this.baseTexture.resolution,o=Math.round(e*s)/s,a=Math.round(i*s)/s;this.valid=o>0&&a>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=a,n&&this.baseTexture.resize(o,a),this.updateUvs()},t.prototype.setResolution=function(e){var i=this.baseTexture;i.resolution!==e&&(i.setResolution(e),this.resize(i.width,i.height,!1))},t.create=function(e){for(var i=arguments,n=[],s=1;s<arguments.length;s++)n[s-1]=i[s];return typeof e=="number"&&(oi("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),e={width:e,height:n[0],scaleMode:n[1],resolution:n[2]}),new t(new dm(e))},t}(yo),OE=function(){function r(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return r.prototype.createTexture=function(t,e,i){i===void 0&&(i=bt.NONE);var n=new dm(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Hl(n)},r.prototype.getOptimalTexture=function(t,e,i,n){i===void 0&&(i=1),n===void 0&&(n=bt.NONE);var s;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=ko(t),e=ko(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);var o=this.texturePool[s].pop();return o||(o=this.createTexture(t,e,n)),o.filterPoolKey=s,o.setResolution(i),o},r.prototype.getFilterTexture=function(t,e,i){var n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||bt.NONE);return n.filterFrame=t.filterFrame,n},r.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},r.prototype.returnFilterTexture=function(t){this.returnTexture(t)},r.prototype.clear=function(t){if(t=t!==!1,t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}},r.prototype.setScreenSize=function(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(var e in this.texturePool)if(Number(e)<0){var i=this.texturePool[e];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},r.SCREEN_KEY=-1,r}(),Ud=function(){function r(t,e,i,n,s,o,a){e===void 0&&(e=0),i===void 0&&(i=!1),n===void 0&&(n=et.FLOAT),this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=s,this.start=o,this.instance=a}return r.prototype.destroy=function(){this.buffer=null},r.from=function(t,e,i,n,s){return new r(t,e,i,n,s)},r}(),FE=0,me=function(){function r(t,e,i){e===void 0&&(e=!0),i===void 0&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=FE++,this.disposeRunner=new jt("disposeBuffer")}return r.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(r.prototype,"index",{get:function(){return this.type===Ve.ELEMENT_ARRAY_BUFFER},set:function(t){this.type=t?Ve.ELEMENT_ARRAY_BUFFER:Ve.ARRAY_BUFFER},enumerable:!1,configurable:!0}),r.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new r(t)},r}(),DE={Float32Array,Uint32Array,Int32Array,Uint8Array};function LE(r,t){for(var e=0,i=0,n={},s=0;s<r.length;s++)i+=t[s],e+=r[s].length;for(var o=new ArrayBuffer(e*4),a=null,l=0,s=0;s<r.length;s++){var h=t[s],c=r[s],p=om(c);n[p]||(n[p]=new DE[p](o)),a=n[p];for(var m=0;m<c.length;m++){var g=(m/h|0)*i+l,_=m%h;a[g+_]=c[m]}l+=h}return new Float32Array(o)}var Vd={5126:4,5123:2,5121:1},NE=0,kE={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},$l=function(){function r(t,e){t===void 0&&(t=[]),e===void 0&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=NE++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new jt("disposeGeometry"),this.refCount=0}return r.prototype.addAttribute=function(t,e,i,n,s,o,a,l){if(i===void 0&&(i=0),n===void 0&&(n=!1),l===void 0&&(l=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof me||(e instanceof Array&&(e=new Float32Array(e)),e=new me(e));var h=t.split("|");if(h.length>1){for(var c=0;c<h.length;c++)this.addAttribute(h[c],e,i,n,s);return this}var p=this.buffers.indexOf(e);return p===-1&&(this.buffers.push(e),p=this.buffers.length-1),this.attributes[t]=new Ud(p,i,n,s,o,a,l),this.instanced=this.instanced||l,this},r.prototype.getAttribute=function(t){return this.attributes[t]},r.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},r.prototype.addIndex=function(t){return t instanceof me||(t instanceof Array&&(t=new Uint16Array(t)),t=new me(t)),t.type=Ve.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.indexOf(t)===-1&&this.buffers.push(t),this},r.prototype.getIndex=function(){return this.indexBuffer},r.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var t=[],e=[],i=new me,n;for(n in this.attributes){var s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),e.push(s.size*Vd[s.type]/4),s.buffer=0}for(i.data=LE(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},r.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t],i=this.buffers[e.buffer];return i.data.length/(e.stride/4||e.size)}return 0},r.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},r.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},r.prototype.clone=function(){for(var t=new r,e=0;e<this.buffers.length;e++)t.buffers[e]=new me(this.buffers[e].data.slice(0));for(var e in this.attributes){var i=this.attributes[e];t.attributes[e]=new Ud(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Ve.ELEMENT_ARRAY_BUFFER),t},r.merge=function(t){for(var e=new r,i=[],n=[],s=[],o,a=0;a<t.length;a++){o=t[a];for(var l=0;l<o.buffers.length;l++)n[l]=n[l]||0,n[l]+=o.buffers[l].data.length,s[l]=0}for(var a=0;a<o.buffers.length;a++)i[a]=new kE[om(o.buffers[a].data)](n[a]),e.buffers[a]=new me(i[a]);for(var a=0;a<t.length;a++){o=t[a];for(var l=0;l<o.buffers.length;l++)i[l].set(o.buffers[l].data,s[l]),s[l]+=o.buffers[l].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=Ve.ELEMENT_ARRAY_BUFFER;for(var h=0,c=0,p=0,m=0,a=0;a<o.buffers.length;a++)if(o.buffers[a]!==o.indexBuffer){m=a;break}for(var a in o.attributes){var g=o.attributes[a];(g.buffer|0)===m&&(c+=g.size*Vd[g.type]/4)}for(var a=0;a<t.length;a++){for(var _=t[a].indexBuffer.data,l=0;l<_.length;l++)e.indexBuffer.data[l+p]+=h;h+=t[a].buffers[m].data.length/c,p+=_.length}}return e},r}(),BE=function(r){ut(t,r);function t(){var e=r.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return t}($l),UE=function(r){ut(t,r);function t(){var e=r.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new me(e.vertices),e.uvBuffer=new me(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return t.prototype.map=function(e,i){var n=0,s=0;return this.uvs[0]=n,this.uvs[1]=s,this.uvs[2]=n+i.width/e.width,this.uvs[3]=s,this.uvs[4]=n+i.width/e.width,this.uvs[5]=s+i.height/e.height,this.uvs[6]=n,this.uvs[7]=s+i.height/e.height,n=i.x,s=i.y,this.vertices[0]=n,this.vertices[1]=s,this.vertices[2]=n+i.width,this.vertices[3]=s,this.vertices[4]=n+i.width,this.vertices[5]=s+i.height,this.vertices[6]=n,this.vertices[7]=s+i.height,this.invalidate(),this},t.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},t}($l),VE=0,Ui=function(){function r(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=VE++,this.static=!!e,this.ubo=!!i,t instanceof me?(this.buffer=t,this.buffer.type=Ve.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new me(new Float32Array(1)),this.buffer.type=Ve.UNIFORM_BUFFER,this.autoManage=!0))}return r.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},r.prototype.add=function(t,e,i){if(!this.ubo)this.uniforms[t]=new r(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")},r.from=function(t,e,i){return new r(t,e,i)},r.uboFrom=function(t,e){return new r(t,e??!0,!0)},r}(),GE=function(){function r(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=bt.NONE,this.sourceFrame=new At,this.destinationFrame=new At,this.bindingSourceFrame=new At,this.bindingDestinationFrame=new At,this.filters=[],this.transform=null}return r.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},r}(),Zs=[new ae,new ae,new ae,new ae],fu=new Xt,jE=function(){function r(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new OE,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new BE,this.quadUv=new UE,this.tempRect=new At,this.activeState={},this.globalUniforms=new Ui({outputFrame:new At,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return r.prototype.push=function(t,e){for(var i,n,s=this.renderer,o=this.defaultFilterStack,a=this.statePool.pop()||new GE,l=this.renderer.renderTexture,h=e[0].resolution,c=e[0].multisample,p=e[0].padding,m=e[0].autoFit,g=(i=e[0].legacy)!==null&&i!==void 0?i:!0,_=1;_<e.length;_++){var A=e[_];h=Math.min(h,A.resolution),c=Math.min(c,A.multisample),p=this.useMaxPadding?Math.max(p,A.padding):p+A.padding,m=m&&A.autoFit,g=g||((n=A.legacy)!==null&&n!==void 0?n:!0)}o.length===1&&(this.defaultFilterStack[0].renderTexture=l.current),o.push(a),a.resolution=h,a.multisample=c,a.legacy=g,a.target=t,a.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),a.sourceFrame.pad(p);var y=this.tempRect.copyFrom(l.sourceFrame);s.projection.transform&&this.transformAABB(fu.copyFrom(s.projection.transform).invert(),y),m?(a.sourceFrame.fit(y),(a.sourceFrame.width<=0||a.sourceFrame.height<=0)&&(a.sourceFrame.width=0,a.sourceFrame.height=0)):a.sourceFrame.intersects(y)||(a.sourceFrame.width=0,a.sourceFrame.height=0),this.roundFrame(a.sourceFrame,l.current?l.current.resolution:s.resolution,l.sourceFrame,l.destinationFrame,s.projection.transform),a.renderTexture=this.getOptimalFilterTexture(a.sourceFrame.width,a.sourceFrame.height,h,c),a.filters=e,a.destinationFrame.width=a.renderTexture.width,a.destinationFrame.height=a.renderTexture.height;var S=this.tempRect;S.x=0,S.y=0,S.width=a.sourceFrame.width,S.height=a.sourceFrame.height,a.renderTexture.filterFrame=a.sourceFrame,a.bindingSourceFrame.copyFrom(l.sourceFrame),a.bindingDestinationFrame.copyFrom(l.destinationFrame),a.transform=s.projection.transform,s.projection.transform=null,l.bind(a.renderTexture,a.sourceFrame,S),s.framebuffer.clear(0,0,0,0)},r.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;var s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*e.resolution),o[1]=Math.round(s[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*s[2]-.5*o[2],a[3]=e.sourceFrame.height*s[3]-.5*o[3],e.legacy){var l=n.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var h=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,h.renderTexture,mr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var c=e.renderTexture,p=this.getOptimalFilterTexture(c.width,c.height,e.resolution);p.filterFrame=c.filterFrame;var m=0;for(m=0;m<i.length-1;++m){m===1&&e.multisample>1&&(p=this.getOptimalFilterTexture(c.width,c.height,e.resolution),p.filterFrame=c.filterFrame),i[m].apply(this,c,p,mr.CLEAR,e);var g=c;c=p,p=g}i[m].apply(this,c,h.renderTexture,mr.BLEND,e),m>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(p)}e.clear(),this.statePool.push(e)},r.prototype.bindAndClear=function(t,e){e===void 0&&(e=mr.CLEAR);var i=this.renderer,n=i.renderTexture,s=i.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,n.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var a=s.stateId&1||this.forceClear;(e===mr.CLEAR||e===mr.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)},r.prototype.applyFilter=function(t,e,i,n){var s=this.renderer;s.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Kn.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Kn.TRIANGLE_STRIP))},r.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,n=i.sourceFrame,s=i.destinationFrame,o=e._texture.orig,a=t.set(s.width,0,0,s.height,n.x,n.y),l=e.worldTransform.copyTo(Xt.TEMP_MATRIX);return l.invert(),a.prepend(l),a.scale(1/o.width,1/o.height),a.translate(e.anchor.x,e.anchor.y),a},r.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},r.prototype.getOptimalFilterTexture=function(t,e,i,n){return i===void 0&&(i=1),n===void 0&&(n=bt.NONE),this.texturePool.getOptimalTexture(t,e,i,n)},r.prototype.getFilterTexture=function(t,e,i){if(typeof t=="number"){var n=t;t=e,e=n}t=t||this.activeState.renderTexture;var s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||bt.NONE);return s.filterFrame=t.filterFrame,s},r.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},r.prototype.emptyPool=function(){this.texturePool.clear(!0)},r.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},r.prototype.transformAABB=function(t,e){var i=Zs[0],n=Zs[1],s=Zs[2],o=Zs[3];i.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(s,s),t.apply(o,o);var a=Math.min(i.x,n.x,s.x,o.x),l=Math.min(i.y,n.y,s.y,o.y),h=Math.max(i.x,n.x,s.x,o.x),c=Math.max(i.y,n.y,s.y,o.y);e.x=a,e.y=l,e.width=h-a,e.height=c-l},r.prototype.roundFrame=function(t,e,i,n,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){var o=s.a,a=s.b,l=s.c,h=s.d;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return}s=s?fu.copyFrom(s):fu.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}},r}(),pm=function(){function r(t){this.renderer=t}return r.prototype.flush=function(){},r.prototype.destroy=function(){this.renderer=null},r.prototype.start=function(){},r.prototype.stop=function(){this.flush()},r.prototype.render=function(t){},r}(),HE=function(){function r(t){this.renderer=t,this.emptyRenderer=new pm(t),this.currentRenderer=this.emptyRenderer}return r.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},r.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},r.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},r.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,n=e-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)},r.prototype.boundArray=function(t,e,i,n){for(var s=t.elements,o=t.ids,a=t.count,l=0,h=0;h<a;h++){var c=s[h],p=c._batchLocation;if(p>=0&&p<n&&e[p]===c){o[h]=p;continue}for(;l<n;){var m=e[l];if(m&&m._batchEnabled===i&&m._batchLocation===l){l++;continue}o[h]=l,c._batchLocation=l,e[l]=c;break}}},r.prototype.destroy=function(){this.renderer=null},r}(),Gd=0,$E=function(){function r(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(r.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),r.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Gd++},r.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Gd++,this.renderer.runners.contextChange.emit(t)},r.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},r.prototype.createContext=function(t,e){var i;if(j.PREFER_ENV>=sr.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},r.prototype.getExtensions=function(){var t=this.gl,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},r.prototype.handleContextLost=function(t){var e=this;t.preventDefault(),setTimeout(function(){e.gl.isContextLost()&&e.extensions.loseContext&&e.extensions.loseContext.restoreContext()},0)},r.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},r.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},r.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},r.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},r}(),zE=function(){function r(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=bt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}return r}(),XE=new At,WE=function(){function r(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new ol(10,10),this.msaaSamples=null}return r.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new At,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;j.PREFER_ENV===sr.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=function(n){return e.drawBuffersWEBGL(n)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},r.prototype.bind=function(t,e,i){i===void 0&&(i=0);var n=this.gl;if(t){var s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var o=0;o<t.colorTextures.length;o++){var a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var l=e.width>>i,h=e.height>>i,c=l/e.width;this.setViewport(e.x*c,e.y*c,l,h)}else{var l=t.width>>i,h=t.height>>i;this.setViewport(0,0,l,h)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},r.prototype.setViewport=function(t,e,i,n){var s=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=i,s.height=n,this.gl.viewport(t,e,i,n))},Object.defineProperty(r.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),r.prototype.clear=function(t,e,i,n,s){s===void 0&&(s=So.COLOR|So.DEPTH);var o=this.gl;o.clearColor(t,e,i,n),o.clear(s)},r.prototype.initFramebuffer=function(t){var e=this.gl,i=new zE(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},r.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height)),i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));var n=t.colorTextures,s=n.length;e.drawBuffers||(s=Math.min(s,1));for(var o=0;o<s;o++){var a=n[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},r.prototype.updateFramebuffer=function(t,e){var i=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures,o=s.length;i.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?(n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.RGBA8,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));for(var a=[],l=0;l<o;l++){var h=s[l],c=h.parentTextureArray||h;this.renderer.texture.bind(c,0),!(l===0&&n.msaaBuffer)&&(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,c._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+l))}if(a.length>1&&i.drawBuffers(a),t.depthTexture){var p=this.writeDepthTexture;if(p){var m=t.depthTexture;this.renderer.texture.bind(m,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,m._glTextures[this.CONTEXT_UID].texture,e)}}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil)):n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)},r.prototype.canMultisampleFramebuffer=function(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture},r.prototype.detectSamples=function(t){var e=this.msaaSamples,i=bt.NONE;if(t<=1||e===null)return i;for(var n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return i===1&&(i=bt.NONE),i},r.prototype.blit=function(t,e,i){var n=this,s=n.current,o=n.renderer,a=n.gl,l=n.CONTEXT_UID;if(o.context.webGLVersion===2&&!!s){var h=s.glFramebuffers[l];if(!!h){if(!t){if(!h.msaaBuffer)return;var c=s.colorTextures[0];if(!c)return;h.blitFramebuffer||(h.blitFramebuffer=new ol(s.width,s.height),h.blitFramebuffer.addColorTexture(0,c)),t=h.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=XE,e.width=s.width,e.height=s.height),i||(i=e);var p=e.width===i.width&&e.height===i.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,p?a.NEAREST:a.LINEAR)}}},r.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!!i){delete t.glFramebuffers[this.CONTEXT_UID];var s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}},r.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},r.prototype.forceStencil=function(){var t=this.current;if(!!t){var e=t.glFramebuffers[this.CONTEXT_UID];if(!(!e||e.stencil)){t.stencil=!0;var i=t.width,n=t.height,s=this.gl,o=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,s.DEPTH24_STENCIL8,i,n):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,n),e.stencil=o,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,o)}}},r.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new At},r.prototype.destroy=function(){this.renderer=null},r}(),pu={5126:4,5123:2,5121:1},qE=function(){function r(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return r.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){var i=this.renderer.context.extensions.vertexArrayObject;j.PREFER_ENV===sr.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(s){return i.bindVertexArrayOES(s)},t.deleteVertexArray=function(s){return i.deleteVertexArrayOES(s)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(e.webGLVersion!==2){var n=t.getExtension("ANGLE_instanced_arrays");n?(t.vertexAttribDivisor=function(s,o){return n.vertexAttribDivisorANGLE(s,o)},t.drawElementsInstanced=function(s,o,a,l,h){return n.drawElementsInstancedANGLE(s,o,a,l,h)},t.drawArraysInstanced=function(s,o,a,l){return n.drawArraysInstancedANGLE(s,o,a,l)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex},r.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);var o=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()},r.prototype.reset=function(){this.unbind()},r.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.renderer.buffer,i=0;i<t.buffers.length;i++){var n=t.buffers[i];e.update(n)}},r.prototype.checkCompatibility=function(t,e){var i=t.attributes,n=e.attributeData;for(var s in n)if(!i[s])throw new Error('shader and geometry incompatible, geometry missing the "'+s+'" attribute')},r.prototype.getSignature=function(t,e){var i=t.attributes,n=e.attributeData,s=["g",t.id];for(var o in i)n[o]&&s.push(o,n[o].location);return s.join("-")},r.prototype.initGeometryVao=function(t,e,i){i===void 0&&(i=!0);var n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=e.program;a.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);var l=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID],c=h[l];if(c)return h[a.id]=c,c;var p=t.buffers,m=t.attributes,g={},_={};for(var A in p)g[A]=0,_[A]=0;for(var A in m)!m[A].size&&a.attributeData[A]?m[A].size=a.attributeData[A].size:m[A].size||console.warn("PIXI Geometry attribute '"+A+"' size cannot be determined (likely the bound shader does not have the attribute)"),g[m[A].buffer]+=m[A].size*pu[m[A].type];for(var A in m){var y=m[A],S=y.size;y.stride===void 0&&(g[y.buffer]===S*pu[y.type]?y.stride=0:y.stride=g[y.buffer]),y.start===void 0&&(y.start=_[y.buffer],_[y.buffer]+=S*pu[y.type])}c=n.createVertexArray(),n.bindVertexArray(c);for(var M=0;M<p.length;M++){var x=p[M];o.bind(x),i&&x._glBuffers[s].refCount++}return this.activateVao(t,a),this._activeVao=c,h[a.id]=c,h[l]=c,c},r.prototype.disposeGeometry=function(t,e){var i;if(!!this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=t.buffers,a=(i=this.renderer)===null||i===void 0?void 0:i.buffer;if(t.disposeRunner.remove(this),!!n){if(a)for(var l=0;l<o.length;l++){var h=o[l]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&a.dispose(o[l],e))}if(!e){for(var c in n)if(c[0]==="g"){var p=n[c];this._activeVao===p&&this.unbind(),s.deleteVertexArray(p)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},r.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)},r.prototype.activateVao=function(t,e){var i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);var l=null;for(var h in a){var c=a[h],p=o[c.buffer],m=p._glBuffers[n];if(e.attributeData[h]){l!==m&&(s.bind(p),l=m);var g=e.attributeData[h].location;if(i.enableVertexAttribArray(g),i.vertexAttribPointer(g,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(g,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},r.prototype.draw=function(t,e,i,n){var s=this.gl,o=this._activeGeometry;if(o.indexBuffer){var a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(t,e||o.indexBuffer.data.length,l,(i||0)*a,n||1):s.drawElements(t,e||o.indexBuffer.data.length,l,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(t,i,e||o.getSize(),n||1):s.drawArrays(t,i,e||o.getSize());return this},r.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},r.prototype.destroy=function(){this.renderer=null},r}(),YE=function(){function r(t){t===void 0&&(t=null),this.type=xt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=j.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}return Object.defineProperty(r.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=xt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},r.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},r}();function jd(r,t,e){var i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function Hd(r,t){var e=r.getShaderSource(t).split(`
`).map(function(h,c){return c+": "+h}),i=r.getShaderInfoLog(t),n=i.split(`
`),s={},o=n.map(function(h){return parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(h){return h&&!s[h]?(s[h]=!0,!0):!1}),a=[""];o.forEach(function(h){e[h-1]="%c"+e[h-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var l=e.join(`
`);a[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,a),console.groupEnd()}function KE(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||Hd(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||Hd(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}function mu(r){for(var t=new Array(r),e=0;e<t.length;e++)t[e]=!1;return t}function mm(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return mu(2*t);case"bvec3":return mu(3*t);case"bvec4":return mu(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var gm={},bn=gm;function JE(){if(bn===gm||bn&&bn.isContextLost()){var r=j.ADAPTER.createCanvas(),t=void 0;j.PREFER_ENV>=sr.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),bn=t}return bn}var to;function QE(){if(!to){to=ge.MEDIUM;var r=JE();if(r&&r.getShaderPrecisionFormat){var t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);to=t.precision?ge.HIGH:ge.MEDIUM}}return to}function $d(r,t,e){if(r.substring(0,9)!=="precision"){var i=t;return t===ge.HIGH&&e!==ge.HIGH&&(i=ge.MEDIUM),"precision "+i+` float;
`+r}else if(e!==ge.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}var ZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function vm(r){return ZE[r]}var eo=null,zd={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function _m(r,t){if(!eo){var e=Object.keys(zd);eo={};for(var i=0;i<e.length;++i){var n=e[i];eo[r[n]]=zd[n]}}return eo[t]}var Vi=[{test:function(r){return r.type==="float"&&r.size===1&&!r.isArray},code:function(r){return`
            if(uv["`+r+'"] !== ud["'+r+`"].value)
            {
                ud["`+r+'"].value = uv["'+r+`"]
                gl.uniform1f(ud["`+r+'"].location, uv["'+r+`"])
            }
            `}},{test:function(r,t){return(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0)},code:function(r){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+r+`"], t);

            if(ud["`+r+`"].value !== t)
            {
                ud["`+r+`"].value = t;
                gl.uniform1i(ud["`+r+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(r,t){return r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0},code:function(r){return`
            gl.uniformMatrix3fv(ud["`+r+'"].location, false, uv["'+r+`"].toArray(true));
            `},codeUbo:function(r){return`
                var `+r+"_matrix = uv."+r+`.toArray(true);

                data[offset] = `+r+`_matrix[0];
                data[offset+1] = `+r+`_matrix[1];
                data[offset+2] = `+r+`_matrix[2];
        
                data[offset + 4] = `+r+`_matrix[3];
                data[offset + 5] = `+r+`_matrix[4];
                data[offset + 6] = `+r+`_matrix[5];
        
                data[offset + 8] = `+r+`_matrix[6];
                data[offset + 9] = `+r+`_matrix[7];
                data[offset + 10] = `+r+`_matrix[8];
            `}},{test:function(r,t){return r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+r+`"].location, v.x, v.y);
                }`},codeUbo:function(r){return`
                v = uv.`+r+`;

                data[offset] = v.x;
                data[offset+1] = v.y;
            `}},{test:function(r){return r.type==="vec2"&&r.size===1&&!r.isArray},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+r+`"].location, v[0], v[1]);
                }
            `}},{test:function(r,t){return r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+r+`"].location, v.x, v.y, v.width, v.height)
                }`},codeUbo:function(r){return`
                    v = uv.`+r+`;

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `}},{test:function(r){return r.type==="vec4"&&r.size===1&&!r.isArray},code:function(r){return`
                cv = ud["`+r+`"].value;
                v = uv["`+r+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+r+`"].location, v[0], v[1], v[2], v[3])
                }`}}],tT={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},eT={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function rT(r,t){var e,i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(var n in r.uniforms){var s=t[n];if(!s){!((e=r.uniforms[n])===null||e===void 0)&&e.group&&(r.uniforms[n].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.`+n+", '"+n+`');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.`+n+`, syncData);
                    `));continue}for(var o=r.uniforms[n],a=!1,l=0;l<Vi.length;l++)if(Vi[l].test(s,o)){i.push(Vi[l].code(n,o)),a=!0;break}if(!a){var h=s.size===1&&!s.isArray?tT:eT,c=h[s.type].replace("location",'ud["'+n+'"].location');i.push(`
            cu = ud["`+n+`"];
            cv = cu.value;
            v = uv["`+n+`"];
            `+c+";")}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}var iT=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function nT(r){for(var t="",e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+="if(test == "+e+".0){}");return t}function sT(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var e=t.createShader(t.FRAGMENT_SHADER);;){var i=iT.replace(/%forloop%/gi,nT(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}var An;function oT(){if(typeof An=="boolean")return An;try{var r=new Function("param1","param2","param3","return param1[param2] === param3;");An=r({a:"b"},"a","b")===!0}catch{An=!1}return An}var aT=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,uT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,lT=0,ro={},zl=function(){function r(t,e,i){i===void 0&&(i="pixi-shader"),this.id=lT++,this.vertexSrc=t||r.defaultVertexSrc,this.fragmentSrc=e||r.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),ro[i]?(ro[i]++,i+="-"+ro[i]):ro[i]=1,this.vertexSrc="#define SHADER_NAME "+i+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+`
`+this.fragmentSrc,this.vertexSrc=$d(this.vertexSrc,j.PRECISION_VERTEX,ge.HIGH),this.fragmentSrc=$d(this.fragmentSrc,j.PRECISION_FRAGMENT,QE())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(r,"defaultVertexSrc",{get:function(){return uT},enumerable:!1,configurable:!0}),Object.defineProperty(r,"defaultFragmentSrc",{get:function(){return aT},enumerable:!1,configurable:!0}),r.from=function(t,e,i){var n=t+e,s=Ld[n];return s||(Ld[n]=s=new r(t,e,i)),s},r}(),ym=function(){function r(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Ui?this.uniformGroup=e:this.uniformGroup=new Ui(e):this.uniformGroup=new Ui({}),this.disposeRunner=new jt("disposeShader")}return r.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var n=e.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1},r.prototype.destroy=function(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()},Object.defineProperty(r.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),r.from=function(t,e,i){var n=zl.from(t,e);return new r(n,i)},r}(),gu=0,vu=1,_u=2,yu=3,Eu=4,Tu=5,Xl=function(){function r(){this.data=0,this.blendMode=H.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(r.prototype,"blend",{get:function(){return!!(this.data&1<<gu)},set:function(t){!!(this.data&1<<gu)!==t&&(this.data^=1<<gu)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"offsets",{get:function(){return!!(this.data&1<<vu)},set:function(t){!!(this.data&1<<vu)!==t&&(this.data^=1<<vu)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"culling",{get:function(){return!!(this.data&1<<_u)},set:function(t){!!(this.data&1<<_u)!==t&&(this.data^=1<<_u)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return!!(this.data&1<<yu)},set:function(t){!!(this.data&1<<yu)!==t&&(this.data^=1<<yu)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthMask",{get:function(){return!!(this.data&1<<Tu)},set:function(t){!!(this.data&1<<Tu)!==t&&(this.data^=1<<Tu)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<Eu)},set:function(t){!!(this.data&1<<Eu)!==t&&(this.data^=1<<Eu)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==H.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"[@pixi/core:State "+("blendMode="+this.blendMode+" ")+("clockwiseFrontFace="+this.clockwiseFrontFace+" ")+("culling="+this.culling+" ")+("depthMask="+this.depthMask+" ")+("polygonOffset="+this.polygonOffset)+"]"},r.for2d=function(){var t=new r;return t.depthTest=!1,t.blend=!0,t},r}(),hT=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,cT=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,dT=function(r){ut(t,r);function t(e,i,n){var s=this,o=zl.from(e||t.defaultVertexSrc,i||t.defaultFragmentSrc);return s=r.call(this,o,n)||this,s.padding=0,s.resolution=j.FILTER_RESOLUTION,s.multisample=j.FILTER_MULTISAMPLE,s.enabled=!0,s.autoFit=!0,s.state=new Xl,s}return t.prototype.apply=function(e,i,n,s,o){e.applyFilter(this,i,n,s)},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultVertexSrc",{get:function(){return cT},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return hT},enumerable:!1,configurable:!0}),t}(ym),fT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,pT=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Xd=new Xt,mT=function(){function r(t,e){this._texture=t,this.mapCoord=new Xt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}return Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),r.prototype.multiplyUvs=function(t,e){e===void 0&&(e=t);for(var i=this.mapCoord,n=0;n<t.length;n+=2){var s=t[n],o=t[n+1];e[n]=s*i.a+o*i.c+i.tx,e[n+1]=s*i.b+o*i.d+i.ty}return e},r.prototype.update=function(t){var e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var n=e.orig,s=e.trim;s&&(Xd.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Xd));var o=e.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,h=this.clampOffset;return a[0]=(e._frame.x+l+h)/o.width,a[1]=(e._frame.y+l+h)/o.height,a[2]=(e._frame.x+e._frame.width-l+h)/o.width,a[3]=(e._frame.y+e._frame.height-l+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0},r}(),gT=function(r){ut(t,r);function t(e,i,n){var s=this,o=null;return typeof e!="string"&&i===void 0&&n===void 0&&(o=e,e=void 0,i=void 0,n=void 0),s=r.call(this,e||fT,i||pT,n)||this,s.maskSprite=o,s.maskMatrix=new Xt,s}return Object.defineProperty(t.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),t.prototype.apply=function(e,i,n,s){var o=this._maskSprite,a=o._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new mT(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,o).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,i,n,s))},t}(dT),vT=function(){function r(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return r.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},r.prototype.push=function(t,e){var i=e;if(!i.isMaskData){var n=this.maskDataPool.pop()||new YE;n.pooled=!0,n.maskObject=e,i=n}var s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==xt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case xt.SCISSOR:this.renderer.scissor.push(i);break;case xt.STENCIL:this.renderer.stencil.push(i);break;case xt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case xt.COLOR:this.pushColorMask(i);break}i.type===xt.SPRITE&&this.maskStack.push(i)},r.prototype.pop=function(t){var e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case xt.SCISSOR:this.renderer.scissor.pop(e);break;case xt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case xt.SPRITE:this.popSpriteMask(e);break;case xt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){var i=this.maskStack[this.maskStack.length-1];i.type===xt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}},r.prototype.detect=function(t){var e=t.maskObject;e?e.isSprite?t.type=xt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=xt.SCISSOR:t.type=xt.STENCIL:t.type=xt.COLOR},r.prototype.pushSpriteMask=function(t){var e,i,n=t.maskObject,s=t._target,o=t._filters;o||(o=this.alphaMaskPool[this.alphaMaskIndex],o||(o=this.alphaMaskPool[this.alphaMaskIndex]=[new gT]));var a=this.renderer,l=a.renderTexture,h,c;if(l.current){var p=l.current;h=t.resolution||p.resolution,c=(e=t.multisample)!==null&&e!==void 0?e:p.multisample}else h=t.resolution||a.resolution,c=(i=t.multisample)!==null&&i!==void 0?i:a.multisample;o[0].resolution=h,o[0].multisample=c,o[0].maskSprite=n;var m=s.filterArea;s.filterArea=n.getBounds(!0),a.filter.push(s,o),s.filterArea=m,t._filters||this.alphaMaskIndex++},r.prototype.popSpriteMask=function(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},r.prototype.pushColorMask=function(t){var e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)},r.prototype.popColorMask=function(t){var e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)},r.prototype.destroy=function(){this.renderer=null},r}(),Em=function(){function r(t){this.renderer=t,this.maskStack=[],this.glConst=0}return r.prototype.getStackLength=function(){return this.maskStack.length},r.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var n=this.getStackLength();n!==i&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},r.prototype._useCurrent=function(){},r.prototype.destroy=function(){this.renderer=null,this.maskStack=null},r}(),Wd=new Xt,qd=[],_T=function(r){ut(t,r);function t(e){var i=r.call(this,e)||this;return i.glConst=j.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST,i}return t.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0},t.prototype.calcScissorRect=function(e){var i;if(!e._scissorRectLocal){var n=e._scissorRect,s=e.maskObject,o=this.renderer,a=o.renderTexture,l=s.getBounds(!0,(i=qd.pop())!==null&&i!==void 0?i:new At);this.roundFrameToPixels(l,a.current?a.current.resolution:o.resolution,a.sourceFrame,a.destinationFrame,o.projection.transform),n&&l.fit(n),e._scissorRectLocal=l}},t.isMatrixRotated=function(e){if(!e)return!1;var i=e.a,n=e.b,s=e.c,o=e.d;return(Math.abs(n)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(i)>1e-4||Math.abs(o)>1e-4)},t.prototype.testScissor=function(e){var i=e.maskObject;if(!i.isFastRect||!i.isFastRect()||t.isMatrixRotated(i.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);var n=e._scissorRectLocal;return n.width>0&&n.height>0},t.prototype.roundFrameToPixels=function(e,i,n,s,o){t.isMatrixRotated(o)||(o=o?Wd.copyFrom(o):Wd.identity(),o.translate(-n.x,-n.y).scale(s.width/n.width,s.height/n.height).translate(s.x,s.y),this.renderer.filter.transformAABB(o,e),e.fit(s),e.x=Math.round(e.x*i),e.y=Math.round(e.y*i),e.width=Math.round(e.width*i),e.height=Math.round(e.height*i))},t.prototype.push=function(e){e._scissorRectLocal||this.calcScissorRect(e);var i=this.renderer.gl;e._scissorRect||i.enable(i.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()},t.prototype.pop=function(e){var i=this.renderer.gl;e&&qd.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():i.disable(i.SCISSOR_TEST)},t.prototype._useCurrent=function(){var e=this.maskStack[this.maskStack.length-1]._scissorRect,i;this.renderer.renderTexture.current?i=e.y:i=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,i,e.width,e.height)},t}(Em),yT=function(r){ut(t,r);function t(e){var i=r.call(this,e)||this;return i.glConst=j.ADAPTER.getWebGLRenderingContext().STENCIL_TEST,i}return t.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0},t.prototype.push=function(e){var i=e.maskObject,n=this.renderer.gl,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),e._stencilCounter++;var o=e._colorMask;o!==0&&(e._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,s,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,o!==0&&(e._colorMask=o,n.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()},t.prototype.pop=function(e){var i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{var n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=n?n._colorMask:15;s!==0&&(n._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(n._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}},t.prototype._useCurrent=function(){var e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t}(Em),ET=function(){function r(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Xt,this.transform=null}return r.prototype.update=function(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);var s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)},r.prototype.calculateProjection=function(t,e,i,n){var s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=o*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-o-e.y*s.d},r.prototype.setTransform=function(t){},r.prototype.destroy=function(){this.renderer=null},r}(),Ur=new At,Cn=new At,TT=function(){function r(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new At,this.destinationFrame=new At,this.viewportFrame=new At}return r.prototype.bind=function(t,e,i){t===void 0&&(t=null);var n=this.renderer;this.current=t;var s,o,a;t?(s=t.baseTexture,a=s.resolution,e||(Ur.width=t.frame.width,Ur.height=t.frame.height,e=Ur),i||(Cn.x=t.frame.x,Cn.y=t.frame.y,Cn.width=e.width,Cn.height=e.height,i=Cn),o=s.framebuffer):(a=n.resolution,e||(Ur.width=n.screen.width,Ur.height=n.screen.height,e=Ur),i||(i=Ur,i.width=e.width,i.height=e.height));var l=this.viewportFrame;l.x=i.x*a,l.y=i.y*a,l.width=i.width*a,l.height=i.height*a,t||(l.y=n.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(i,e,a,!o),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},r.prototype.clear=function(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.clearColor;var i=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer.screen,s=i.width!==n.width||i.height!==n.height;if(s){var o=this.viewportFrame,a=o.x,l=o.y,h=o.width,c=o.height;a=Math.round(a),l=Math.round(l),h=Math.round(h),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,l,h,c)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),s&&this.renderer.scissor.pop()},r.prototype.resize=function(){this.bind(null)},r.prototype.reset=function(){this.bind(null)},r.prototype.destroy=function(){this.renderer=null},r}();function IT(r,t,e,i,n){e.buffer.update(n)}var wT={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Tm={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function bT(r){for(var t=r.map(function(l){return{data:l,offset:0,dataLen:0,dirty:0}}),e=0,i=0,n=0,s=0;s<t.length;s++){var o=t[s];if(e=Tm[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!==0&&i<16){var a=i%e%16;i+=a,n+=a}i+e>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=e,i=e):(o.offset=n,i+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function AT(r,t){var e=[];for(var i in r)t[i]&&e.push(t[i]);return e.sort(function(n,s){return n.index-s.index}),e}function CT(r,t){if(!r.autoManage)return{size:0,syncFunc:IT};for(var e=AT(r.uniforms,t),i=bT(e),n=i.uboElements,s=i.size,o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `],a=0;a<n.length;a++){for(var l=n[a],h=r.uniforms[l.data.name],c=l.data.name,p=!1,m=0;m<Vi.length;m++){var g=Vi[m];if(g.codeUbo&&g.test(l.data,h)){o.push("offset = "+l.offset/4+";",Vi[m].codeUbo(l.data.name,h)),p=!0;break}}if(!p)if(l.data.size>1){var _=vm(l.data.type),A=Math.max(Tm[l.data.type]/16,1),y=_/A,S=(4-y%4)%4;o.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+l.offset/4+`;

                t = 0;

                for(var i=0; i < `+l.data.size*A+`; i++)
                {
                    for(var j = 0; j < `+y+`; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += `+S+`;
                }

                `)}else{var M=wT[l.data.type];o.push(`
                cv = ud.`+c+`.value;
                v = uv.`+c+`;
                offset = `+l.offset/4+`;
                `+M+`;
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}var xT=function(){function r(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return r.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},r}();function PT(r,t){for(var e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var s=t.getActiveAttrib(r,n);if(s.name.indexOf("gl_")!==0){var o=_m(t,s.type),a={type:o,name:s.name,size:vm(o),location:t.getAttribLocation(r,s.name)};e[s.name]=a}}return e}function ST(r,t){for(var e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS),n=0;n<i;n++){var s=t.getActiveUniform(r,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),l=_m(t,s.type);e[o]={name:o,index:n,type:l,size:s.size,isArray:a,value:mm(l,s.size)}}return e}function RT(r,t){var e=jd(r,r.VERTEX_SHADER,t.vertexSrc),i=jd(r,r.FRAGMENT_SHADER,t.fragmentSrc),n=r.createProgram();if(r.attachShader(n,e),r.attachShader(n,i),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS)||KE(r,n,e,i),t.attributeData=PT(n,r),t.uniformData=ST(n,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){var s=Object.keys(t.attributeData);s.sort(function(c,p){return c>p?1:-1});for(var o=0;o<s.length;o++)t.attributeData[s[o]].location=o,r.bindAttribLocation(n,o,s[o]);r.linkProgram(n)}r.deleteShader(e),r.deleteShader(i);var a={};for(var o in t.uniformData){var l=t.uniformData[o];a[o]={location:r.getUniformLocation(n,o),value:mm(l.type,l.size)}}var h=new xT(n,a);return h}var MT=0,io={textureCount:0,uboCount:0},OT=function(){function r(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=MT++}return r.prototype.systemCheck=function(){if(!oT())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},r.prototype.contextChange=function(t){this.gl=t,this.reset()},r.prototype.bind=function(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(io.textureCount=0,io.uboCount=0,this.syncUniformGroup(t.uniformGroup,io)),n},r.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},r.prototype.syncUniformGroup=function(t,e){var i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},r.prototype.syncUniforms=function(t,e,i){var n=t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t);n(e.uniformData,t.uniforms,this.renderer,i)},r.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=rT(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},r.prototype.syncUniformBufferGroup=function(t,e){var i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;var n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,io,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])},r.prototype.createSyncBufferGroup=function(t,e,i){var n=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var s=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;var o=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[o];if(a||(a=this._uboCache[o]=CT(t,this.shader.program.uniformData)),t.autoManage){var l=new Float32Array(a.size/4);t.buffer.update(l)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]},r.prototype.getSignature=function(t,e,i){var n=t.uniforms,s=[i+"-"];for(var o in n)s.push(o),e[o]&&s.push(e[o].type);return s.join("-")},r.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},r.prototype.generateProgram=function(t){var e=this.gl,i=t.program,n=RT(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n},r.prototype.reset=function(){this.program=null,this.shader=null},r.prototype.disposeShader=function(t){this.shader===t&&(this.shader=null)},r.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},r}();function FT(r,t){return t===void 0&&(t=[]),t[H.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.ADD]=[r.ONE,r.ONE],t[H.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.NONE]=[0,0],t[H.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[H.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[H.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[H.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[H.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[H.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[H.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[H.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[H.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[H.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[H.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}var DT=0,LT=1,NT=2,kT=3,BT=4,UT=5,VT=function(){function r(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=H.NONE,this._blendEq=!1,this.map=[],this.map[DT]=this.setBlend,this.map[LT]=this.setOffset,this.map[NT]=this.setCullFace,this.map[kT]=this.setDepthTest,this.map[BT]=this.setFrontFace,this.map[UT]=this.setDepthMask,this.checks=[],this.defaultState=new Xl,this.defaultState.blend=!0}return r.prototype.contextChange=function(t){this.gl=t,this.blendModes=FT(t),this.set(this.defaultState),this.reset()},r.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(var i=0;i<this.checks.length;i++)this.checks[i](this,t)},r.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(var e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},r.prototype.setBlend=function(t){this.updateCheck(r.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},r.prototype.setOffset=function(t){this.updateCheck(r.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},r.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},r.prototype.setDepthMask=function(t){this.gl.depthMask(t)},r.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},r.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},r.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},r.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},r.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},r.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)},r.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},r.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},r.prototype.destroy=function(){this.gl=null},r}(),GT=function(){function r(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=j.GC_MAX_IDLE,this.checkCountMax=j.GC_MAX_CHECK_COUNT,this.mode=j.GC_MODE}return r.prototype.postrender=function(){!this.renderer.renderingToScreen||(this.count++,this.mode!==Oo.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},r.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,n=0;n<e.length;n++){var s=e[n];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,i=!0)}if(i){for(var o=0,n=0;n<e.length;n++)e[n]!==null&&(e[o++]=e[n]);e.length=o}},r.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var n=t.children.length-1;n>=0;n--)this.unload(t.children[n])},r.prototype.destroy=function(){this.renderer=null},r}();function jT(r){var t,e,i,n,s,o,a,l,h,c,p,m,g,_,A,y,S,M,x,F,B,N,b;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?b=(t={},t[et.UNSIGNED_BYTE]=(e={},e[U.RGBA]=r.RGBA8,e[U.RGB]=r.RGB8,e[U.RG]=r.RG8,e[U.RED]=r.R8,e[U.RGBA_INTEGER]=r.RGBA8UI,e[U.RGB_INTEGER]=r.RGB8UI,e[U.RG_INTEGER]=r.RG8UI,e[U.RED_INTEGER]=r.R8UI,e[U.ALPHA]=r.ALPHA,e[U.LUMINANCE]=r.LUMINANCE,e[U.LUMINANCE_ALPHA]=r.LUMINANCE_ALPHA,e),t[et.BYTE]=(i={},i[U.RGBA]=r.RGBA8_SNORM,i[U.RGB]=r.RGB8_SNORM,i[U.RG]=r.RG8_SNORM,i[U.RED]=r.R8_SNORM,i[U.RGBA_INTEGER]=r.RGBA8I,i[U.RGB_INTEGER]=r.RGB8I,i[U.RG_INTEGER]=r.RG8I,i[U.RED_INTEGER]=r.R8I,i),t[et.UNSIGNED_SHORT]=(n={},n[U.RGBA_INTEGER]=r.RGBA16UI,n[U.RGB_INTEGER]=r.RGB16UI,n[U.RG_INTEGER]=r.RG16UI,n[U.RED_INTEGER]=r.R16UI,n[U.DEPTH_COMPONENT]=r.DEPTH_COMPONENT16,n),t[et.SHORT]=(s={},s[U.RGBA_INTEGER]=r.RGBA16I,s[U.RGB_INTEGER]=r.RGB16I,s[U.RG_INTEGER]=r.RG16I,s[U.RED_INTEGER]=r.R16I,s),t[et.UNSIGNED_INT]=(o={},o[U.RGBA_INTEGER]=r.RGBA32UI,o[U.RGB_INTEGER]=r.RGB32UI,o[U.RG_INTEGER]=r.RG32UI,o[U.RED_INTEGER]=r.R32UI,o[U.DEPTH_COMPONENT]=r.DEPTH_COMPONENT24,o),t[et.INT]=(a={},a[U.RGBA_INTEGER]=r.RGBA32I,a[U.RGB_INTEGER]=r.RGB32I,a[U.RG_INTEGER]=r.RG32I,a[U.RED_INTEGER]=r.R32I,a),t[et.FLOAT]=(l={},l[U.RGBA]=r.RGBA32F,l[U.RGB]=r.RGB32F,l[U.RG]=r.RG32F,l[U.RED]=r.R32F,l[U.DEPTH_COMPONENT]=r.DEPTH_COMPONENT32F,l),t[et.HALF_FLOAT]=(h={},h[U.RGBA]=r.RGBA16F,h[U.RGB]=r.RGB16F,h[U.RG]=r.RG16F,h[U.RED]=r.R16F,h),t[et.UNSIGNED_SHORT_5_6_5]=(c={},c[U.RGB]=r.RGB565,c),t[et.UNSIGNED_SHORT_4_4_4_4]=(p={},p[U.RGBA]=r.RGBA4,p),t[et.UNSIGNED_SHORT_5_5_5_1]=(m={},m[U.RGBA]=r.RGB5_A1,m),t[et.UNSIGNED_INT_2_10_10_10_REV]=(g={},g[U.RGBA]=r.RGB10_A2,g[U.RGBA_INTEGER]=r.RGB10_A2UI,g),t[et.UNSIGNED_INT_10F_11F_11F_REV]=(_={},_[U.RGB]=r.R11F_G11F_B10F,_),t[et.UNSIGNED_INT_5_9_9_9_REV]=(A={},A[U.RGB]=r.RGB9_E5,A),t[et.UNSIGNED_INT_24_8]=(y={},y[U.DEPTH_STENCIL]=r.DEPTH24_STENCIL8,y),t[et.FLOAT_32_UNSIGNED_INT_24_8_REV]=(S={},S[U.DEPTH_STENCIL]=r.DEPTH32F_STENCIL8,S),t):b=(M={},M[et.UNSIGNED_BYTE]=(x={},x[U.RGBA]=r.RGBA,x[U.RGB]=r.RGB,x[U.ALPHA]=r.ALPHA,x[U.LUMINANCE]=r.LUMINANCE,x[U.LUMINANCE_ALPHA]=r.LUMINANCE_ALPHA,x),M[et.UNSIGNED_SHORT_5_6_5]=(F={},F[U.RGB]=r.RGB,F),M[et.UNSIGNED_SHORT_4_4_4_4]=(B={},B[U.RGBA]=r.RGBA,B),M[et.UNSIGNED_SHORT_5_5_5_1]=(N={},N[U.RGBA]=r.RGBA,N),M),b}var Iu=function(){function r(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=et.UNSIGNED_BYTE,this.internalFormat=U.RGBA,this.samplerType=0}return r}(),HT=function(){function r(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Ot,this.hasIntegerTextures=!1}return r.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=jT(t);var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};var n=new Iu(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Iu(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var i=0;i<this.boundTextures.length;i++)this.bind(null,i)},r.prototype.bind=function(t,e){e===void 0&&(e=0);var i=this.gl;if(t=t?.castToBaseTexture(),t&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},r.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},r.prototype.unbind=function(t){var e=this,i=e.gl,n=e.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var s=0;s<n.length;s++)n[s]===this.unknownTexture&&this.bind(null,s)}for(var s=0;s<n.length;s++)n[s]===t&&(this.currentLocation!==s&&(i.activeTexture(i.TEXTURE0+s),this.currentLocation=s),i.bindTexture(t.target,this.emptyTextures[t.target].texture),n[s]=null)},r.prototype.ensureSamplerType=function(t){var e=this,i=e.boundTextures,n=e.hasIntegerTextures,s=e.CONTEXT_UID;if(!!n)for(var o=t-1;o>=0;--o){var a=i[o];if(a){var l=a._glTextures[s];l.samplerType!==Ro.FLOAT&&this.renderer.texture.unbind(a)}}},r.prototype.initTexture=function(t){var e=new Iu(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},r.prototype.initTextureType=function(t,e){var i,n;e.internalFormat=(n=(i=this.internalFormats[t.type])===null||i===void 0?void 0:i[t.format])!==null&&n!==void 0?n:t.format,this.webGLVersion===2&&t.type===et.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type},r.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(!!e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e))e.samplerType!==Ro.FLOAT&&(this.hasIntegerTextures=!0);else{var n=t.realWidth,s=t.realHeight,o=i.gl;(e.width!==n||e.height!==s||e.dirtyId<0)&&(e.width=n,e.height=s,o.texImage2D(t.target,0,e.internalFormat,n,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},r.prototype.destroyTexture=function(t,e){var i=this.gl;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var n=this.managedTextures.indexOf(t);n!==-1&&_o(this.managedTextures,n,1)}},r.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];!e||((t.mipmap===br.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Mo.CLAMP:e.wrapMode=t.wrapMode,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},r.prototype.setStyle=function(t,e){var i=this.gl;if(e.mipmap&&t.mipmap!==br.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Ue.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===Ue.LINEAR){var s=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Ue.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===Ue.LINEAR?i.LINEAR:i.NEAREST)},r.prototype.destroy=function(){this.renderer=null},r}(),wu=new Xt,$T=function(r){ut(t,r);function t(e,i){e===void 0&&(e=Yn.UNKNOWN);var n=r.call(this)||this;return i=Object.assign({},j.RENDER_OPTIONS,i),n.options=i,n.type=e,n.screen=new At(0,0,i.width,i.height),n.view=i.view||j.ADAPTER.createCanvas(),n.resolution=i.resolution||j.RESOLUTION,n.useContextAlpha=i.useContextAlpha,n.autoDensity=!!i.autoDensity,n.preserveDrawingBuffer=i.preserveDrawingBuffer,n.clearBeforeRender=i.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,1],n._backgroundColorString="#000000",n.backgroundColor=i.backgroundColor||n._backgroundColor,n.backgroundAlpha=i.backgroundAlpha,i.transparent!==void 0&&(oi("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),n.useContextAlpha=i.transparent,n.backgroundAlpha=i.transparent?0:1),n._lastObjectRendered=null,n.plugins={},n}return t.prototype.initPlugins=function(e){for(var i in e)this.plugins[i]=new e[i](this)},Object.defineProperty(t.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),t.prototype.resize=function(e,i){this.view.width=Math.round(e*this.resolution),this.view.height=Math.round(i*this.resolution);var n=this.view.width/this.resolution,s=this.view.height/this.resolution;this.screen.width=n,this.screen.height=s,this.autoDensity&&(this.view.style.width=n+"px",this.view.style.height=s+"px"),this.emit("resize",n,s)},t.prototype.generateTexture=function(e,i,n,s){i===void 0&&(i={}),typeof i=="number"&&(oi("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),i={scaleMode:i,resolution:n,region:s});var o=i.region,a=wE(i,["region"]);s=o||e.getLocalBounds(null,!0),s.width===0&&(s.width=1),s.height===0&&(s.height=1);var l=Hl.create(sl({width:s.width,height:s.height},a));return wu.tx=-s.x,wu.ty=-s.y,this.render(e,{renderTexture:l,clear:!1,transform:wu,skipUpdateTransform:!!e.parent}),l},t.prototype.destroy=function(e){for(var i in this.plugins)this.plugins[i].destroy(),this.plugins[i]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=Yn.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=dE(e),cE(e,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(e){this._backgroundColorRgba[3]=e},enumerable:!1,configurable:!0}),t}(Or),zT=function(){function r(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return r}(),XT=function(){function r(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}return r.prototype.destroy=function(){this.renderer=null},r.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},r.prototype.bind=function(t){var e=this,i=e.gl,n=e.CONTEXT_UID,s=t._glBuffers[n]||this.createGLBuffer(t);i.bindBuffer(t.type,s.buffer)},r.prototype.bindBufferBase=function(t,e){var i=this,n=i.gl,s=i.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var o=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,n.bindBufferBase(n.UNIFORM_BUFFER,e,o.buffer)}},r.prototype.bindBufferRange=function(t,e,i){var n=this,s=n.gl,o=n.CONTEXT_UID;i=i||0;var a=t._glBuffers[o]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,a.buffer,i*256,256)},r.prototype.update=function(t){var e=this,i=e.gl,n=e.CONTEXT_UID,s=t._glBuffers[n];if(t._updateID!==s.updateID)if(s.updateID=t._updateID,i.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)i.bufferSubData(t.type,0,t.data);else{var o=t.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,i.bufferData(t.type,t.data,o)}},r.prototype.dispose=function(t,e){if(!!this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},r.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedBuffers),i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)},r.prototype.createGLBuffer=function(t){var e=this,i=e.CONTEXT_UID,n=e.gl;return t._glBuffers[i]=new zT(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[i]},r}(),Wl=function(r){ut(t,r);function t(e){var i=r.call(this,Yn.WEBGL,e)||this;return e=i.options,i.gl=null,i.CONTEXT_UID=0,i.runners={destroy:new jt("destroy"),contextChange:new jt("contextChange"),reset:new jt("reset"),update:new jt("update"),postrender:new jt("postrender"),prerender:new jt("prerender"),resize:new jt("resize")},i.runners.contextChange.add(i),i.globalUniforms=new Ui({projectionMatrix:new Xt},!0),i.addSystem(vT,"mask").addSystem($E,"context").addSystem(VT,"state").addSystem(OT,"shader").addSystem(HT,"texture").addSystem(XT,"buffer").addSystem(qE,"geometry").addSystem(WE,"framebuffer").addSystem(_T,"scissor").addSystem(yT,"stencil").addSystem(ET,"projection").addSystem(GT,"textureGC").addSystem(jE,"filter").addSystem(TT,"renderTexture").addSystem(HE,"batch"),i.initPlugins(t.__plugins),i.multisample=void 0,e.context?i.context.initFromContext(e.context):i.context.initFromOptions({alpha:!!i.useContextAlpha,antialias:e.antialias,premultipliedAlpha:i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:i.options.powerPreference}),i.renderingToScreen=!0,lE(i.context.webGLVersion===2?"WebGL 2":"WebGL 1"),i.resize(i.options.width,i.options.height),i}return t.create=function(e){if(hE())return new t(e);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},t.prototype.contextChange=function(){var e=this.gl,i;if(this.context.webGLVersion===1){var n=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,n)}else{var n=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),i=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n)}i>=bt.HIGH?this.multisample=bt.HIGH:i>=bt.MEDIUM?this.multisample=bt.MEDIUM:i>=bt.LOW?this.multisample=bt.LOW:this.multisample=bt.NONE},t.prototype.addSystem=function(e,i){var n=new e(this);if(this[i])throw new Error('Whoops! The name "'+i+'" is already in use');this[i]=n;for(var s in this.runners)this.runners[s].add(n);return this},t.prototype.render=function(e,i){var n,s,o,a;if(i&&(i instanceof Hl?(oi("6.0.0","Renderer#render arguments changed, use options instead."),n=i,s=arguments[2],o=arguments[3],a=arguments[4]):(n=i.renderTexture,s=i.clear,o=i.transform,a=i.skipUpdateTransform)),this.renderingToScreen=!n,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=o,!this.context.isLost){if(n||(this._lastObjectRendered=e),!a){var l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}this.renderTexture.bind(n),this.batch.currentRenderer.start(),(s!==void 0?s:this.clearBeforeRender)&&this.renderTexture.clear(),e.render(this),this.batch.currentRenderer.flush(),n&&n.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},t.prototype.generateTexture=function(e,i,n,s){i===void 0&&(i={});var o=r.prototype.generateTexture.call(this,e,i,n,s);return this.framebuffer.blit(),o},t.prototype.resize=function(e,i){r.prototype.resize.call(this,e,i),this.runners.resize.emit(this.screen.height,this.screen.width)},t.prototype.reset=function(){return this.runners.reset.emit(),this},t.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},t.prototype.destroy=function(e){this.runners.destroy.emit();for(var i in this.runners)this.runners[i].destroy();r.prototype.destroy.call(this,e),this.gl=null},Object.defineProperty(t.prototype,"extract",{get:function(){return oi("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),t.registerPlugin=function(e,i){oi("6.5.0","Renderer.registerPlugin() has been deprecated, please use extensions.add() instead."),vs.add({name:e,type:be.RendererPlugin,ref:i})},t.__plugins={},t}($T);vs.handleByMap(be.RendererPlugin,Wl.__plugins);function WT(r){return Wl.create(r)}var qT=function(){function r(){this.texArray=null,this.blend=0,this.type=Kn.TRIANGLES,this.start=0,this.size=0,this.data=null}return r}(),YT=function(){function r(){this.elements=[],this.ids=[],this.count=0}return r.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},r}(),KT=function(){function r(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(r.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),r.prototype.view=function(t){return this[t+"View"]},r.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},r.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},r}(),JT=function(r){ut(t,r);function t(e){var i=r.call(this,e)||this;return i.shaderGenerator=null,i.geometryClass=null,i.vertexSize=null,i.state=Xl.for2d(),i.size=j.SPRITE_BATCH_SIZE*4,i._vertexCount=0,i._indexCount=0,i._bufferedElements=[],i._bufferedTextures=[],i._bufferSize=0,i._shader=null,i._packedGeometries=[],i._packedGeometryPoolSize=2,i._flushId=0,i._aBuffers={},i._iBuffers={},i.MAX_TEXTURES=1,i.renderer.on("prerender",i.onPrerender,i),e.runners.contextChange.add(i),i._dcIndex=0,i._aIndex=0,i._iIndex=0,i._attributeBuffer=null,i._indexBuffer=null,i._tempBoundTextures=[],i}return t.prototype.contextChange=function(){var e=this.renderer.gl;j.PREFER_ENV===sr.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),j.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=sT(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},t.prototype.initFlushBuffers=function(){for(var e=t._drawCallPool,i=t._textureArrayPool,n=this.size/4,s=Math.floor(n/this.MAX_TEXTURES)+1;e.length<n;)e.push(new qT);for(;i.length<s;)i.push(new YT);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},t.prototype.onPrerender=function(){this._flushId=0},t.prototype.render=function(e){!e._texture.valid||(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)},t.prototype.buildTexturesAndDrawCalls=function(){var e=this,i=e._bufferedTextures,n=e.MAX_TEXTURES,s=t._textureArrayPool,o=this.renderer.batch,a=this._tempBoundTextures,l=this.renderer.textureGC.count,h=++Ot._globalBatch,c=0,p=s[0],m=0;o.copyBoundTextures(a,n);for(var g=0;g<this._bufferSize;++g){var _=i[g];i[g]=null,_._batchEnabled!==h&&(p.count>=n&&(o.boundArray(p,a,h,n),this.buildDrawCalls(p,m,g),m=g,p=s[++c],++h),_._batchEnabled=h,_.touched=l,p.elements[p.count++]=_)}p.count>0&&(o.boundArray(p,a,h,n),this.buildDrawCalls(p,m,this._bufferSize),++c,++h);for(var g=0;g<a.length;g++)a[g]=null;Ot._globalBatch=h},t.prototype.buildDrawCalls=function(e,i,n){var s=this,o=s._bufferedElements,a=s._attributeBuffer,l=s._indexBuffer,h=s.vertexSize,c=t._drawCallPool,p=this._dcIndex,m=this._aIndex,g=this._iIndex,_=c[p];_.start=this._iIndex,_.texArray=e;for(var A=i;A<n;++A){var y=o[A],S=y._texture.baseTexture,M=pE[S.alphaMode?1:0][y.blendMode];o[A]=null,i<A&&_.blend!==M&&(_.size=g-_.start,i=A,_=c[++p],_.texArray=e,_.start=g),this.packInterleavedGeometry(y,a,l,m,g),m+=y.vertexData.length/2*h,g+=y.indices.length,_.blend=M}i<n&&(_.size=g-_.start,++p),this._dcIndex=p,this._aIndex=m,this._iIndex=g},t.prototype.bindAndClearTexArray=function(e){for(var i=this.renderer.texture,n=0;n<e.count;n++)i.bind(e.elements[n],e.ids[n]),e.elements[n]=null;e.count=0},t.prototype.updateGeometry=function(){var e=this,i=e._packedGeometries,n=e._attributeBuffer,s=e._indexBuffer;j.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(n.rawBinaryData),i[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(n.rawBinaryData),i[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},t.prototype.drawBatches=function(){for(var e=this._dcIndex,i=this.renderer,n=i.gl,s=i.state,o=t._drawCallPool,a=null,l=0;l<e;l++){var h=o[l],c=h.texArray,p=h.type,m=h.size,g=h.start,_=h.blend;a!==c&&(a=c,this.bindAndClearTexArray(c)),this.state.blendMode=_,s.set(this.state),n.drawElements(p,m,n.UNSIGNED_SHORT,g*2)}},t.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},t.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),j.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),r.prototype.destroy.call(this)},t.prototype.getAttributeBuffer=function(e){var i=ko(Math.ceil(e/8)),n=Fd(i),s=i*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._aBuffers[s];return o||(this._aBuffers[s]=o=new KT(s*this.vertexSize*4)),o},t.prototype.getIndexBuffer=function(e){var i=ko(Math.ceil(e/12)),n=Fd(i),s=i*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._iBuffers[n];return o||(this._iBuffers[n]=o=new Uint16Array(s)),o},t.prototype.packInterleavedGeometry=function(e,i,n,s,o){for(var a=i.uint32View,l=i.float32View,h=s/this.vertexSize,c=e.uvs,p=e.indices,m=e.vertexData,g=e._texture.baseTexture._batchLocation,_=Math.min(e.worldAlpha,1),A=_<1&&e._texture.baseTexture.alphaMode?mE(e._tintRGB,_):e._tintRGB+(_*255<<24),y=0;y<m.length;y+=2)l[s++]=m[y],l[s++]=m[y+1],l[s++]=c[y],l[s++]=c[y+1],a[s++]=A,l[s++]=g;for(var y=0;y<p.length;y++)n[o++]=h+p[y]},t._drawCallPool=[],t._textureArrayPool=[],t}(pm),QT=function(){function r(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return r.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=Ui.from({uSamplers:e},!0);var n=this.fragTemplate;n=n.replace(/%count%/gi,""+t),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new zl(this.vertexSrc,n)}var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Xt,default:this.defaultGroupCache[t]};return new ym(this.programCache[t],s)},r.prototype.generateSampleSrc=function(t){var e="";e+=`
`,e+=`
`;for(var i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+=`
{`,e+=`
	color = texture2D(uSamplers[`+i+"], vTextureCoord);",e+=`
}`;return e+=`
`,e+=`
`,e},r}(),ZT=function(r){ut(t,r);function t(e){e===void 0&&(e=!1);var i=r.call(this)||this;return i._buffer=new me(null,e,!1),i._indexBuffer=new me(null,e,!0),i.addAttribute("aVertexPosition",i._buffer,2,!1,et.FLOAT).addAttribute("aTextureCoord",i._buffer,2,!1,et.FLOAT).addAttribute("aColor",i._buffer,4,!0,et.UNSIGNED_BYTE).addAttribute("aTextureId",i._buffer,1,!0,et.FLOAT).addIndex(i._indexBuffer),i}return t}($l),Yd=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,Kd=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,tI=function(){function r(){}return r.create=function(t){var e=Object.assign({vertex:Yd,fragment:Kd,geometryClass:ZT,vertexSize:6},t),i=e.vertex,n=e.fragment,s=e.vertexSize,o=e.geometryClass;return function(a){ut(l,a);function l(h){var c=a.call(this,h)||this;return c.shaderGenerator=new QT(i,n),c.geometryClass=o,c.vertexSize=s,c}return l}(JT)},Object.defineProperty(r,"defaultVertexSrc",{get:function(){return Yd},enumerable:!1,configurable:!0}),Object.defineProperty(r,"defaultFragmentTemplate",{get:function(){return Kd},enumerable:!1,configurable:!0}),r}(),eI=tI.create();Object.assign(eI,{extension:{name:"batch",type:be.RendererPlugin}});/*!
 * @pixi/display - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/display is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */j.SORTABLE_CHILDREN=!1;var Jd=function(){function r(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return r.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},r.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},r.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?At.EMPTY:(t=t||new At(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},r.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},r.prototype.addPointMatrix=function(t,e){var i=t.a,n=t.b,s=t.c,o=t.d,a=t.tx,l=t.ty,h=i*e.x+s*e.y+a,c=n*e.x+o*e.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)},r.prototype.addQuad=function(t){var e=this.minX,i=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],e=o<e?o:e,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,this.minX=e,this.minY=i,this.maxX=n,this.maxY=s},r.prototype.addFrame=function(t,e,i,n,s){this.addFrameMatrix(t.worldTransform,e,i,n,s)},r.prototype.addFrameMatrix=function(t,e,i,n,s){var o=t.a,a=t.b,l=t.c,h=t.d,c=t.tx,p=t.ty,m=this.minX,g=this.minY,_=this.maxX,A=this.maxY,y=o*e+l*i+c,S=a*e+h*i+p;m=y<m?y:m,g=S<g?S:g,_=y>_?y:_,A=S>A?S:A,y=o*n+l*i+c,S=a*n+h*i+p,m=y<m?y:m,g=S<g?S:g,_=y>_?y:_,A=S>A?S:A,y=o*e+l*s+c,S=a*e+h*s+p,m=y<m?y:m,g=S<g?S:g,_=y>_?y:_,A=S>A?S:A,y=o*n+l*s+c,S=a*n+h*s+p,m=y<m?y:m,g=S<g?S:g,_=y>_?y:_,A=S>A?S:A,this.minX=m,this.minY=g,this.maxX=_,this.maxY=A},r.prototype.addVertexData=function(t,e,i){for(var n=this.minX,s=this.minY,o=this.maxX,a=this.maxY,l=e;l<i;l+=2){var h=t[l],c=t[l+1];n=h<n?h:n,s=c<s?c:s,o=h>o?h:o,a=c>a?c:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a},r.prototype.addVertices=function(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)},r.prototype.addVerticesMatrix=function(t,e,i,n,s,o){s===void 0&&(s=0),o===void 0&&(o=s);for(var a=t.a,l=t.b,h=t.c,c=t.d,p=t.tx,m=t.ty,g=this.minX,_=this.minY,A=this.maxX,y=this.maxY,S=i;S<n;S+=2){var M=e[S],x=e[S+1],F=a*M+h*x+p,B=c*x+l*M+m;g=Math.min(g,F-s),A=Math.max(A,F+s),_=Math.min(_,B-o),y=Math.max(y,B+o)}this.minX=g,this.minY=_,this.maxX=A,this.maxY=y},r.prototype.addBounds=function(t){var e=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s},r.prototype.addBoundsMask=function(t,e){var i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&n<=o){var a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=n<l?n:l,this.maxX=s>h?s:h,this.maxY=o>c?o:c}},r.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},r.prototype.addBoundsArea=function(t,e){var i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&n<=o){var a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=n<l?n:l,this.maxX=s>h?s:h,this.maxY=o>c?o:c}},r.prototype.pad=function(t,e){t===void 0&&(t=0),e===void 0&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},r.prototype.addFramePad=function(t,e,i,n,s,o){t-=s,e-=o,i+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n},r}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var al=function(r,t){return al=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},al(r,t)};function ql(r,t){al(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var rs=function(r){ql(t,r);function t(){var e=r.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new um,e.alpha=1,e.visible=!0,e.renderable=!0,e.cullable=!1,e.cullArea=null,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new Jd,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._maskRefCount=0,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return t.mixin=function(e){for(var i=Object.keys(e),n=0;n<i.length;++n){var s=i[n];Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e,s))}},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),t.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},t.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},t.prototype.getBounds=function(e,i){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new At),i=this._boundsRect),this._bounds.getRectangle(i)},t.prototype.getLocalBounds=function(e){e||(this._localBoundsRect||(this._localBoundsRect=new At),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Jd);var i=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;var a=this.getBounds(!1,e);return this.parent=n,this.transform=i,this._bounds=s,this._bounds.updateID+=this._boundsID-o,a},t.prototype.toGlobal=function(e,i,n){return n===void 0&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,i)},t.prototype.toLocal=function(e,i,n,s){return i&&(e=i.toGlobal(e,n,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,n)},t.prototype.setParent=function(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e},t.prototype.setTransform=function(e,i,n,s,o,a,l,h,c){return e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=1),s===void 0&&(s=1),o===void 0&&(o=0),a===void 0&&(a=0),l===void 0&&(l=0),h===void 0&&(h=0),c===void 0&&(c=0),this.position.x=e,this.position.y=i,this.scale.x=n||1,this.scale.y=s||1,this.rotation=o,this.skew.x=a,this.skew.y=l,this.pivot.x=h,this.pivot.y=c,this},t.prototype.destroy=function(e){this.parent&&this.parent.removeChild(this),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()},Object.defineProperty(t.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Im),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),t.prototype.enableTempParent=function(){var e=this.parent;return this.parent=this._tempDisplayObjectParent,e},t.prototype.disableTempParent=function(e){this.parent=e},Object.defineProperty(t.prototype,"x",{get:function(){return this.position.x},set:function(e){this.transform.position.x=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.position.y},set:function(e){this.transform.position.y=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.transform.position},set:function(e){this.transform.position.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.transform.scale},set:function(e){this.transform.scale.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(e){this.transform.pivot.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skew",{get:function(){return this.transform.skew},set:function(e){this.transform.skew.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(e){this.transform.rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.transform.rotation*EE},set:function(e){this.transform.rotation=e*TE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){if(this._mask!==e){if(this._mask){var i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=e,this._mask){var i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}},enumerable:!1,configurable:!0}),t}(Or),Im=function(r){ql(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.sortDirty=null,e}return t}(rs);rs.prototype.displayObjectUpdateTransform=rs.prototype.updateTransform;function rI(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}var Bo=function(r){ql(t,r);function t(){var e=r.call(this)||this;return e.children=[],e.sortableChildren=j.SORTABLE_CHILDREN,e.sortDirty=!1,e}return t.prototype.onChildrenChange=function(e){},t.prototype.addChild=function(){for(var e=arguments,i=[],n=0;n<arguments.length;n++)i[n]=e[n];if(i.length>1)for(var s=0;s<i.length;s++)this.addChild(i[s]);else{var o=i[0];o.parent&&o.parent.removeChild(o),o.parent=this,this.sortDirty=!0,o.transform._parentID=-1,this.children.push(o),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",o,this,this.children.length-1),o.emit("added",this)}return i[0]},t.prototype.addChildAt=function(e,i){if(i<0||i>this.children.length)throw new Error(e+"addChildAt: The index "+i+" supplied is out of bounds "+this.children.length);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(i,0,e),this._boundsID++,this.onChildrenChange(i),e.emit("added",this),this.emit("childAdded",e,this,i),e},t.prototype.swapChildren=function(e,i){if(e!==i){var n=this.getChildIndex(e),s=this.getChildIndex(i);this.children[n]=i,this.children[s]=e,this.onChildrenChange(n<s?n:s)}},t.prototype.getChildIndex=function(e){var i=this.children.indexOf(e);if(i===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return i},t.prototype.setChildIndex=function(e,i){if(i<0||i>=this.children.length)throw new Error("The index "+i+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(e);_o(this.children,n,1),this.children.splice(i,0,e),this.onChildrenChange(i)},t.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Index ("+e+") does not exist.");return this.children[e]},t.prototype.removeChild=function(){for(var e=arguments,i=[],n=0;n<arguments.length;n++)i[n]=e[n];if(i.length>1)for(var s=0;s<i.length;s++)this.removeChild(i[s]);else{var o=i[0],a=this.children.indexOf(o);if(a===-1)return null;o.parent=null,o.transform._parentID=-1,_o(this.children,a,1),this._boundsID++,this.onChildrenChange(a),o.emit("removed",this),this.emit("childRemoved",o,this,a)}return i[0]},t.prototype.removeChildAt=function(e){var i=this.getChildAt(e);return i.parent=null,i.transform._parentID=-1,_o(this.children,e,1),this._boundsID++,this.onChildrenChange(e),i.emit("removed",this),this.emit("childRemoved",i,this,e),i},t.prototype.removeChildren=function(e,i){e===void 0&&(e=0),i===void 0&&(i=this.children.length);var n=e,s=i,o=s-n,a;if(o>0&&o<=s){a=this.children.splice(n,o);for(var l=0;l<a.length;++l)a[l].parent=null,a[l].transform&&(a[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(var l=0;l<a.length;++l)a[l].emit("removed",this),this.emit("childRemoved",a[l],this,l);return a}else if(o===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},t.prototype.sortChildren=function(){for(var e=!1,i=0,n=this.children.length;i<n;++i){var s=this.children[i];s._lastSortedIndex=i,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(rI),this.sortDirty=!1},t.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var e=0,i=this.children.length;e<i;++e){var n=this.children[e];n.visible&&n.updateTransform()}},t.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var e=0;e<this.children.length;e++){var i=this.children[e];if(!(!i.visible||!i.renderable))if(i.calculateBounds(),i._mask){var n=i._mask.isMaskData?i._mask.maskObject:i._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(i._bounds,n._bounds)):this._bounds.addBounds(i._bounds)}else i.filterArea?this._bounds.addBoundsArea(i._bounds,i.filterArea):this._bounds.addBounds(i._bounds)}this._bounds.updateID=this._boundsID},t.prototype.getLocalBounds=function(e,i){i===void 0&&(i=!1);var n=r.prototype.getLocalBounds.call(this,e);if(!i)for(var s=0,o=this.children.length;s<o;++s){var a=this.children[s];a.visible&&a.updateTransform()}return n},t.prototype._calculateBounds=function(){},t.prototype._renderWithCulling=function(e){var i=e.renderTexture.sourceFrame;if(i.width>0&&i.height>0){var n,s;if(this.cullArea?(n=this.cullArea,s=this.worldTransform):this._render!==t.prototype._render&&(n=this.getBounds(!0)),n&&i.intersects(n,s))this._render(e);else if(this.cullArea)return;for(var o=0,a=this.children.length;o<a;++o){var l=this.children[o],h=l.cullable;l.cullable=h||!this.cullArea,l.render(e),l.cullable=h}}},t.prototype.render=function(e){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(var i=0,n=this.children.length;i<n;++i)this.children[i].render(e)}},t.prototype.renderAdvanced=function(e){var i=this.filters,n=this._mask;if(i){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var s=0;s<i.length;s++)i[s].enabled&&this._enabledFilters.push(i[s])}var o=i&&this._enabledFilters&&this._enabledFilters.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==xt.NONE));if(o&&e.batch.flush(),i&&this._enabledFilters&&this._enabledFilters.length&&e.filter.push(this,this._enabledFilters),n&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(var s=0,a=this.children.length;s<a;++s)this.children[s].render(e)}o&&e.batch.flush(),n&&e.mask.pop(this),i&&this._enabledFilters&&this._enabledFilters.length&&e.filter.pop()},t.prototype._render=function(e){},t.prototype.destroy=function(e){r.prototype.destroy.call(this),this.sortDirty=!1;var i=typeof e=="boolean"?e:e&&e.children,n=this.removeChildren(0,this.children.length);if(i)for(var s=0;s<n.length;++s)n[s].destroy(e)},Object.defineProperty(t.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var i=this.getLocalBounds().width;i!==0?this.scale.x=e/i:this.scale.x=1,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var i=this.getLocalBounds().height;i!==0?this.scale.y=e/i:this.scale.y=1,this._height=e},enumerable:!1,configurable:!0}),t}(rs);Bo.prototype.containerUpdateTransform=Bo.prototype.updateTransform;/*!
 * @pixi/app - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/app is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var iI=function(){function r(){}return r.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){!e._resizeTo||(e.cancelResize(),e._resizeId=requestAnimationFrame(function(){return e.resize()}))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(!!e._resizeTo){e.cancelResize();var i,n;if(e._resizeTo===globalThis.window)i=globalThis.innerWidth,n=globalThis.innerHeight;else{var s=e._resizeTo,o=s.clientWidth,a=s.clientHeight;i=o,n=a}e.renderer.resize(i,n)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},r.destroy=function(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},r.extension=be.Application,r}(),Yl=function(){function r(t){var e=this;this.stage=new Bo,t=Object.assign({forceCanvas:!1},t),this.renderer=WT(t),r._plugins.forEach(function(i){i.init.call(e,t)})}return r.registerPlugin=function(t){oi("6.5.0","Application.registerPlugin() is deprecated, use extensions.add()"),vs.add({type:be.Application,ref:t})},r.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(r.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),r.prototype.destroy=function(t,e){var i=this,n=r._plugins.slice(0);n.reverse(),n.forEach(function(s){s.destroy.call(i)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null},r._plugins=[],r}();vs.handleByList(be.Application,Yl._plugins);vs.add(iI);/*!
 * @pixi/interaction - v6.5.10
 * Compiled Thu, 06 Jul 2023 15:25:11 UTC
 *
 * @pixi/interaction is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Qd=function(){function r(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new ae,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(r.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),r.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)},r.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},r.prototype.reset=function(){this.isPrimary=!1},r}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ul=function(r,t){return ul=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},ul(r,t)};function nI(r,t){ul(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var sI=function(){function r(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return r.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},r.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},r}(),bu=function(){function r(t){this._pointerId=t,this._flags=r.FLAGS.NONE}return r.prototype._doSet=function(t,e){e?this._flags=this._flags|t:this._flags=this._flags&~t},Object.defineProperty(r.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"none",{get:function(){return this._flags===r.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"over",{get:function(){return(this._flags&r.FLAGS.OVER)!==0},set:function(t){this._doSet(r.FLAGS.OVER,t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rightDown",{get:function(){return(this._flags&r.FLAGS.RIGHT_DOWN)!==0},set:function(t){this._doSet(r.FLAGS.RIGHT_DOWN,t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"leftDown",{get:function(){return(this._flags&r.FLAGS.LEFT_DOWN)!==0},set:function(t){this._doSet(r.FLAGS.LEFT_DOWN,t)},enumerable:!1,configurable:!0}),r.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2}),r}(),oI=function(){function r(){this._tempPoint=new ae}return r.prototype.recursiveFindHit=function(t,e,i,n,s){var o;if(!e||!e.visible)return!1;var a=t.data.global;s=e.interactive||s;var l=!1,h=s,c=!0;if(e.hitArea)n&&(e.worldTransform.applyInverse(a,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?l=!0:(n=!1,c=!1)),h=!1;else if(e._mask&&n){var p=e._mask.isMaskData?e._mask.maskObject:e._mask;p&&!(!((o=p.containsPoint)===null||o===void 0)&&o.call(p,a))&&(n=!1)}if(c&&e.interactiveChildren&&e.children)for(var m=e.children,g=m.length-1;g>=0;g--){var _=m[g],A=this.recursiveFindHit(t,_,i,n,h);if(A){if(!_.parent)continue;h=!1,A&&(t.target&&(n=!1),l=!0)}}return s&&(n&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(a)&&(l=!0),e.interactive&&(l&&!t.target&&(t.target=e),i&&i(t,e,!!l))),l},r.prototype.findHit=function(t,e,i,n){this.recursiveFindHit(t,e,i,n,!1)},r}(),aI={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(r){r?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};rs.mixin(aI);var no=1,so={target:null,data:{global:null}},uI=function(r){nI(t,r);function t(e,i){var n=r.call(this)||this;return i=i||{},n.renderer=e,n.autoPreventDefault=i.autoPreventDefault!==void 0?i.autoPreventDefault:!0,n.interactionFrequency=i.interactionFrequency||10,n.mouse=new Qd,n.mouse.identifier=no,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[no]=n.mouse,n.interactionDataPool=[],n.eventData=new sI,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!("PointerEvent"in globalThis),n.supportsTouchEvents="ontouchstart"in globalThis,n.supportsPointerEvents=!!globalThis.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new oI,n._tempDisplayObject=new Im,n._eventListenerOptions={capture:!0,passive:!1},n._useSystemTicker=i.useSystemTicker!==void 0?i.useSystemTicker:!0,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return Object.defineProperty(t.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(e){this._useSystemTicker=e,e?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),t.prototype.hitTest=function(e,i){return so.target=null,so.data.global=e,i||(i=this.lastObjectRendered),this.processInteractive(so,i,null,!0),so.target},t.prototype.setTargetElement=function(e,i){i===void 0&&(i=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=e,this.resolution=i,this.addEvents(),this.addTickerListener()},t.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(xe.system.add(this.tickerUpdate,this,Ki.INTERACTION),this.tickerAdded=!0)},t.prototype.removeTickerListener=function(){!this.tickerAdded||(xe.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},t.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var e=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none"),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},t.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var e=this.interactionDOMElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),globalThis.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),globalThis.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},t.prototype.tickerUpdate=function(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},t.prototype.update=function(){if(!!this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var e in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var i=this.activeInteractionData[e];if(i.originalEvent&&i.pointerType!=="touch"){var n=this.configureInteractionEventForDOMEvent(this.eventData,i.originalEvent,i);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},t.prototype.setCursorMode=function(e){e=e||"default";var i=!0;if(globalThis.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(i=!1),this.currentCursorMode!==e){this.currentCursorMode=e;var n=this.cursorStyles[e];if(n)switch(typeof n){case"string":i&&(this.interactionDOMElement.style.cursor=n);break;case"function":n(e);break;case"object":i&&Object.assign(this.interactionDOMElement.style,n);break}else i&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.interactionDOMElement.style.cursor=e)}},t.prototype.dispatchEvent=function(e,i,n){(!n.stopPropagationHint||e===n.stopsPropagatingAt)&&(n.currentTarget=e,n.type=i,e.emit(i,n),e[i]&&e[i](n))},t.prototype.delayDispatchEvent=function(e,i,n){this.delayedEvents.push({displayObject:e,eventString:i,eventData:n})},t.prototype.mapPositionToPoint=function(e,i,n){var s;this.interactionDOMElement.parentElement?s=this.interactionDOMElement.getBoundingClientRect():s={x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var o=1/this.resolution;e.x=(i-s.left)*(this.interactionDOMElement.width/s.width)*o,e.y=(n-s.top)*(this.interactionDOMElement.height/s.height)*o},t.prototype.processInteractive=function(e,i,n,s){var o=this.search.findHit(e,i,n,s),a=this.delayedEvents;if(!a.length)return o;e.stopPropagationHint=!1;var l=a.length;this.delayedEvents=[];for(var h=0;h<l;h++){var c=a[h],p=c.displayObject,m=c.eventString,g=c.eventData;g.stopsPropagatingAt===p&&(g.stopPropagationHint=!0),this.dispatchEvent(p,m,g)}return o},t.prototype.onPointerDown=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e);if(this.autoPreventDefault&&i[0].isNormalized){var n=e.cancelable||!("cancelable"in e);n&&e.preventDefault()}for(var s=i.length,o=0;o<s;o++){var a=i[o],l=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,l);if(h.data.originalEvent=e,this.processInteractive(h,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",h),a.pointerType==="touch")this.emit("touchstart",h);else if(a.pointerType==="mouse"||a.pointerType==="pen"){var c=a.button===2;this.emit(c?"rightdown":"mousedown",this.eventData)}}}},t.prototype.processPointerDown=function(e,i,n){var s=e.data,o=e.data.identifier;if(n){if(i.trackedPointers[o]||(i.trackedPointers[o]=new bu(o)),this.dispatchEvent(i,"pointerdown",e),s.pointerType==="touch")this.dispatchEvent(i,"touchstart",e);else if(s.pointerType==="mouse"||s.pointerType==="pen"){var a=s.button===2;a?i.trackedPointers[o].rightDown=!0:i.trackedPointers[o].leftDown=!0,this.dispatchEvent(i,a?"rightdown":"mousedown",e)}}},t.prototype.onPointerComplete=function(e,i,n){var s=this.normalizeToPointerData(e),o=s.length,a=e.target;e.composedPath&&e.composedPath().length>0&&(a=e.composedPath()[0]);for(var l=a!==this.interactionDOMElement?"outside":"",h=0;h<o;h++){var c=s[h],p=this.getInteractionDataForPointerId(c),m=this.configureInteractionEventForDOMEvent(this.eventData,c,p);if(m.data.originalEvent=e,this.processInteractive(m,this.lastObjectRendered,n,i||!l),this.emit(i?"pointercancel":"pointerup"+l,m),c.pointerType==="mouse"||c.pointerType==="pen"){var g=c.button===2;this.emit(g?"rightup"+l:"mouseup"+l,m)}else c.pointerType==="touch"&&(this.emit(i?"touchcancel":"touchend"+l,m),this.releaseInteractionDataForPointerId(c.pointerId))}},t.prototype.onPointerCancel=function(e){this.supportsTouchEvents&&e.pointerType==="touch"||this.onPointerComplete(e,!0,this.processPointerCancel)},t.prototype.processPointerCancel=function(e,i){var n=e.data,s=e.data.identifier;i.trackedPointers[s]!==void 0&&(delete i.trackedPointers[s],this.dispatchEvent(i,"pointercancel",e),n.pointerType==="touch"&&this.dispatchEvent(i,"touchcancel",e))},t.prototype.onPointerUp=function(e){this.supportsTouchEvents&&e.pointerType==="touch"||this.onPointerComplete(e,!1,this.processPointerUp)},t.prototype.processPointerUp=function(e,i,n){var s=e.data,o=e.data.identifier,a=i.trackedPointers[o],l=s.pointerType==="touch",h=s.pointerType==="mouse"||s.pointerType==="pen",c=!1;if(h){var p=s.button===2,m=bu.FLAGS,g=p?m.RIGHT_DOWN:m.LEFT_DOWN,_=a!==void 0&&a.flags&g;n?(this.dispatchEvent(i,p?"rightup":"mouseup",e),_&&(this.dispatchEvent(i,p?"rightclick":"click",e),c=!0)):_&&this.dispatchEvent(i,p?"rightupoutside":"mouseupoutside",e),a&&(p?a.rightDown=!1:a.leftDown=!1)}n?(this.dispatchEvent(i,"pointerup",e),l&&this.dispatchEvent(i,"touchend",e),a&&((!h||c)&&this.dispatchEvent(i,"pointertap",e),l&&(this.dispatchEvent(i,"tap",e),a.over=!1))):a&&(this.dispatchEvent(i,"pointerupoutside",e),l&&this.dispatchEvent(i,"touchendoutside",e)),a&&a.none&&delete i.trackedPointers[o]},t.prototype.onPointerMove=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e);(i[0].pointerType==="mouse"||i[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var n=i.length,s=0;s<n;s++){var o=i[s],a=this.getInteractionDataForPointerId(o),l=this.configureInteractionEventForDOMEvent(this.eventData,o,a);l.data.originalEvent=e,this.processInteractive(l,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",l),o.pointerType==="touch"&&this.emit("touchmove",l),(o.pointerType==="mouse"||o.pointerType==="pen")&&this.emit("mousemove",l)}i[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},t.prototype.processPointerMove=function(e,i,n){var s=e.data,o=s.pointerType==="touch",a=s.pointerType==="mouse"||s.pointerType==="pen";a&&this.processPointerOverOut(e,i,n),(!this.moveWhenInside||n)&&(this.dispatchEvent(i,"pointermove",e),o&&this.dispatchEvent(i,"touchmove",e),a&&this.dispatchEvent(i,"mousemove",e))},t.prototype.onPointerOut=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e),n=i[0];n.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,this.processInteractive(o,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",o),n.pointerType==="mouse"||n.pointerType==="pen"?this.emit("mouseout",o):this.releaseInteractionDataForPointerId(s.identifier)}},t.prototype.processPointerOverOut=function(e,i,n){var s=e.data,o=e.data.identifier,a=s.pointerType==="mouse"||s.pointerType==="pen",l=i.trackedPointers[o];n&&!l&&(l=i.trackedPointers[o]=new bu(o)),l!==void 0&&(n&&this.mouseOverRenderer?(l.over||(l.over=!0,this.delayDispatchEvent(i,"pointerover",e),a&&this.delayDispatchEvent(i,"mouseover",e)),a&&this.cursor===null&&(this.cursor=i.cursor)):l.over&&(l.over=!1,this.dispatchEvent(i,"pointerout",this.eventData),a&&this.dispatchEvent(i,"mouseout",e),l.none&&delete i.trackedPointers[o]))},t.prototype.onPointerOver=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var i=this.normalizeToPointerData(e),n=i[0],s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,n.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",o),(n.pointerType==="mouse"||n.pointerType==="pen")&&this.emit("mouseover",o)}},t.prototype.getInteractionDataForPointerId=function(e){var i=e.pointerId,n;return i===no||e.pointerType==="mouse"?n=this.mouse:this.activeInteractionData[i]?n=this.activeInteractionData[i]:(n=this.interactionDataPool.pop()||new Qd,n.identifier=i,this.activeInteractionData[i]=n),n.copyEvent(e),n},t.prototype.releaseInteractionDataForPointerId=function(e){var i=this.activeInteractionData[e];i&&(delete this.activeInteractionData[e],i.reset(),this.interactionDataPool.push(i))},t.prototype.configureInteractionEventForDOMEvent=function(e,i,n){return e.data=n,this.mapPositionToPoint(n.global,i.clientX,i.clientY),i.pointerType==="touch"&&(i.globalX=n.global.x,i.globalY=n.global.y),n.originalEvent=i,e.reset(),e},t.prototype.normalizeToPointerData=function(e){var i=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(var n=0,s=e.changedTouches.length;n<s;n++){var o=e.changedTouches[n];typeof o.button>"u"&&(o.button=e.touches.length?1:0),typeof o.buttons>"u"&&(o.buttons=e.touches.length?1:0),typeof o.isPrimary>"u"&&(o.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,i.push(o)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){var a=e;typeof a.isPrimary>"u"&&(a.isPrimary=!0),typeof a.width>"u"&&(a.width=1),typeof a.height>"u"&&(a.height=1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="mouse"),typeof a.pointerId>"u"&&(a.pointerId=no),typeof a.pressure>"u"&&(a.pressure=.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),a.isNormalized=!0,i.push(a)}else i.push(e);return i},t.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},t.extension={name:"interaction",type:[be.RendererPlugin,be.CanvasRendererPlugin]},t}(Or),Vr=Math.pow,mt=(r,t,e)=>new Promise((i,n)=>{var s=l=>{try{a(e.next(l))}catch(h){n(h)}},o=l=>{try{a(e.throw(l))}catch(h){n(h)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,o);a((e=e.apply(r,t)).next())});const Zd=2,tf=2;var is;(r=>{r.supportMoreMaskDivisions=!0,r.setOpacityFromMotion=!1})(is||(is={}));var Ht;(r=>{r.LOG_LEVEL_VERBOSE=0,r.LOG_LEVEL_WARNING=1,r.LOG_LEVEL_ERROR=2,r.LOG_LEVEL_NONE=999,r.logLevel=r.LOG_LEVEL_WARNING,r.sound=!0,r.motionSync=!0,r.motionFadingDuration=500,r.idleMotionFadingDuration=2e3,r.expressionFadingDuration=500,r.preserveExpressionOnMotion=!0,r.cubism4=is})(Ht||(Ht={}));const st={log(r,...t){Ht.logLevel<=Ht.LOG_LEVEL_VERBOSE&&console.log(`[${r}]`,...t)},warn(r,...t){Ht.logLevel<=Ht.LOG_LEVEL_WARNING&&console.warn(`[${r}]`,...t)},error(r,...t){Ht.logLevel<=Ht.LOG_LEVEL_ERROR&&console.error(`[${r}]`,...t)}};function Uo(r,t,e){return r<t?t:r>e?e:r}function lI(r,t){return Math.random()*(t-r)+r}function xn(r,t,e,i,n){const s=t[i];s!==null&&typeof s===r&&(e[n]=s)}function Pn(r,t,e,i,n){const s=t[i];Array.isArray(s)&&(e[n]=s.filter(o=>o!==null&&typeof o===r))}function wm(r,t){t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{i!=="constructor"&&Object.defineProperty(r.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i))})})}function hI(r){let t=r.lastIndexOf("/");return t!=-1&&(r=r.slice(0,t)),t=r.lastIndexOf("/"),t!==-1&&(r=r.slice(t+1)),r}function cI(r,t){const e=r.indexOf(t);e!==-1&&r.splice(e,1)}class Kl extends Or{constructor(t,e){super(),this.expressions=[],this.reserveExpressionIndex=-1,this.destroyed=!1,this.settings=t,this.tag=`ExpressionManager(${t.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(t){return mt(this,null,function*(){if(!this.definitions[t]){st.warn(this.tag,`Undefined expression at [${t}]`);return}if(this.expressions[t]===null){st.warn(this.tag,`Cannot set expression at [${t}] because it's already failed in loading.`);return}if(this.expressions[t])return this.expressions[t];const e=yield this._loadExpression(t);return this.expressions[t]=e,e})}_loadExpression(t){throw new Error("Not implemented.")}setRandomExpression(){return mt(this,null,function*(){if(this.definitions.length){const t=[];for(let e=0;e<this.definitions.length;e++)this.expressions[e]!==null&&this.expressions[e]!==this.currentExpression&&e!==this.reserveExpressionIndex&&t.push(e);if(t.length){const e=Math.floor(Math.random()*t.length);return this.setExpression(e)}}return!1})}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(t){return mt(this,null,function*(){if(typeof t!="number"&&(t=this.getExpressionIndex(t)),!(t>-1&&t<this.definitions.length)||t===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=t;const e=yield this.loadExpression(t);return!e||this.reserveExpressionIndex!==t?!1:(this.reserveExpressionIndex=-1,this.currentExpression=e,this._setExpression(e),!0)})}update(t,e){return this.isFinished()?!1:this.updateParameters(t,e)}destroy(){this.destroyed=!0,this.emit("destroy");const t=this;t.definitions=void 0,t.expressions=void 0}}const ef=.01,dI=40/7.5,fI=1/(.15*1e3);class pI{constructor(){this.targetX=0,this.targetY=0,this.x=0,this.y=0,this.vx=0,this.vy=0}focus(t,e,i=!1){this.targetX=Uo(t,-1,1),this.targetY=Uo(e,-1,1),i&&(this.x=this.targetX,this.y=this.targetY)}update(t){const e=this.targetX-this.x,i=this.targetY-this.y;if(Math.abs(e)<ef&&Math.abs(i)<ef)return;const n=Math.sqrt(Vr(e,2)+Vr(i,2)),s=dI/(1e3/t);let o=s*(e/n)-this.vx,a=s*(i/n)-this.vy;const l=Math.sqrt(Vr(o,2)+Vr(a,2)),h=s*fI*t;l>h&&(o*=h/l,a*=h/l),this.vx+=o,this.vy+=a;const c=Math.sqrt(Vr(this.vx,2)+Vr(this.vy,2)),p=.5*(Math.sqrt(Vr(h,2)+8*h*n)-h);c>p&&(this.vx*=p/c,this.vy*=p/c),this.x+=this.vx,this.y+=this.vy}}class fa{constructor(t){this.json=t;let e=t.url;if(typeof e!="string")throw new TypeError("The `url` field in settings JSON must be defined as a string.");this.url=e,this.name=hI(this.url)}resolveURL(t){return da.resolve(this.url,t)}replaceFiles(t){this.moc=t(this.moc,"moc"),this.pose!==void 0&&(this.pose=t(this.pose,"pose")),this.physics!==void 0&&(this.physics=t(this.physics,"physics"));for(let e=0;e<this.textures.length;e++)this.textures[e]=t(this.textures[e],`textures[${e}]`)}getDefinedFiles(){const t=[];return this.replaceFiles(e=>(t.push(e),e)),t}validateFiles(t){const e=(s,o)=>{const a=this.resolveURL(s);if(!t.includes(a)){if(o)throw new Error(`File "${s}" is defined in settings, but doesn't exist in given files`);return!1}return!0};return[this.moc,...this.textures].forEach(s=>e(s,!0)),this.getDefinedFiles().filter(s=>e(s,!1))}}var ll=(r=>(r[r.NONE=0]="NONE",r[r.IDLE=1]="IDLE",r[r.NORMAL=2]="NORMAL",r[r.FORCE=3]="FORCE",r))(ll||{});class mI{constructor(){this.debug=!1,this.currentPriority=0,this.reservePriority=0}reserve(t,e,i){if(i<=0)return st.log(this.tag,"Cannot start a motion with MotionPriority.NONE."),!1;if(t===this.currentGroup&&e===this.currentIndex)return st.log(this.tag,"Motion is already playing.",this.dump(t,e)),!1;if(t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex)return st.log(this.tag,"Motion is already reserved.",this.dump(t,e)),!1;if(i===1){if(this.currentPriority!==0)return st.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(t,e)),!1;if(this.reservedIdleGroup!==void 0)return st.log(this.tag,"Cannot start idle motion because another idle motion has reserved.",this.dump(t,e)),!1;this.setReservedIdle(t,e)}else{if(i<3){if(i<=this.currentPriority)return st.log(this.tag,"Cannot start motion because another motion is playing as an equivalent or higher priority.",this.dump(t,e)),!1;if(i<=this.reservePriority)return st.log(this.tag,"Cannot start motion because another motion has reserved as an equivalent or higher priority.",this.dump(t,e)),!1}this.setReserved(t,e,i)}return!0}start(t,e,i,n){if(n===1){if(this.setReservedIdle(void 0,void 0),this.currentPriority!==0)return st.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(e,i)),!1}else{if(e!==this.reservedGroup||i!==this.reservedIndex)return st.log(this.tag,"Cannot start motion because another motion has taken the place.",this.dump(e,i)),!1;this.setReserved(void 0,void 0,0)}return t?(this.setCurrent(e,i,n),!0):!1}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(t,e,i){this.currentPriority=i,this.currentGroup=t,this.currentIndex=e}setReserved(t,e,i){this.reservePriority=i,this.reservedGroup=t,this.reservedIndex=e}setReservedIdle(t,e){this.reservedIdleGroup=t,this.reservedIdleIndex=e}isActive(t,e){return t===this.currentGroup&&e===this.currentIndex||t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return this.currentGroup===void 0&&this.reservedIdleGroup===void 0}shouldOverrideExpression(){return!Ht.preserveExpressionOnMotion&&this.currentPriority>1}dump(t,e){if(this.debug){const i=["currentPriority","reservePriority","currentGroup","currentIndex","reservedGroup","reservedIndex","reservedIdleGroup","reservedIdleIndex"];return`
<Requested> group = "${t}", index = ${e}
`+i.map(n=>"["+n+"] "+this[n]).join(`
`)}return""}}const gI="SoundManager",vI=.5;class Zr{static get volume(){return this._volume}static set volume(t){this._volume=(t>1?1:t<0?0:t)||0,this.audios.forEach(e=>e.volume=this._volume)}static add(t,e,i){const n=new Audio(t);return n.volume=this._volume,n.preload="auto",n.addEventListener("ended",()=>{this.dispose(n),e?.()}),n.addEventListener("error",s=>{this.dispose(n),st.warn(gI,`Error occurred on "${t}"`,s.error),i?.(s.error)}),this.audios.push(n),n}static play(t){return new Promise((e,i)=>{var n;(n=t.play())==null||n.catch(s=>{t.dispatchEvent(new ErrorEvent("error",{error:s})),i(s)}),t.readyState===t.HAVE_ENOUGH_DATA?e():t.addEventListener("canplaythrough",e)})}static dispose(t){t.pause(),t.removeAttribute("src"),cI(this.audios,t)}static destroy(){for(let t=this.audios.length-1;t>=0;t--)this.dispose(this.audios[t])}}Zr.audios=[];Zr._volume=vI;var bm=(r=>(r.ALL="ALL",r.IDLE="IDLE",r.NONE="NONE",r))(bm||{});class pa extends Or{constructor(t,e){super(),this.motionGroups={},this.state=new mI,this.playing=!1,this.destroyed=!1,this.settings=t,this.tag=`MotionManager(${t.name})`,this.state.tag=this.tag}init(t){t?.idleMotionGroup&&(this.groups.idle=t.idleMotionGroup),this.setupMotions(t),this.stopAllMotions()}setupMotions(t){for(const i of Object.keys(this.definitions))this.motionGroups[i]=[];let e;switch(t?.motionPreload){case"NONE":return;case"ALL":e=Object.keys(this.definitions);break;case"IDLE":default:e=[this.groups.idle];break}for(const i of e)if(this.definitions[i])for(let n=0;n<this.definitions[i].length;n++)this.loadMotion(i,n).then()}loadMotion(t,e){return mt(this,null,function*(){var i;if(!((i=this.definitions[t])!=null&&i[e])){st.warn(this.tag,`Undefined motion at "${t}"[${e}]`);return}if(this.motionGroups[t][e]===null){st.warn(this.tag,`Cannot start motion at "${t}"[${e}] because it's already failed in loading.`);return}if(this.motionGroups[t][e])return this.motionGroups[t][e];const n=yield this._loadMotion(t,e);if(!this.destroyed)return this.motionGroups[t][e]=n??null,n})}_loadMotion(t,e){throw new Error("Not implemented.")}startMotion(t,e){return mt(this,arguments,function*(i,n,s=ll.NORMAL){var o;if(!this.state.reserve(i,n,s))return!1;const a=(o=this.definitions[i])==null?void 0:o[n];if(!a)return!1;this.currentAudio&&Zr.dispose(this.currentAudio);let l;if(Ht.sound){const c=this.getSoundFile(a);if(c)try{l=Zr.add(this.settings.resolveURL(c),()=>this.currentAudio=void 0,()=>this.currentAudio=void 0),this.currentAudio=l}catch(p){st.warn(this.tag,"Failed to create audio",c,p)}}const h=yield this.loadMotion(i,n);if(l){const c=Zr.play(l).catch(p=>st.warn(this.tag,"Failed to play audio",l.src,p));Ht.motionSync&&(yield c)}return this.state.start(h,i,n,s)?(st.log(this.tag,"Start motion:",this.getMotionName(a)),this.emit("motionStart",i,n,l),this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),this.playing=!0,this._startMotion(h),!0):(l&&(Zr.dispose(l),this.currentAudio=void 0),!1)})}startRandomMotion(t,e){return mt(this,null,function*(){const i=this.definitions[t];if(i?.length){const n=[];for(let s=0;s<i.length;s++)this.motionGroups[t][s]!==null&&!this.state.isActive(t,s)&&n.push(s);if(n.length){const s=Math.floor(Math.random()*n.length);return this.startMotion(t,n[s],e)}}return!1})}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.currentAudio&&(Zr.dispose(this.currentAudio),this.currentAudio=void 0)}update(t,e){var i;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.shouldOverrideExpression()&&((i=this.expressionManager)==null||i.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,ll.IDLE)),this.updateParameters(t,e)}destroy(){var t;this.destroyed=!0,this.emit("destroy"),this.stopAllMotions(),(t=this.expressionManager)==null||t.destroy();const e=this;e.definitions=void 0,e.motionGroups=void 0}}const _I={x:0,y:0,width:0,height:0};class Am extends Or{constructor(){super(...arguments),this.focusController=new pI,this.originalWidth=0,this.originalHeight=0,this.width=0,this.height=0,this.localTransform=new Xt,this.drawingMatrix=new Xt,this.hitAreas={},this.textureFlipY=!1,this.viewport=[0,0,0,0],this.destroyed=!1}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const t=this,e=this.getSize();t.originalWidth=e[0],t.originalHeight=e[1];const i=Object.assign({width:Zd,height:tf},this.getLayout());this.localTransform.scale(i.width/Zd,i.height/tf),t.width=this.originalWidth*this.localTransform.a,t.height=this.originalHeight*this.localTransform.d;const n=i.x!==void 0&&i.x-i.width/2||i.centerX!==void 0&&i.centerX||i.left!==void 0&&i.left-i.width/2||i.right!==void 0&&i.right+i.width/2||0,s=i.y!==void 0&&i.y-i.height/2||i.centerY!==void 0&&i.centerY||i.top!==void 0&&i.top-i.height/2||i.bottom!==void 0&&i.bottom+i.height/2||0;this.localTransform.translate(this.width*n,-this.height*s)}setupHitAreas(){const t=this.getHitAreaDefs().filter(e=>e.index>=0);for(const e of t)this.hitAreas[e.name]=e}hitTest(t,e){return Object.keys(this.hitAreas).filter(i=>this.isHit(i,t,e))}isHit(t,e,i){if(!this.hitAreas[t])return!1;const n=this.hitAreas[t].index,s=this.getDrawableBounds(n,_I);return s.x<=e&&e<=s.x+s.width&&s.y<=i&&i<=s.y+s.height}getDrawableBounds(t,e){const i=this.getDrawableVertices(t);let n=i[0],s=i[0],o=i[1],a=i[1];for(let l=0;l<i.length;l+=2){const h=i[l],c=i[l+1];n=Math.min(h,n),s=Math.max(h,s),o=Math.min(c,o),a=Math.max(c,a)}return e??(e={}),e.x=n,e.y=o,e.width=s-n,e.height=a-o,e}updateTransform(t){this.drawingMatrix.copyFrom(t).append(this.localTransform)}update(t,e){this.focusController.update(t)}destroy(){this.destroyed=!0,this.emit("destroy"),this.motionManager.destroy(),this.motionManager=void 0}}const yI="XHRLoader";class rf extends Error{constructor(t,e,i,n=!1){super(t),this.url=e,this.status=i,this.aborted=n}}const oe=class{static createXHR(r,t,e,i,n){const s=new XMLHttpRequest;if(oe.allXhrSet.add(s),r){let o=oe.xhrMap.get(r);o?o.add(s):(o=new Set([s]),oe.xhrMap.set(r,o)),r.listeners("destroy").includes(oe.cancelXHRs)||r.once("destroy",oe.cancelXHRs)}return s.open("GET",t),s.responseType=e,s.onload=()=>{(s.status===200||s.status===0)&&s.response?i(s.response):s.onerror()},s.onerror=()=>{st.warn(yI,`Failed to load resource as ${s.responseType} (Status ${s.status}): ${t}`),n(new rf("Network error.",t,s.status))},s.onabort=()=>n(new rf("Aborted.",t,s.status,!0)),s.onloadend=()=>{var o;oe.allXhrSet.delete(s),r&&((o=oe.xhrMap.get(r))==null||o.delete(s))},s}static cancelXHRs(){var r;(r=oe.xhrMap.get(this))==null||r.forEach(t=>{t.abort(),oe.allXhrSet.delete(t)}),oe.xhrMap.delete(this)}static release(){oe.allXhrSet.forEach(r=>r.abort()),oe.allXhrSet.clear(),oe.xhrMap=new WeakMap}};let ma=oe;ma.xhrMap=new WeakMap;ma.allXhrSet=new Set;ma.loader=(r,t)=>new Promise((e,i)=>{oe.createXHR(r.target,r.settings?r.settings.resolveURL(r.url):r.url,r.type,s=>{r.result=s,e()},i).send()});function Cm(r,t){let e=-1;return i(0);function i(n,s){if(s)return Promise.reject(s);if(n<=e)return Promise.reject(new Error("next() called multiple times"));e=n;const o=r[n];if(!o)return Promise.resolve();try{return Promise.resolve(o(t,i.bind(null,n+1)))}catch(a){return Promise.reject(a)}}}class xr{static load(t){return Cm(this.middlewares,t).then(()=>t.result)}}xr.middlewares=[ma.loader];function EI(r,t={}){var e;const i={resourceOptions:{crossorigin:t.crossOrigin}};if(yo.fromURL)return yo.fromURL(r,i).catch(o=>{if(o instanceof Error)throw o;const a=new Error("Texture loading error");throw a.event=o,a});i.resourceOptions.autoLoad=!1;const n=yo.from(r,i);if(n.baseTexture.valid)return Promise.resolve(n);const s=n.baseTexture.resource;return(e=s._live2d_load)!=null||(s._live2d_load=new Promise((o,a)=>{const l=h=>{s.source.removeEventListener("error",l);const c=new Error("Texture loading error");c.event=h,a(c)};s.source.addEventListener("error",l),s.load().then(()=>o(n)).catch(l)})),s._live2d_load}const nf="Live2DFactory",xm=(r,t)=>mt(void 0,null,function*(){if(typeof r.source=="string"){const e=yield xr.load({url:r.source,type:"json",target:r.live2dModel});e.url=r.source,r.source=e,r.live2dModel.emit("settingsJSONLoaded",e)}return t()}),Pm=(r,t)=>mt(void 0,null,function*(){if(r.source instanceof fa)return r.settings=r.source,t();if(typeof r.source=="object"){const e=dt.findRuntime(r.source);if(e){const i=e.createModelSettings(r.source);return r.settings=i,r.live2dModel.emit("settingsLoaded",i),t()}}throw new TypeError("Unknown settings format.")}),Sm=(r,t)=>{if(r.settings){const e=dt.findRuntime(r.settings);if(e)return e.ready().then(t)}return t()},Rm=(r,t)=>mt(void 0,null,function*(){yield t();const e=r.internalModel;if(e){const i=r.settings,n=dt.findRuntime(i);if(n){const s=[];i.pose&&s.push(xr.load({settings:i,url:i.pose,type:"json",target:e}).then(o=>{e.pose=n.createPose(e.coreModel,o),r.live2dModel.emit("poseLoaded",e.pose)}).catch(o=>{r.live2dModel.emit("poseLoadError",o),st.warn(nf,"Failed to load pose.",o)})),i.physics&&s.push(xr.load({settings:i,url:i.physics,type:"json",target:e}).then(o=>{e.physics=n.createPhysics(e.coreModel,o),r.live2dModel.emit("physicsLoaded",e.physics)}).catch(o=>{r.live2dModel.emit("physicsLoadError",o),st.warn(nf,"Failed to load physics.",o)})),s.length&&(yield Promise.all(s))}}}),Mm=(r,t)=>mt(void 0,null,function*(){if(r.settings){const e=r.live2dModel,i=r.settings.textures.map(n=>{const s=r.settings.resolveURL(n);return EI(s,{crossOrigin:r.options.crossOrigin})});if(yield t(),r.internalModel)e.internalModel=r.internalModel,e.emit("modelLoaded",r.internalModel);else throw new TypeError("Missing internal model.");e.textures=yield Promise.all(i),e.emit("textureLoaded",e.textures)}else throw new TypeError("Missing settings.")}),Om=(r,t)=>mt(void 0,null,function*(){const e=r.settings;if(e instanceof fa){const i=dt.findRuntime(e);if(!i)throw new TypeError("Unknown model settings.");const n=yield xr.load({settings:e,url:e.moc,type:"arraybuffer",target:r.live2dModel});if(!i.isValidMoc(n))throw new Error("Invalid moc data");const s=i.createCoreModel(n);return r.internalModel=i.createInternalModel(s,e,r.options),t()}throw new TypeError("Missing settings.")}),Bt=class{static registerRuntime(r){Bt.runtimes.push(r),Bt.runtimes.sort((t,e)=>e.version-t.version)}static findRuntime(r){for(const t of Bt.runtimes)if(t.test(r))return t}static setupLive2DModel(r,t,e){return mt(this,null,function*(){const i=new Promise(o=>r.once("textureLoaded",o)),n=new Promise(o=>r.once("modelLoaded",o)),s=Promise.all([i,n]).then(()=>r.emit("ready"));yield Cm(Bt.live2DModelMiddlewares,{live2dModel:r,source:t,options:e||{}}),yield s,r.emit("load")})}static loadMotion(r,t,e){var i,n;const s=o=>r.emit("motionLoadError",t,e,o);try{const o=(i=r.definitions[t])==null?void 0:i[e];if(!o)return Promise.resolve(void 0);r.listeners("destroy").includes(Bt.releaseTasks)||r.once("destroy",Bt.releaseTasks);let a=Bt.motionTasksMap.get(r);a||(a={},Bt.motionTasksMap.set(r,a));let l=a[t];l||(l=[],a[t]=l);const h=r.getMotionFile(o);return(n=l[e])!=null||(l[e]=xr.load({url:h,settings:r.settings,type:r.motionDataType,target:r}).then(c=>{var p;const m=(p=Bt.motionTasksMap.get(r))==null?void 0:p[t];m&&delete m[e];const g=r.createMotion(c,t,o);return r.emit("motionLoaded",t,e,g),g}).catch(c=>{st.warn(r.tag,`Failed to load motion: ${h}
`,c),s(c)})),l[e]}catch(o){st.warn(r.tag,`Failed to load motion at "${t}"[${e}]
`,o),s(o)}return Promise.resolve(void 0)}static loadExpression(r,t){var e;const i=n=>r.emit("expressionLoadError",t,n);try{const n=r.definitions[t];if(!n)return Promise.resolve(void 0);r.listeners("destroy").includes(Bt.releaseTasks)||r.once("destroy",Bt.releaseTasks);let s=Bt.expressionTasksMap.get(r);s||(s=[],Bt.expressionTasksMap.set(r,s));const o=r.getExpressionFile(n);return(e=s[t])!=null||(s[t]=xr.load({url:o,settings:r.settings,type:"json",target:r}).then(a=>{const l=Bt.expressionTasksMap.get(r);l&&delete l[t];const h=r.createExpression(a,n);return r.emit("expressionLoaded",t,h),h}).catch(a=>{st.warn(r.tag,`Failed to load expression: ${o}
`,a),i(a)})),s[t]}catch(n){st.warn(r.tag,`Failed to load expression at [${t}]
`,n),i(n)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof pa?Bt.motionTasksMap.delete(this):Bt.expressionTasksMap.delete(this)}};let dt=Bt;dt.runtimes=[];dt.urlToJSON=xm;dt.jsonToSettings=Pm;dt.waitUntilReady=Sm;dt.setupOptionals=Rm;dt.setupEssentials=Mm;dt.createInternalModel=Om;dt.live2DModelMiddlewares=[xm,Pm,Sm,Rm,Mm,Om];dt.motionTasksMap=new WeakMap;dt.expressionTasksMap=new WeakMap;pa.prototype._loadMotion=function(r,t){return dt.loadMotion(this,r,t)};Kl.prototype._loadExpression=function(r){return dt.loadExpression(this,r)};class TI{constructor(){this._autoInteract=!1}get autoInteract(){return this._autoInteract}set autoInteract(t){t!==this._autoInteract&&(t?this.on("pointertap",sf,this):this.off("pointertap",sf,this),this._autoInteract=t)}registerInteraction(t){t!==this.interactionManager&&(this.unregisterInteraction(),this._autoInteract&&t&&(this.interactionManager=t,t.on("pointermove",of,this)))}unregisterInteraction(){var t;this.interactionManager&&((t=this.interactionManager)==null||t.off("pointermove",of,this),this.interactionManager=void 0)}}function sf(r){this.tap(r.data.global.x,r.data.global.y)}function of(r){this.focus(r.data.global.x,r.data.global.y)}class II extends um{}const Ee=new ae,wI=new Xt;let dr;class Jl extends Bo{constructor(t){super(),this.tag="Live2DModel(uninitialized)",this.textures=[],this.transform=new II,this.anchor=new On(this.onAnchorChange,this,0,0),this.glContextID=-1,this.elapsedTime=performance.now(),this.deltaTime=0,this._autoUpdate=!1,this.once("modelLoaded",()=>this.init(t))}static from(t,e){const i=new this(e);return dt.setupLive2DModel(i,t,e).then(()=>i)}static fromSync(t,e){const i=new this(e);return dt.setupLive2DModel(i,t,e).then(e?.onLoad).catch(e?.onError),i}static registerTicker(t){dr=t}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){var e;dr||(dr=(e=window.PIXI)==null?void 0:e.Ticker),t?this._destroyed||(dr?(dr.shared.add(this.onTickerUpdate,this),this._autoUpdate=!0):st.warn(this.tag,"No Ticker registered, please call Live2DModel.registerTicker(Ticker).")):(dr?.shared.remove(this.onTickerUpdate,this),this._autoUpdate=!1)}init(t){this.tag=`Live2DModel(${this.internalModel.settings.name})`;const e=Object.assign({autoUpdate:!0,autoInteract:!0},t);e.autoInteract&&(this.interactive=!0),this.autoInteract=e.autoInteract,this.autoUpdate=e.autoUpdate}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(t,e,i){return e===void 0?this.internalModel.motionManager.startRandomMotion(t,i):this.internalModel.motionManager.startMotion(t,e,i)}expression(t){return this.internalModel.motionManager.expressionManager?t===void 0?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(t):Promise.resolve(!1)}focus(t,e,i=!1){Ee.x=t,Ee.y=e,this.toModelPosition(Ee,Ee,!0);let n=Ee.x/this.internalModel.originalWidth*2-1,s=Ee.y/this.internalModel.originalHeight*2-1,o=Math.atan2(s,n);this.internalModel.focusController.focus(Math.cos(o),-Math.sin(o),i)}tap(t,e){const i=this.hitTest(t,e);i.length&&(st.log(this.tag,"Hit",i),this.emit("hit",i))}hitTest(t,e){return Ee.x=t,Ee.y=e,this.toModelPosition(Ee,Ee),this.internalModel.hitTest(Ee.x,Ee.y)}toModelPosition(t,e=t.clone(),i){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(t,e),this.internalModel.localTransform.applyInverse(e,e),e}containsPoint(t){return this.getBounds(!0).contains(t.x,t.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}onTickerUpdate(){this.update(dr.shared.deltaMS)}update(t){this.deltaTime+=t,this.elapsedTime+=t}_render(t){this.registerInteraction(t.plugins.interaction),t.batch.reset(),t.geometry.reset(),t.shader.reset(),t.state.reset();let e=!1;this.glContextID!==t.CONTEXT_UID&&(this.glContextID=t.CONTEXT_UID,this.internalModel.updateWebGLContext(t.gl,this.glContextID),e=!0);for(let s=0;s<this.textures.length;s++){const o=this.textures[s];!o.valid||((e||!o.baseTexture._glTextures[this.glContextID])&&(t.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),t.texture.bind(o.baseTexture,0)),this.internalModel.bindTexture(s,o.baseTexture._glTextures[this.glContextID].texture),o.baseTexture.touched=t.textureGC.count)}const i=t.framebuffer.viewport;this.internalModel.viewport=[i.x,i.y,i.width,i.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const n=wI.copyFrom(t.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(n),this.internalModel.draw(t.gl),t.state.reset(),t.texture.reset()}destroy(t){this.emit("destroy"),this.autoUpdate=!1,this.unregisterInteraction(),t?.texture&&this.textures.forEach(e=>e.destroy(t.baseTexture)),this.internalModel.destroy(),super.destroy(t)}}wm(Jl,[TI]);const Be=class{static resolveURL(r,t){var e;const i=(e=Be.filesMap[r])==null?void 0:e[t];if(i===void 0)throw new Error("Cannot find this file from uploaded files: "+t);return i}static upload(r,t){return mt(this,null,function*(){const e={};for(const i of t.getDefinedFiles()){const n=decodeURI(da.resolve(t.url,i)),s=r.find(o=>o.webkitRelativePath===n);s&&(e[i]=URL.createObjectURL(s))}Be.filesMap[t._objectURL]=e})}static createSettings(r){return mt(this,null,function*(){const t=r.find(o=>o.name.endsWith("model.json")||o.name.endsWith("model3.json"));if(!t)throw new TypeError("Settings file not found");const e=yield Be.readText(t),i=JSON.parse(e);i.url=t.webkitRelativePath;const n=dt.findRuntime(i);if(!n)throw new Error("Unknown settings JSON");const s=n.createModelSettings(i);return s._objectURL=URL.createObjectURL(t),s})}static readText(r){return mt(this,null,function*(){return new Promise((t,e)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=e,i.readAsText(r,"utf8")})})}};let Ql=Be;Ql.filesMap={};Ql.factory=(r,t)=>mt(void 0,null,function*(){if(Array.isArray(r.source)&&r.source[0]instanceof File){const e=r.source;let i=e.settings;if(!i)i=yield Be.createSettings(e);else if(!i._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings');i.validateFiles(e.map(n=>encodeURI(n.webkitRelativePath))),yield Be.upload(e,i),i.resolveURL=function(n){return Be.resolveURL(this._objectURL,n)},r.source=i,r.live2dModel.once("modelLoaded",n=>{n.once("destroy",function(){const s=this.settings._objectURL;if(URL.revokeObjectURL(s),Be.filesMap[s])for(const o of Object.values(Be.filesMap[s]))URL.revokeObjectURL(o);delete Be.filesMap[s]})})}return t()});dt.live2DModelMiddlewares.unshift(Ql.factory);const he=class{static unzip(r,t){return mt(this,null,function*(){const e=yield he.getFilePaths(r),i=[];for(const s of t.getDefinedFiles()){const o=decodeURI(da.resolve(t.url,s));e.includes(o)&&i.push(o)}const n=yield he.getFiles(r,i);for(let s=0;s<n.length;s++){const o=i[s],a=n[s];Object.defineProperty(a,"webkitRelativePath",{value:o})}return n})}static createSettings(r){return mt(this,null,function*(){const e=(yield he.getFilePaths(r)).find(o=>o.endsWith("model.json")||o.endsWith("model3.json"));if(!e)throw new Error("Settings file not found");const i=yield he.readText(r,e);if(!i)throw new Error("Empty settings file: "+e);const n=JSON.parse(i);n.url=e;const s=dt.findRuntime(n);if(!s)throw new Error("Unknown settings JSON");return s.createModelSettings(n)})}static zipReader(r,t){return mt(this,null,function*(){throw new Error("Not implemented")})}static getFilePaths(r){return mt(this,null,function*(){throw new Error("Not implemented")})}static getFiles(r,t){return mt(this,null,function*(){throw new Error("Not implemented")})}static readText(r,t){return mt(this,null,function*(){throw new Error("Not implemented")})}static releaseReader(r){}};let ga=he;ga.ZIP_PROTOCOL="zip://";ga.uid=0;ga.factory=(r,t)=>mt(void 0,null,function*(){const e=r.source;let i,n,s;if(typeof e=="string"&&(e.endsWith(".zip")||e.startsWith(he.ZIP_PROTOCOL))?(e.startsWith(he.ZIP_PROTOCOL)?i=e.slice(he.ZIP_PROTOCOL.length):i=e,n=yield xr.load({url:i,type:"blob",target:r.live2dModel})):Array.isArray(e)&&e.length===1&&e[0]instanceof File&&e[0].name.endsWith(".zip")&&(n=e[0],i=URL.createObjectURL(n),s=e.settings),n){if(!n.size)throw new Error("Empty zip file");const o=yield he.zipReader(n,i);s||(s=yield he.createSettings(o)),s._objectURL=he.ZIP_PROTOCOL+he.uid+"/"+s.url;const a=yield he.unzip(o,s);a.settings=s,r.source=a,i.startsWith("blob:")&&r.live2dModel.once("modelLoaded",l=>{l.once("destroy",function(){URL.revokeObjectURL(i)})}),he.releaseReader(o)}return t()});dt.live2DModelMiddlewares.unshift(ga.factory);if(!window.Live2D)throw new Error("Could not find Cubism 2 runtime. This plugin requires live2d.min.js to be loaded.");const bI=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(r,t){bI.call(this,r,t),t.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)};class AI extends AMotion{constructor(t){super(),this.params=[],this.setFadeIn(t.fade_in>0?t.fade_in:Ht.expressionFadingDuration),this.setFadeOut(t.fade_out>0?t.fade_out:Ht.expressionFadingDuration),Array.isArray(t.params)&&t.params.forEach(e=>{const i=e.calc||"add";if(i==="add"){const n=e.def||0;e.val-=n}else if(i==="mult"){const n=e.def||1;e.val/=n}this.params.push({calc:i,val:e.val,id:e.id})})}updateParamExe(t,e,i,n){this.params.forEach(s=>{t.setParamFloat(s.id,s.val*i)})}}class CI extends Kl{constructor(t,e){var i;super(t,e),this.queueManager=new MotionQueueManager,this.definitions=(i=this.settings.expressions)!=null?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex(e=>e.name===t)}getExpressionFile(t){return t.file}createExpression(t,e){return new AI(t)}_setExpression(t){return this.queueManager.startMotion(t)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}}class xI extends pa{constructor(t,e){super(t,e),this.groups={idle:"idle"},this.motionDataType="arraybuffer",this.queueManager=new MotionQueueManager,this.definitions=this.settings.motions,this.init(e)}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new CI(this.settings,t))}isFinished(){return this.queueManager.isFinished()}createMotion(t,e,i){const n=Live2DMotion.loadMotion(t),s=e===this.groups.idle?Ht.idleMotionFadingDuration:Ht.motionFadingDuration;return n.setFadeIn(i.fade_in>0?i.fade_in:s),n.setFadeOut(i.fade_out>0?i.fade_out:s),n}getMotionFile(t){return t.file}getMotionName(t){return t.file}getSoundFile(t){return t.sound}_startMotion(t,e){return t.onFinishHandler=e,this.queueManager.stopAllMotions(),this.queueManager.startMotion(t)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}destroy(){super.destroy(),this.queueManager=void 0}}class PI{constructor(t){this.coreModel=t,this.blinkInterval=4e3,this.closingDuration=100,this.closedDuration=50,this.openingDuration=150,this.eyeState=0,this.eyeParamValue=1,this.closedTimer=0,this.nextBlinkTimeLeft=this.blinkInterval,this.leftParam=t.getParamIndex("PARAM_EYE_L_OPEN"),this.rightParam=t.getParamIndex("PARAM_EYE_R_OPEN")}setEyeParams(t){this.eyeParamValue=Uo(t,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(t){switch(this.eyeState){case 0:this.nextBlinkTimeLeft-=t,this.nextBlinkTimeLeft<0&&(this.eyeState=1,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+lI(0,2e3));break;case 1:this.setEyeParams(this.eyeParamValue+t/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=2,this.closedTimer=0);break;case 2:this.closedTimer+=t,this.closedTimer>=this.closedDuration&&(this.eyeState=3);break;case 3:this.setEyeParams(this.eyeParamValue+t/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=0)}}}const Gr=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class SI extends Am{constructor(t,e,i){super(),this.textureFlipY=!0,this.drawDataCount=0,this.disableCulling=!1,this.coreModel=t,this.settings=e,this.motionManager=new xI(e,i),this.eyeBlink=new PI(t),this.eyeballXParamIndex=t.getParamIndex("PARAM_EYE_BALL_X"),this.eyeballYParamIndex=t.getParamIndex("PARAM_EYE_BALL_Y"),this.angleXParamIndex=t.getParamIndex("PARAM_ANGLE_X"),this.angleYParamIndex=t.getParamIndex("PARAM_ANGLE_Y"),this.angleZParamIndex=t.getParamIndex("PARAM_ANGLE_Z"),this.bodyAngleXParamIndex=t.getParamIndex("PARAM_BODY_ANGLE_X"),this.breathParamIndex=t.getParamIndex("PARAM_BREATH"),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach(({id:s,value:o})=>this.coreModel.setParamFloat(s,o)),this.settings.initOpacities&&this.settings.initOpacities.forEach(({id:s,value:o})=>this.coreModel.setPartsOpacity(s,o)),this.coreModel.saveParam();const t=this.coreModel.getModelContext()._$aS;t?.length&&(this.drawDataCount=t.length);let e=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,"culling",{set:s=>e=s,get:()=>this.disableCulling?!1:e});const i=this.coreModel.getModelContext().clipManager,n=i.setupClip;i.setupClip=(s,o)=>{n.call(i,s,o),o.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const t={};if(this.settings.layout)for(const e of Object.keys(this.settings.layout)){let i=e;e==="center_x"?i="centerX":e==="center_y"&&(i="centerY"),t[i]=this.settings.layout[e]}return t}updateWebGLContext(t,e){const i=this.coreModel.drawParamWebGL;i.firstDraw=!0,i.setGL(t),i.glno=e;for(const o in i)i.hasOwnProperty(o)&&i[o]instanceof WebGLBuffer&&(i[o]=null);const n=this.coreModel.getModelContext().clipManager;n.curFrameNo=e;const s=t.getParameter(t.FRAMEBUFFER_BINDING);n.getMaskRenderTexture(),t.bindFramebuffer(t.FRAMEBUFFER,s)}bindTexture(t,e){this.coreModel.setTexture(t,e)}getHitAreaDefs(){var t;return((t=this.settings.hitAreas)==null?void 0:t.map(e=>({id:e.id,name:e.name,index:this.coreModel.getDrawDataIndex(e.id)})))||[]}getDrawableIDs(){const t=this.coreModel.getModelContext(),e=[];for(let i=0;i<this.drawDataCount;i++){const n=t.getDrawData(i);n&&e.push(n.getDrawDataID().id)}return e}getDrawableIndex(t){return this.coreModel.getDrawDataIndex(t)}getDrawableVertices(t){if(typeof t=="string"&&(t=this.coreModel.getDrawDataIndex(t),t===-1))throw new TypeError("Unable to find drawable ID: "+t);return this.coreModel.getTransformedPoints(t).slice()}update(t,e){var i,n,s,o;super.update(t,e);const a=this.coreModel;this.emit("beforeMotionUpdate");const l=this.motionManager.update(this.coreModel,e);this.emit("afterMotionUpdate"),a.saveParam(),(i=this.motionManager.expressionManager)==null||i.update(a,e),l||(n=this.eyeBlink)==null||n.update(t),this.updateFocus(),this.updateNaturalMovements(t,e),(s=this.physics)==null||s.update(e),(o=this.pose)==null||o.update(t),this.emit("beforeModelUpdate"),a.update(),a.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,this.focusController.x*30),this.coreModel.addToParamFloat(this.angleYParamIndex,this.focusController.y*30),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,this.focusController.x*10)}updateNaturalMovements(t,e){const i=e/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*Math.sin(i/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*Math.sin(i/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*Math.sin(i/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*Math.sin(i/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(i/3.2345))}draw(t){const e=this.disableCulling;t.getParameter(t.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const i=this.drawingMatrix;Gr[0]=i.a,Gr[1]=i.b,Gr[4]=i.c,Gr[5]=i.d,Gr[12]=i.tx,Gr[13]=i.ty,this.coreModel.setMatrix(Gr),this.coreModel.draw(),this.disableCulling=e}destroy(){super.destroy(),this.coreModel=void 0}}class Hn extends fa{constructor(t){if(super(t),this.motions={},!Hn.isValidJSON(t))throw new TypeError("Invalid JSON.");this.moc=t.model,Pn("string",t,this,"textures","textures"),this.copy(t)}static isValidJSON(t){var e;return!!t&&typeof t.model=="string"&&((e=t.textures)==null?void 0:e.length)>0&&t.textures.every(i=>typeof i=="string")}copy(t){xn("string",t,this,"name","name"),xn("string",t,this,"pose","pose"),xn("string",t,this,"physics","physics"),xn("object",t,this,"layout","layout"),xn("object",t,this,"motions","motions"),Pn("object",t,this,"hit_areas","hitAreas"),Pn("object",t,this,"expressions","expressions"),Pn("object",t,this,"init_params","initParams"),Pn("object",t,this,"init_opacities","initOpacities")}replaceFiles(t){super.replaceFiles(t);for(const[e,i]of Object.entries(this.motions))for(let n=0;n<i.length;n++)i[n].file=t(i[n].file,`motions.${e}[${n}].file`),i[n].sound!==void 0&&(i[n].sound=t(i[n].sound,`motions.${e}[${n}].sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].file=t(this.expressions[e].file,`expressions[${e}].file`)}}const RI={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},MI={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class OI{constructor(t,e){this.coreModel=t,this.physicsHairs=[],e.physics_hair&&(this.physicsHairs=e.physics_hair.map(i=>{const n=new PhysicsHair;return n.setup(i.setup.length,i.setup.regist,i.setup.mass),i.src.forEach(({id:s,ptype:o,scale:a,weight:l})=>{const h=RI[o];h&&n.addSrcParam(h,s,a,l)}),i.targets.forEach(({id:s,ptype:o,scale:a,weight:l})=>{const h=MI[o];h&&n.addTargetParam(h,s,a,l)}),n}))}update(t){this.physicsHairs.forEach(e=>e.update(this.coreModel,t))}}class af{constructor(t){this.id=t,this.paramIndex=-1,this.partsIndex=-1,this.link=[]}initIndex(t){this.paramIndex=t.getParamIndex("VISIBLE:"+this.id),this.partsIndex=t.getPartsDataIndex(PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)}}class FI{constructor(t,e){this.coreModel=t,this.opacityAnimDuration=500,this.partsGroups=[],e.parts_visible&&(this.partsGroups=e.parts_visible.map(({group:i})=>i.map(({id:n,link:s})=>{const o=new af(n);return s&&(o.link=s.map(a=>new af(a))),o})),this.init())}init(){this.partsGroups.forEach(t=>{t.forEach(e=>{if(e.initIndex(this.coreModel),e.paramIndex>=0){const i=this.coreModel.getParamFloat(e.paramIndex)!==0;this.coreModel.setPartsOpacity(e.partsIndex,i?1:0),this.coreModel.setParamFloat(e.paramIndex,i?1:0),e.link.length>0&&e.link.forEach(n=>n.initIndex(this.coreModel))}})})}normalizePartsOpacityGroup(t,e){const i=this.coreModel,n=.5,s=.15;let o=1,a=t.findIndex(({paramIndex:l,partsIndex:h})=>h>=0&&i.getParamFloat(l)!==0);if(a>=0){const l=i.getPartsOpacity(t[a].partsIndex);o=Uo(l+e/this.opacityAnimDuration,0,1)}else a=0,o=1;t.forEach(({partsIndex:l},h)=>{if(l>=0)if(a==h)i.setPartsOpacity(l,o);else{let c=i.getPartsOpacity(l),p;o<n?p=o*(n-1)/n+1:p=(1-o)*n/(1-n),(1-p)*(1-o)>s&&(p=1-s/(1-o)),c>p&&(c=p),i.setPartsOpacity(l,c)}})}copyOpacity(t){const e=this.coreModel;t.forEach(({partsIndex:i,link:n})=>{if(i>=0&&n){const s=e.getPartsOpacity(i);n.forEach(({partsIndex:o})=>{o>=0&&e.setPartsOpacity(o,s)})}})}update(t){this.partsGroups.forEach(e=>{this.normalizePartsOpacityGroup(e,t),this.copyOpacity(e)})}}dt.registerRuntime({version:2,test(r){return r instanceof Hn||Hn.isValidJSON(r)},ready(){return Promise.resolve()},isValidMoc(r){if(r.byteLength<3)return!1;const t=new Int8Array(r,0,3);return String.fromCharCode(...t)==="moc"},createModelSettings(r){return new Hn(r)},createCoreModel(r){const t=Live2DModelWebGL.loadModel(r),e=Live2D.getError();if(e)throw e;return t},createInternalModel(r,t,e){return new SI(r,t,e)},createPose(r,t){return new FI(r,t)},createPhysics(r,t){return new OI(r,t)}});if(!window.Live2DCubismCore)throw new Error("Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.");class X{constructor(t,e){this.x=t||0,this.y=e||0}add(t){const e=new X(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new X(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new X(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new X(t,t))}division(t){const e=new X(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new X(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}const Eo=class{static range(r,t,e){return r<t?r=t:r>e&&(r=e),r}static sin(r){return Math.sin(r)}static cos(r){return Math.cos(r)}static abs(r){return Math.abs(r)}static sqrt(r){return Math.sqrt(r)}static cbrt(r){if(r===0)return r;let t=r;const e=t<0;e&&(t=-t);let i;return t===1/0?i=1/0:(i=Math.exp(Math.log(t)/3),i=(t/(i*i)+2*i)/3),e?-i:i}static getEasingSine(r){return r<0?0:r>1?1:.5-.5*this.cos(r*Math.PI)}static max(r,t){return r>t?r:t}static min(r,t){return r>t?t:r}static degreesToRadian(r){return r/180*Math.PI}static radianToDegrees(r){return r*180/Math.PI}static directionToRadian(r,t){const e=Math.atan2(t.y,t.x),i=Math.atan2(r.y,r.x);let n=e-i;for(;n<-Math.PI;)n+=Math.PI*2;for(;n>Math.PI;)n-=Math.PI*2;return n}static directionToDegrees(r,t){const e=this.directionToRadian(r,t);let i=this.radianToDegrees(e);return t.x-r.x>0&&(i=-i),i}static radianToDirection(r){const t=new X;return t.x=this.sin(r),t.y=this.cos(r),t}static quadraticEquation(r,t,e){return this.abs(r)<Eo.Epsilon?this.abs(t)<Eo.Epsilon?-e:-e/t:-(t+this.sqrt(t*t-4*r*e))/(2*r)}static cardanoAlgorithmForBezier(r,t,e,i){if(this.sqrt(r)<Eo.Epsilon)return this.range(this.quadraticEquation(t,e,i),0,1);const n=t/r,s=e/r,o=i/r,a=(3*s-n*n)/3,l=a/3,h=(2*n*n*n-9*n*s+27*o)/27,c=h/2,p=c*c+l*l*l,m=.5,g=m+.01;if(p<0){const M=-a/3,x=M*M*M,F=this.sqrt(x),B=-h/(2*F),N=this.range(B,-1,1),b=Math.acos(N),T=2*this.cbrt(F),w=T*this.cos(b/3)-n/3;if(this.abs(w-m)<g)return this.range(w,0,1);const C=T*this.cos((b+2*Math.PI)/3)-n/3;if(this.abs(C-m)<g)return this.range(C,0,1);const P=T*this.cos((b+4*Math.PI)/3)-n/3;return this.range(P,0,1)}if(p==0){let M;c<0?M=this.cbrt(-c):M=-this.cbrt(c);const x=2*M-n/3;if(this.abs(x-m)<g)return this.range(x,0,1);const F=-M-n/3;return this.range(F,0,1)}const _=this.sqrt(p),A=this.cbrt(_-c),y=this.cbrt(_+c),S=A-y-n/3;return this.range(S,0,1)}constructor(){}};let ot=Eo;ot.Epsilon=1e-5;class we{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const n=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),s=4;for(let o=0;o<s;++o)for(let a=0;a<s;++a)for(let l=0;l<s;++l)n[a+o*4]+=t[l+o*4]*e[a+l*4];for(let o=0;o<16;++o)i[o]=n[o]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);we.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);we.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){we.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new we;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}class Zl{initialize(t){this._model=t}drawModel(){this.getModel()!=null&&this.doDrawModel()}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,n){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),n<0?n=0:n>1&&(n=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=n}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisortopy=t}getAnisotropy(){return this._anisortopy}getModel(){return this._model}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisortopy=0,this._modelColor=new Fn,this._mvpMatrix4x4=new we,this._mvpMatrix4x4.loadIdentity()}}var Tr=(r=>(r[r.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",r[r.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",r[r.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",r))(Tr||{});class Fn{constructor(){this.R=1,this.G=1,this.B=1,this.A=1}}let De=!1,Pi=!1,Si;const Au={vertexOffset:0,vertexStep:2};class ns{static startUp(t){if(De)return Sn("CubismFramework.startUp() is already done."),De;if(Live2DCubismCore._isStarted)return De=!0,!0;if(Live2DCubismCore._isStarted=!0,Si=t,Si&&Live2DCubismCore.Logging.csmSetLogFunction(Si.logFunction),De=!0,De){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,n=(e&16711680)>>16,s=e&65535,o=e;Sn("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+n).slice(-2),("0000"+s).slice(-4),o)}return Sn("CubismFramework.startUp() is complete."),De}static cleanUp(){De=!1,Pi=!1,Si=void 0}static initialize(){if(!De){Dn("CubismFramework is not started.");return}if(Pi){Dn("CubismFramework.initialize() skipped, already initialized.");return}Pi=!0,Sn("CubismFramework.initialize() is complete.")}static dispose(){if(!De){Dn("CubismFramework is not started.");return}if(!Pi){Dn("CubismFramework.dispose() skipped, not initialized.");return}Zl.staticRelease(),Pi=!1,Sn("CubismFramework.dispose() is complete.")}static isStarted(){return De}static isInitialized(){return Pi}static coreLogFunction(t){!Live2DCubismCore.Logging.csmGetLogFunction()||Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return Si!=null?Si.loggingLevel:vi.LogLevel_Off}constructor(){}}var vi=(r=>(r[r.LogLevel_Verbose=0]="LogLevel_Verbose",r[r.LogLevel_Debug=1]="LogLevel_Debug",r[r.LogLevel_Info=2]="LogLevel_Info",r[r.LogLevel_Warning=3]="LogLevel_Warning",r[r.LogLevel_Error=4]="LogLevel_Error",r[r.LogLevel_Off=5]="LogLevel_Off",r))(vi||{});const oo=()=>{};function uf(r,...t){va.print(vi.LogLevel_Debug,"[CSM][D]"+r+`
`,t)}function Sn(r,...t){va.print(vi.LogLevel_Info,"[CSM][I]"+r+`
`,t)}function Dn(r,...t){va.print(vi.LogLevel_Warning,"[CSM][W]"+r+`
`,t)}function Mi(r,...t){va.print(vi.LogLevel_Error,"[CSM][E]"+r+`
`,t)}class va{static print(t,e,i){if(t<ns.getLoggingLevel())return;const n=ns.coreLogFunction;if(!n)return;const s=e.replace(/{(\d+)}/g,(o,a)=>i[a]);n(s)}static dumpBytes(t,e,i){for(let n=0;n<i;n++)n%16==0&&n>0?this.print(t,`
`):n%8==0&&n>0&&this.print(t,"  "),this.print(t,"{0} ",[e[n]&255]);this.print(t,`
`)}constructor(){}}class Fm{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const a=this.getDuration();e.getEndTime()<0&&e.setEndTime(a<=0?-1:e.getStartTime()+a)}let n=this._weight;const s=this._fadeInSeconds==0?1:ot.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds),o=this._fadeOutSeconds==0||e.getEndTime()<0?1:ot.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds);n=n*s*o,e.setState(i,n),this.doUpdateParameters(t,i,n,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}setFinishedMotionHandler(t){this._onFinishedMotion=t}getFinishedMotionHandler(){return this._onFinishedMotion}}const lf=1;class th extends Fm{constructor(){super(),this._parameters=[]}static create(t){const e=new th,i=t.FadeInTime,n=t.FadeOutTime;e.setFadeInTime(i!==void 0?i:lf),e.setFadeOutTime(n!==void 0?n:lf);const s=t.Parameters||[];for(let o=0;o<s.length;++o){const a=s[o],l=a.Id,h=a.Value;let c;switch(a.Blend){case"Multiply":c=Wr.ExpressionBlendType_Multiply;break;case"Overwrite":c=Wr.ExpressionBlendType_Overwrite;break;case"Add":default:c=Wr.ExpressionBlendType_Add;break}const p={parameterId:l,blendType:c,value:h};e._parameters.push(p)}return e}doUpdateParameters(t,e,i,n){for(let s=0;s<this._parameters.length;++s){const o=this._parameters[s];switch(o.blendType){case Wr.ExpressionBlendType_Add:{t.addParameterValueById(o.parameterId,o.value,i);break}case Wr.ExpressionBlendType_Multiply:{t.multiplyParameterValueById(o.parameterId,o.value,i);break}case Wr.ExpressionBlendType_Overwrite:{t.setParameterValueById(o.parameterId,o.value,i);break}}}}}var Wr=(r=>(r[r.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",r[r.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",r[r.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite",r))(Wr||{});class DI{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class Dm{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let t=0;t<this._motions.length;++t)this._motions[t]&&this._motions[t].release();this._motions=void 0}startMotion(t,e,i){if(t==null)return LI;let n;for(let s=0;s<this._motions.length;++s)n=this._motions[s],n?.setFadeOut(n._motion.getFadeOutTime());return n=new DI,n._autoDelete=e,n._motion=t,this._motions.push(n),n._motionQueueEntryHandle}isFinished(){let t=0;for(;t<this._motions.length;){const e=this._motions[t];if(e==null){this._motions.splice(t,1);continue}if(e._motion==null){e.release(),this._motions.splice(t,1);continue}if(!e.isFinished())return!1;t++}return!0}isFinishedByHandle(t){for(let e=0;e<this._motions.length;e++){const i=this._motions[e];if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=0;t<this._motions.length;t++){const e=this._motions[t];e?.release()}this._motions=[]}getCubismMotionQueueEntry(t){return this._motions.find(e=>e!=null&&e._motionQueueEntryHandle==t)}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1,n=0;for(;n<this._motions.length;){const s=this._motions[n];if(s==null){this._motions.splice(n,1);continue}const o=s._motion;if(o==null){s.release(),this._motions.splice(n,1);continue}o.updateParameters(t,s,e),i=!0;const a=o.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),e-s.getStartTime());for(let l=0;l<a.length;++l)this._eventCallBack(this,a[l],this._eventCustomData);s.setLastCheckEventSeconds(e),s.isFinished()?(s.release(),this._motions.splice(n,1)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),e),n++)}return i}}const LI=-1;class NI extends Kl{constructor(t,e){var i;super(t,e),this.queueManager=new Dm,this.definitions=(i=t.expressions)!=null?i:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex(e=>e.Name===t)}getExpressionFile(t){return t.File}createExpression(t,e){return th.create(t)}_setExpression(t){return this.queueManager.startMotion(t,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}}class Lm{constructor(t){this.groups=t.Groups,this.hitAreas=t.HitAreas,this.layout=t.Layout,this.moc=t.FileReferences.Moc,this.expressions=t.FileReferences.Expressions,this.motions=t.FileReferences.Motions,this.textures=t.FileReferences.Textures,this.physics=t.FileReferences.Physics,this.pose=t.FileReferences.Pose}getEyeBlinkParameters(){var t,e;return(e=(t=this.groups)==null?void 0:t.find(i=>i.Name==="EyeBlink"))==null?void 0:e.Ids}getLipSyncParameters(){var t,e;return(e=(t=this.groups)==null?void 0:t.find(i=>i.Name==="LipSync"))==null?void 0:e.Ids}}class Gi extends fa{constructor(t){if(super(t),!Gi.isValidJSON(t))throw new TypeError("Invalid JSON.");Object.assign(this,new Lm(t))}static isValidJSON(t){var e;return!!t?.FileReferences&&typeof t.FileReferences.Moc=="string"&&((e=t.FileReferences.Textures)==null?void 0:e.length)>0&&t.FileReferences.Textures.every(i=>typeof i=="string")}replaceFiles(t){if(super.replaceFiles(t),this.motions)for(const[e,i]of Object.entries(this.motions))for(let n=0;n<i.length;n++)i[n].File=t(i[n].File,`motions.${e}[${n}].File`),i[n].Sound!==void 0&&(i[n].Sound=t(i[n].Sound,`motions.${e}[${n}].Sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].File=t(this.expressions[e].File,`expressions[${e}].File`)}}wm(Gi,[Lm]);var qr=(r=>(r[r.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",r[r.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",r[r.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",r))(qr||{}),Le=(r=>(r[r.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",r[r.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",r[r.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",r[r.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",r))(Le||{});class pr{constructor(t=0,e=0){this.time=t,this.value=e}}class kI{constructor(){this.basePointIndex=0,this.segmentType=0}}class BI{constructor(){this.id="",this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class UI{constructor(){this.fireTime=0,this.value=""}}class VI{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class Nm{constructor(t){this._json=t}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(t){return eh.EvaluationOptionFlag_AreBeziersRistricted==t?!!this._json.Meta.AreBeziersRestricted:!1}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(t){return this._json.Curves[t].Target}getMotionCurveId(t){return this._json.Curves[t].Id}getMotionCurveFadeInTime(t){return this._json.Curves[t].FadeInTime}getMotionCurveFadeOutTime(t){return this._json.Curves[t].FadeOutTime}getMotionCurveSegmentCount(t){return this._json.Curves[t].Segments.length}getMotionCurveSegment(t,e){return this._json.Curves[t].Segments[e]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(t){return this._json.UserData[t].Time}getEventValue(t){return this._json.UserData[t].Value}}var eh=(r=>(r[r.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",r))(eh||{});const GI="EyeBlink",jI="LipSync",HI="Model",$I="Parameter",zI="PartOpacity",XI=!1;function Ie(r,t,e){const i=new pr;return i.time=r.time+(t.time-r.time)*e,i.value=r.value+(t.value-r.value)*e,i}function WI(r,t){let e=(t-r[0].time)/(r[1].time-r[0].time);return e<0&&(e=0),r[0].value+(r[1].value-r[0].value)*e}function qI(r,t){let e=(t-r[0].time)/(r[3].time-r[0].time);e<0&&(e=0);const i=Ie(r[0],r[1],e),n=Ie(r[1],r[2],e),s=Ie(r[2],r[3],e),o=Ie(i,n,e),a=Ie(n,s,e);return Ie(o,a,e).value}function YI(r,t){const e=t,i=r[0].time,n=r[3].time,s=r[1].time,o=r[2].time,a=n-3*o+3*s-i,l=3*o-6*s+3*i,h=3*s-3*i,c=i-e,p=ot.cardanoAlgorithmForBezier(a,l,h,c),m=Ie(r[0],r[1],p),g=Ie(r[1],r[2],p),_=Ie(r[2],r[3],p),A=Ie(m,g,p),y=Ie(g,_,p);return Ie(A,y,p).value}function KI(r,t){return r[0].value}function JI(r,t){return r[1].value}function Cu(r,t,e){const i=r.curves[t];let n=-1;const s=i.baseSegmentIndex+i.segmentCount;let o=0;for(let l=i.baseSegmentIndex;l<s;++l)if(o=r.segments[l].basePointIndex+(r.segments[l].segmentType==Le.CubismMotionSegmentType_Bezier?3:1),r.points[o].time>e){n=l;break}if(n==-1)return r.points[o].value;const a=r.segments[n];return a.evaluate(r.points.slice(a.basePointIndex),e)}class rh extends Fm{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0}static create(t,e){const i=new rh;return i.parse(t),i._sourceFrameRate=i._motionData.fps,i._loopDurationSeconds=i._motionData.duration,i._onFinishedMotion=e,i}doUpdateParameters(t,e,i,n){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=GI),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=jI);let s=e-n.getStartTime();s<0&&(s=0);let o=Number.MAX_VALUE,a=Number.MAX_VALUE;const l=64;let h=0,c=0;this._eyeBlinkParameterIds.length>l&&uf("too many eye blink targets : {0}",this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>l&&uf("too many lip sync targets : {0}",this._lipSyncParameterIds.length);const p=this._fadeInSeconds<=0?1:ot.getEasingSine((e-n.getFadeInStartTime())/this._fadeInSeconds),m=this._fadeOutSeconds<=0||n.getEndTime()<0?1:ot.getEasingSine((n.getEndTime()-e)/this._fadeOutSeconds);let g,_,A,y=s;if(this._isLoop)for(;y>this._motionData.duration;)y-=this._motionData.duration;const S=this._motionData.curves;for(_=0;_<this._motionData.curveCount&&S[_].type==qr.CubismMotionCurveTarget_Model;++_)g=Cu(this._motionData,_,y),S[_].id==this._modelCurveIdEyeBlink?a=g:S[_].id==this._modelCurveIdLipSync&&(o=g);for(;_<this._motionData.curveCount&&S[_].type==qr.CubismMotionCurveTarget_Parameter;++_){if(A=t.getParameterIndex(S[_].id),A==-1)continue;const M=t.getParameterValueByIndex(A);if(g=Cu(this._motionData,_,y),a!=Number.MAX_VALUE){for(let F=0;F<this._eyeBlinkParameterIds.length&&F<l;++F)if(this._eyeBlinkParameterIds[F]==S[_].id){g*=a,c|=1<<F;break}}if(o!=Number.MAX_VALUE){for(let F=0;F<this._lipSyncParameterIds.length&&F<l;++F)if(this._lipSyncParameterIds[F]==S[_].id){g+=o,h|=1<<F;break}}let x;if(S[_].fadeInTime<0&&S[_].fadeOutTime<0)x=M+(g-M)*i;else{let F,B;S[_].fadeInTime<0?F=p:F=S[_].fadeInTime==0?1:ot.getEasingSine((e-n.getFadeInStartTime())/S[_].fadeInTime),S[_].fadeOutTime<0?B=m:B=S[_].fadeOutTime==0||n.getEndTime()<0?1:ot.getEasingSine((n.getEndTime()-e)/S[_].fadeOutTime);const N=this._weight*F*B;x=M+(g-M)*N}t.setParameterValueByIndex(A,x,1)}{if(a!=Number.MAX_VALUE)for(let M=0;M<this._eyeBlinkParameterIds.length&&M<l;++M){const x=t.getParameterValueById(this._eyeBlinkParameterIds[M]);if(c>>M&1)continue;const F=x+(a-x)*i;t.setParameterValueById(this._eyeBlinkParameterIds[M],F)}if(o!=Number.MAX_VALUE)for(let M=0;M<this._lipSyncParameterIds.length&&M<l;++M){const x=t.getParameterValueById(this._lipSyncParameterIds[M]);if(h>>M&1)continue;const F=x+(o-x)*i;t.setParameterValueById(this._lipSyncParameterIds[M],F)}}for(;_<this._motionData.curveCount&&S[_].type==qr.CubismMotionCurveTarget_PartOpacity;++_)if(g=Cu(this._motionData,_,y),is.setOpacityFromMotion)t.setPartOpacityById(S[_].id,g);else{if(A=t.getParameterIndex(S[_].id),A==-1)continue;t.setParameterValueByIndex(A,g)}s>=this._motionData.duration&&(this._isLoop?(n.setStartTime(e),this._isLoopFadeIn&&n.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),n.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let n=0;n<this._motionData.curveCount;++n)if(t==i[n].id){i[n].fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let n=0;n<this._motionData.curveCount;++n)if(t==i[n].id){i[n].fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e[i].id)return e[i].fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e[i].id)return e[i].fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0}parse(t){this._motionData=new VI;let e=new Nm(t);this._motionData.duration=e.getMotionDuration(),this._motionData.loop=e.isMotionLoop(),this._motionData.curveCount=e.getMotionCurveCount(),this._motionData.fps=e.getMotionFps(),this._motionData.eventCount=e.getEventCount();const i=e.getEvaluationOptionFlag(eh.EvaluationOptionFlag_AreBeziersRistricted),n=e.getMotionFadeInTime(),s=e.getMotionFadeOutTime();n!==void 0?this._fadeInSeconds=n<0?1:n:this._fadeInSeconds=1,s!==void 0?this._fadeOutSeconds=s<0?1:s:this._fadeOutSeconds=1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map(()=>new BI),this._motionData.segments=Array.from({length:e.getMotionTotalSegmentCount()}).map(()=>new kI),this._motionData.events=Array.from({length:this._motionData.eventCount}).map(()=>new UI),this._motionData.points=[];let o=0,a=0;for(let l=0;l<this._motionData.curveCount;++l){const h=this._motionData.curves[l];switch(e.getMotionCurveTarget(l)){case HI:h.type=qr.CubismMotionCurveTarget_Model;break;case $I:h.type=qr.CubismMotionCurveTarget_Parameter;break;case zI:h.type=qr.CubismMotionCurveTarget_PartOpacity;break;default:Dn('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!')}h.id=e.getMotionCurveId(l),h.baseSegmentIndex=a;const c=e.getMotionCurveFadeInTime(l),p=e.getMotionCurveFadeOutTime(l);h.fadeInTime=c!==void 0?c:-1,h.fadeOutTime=p!==void 0?p:-1;for(let m=0;m<e.getMotionCurveSegmentCount(l);){switch(m==0?(this._motionData.segments[a].basePointIndex=o,this._motionData.points[o]=new pr(e.getMotionCurveSegment(l,m),e.getMotionCurveSegment(l,m+1)),o+=1,m+=2):this._motionData.segments[a].basePointIndex=o-1,e.getMotionCurveSegment(l,m)){case Le.CubismMotionSegmentType_Linear:{this._motionData.segments[a].segmentType=Le.CubismMotionSegmentType_Linear,this._motionData.segments[a].evaluate=WI,this._motionData.points[o]=new pr(e.getMotionCurveSegment(l,m+1),e.getMotionCurveSegment(l,m+2)),o+=1,m+=3;break}case Le.CubismMotionSegmentType_Bezier:{this._motionData.segments[a].segmentType=Le.CubismMotionSegmentType_Bezier,i||XI?this._motionData.segments[a].evaluate=qI:this._motionData.segments[a].evaluate=YI,this._motionData.points[o]=new pr(e.getMotionCurveSegment(l,m+1),e.getMotionCurveSegment(l,m+2)),this._motionData.points[o+1]=new pr(e.getMotionCurveSegment(l,m+3),e.getMotionCurveSegment(l,m+4)),this._motionData.points[o+2]=new pr(e.getMotionCurveSegment(l,m+5),e.getMotionCurveSegment(l,m+6)),o+=3,m+=7;break}case Le.CubismMotionSegmentType_Stepped:{this._motionData.segments[a].segmentType=Le.CubismMotionSegmentType_Stepped,this._motionData.segments[a].evaluate=KI,this._motionData.points[o]=new pr(e.getMotionCurveSegment(l,m+1),e.getMotionCurveSegment(l,m+2)),o+=1,m+=3;break}case Le.CubismMotionSegmentType_InverseStepped:{this._motionData.segments[a].segmentType=Le.CubismMotionSegmentType_InverseStepped,this._motionData.segments[a].evaluate=JI,this._motionData.points[o]=new pr(e.getMotionCurveSegment(l,m+1),e.getMotionCurveSegment(l,m+2)),o+=1,m+=3;break}}++h.segmentCount,++a}this._motionData.curves.push(h)}for(let l=0;l<e.getEventCount();++l)this._motionData.events[l].fireTime=e.getEventTime(l),this._motionData.events[l].value=e.getEventValue(l);e.release()}getFiredEvent(t,e){this._firedEventValues.length=0;for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events[i].fireTime>t&&this._motionData.events[i].fireTime<=e&&this._firedEventValues.push(this._motionData.events[i].value);return this._firedEventValues}}class QI extends pa{constructor(t,e){var i;super(t,e),this.groups={idle:"Idle"},this.motionDataType="json",this.queueManager=new Dm,this.definitions=(i=t.motions)!=null?i:{},this.eyeBlinkIds=t.getEyeBlinkParameters()||[],this.lipSyncIds=t.getLipSyncParameters()||[],this.init(e)}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new NI(this.settings,t)),this.queueManager.setEventCallback((e,i,n)=>{this.emit("motion:"+i)})}isFinished(){return this.queueManager.isFinished()}_startMotion(t,e){return t.setFinishedMotionHandler(e),this.queueManager.stopAllMotions(),this.queueManager.startMotion(t,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(t,e,i){const n=rh.create(t),s=new Nm(t),o=(e===this.groups.idle?Ht.idleMotionFadingDuration:Ht.motionFadingDuration)/1e3;return s.getMotionFadeInTime()===void 0&&n.setFadeInTime(i.FadeInTime>0?i.FadeInTime:o),s.getMotionFadeOutTime()===void 0&&n.setFadeOutTime(i.FadeOutTime>0?i.FadeOutTime:o),n.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),n}getMotionFile(t){return t.File}getMotionName(t){return t.File}getSoundFile(t){return t.Sound}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}const ZI="ParamAngleX",tw="ParamAngleY",ew="ParamAngleZ",rw="ParamEyeBallX",iw="ParamEyeBallY",nw="ParamBodyAngleX",sw="ParamBreath";class ih{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new ih}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let n=0;n<this._breathParameters.length;++n){const s=this._breathParameters[n];t.addParameterValueById(s.parameterId,s.offset+s.peak*Math.sin(i/s.cycle),s.weight)}}}class Rn{constructor(t,e,i,n,s){this.parameterId=t??void 0,this.offset=e??0,this.peak=i??0,this.cycle=n??0,this.weight=s??0}}const hl=class{static create(r){return new hl(r)}setBlinkingInterval(r){this._blinkingIntervalSeconds=r}setBlinkingSetting(r,t,e){this._closingSeconds=r,this._closedSeconds=t,this._openingSeconds=e}setParameterIds(r){this._parameterIds=r}getParameterIds(){return this._parameterIds}updateParameters(r,t){this._userTimeSeconds+=t;let e,i=0;switch(this._blinkingState){case Te.EyeState_Closing:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,i>=1&&(i=1,this._blinkingState=Te.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),e=1-i;break;case Te.EyeState_Closed:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,i>=1&&(this._blinkingState=Te.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),e=0;break;case Te.EyeState_Opening:i=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,i>=1&&(i=1,this._blinkingState=Te.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),e=i;break;case Te.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=Te.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),e=1;break;case Te.EyeState_First:default:this._blinkingState=Te.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),e=1;break}hl.CloseIfZero||(e=-e);for(let n=0;n<this._parameterIds.length;++n)r.setParameterValueById(this._parameterIds[n],e)}constructor(r){var t,e;this._blinkingState=Te.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],r!=null&&(this._parameterIds=(e=(t=r.getEyeBlinkParameters())==null?void 0:t.slice())!=null?e:this._parameterIds)}determinNextBlinkingTiming(){const r=Math.random();return this._userTimeSeconds+r*(2*this._blinkingIntervalSeconds-1)}};let km=hl;km.CloseIfZero=!0;var Te=(r=>(r[r.EyeState_First=0]="EyeState_First",r[r.EyeState_Interval=1]="EyeState_Interval",r[r.EyeState_Closing=2]="EyeState_Closing",r[r.EyeState_Closed=3]="EyeState_Closed",r[r.EyeState_Opening=4]="EyeState_Opening",r))(Te||{});class cl{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}const xu=4,ow=10;let jr,Ln,dl;class Pu{getChannelFlagAsColor(t){return this._channelColors[t]}getMaskRenderTexture(){let t=0;if(this._maskTexture&&this._maskTexture.texture!=0&&(this._maskTexture.frameNo=this._currentFrameNo,t=this._maskTexture.texture),t==0){const e=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,dl),this._maskTexture=new aw(this._currentFrameNo,t)}return t}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,n=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MIN_VALUE;const a=e._clippedDrawableIndexList.length;for(let l=0;l<a;l++){const h=e._clippedDrawableIndexList[l],c=t.getDrawableVertexCount(h),p=t.getDrawableVertices(h);let m=Number.MAX_VALUE,g=Number.MAX_VALUE,_=Number.MIN_VALUE,A=Number.MIN_VALUE;const y=c*Au.vertexStep;for(let S=Au.vertexOffset;S<y;S+=Au.vertexStep){const M=p[S],x=p[S+1];M<m&&(m=M),M>_&&(_=M),x<g&&(g=x),x>A&&(A=x)}if(m!=Number.MAX_VALUE)if(m<i&&(i=m),g<n&&(n=g),_>s&&(s=_),A>o&&(o=A),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const S=s-i,M=o-n;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=n,e._allClippedDrawRect.width=S,e._allClippedDrawRect.height=M}}}constructor(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new cl,this._tmpMatrix=new we,this._tmpMatrixForMask=new we,this._tmpMatrixForDraw=new we;let t=new Fn;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.push(t),t=new Fn,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.push(t),t=new Fn,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.push(t),t=new Fn,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.push(t)}release(){var t,e,i;const n=this;for(let s=0;s<this._clippingContextListForMask.length;s++)this._clippingContextListForMask[s]&&((t=this._clippingContextListForMask[s])==null||t.release());n._clippingContextListForMask=void 0,n._clippingContextListForDraw=void 0,this._maskTexture&&((e=this.gl)==null||e.deleteFramebuffer(this._maskTexture.texture),n._maskTexture=void 0),n._channelColors=void 0,(i=this.gl)==null||i.deleteTexture(this._colorBuffer),this._colorBuffer=null}initialize(t,e,i,n){for(let s=0;s<e;s++){if(n[s]<=0){this._clippingContextListForDraw.push(null);continue}let o=this.findSameClip(i[s],n[s]);o==null&&(o=new uw(this,i[s],n[s]),this._clippingContextListForMask.push(o)),o.addClippedDrawable(s),this._clippingContextListForDraw.push(o)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let n=0;n<this._clippingContextListForMask.length;n++){const s=this._clippingContextListForMask[n];this.calcClippedDrawTotalBounds(t,s),s._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture(),e.getMvpMatrix(),e.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let n=0;n<this._clippingContextListForMask.length;n++){const s=this._clippingContextListForMask[n],o=s._allClippedDrawRect,a=s._layoutBounds,l=.05;this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.expand(o.width*l,o.height*l);const h=a.width/this._tmpBoundsOnModel.width,c=a.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(h,c),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(h,c),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),s._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),s._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const p=s._clippingIdCount;for(let m=0;m<p;m++){const g=s._clippingIdList[m];!t.getDrawableDynamicFlagVertexPositionsDidChange(g)||(e.setIsCulling(t.getDrawableCulling(g)!=!1),e.setClippingContextBufferForMask(s),e.drawMesh(t.getDrawableTextureIndices(g),t.getDrawableVertexIndexCount(g),t.getDrawableVertexCount(g),t.getDrawableVertexIndices(g),t.getDrawableVertices(g),t.getDrawableVertexUvs(g),t.getDrawableOpacity(g),Tr.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,dl),e.setClippingContextBufferForMask(null),this.gl.viewport(Ln[0],Ln[1],Ln[2],Ln[3])}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.length;i++){const n=this._clippingContextListForMask[i],s=n._clippingIdCount;if(s!=e)continue;let o=0;for(let a=0;a<s;a++){const l=n._clippingIdList[a];for(let h=0;h<s;h++)if(t[h]==l){o++;break}}if(o==s)return n}return null}setupLayoutBounds(t){let e=t/xu,i=t%xu;e=~~e,i=~~i;let n=0;for(let s=0;s<xu;s++){const o=e+(s<i?1:0);if(o!=0)if(o==1){const a=this._clippingContextListForMask[n++];a._layoutChannelNo=s,a._layoutBounds.x=0,a._layoutBounds.y=0,a._layoutBounds.width=1,a._layoutBounds.height=1}else if(o==2)for(let a=0;a<o;a++){let l=a%2;l=~~l;const h=this._clippingContextListForMask[n++];h._layoutChannelNo=s,h._layoutBounds.x=l*.5,h._layoutBounds.y=0,h._layoutBounds.width=.5,h._layoutBounds.height=1}else if(o<=4)for(let a=0;a<o;a++){let l=a%2,h=a/2;l=~~l,h=~~h;const c=this._clippingContextListForMask[n++];c._layoutChannelNo=s,c._layoutBounds.x=l*.5,c._layoutBounds.y=h*.5,c._layoutBounds.width=.5,c._layoutBounds.height=.5}else if(o<=9)for(let a=0;a<o;a++){let l=a%3,h=a/3;l=~~l,h=~~h;const c=this._clippingContextListForMask[n++];c._layoutChannelNo=s,c._layoutBounds.x=l/3,c._layoutBounds.y=h/3,c._layoutBounds.width=1/3,c._layoutBounds.height=1/3}else if(is.supportMoreMaskDivisions&&o<=16)for(let a=0;a<o;a++){let l=a%4,h=a/4;l=~~l,h=~~h;const c=this._clippingContextListForMask[n++];c._layoutChannelNo=s,c._layoutBounds.x=l/4,c._layoutBounds.y=h/4,c._layoutBounds.width=1/4,c._layoutBounds.height=1/4}else Mi("not supported mask count : {0}",o)}}getColorBuffer(){return this._colorBuffer}getClippingContextListForDraw(){return this._clippingContextListForDraw}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}}class aw{constructor(t,e){this.frameNo=t,this.texture=e}}class uw{constructor(t,e,i){this._isUsing=!1,this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new cl,this._layoutBounds=new cl,this._clippedDrawableIndexList=[],this._matrixForMask=new we,this._matrixForDraw=new we}release(){const t=this;t._layoutBounds=void 0,t._allClippedDrawRect=void 0,t._clippedDrawableIndexList=void 0}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class ji{static getInstance(){return jr==null&&(jr=new ji),jr}static deleteInstance(){jr&&(jr.release(),jr=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,n,s,o,a,l,h,c,p,m,g){p||Mi("NoPremultipliedAlpha is not allowed"),this._shaderSets.length==0&&this.generateShaders();let _,A,y,S;const M=t.getClippingContextBufferForMask();if(M!=null){const x=this._shaderSets[Nn.ShaderNames_SetupMask];this.gl.useProgram(x.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(x.samplerTexture0Location,0),a.vertex==null&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(x.attributePositionLocation),this.gl.vertexAttribPointer(x.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),a.uv==null&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(x.attributeTexCoordLocation),this.gl.vertexAttribPointer(x.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const F=M._layoutChannelNo,B=M.getClippingManager().getChannelFlagAsColor(F);this.gl.uniform4f(x.uniformChannelFlagLocation,B.R,B.G,B.B,B.A),this.gl.uniformMatrix4fv(x.uniformClipMatrixLocation,!1,M._matrixForMask.getArray());const N=M._layoutBounds;this.gl.uniform4f(x.uniformBaseColorLocation,N.x*2-1,N.y*2-1,N.getRight()*2-1,N.getBottom()*2-1),_=this.gl.ZERO,A=this.gl.ONE_MINUS_SRC_COLOR,y=this.gl.ZERO,S=this.gl.ONE_MINUS_SRC_ALPHA}else{const x=t.getClippingContextBufferForDraw(),B=x!=null?g?2:1:0;let N;switch(h){case Tr.CubismBlendMode_Normal:default:N=this._shaderSets[Nn.ShaderNames_NormalPremultipliedAlpha+B],_=this.gl.ONE,A=this.gl.ONE_MINUS_SRC_ALPHA,y=this.gl.ONE,S=this.gl.ONE_MINUS_SRC_ALPHA;break;case Tr.CubismBlendMode_Additive:N=this._shaderSets[Nn.ShaderNames_AddPremultipliedAlpha+B],_=this.gl.ONE,A=this.gl.ONE,y=this.gl.ZERO,S=this.gl.ONE;break;case Tr.CubismBlendMode_Multiplicative:N=this._shaderSets[Nn.ShaderNames_MultPremultipliedAlpha+B],_=this.gl.DST_COLOR,A=this.gl.ONE_MINUS_SRC_ALPHA,y=this.gl.ZERO,S=this.gl.ONE;break}if(this.gl.useProgram(N.shaderProgram),a.vertex==null&&(a.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(N.attributePositionLocation),this.gl.vertexAttribPointer(N.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),a.uv==null&&(a.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(N.attributeTexCoordLocation),this.gl.vertexAttribPointer(N.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),x!=null){this.gl.activeTexture(this.gl.TEXTURE1);const b=x.getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,b),this.gl.uniform1i(N.samplerTexture1Location,1),this.gl.uniformMatrix4fv(N.uniformClipMatrixLocation,!1,x._matrixForDraw.getArray());const E=x._layoutChannelNo,T=x.getClippingManager().getChannelFlagAsColor(E);this.gl.uniform4f(N.uniformChannelFlagLocation,T.R,T.G,T.B,T.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(N.samplerTexture0Location,0),this.gl.uniformMatrix4fv(N.uniformMatrixLocation,!1,m.getArray()),this.gl.uniform4f(N.uniformBaseColorLocation,c.R,c.G,c.B,c.A)}a.index==null&&(a.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(_,A,y,S)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.length;t++)this.gl.deleteProgram(this._shaderSets[t].shaderProgram),this._shaderSets[t].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let t=0;t<ow;t++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(lw,hw),this._shaderSets[1].shaderProgram=this.loadShaderProgram(cw,dw),this._shaderSets[2].shaderProgram=this.loadShaderProgram(hf,fw),this._shaderSets[3].shaderProgram=this.loadShaderProgram(hf,pw),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_position"),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_texCoord"),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"s_texture0"),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_clipMatrix"),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_channelFlag"),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_baseColor"),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_position"),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_texCoord"),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"s_texture0"),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_matrix"),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_baseColor"),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_position"),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_texCoord"),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture0"),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture1"),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_matrix"),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_clipMatrix"),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_channelFlag"),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_baseColor"),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_position"),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_texCoord"),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture0"),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture1"),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_matrix"),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_clipMatrix"),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_channelFlag"),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_baseColor"),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_position"),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_texCoord"),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"s_texture0"),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_matrix"),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_baseColor"),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_position"),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_texCoord"),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture0"),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture1"),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_matrix"),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_clipMatrix"),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_channelFlag"),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_baseColor"),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_position"),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_texCoord"),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture0"),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture1"),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_matrix"),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_clipMatrix"),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_channelFlag"),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_baseColor"),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_position"),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_texCoord"),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"s_texture0"),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_matrix"),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_baseColor"),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_position"),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_texCoord"),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture0"),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture1"),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_matrix"),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_clipMatrix"),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_channelFlag"),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_baseColor"),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_position"),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_texCoord"),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture0"),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture1"),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_matrix"),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_clipMatrix"),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_channelFlag"),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_baseColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),n=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!n)return Mi("Vertex shader compile error!"),0;let s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return s?(this.gl.attachShader(i,n),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(n),this.gl.deleteShader(s),i):(Mi("Failed to link program: {0}",i),this.gl.deleteShader(n),this.gl.deleteShader(s),i&&this.gl.deleteProgram(i),0)):(Mi("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,n=this.gl.createShader(t);if(this.gl.shaderSource(n,i),this.gl.compileShader(n),!n){const o=this.gl.getShaderInfoLog(n);Mi("Shader compile log: {0} ",o)}return this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(this.gl.deleteShader(n),null)}setGl(t){this.gl=t}}var Nn=(r=>(r[r.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",r[r.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",r[r.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",r[r.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",r[r.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",r[r.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",r))(Nn||{});const lw="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",hw="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",cw="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",hf="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",dw="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;void main(){   gl_FragColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;}",fw="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;void main(){   vec4 col_formask = texture2D(s_texture0 , v_texCoord) * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",pw="precision mediump float;varying vec2 v_texCoord;varying vec4 v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4 u_channelFlag;uniform vec4 u_baseColor;void main(){vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;col_formask = col_formask * (1.0 - maskVal);gl_FragColor = col_formask;}";class Bm extends Zl{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._clippingManager=new Pu,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}initialize(t){t.isUsingMasking()&&(this._clippingManager=new Pu,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts()));for(let e=t.getDrawableCount()-1;e>=0;e--)this._sortedDrawableIndexList[e]=0;super.initialize(t)}bindTexture(t,e){this._textures[t]=e}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){this._clippingManager.release(),this._clippingManager=new Pu,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())}getClippingMaskBufferSize(){return this._clippingManager.getClippingMaskBufferSize()}release(){var t,e,i;const n=this;this._clippingManager.release(),n._clippingManager=void 0,(t=this.gl)==null||t.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,(e=this.gl)==null||e.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,(i=this.gl)==null||i.deleteBuffer(this._bufferData.index),this._bufferData.index=null,n._bufferData=void 0,n._textures=void 0}doDrawModel(){this.preDraw(),this._clippingManager!=null&&this._clippingManager.setupClippingContext(this.getModel(),this);const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const n=e[i];this._sortedDrawableIndexList[n]=i}for(let i=0;i<t;++i){const n=this._sortedDrawableIndexList[i];!this.getModel().getDrawableDynamicFlagIsVisible(n)||(this.setClippingContextBufferForDraw(this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw()[n]:null),this.setIsCulling(this.getModel().getDrawableCulling(n)),this.drawMesh(this.getModel().getDrawableTextureIndices(n),this.getModel().getDrawableVertexIndexCount(n),this.getModel().getDrawableVertexCount(n),this.getModel().getDrawableVertexIndices(n),this.getModel().getDrawableVertices(n),this.getModel().getDrawableVertexUvs(n),this.getModel().getDrawableOpacity(n),this.getModel().getDrawableBlendMode(n),this.getModel().getDrawableInvertedMaskBit(n)))}}drawMesh(t,e,i,n,s,o,a,l,h){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const c=this.getModelColor();this.getClippingContextBufferForMask()==null&&(c.A*=a,this.isPremultipliedAlpha()&&(c.R*=c.A,c.G*=c.A,c.B*=c.A));let p=null;this._textures[t]!=null&&(p=this._textures[t]),ji.getInstance().setupShaderProgram(this,p,i,s,n,o,this._bufferData,a,l,c,this.isPremultipliedAlpha(),this.getMvpMatrix(),h),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}static doStaticRelease(){ji.deleteInstance()}setRenderState(t,e){dl=t,Ln=e}preDraw(){this.firstDraw&&(this.firstDraw=!1,this._anisortopy=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager.setGL(t),ji.getInstance().setGl(t)}}Zl.staticRelease=()=>{Bm.doStaticRelease()};const cf=new we;class mw extends Am{constructor(t,e,i){super(),this.lipSync=!0,this.breath=ih.create(),this.renderer=new Bm,this.idParamAngleX=ZI,this.idParamAngleY=tw,this.idParamAngleZ=ew,this.idParamEyeBallX=rw,this.idParamEyeBallY=iw,this.idParamBodyAngleX=nw,this.idParamBreath=sw,this.pixelsPerUnit=1,this.centeringTransform=new Xt,this.coreModel=t,this.settings=e,this.motionManager=new QI(e,i),this.init()}init(){var t;super.init(),((t=this.settings.getEyeBlinkParameters())==null?void 0:t.length)>0&&(this.eyeBlink=km.create(this.settings)),this.breath.setParameters([new Rn(this.idParamAngleX,0,15,6.5345,.5),new Rn(this.idParamAngleY,0,8,3.5345,.5),new Rn(this.idParamAngleZ,0,10,5.5345,.5),new Rn(this.idParamBodyAngleX,0,4,15.5345,.5),new Rn(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const t={};if(this.settings.layout)for(const e of Object.keys(this.settings.layout)){const i=e.charAt(0).toLowerCase()+e.slice(1);t[i]=this.settings.layout[e]}return t}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(t,e){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(t),this.renderer._clippingManager._currentFrameNo=e,this.renderer._clippingManager._maskTexture=void 0,ji.getInstance()._shaderSets=[]}bindTexture(t,e){this.renderer.bindTexture(t,e)}getHitAreaDefs(){var t,e;return(e=(t=this.settings.hitAreas)==null?void 0:t.map(i=>({id:i.Id,name:i.Name,index:this.coreModel.getDrawableIndex(i.Id)})))!=null?e:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(t){return this.coreModel.getDrawableIndex(t)}getDrawableVertices(t){if(typeof t=="string"&&(t=this.coreModel.getDrawableIndex(t),t===-1))throw new TypeError("Unable to find drawable ID: "+t);const e=this.coreModel.getDrawableVertices(t).slice();for(let i=0;i<e.length;i+=2)e[i]=e[i]*this.pixelsPerUnit+this.originalWidth/2,e[i+1]=-e[i+1]*this.pixelsPerUnit+this.originalHeight/2;return e}updateTransform(t){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(t)}update(t,e){var i,n,s,o;super.update(t,e),t/=1e3,e/=1e3;const a=this.coreModel;this.emit("beforeMotionUpdate");const l=this.motionManager.update(this.coreModel,e);this.emit("afterMotionUpdate"),a.saveParameters(),(i=this.motionManager.expressionManager)==null||i.update(a,e),l||(n=this.eyeBlink)==null||n.updateParameters(a,t),this.updateFocus(),this.updateNaturalMovements(t*1e3,e*1e3),(s=this.physics)==null||s.evaluate(a,t),(o=this.pose)==null||o.updateParameters(a,t),this.emit("beforeModelUpdate"),a.update(),a.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,this.focusController.x*30),this.coreModel.addParameterValueById(this.idParamAngleY,this.focusController.y*30),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,this.focusController.x*10)}updateNaturalMovements(t,e){var i;(i=this.breath)==null||i.updateParameters(this.coreModel,t/1e3)}draw(t){const e=this.drawingMatrix,i=cf.getArray();i[0]=e.a,i[1]=e.b,i[4]=-e.c,i[5]=-e.d,i[12]=e.tx,i[13]=e.ty,this.renderer.setMvpMatrix(cf),this.renderer.setRenderState(t.getParameter(t.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}let ao,df=20;function gw(){return ns.isStarted()?Promise.resolve():(ao??(ao=new Promise((r,t)=>{function e(){try{vw(),r()}catch(i){if(df--,df<0){const n=new Error("Failed to start up Cubism 4 framework.");n.cause=i,t(n);return}st.log("Cubism4","Startup failed, retrying 10ms later..."),setTimeout(e,10)}}e()})),ao)}function vw(r){r=Object.assign({logFunction:console.log,loggingLevel:vi.LogLevel_Verbose},r),ns.startUp(r),ns.initialize()}const _w=.001,ff=.5;class nh{static create(t){const e=new nh;typeof t.FadeInTime=="number"&&(e._fadeTimeSeconds=t.FadeInTime,e._fadeTimeSeconds<=0&&(e._fadeTimeSeconds=ff));const i=t.Groups,n=i.length;for(let s=0;s<n;++s){const o=i[s],a=o.length;let l=0;for(let h=0;h<a;++h){const c=o[h],p=new Vo;p.partId=c.Id;const m=c.Link;if(m){const g=m.length;for(let _=0;_<g;++_){const A=new Vo;A.partId=m[_],p.link.push(A)}}e._partGroups.push(p),++l}e._partGroupCounts.push(l)}return e}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let n=0;n<this._partGroupCounts.length;n++){const s=this._partGroupCounts[n];this.doFade(t,e,i,s),i+=s}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.length;++i){const n=this._partGroupCounts[i];for(let s=e;s<e+n;++s){this._partGroups[s].initialize(t);const o=this._partGroups[s].partIndex,a=this._partGroups[s].parameterIndex;if(!(o<0)){t.setPartOpacityByIndex(o,s==e?1:0),t.setParameterValueByIndex(a,s==e?1:0);for(let l=0;l<this._partGroups[s].link.length;++l)this._partGroups[s].link[l].initialize(t)}}e+=n}}copyPartOpacities(t){for(let e=0;e<this._partGroups.length;++e){const i=this._partGroups[e];if(i.link.length==0)continue;const n=this._partGroups[e].partIndex,s=t.getPartOpacityByIndex(n);for(let o=0;o<i.link.length;++o){const l=i.link[o].partIndex;l<0||t.setPartOpacityByIndex(l,s)}}}doFade(t,e,i,n){let s=-1,o=1;const a=.5,l=.15;for(let h=i;h<i+n;++h){const c=this._partGroups[h].partIndex,p=this._partGroups[h].parameterIndex;if(t.getParameterValueByIndex(p)>_w){if(s>=0)break;s=h,o=t.getPartOpacityByIndex(c),o+=e/this._fadeTimeSeconds,o>1&&(o=1)}}s<0&&(s=0,o=1);for(let h=i;h<i+n;++h){const c=this._partGroups[h].partIndex;if(s==h)t.setPartOpacityByIndex(c,o);else{let p=t.getPartOpacityByIndex(c),m;o<a?m=o*(a-1)/a+1:m=(1-o)*a/(1-a),(1-m)*(1-o)>l&&(m=1-l/(1-o)),p>m&&(p=m),t.setPartOpacityByIndex(c,p)}}}constructor(){this._fadeTimeSeconds=ff,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class Vo{constructor(t){this.parameterIndex=0,this.partIndex=0,this.partId="",this.link=[],t!=null&&this.assignment(t)}assignment(t){return this.partId=t.partId,this.link=t.link.map(e=>e.clone()),this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new Vo;return t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=this.link.map(e=>e.clone()),t}}class yw{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.length;for(let i=0;i<t;++i)i<e?this._savedParameters[i]=this._parameterValues[i]:this._savedParameters.push(this._parameterValues[i])}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds[e])return e;return t in this._notExistPartId?this._notExistPartId[t]:(e=i+this._notExistPartId.length,this._notExistPartId[t]=e,this._notExistPartOpacities[e]=0,e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(t in this._notExistPartOpacities){this._notExistPartOpacities[t]=e;return}oo(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return t in this._notExistPartOpacities?this._notExistPartOpacities[t]:(oo(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds[e])return e;return t in this._notExistParameterId?this._notExistParameterId[t]:(e=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[t]=e,this._notExistParameterValues[e]=0,e)}getParameterCount(){return this._model.parameters.count}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return t in this._notExistParameterValues?this._notExistParameterValues[t]:(oo(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(t in this._notExistParameterValues){this._notExistParameterValues[t]=i==1?e:this._notExistParameterValues[t]*(1-i)+e*i;return}oo(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const n=this.getParameterIndex(t);this.setParameterValueByIndex(n,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const n=this.getParameterIndex(t);this.addParameterValueByIndex(n,e,i)}multiplyParameterValueById(t,e,i=1){const n=this.getParameterIndex(t);this.multiplyParameterValueByIndex(n,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds[i]==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){return this._model.drawables.ids[t]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableCulling(t){const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?Tr.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?Tr.CubismBlendMode_Multiplicative:Tr.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.length;t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters[i]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;for(let i=0;i<e;++i)this._parameterIds.push(t[i])}{const t=this._model.parts.ids,e=this._model.parts.count;for(let i=0;i<e;++i)this._partIds.push(t[i])}{const t=this._model.drawables.ids,e=this._model.drawables.count;for(let i=0;i<e;++i)this._drawableIds.push(t[i])}}constructor(t){this._model=t,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class sh{static create(t){const e=Live2DCubismCore.Moc.fromArrayBuffer(t);if(e)return new sh(e);throw new Error("Unknown error")}createModel(){let t;const e=Live2DCubismCore.Model.fromMoc(this._moc);if(e)return t=new yw(e),++this._modelCount,t;throw new Error("Unknown error")}deleteModel(t){t!=null&&--this._modelCount}constructor(t){this._moc=t,this._modelCount=0}release(){this._moc._release(),this._moc=void 0}}var fl=(r=>(r[r.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",r))(fl||{}),Yr=(r=>(r[r.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",r[r.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",r[r.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",r))(Yr||{});class Ew{constructor(){this.initialPosition=new X(0,0),this.position=new X(0,0),this.lastPosition=new X(0,0),this.lastGravity=new X(0,0),this.force=new X(0,0),this.velocity=new X(0,0)}}class Tw{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class Iw{constructor(){this.source={}}}class ww{constructor(){this.destination={},this.translationScale=new X(0,0)}}class bw{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new X(0,0),this.wind=new X(0,0)}}class Aw{constructor(t){this._json=t}release(){this._json=void 0}getGravity(){const t=new X(0,0);return t.x=this._json.Meta.EffectiveForces.Gravity.X,t.y=this._json.Meta.EffectiveForces.Gravity.Y,t}getWind(){const t=new X(0,0);return t.x=this._json.Meta.EffectiveForces.Wind.X,t.y=this._json.Meta.EffectiveForces.Wind.Y,t}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Default}getNormalizationAngleMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Default}getInputCount(t){return this._json.PhysicsSettings[t].Input.length}getInputWeight(t,e){return this._json.PhysicsSettings[t].Input[e].Weight}getInputReflect(t,e){return this._json.PhysicsSettings[t].Input[e].Reflect}getInputType(t,e){return this._json.PhysicsSettings[t].Input[e].Type}getInputSourceId(t,e){return this._json.PhysicsSettings[t].Input[e].Source.Id}getOutputCount(t){return this._json.PhysicsSettings[t].Output.length}getOutputVertexIndex(t,e){return this._json.PhysicsSettings[t].Output[e].VertexIndex}getOutputAngleScale(t,e){return this._json.PhysicsSettings[t].Output[e].Scale}getOutputWeight(t,e){return this._json.PhysicsSettings[t].Output[e].Weight}getOutputDestinationId(t,e){return this._json.PhysicsSettings[t].Output[e].Destination.Id}getOutputType(t,e){return this._json.PhysicsSettings[t].Output[e].Type}getOutputReflect(t,e){return this._json.PhysicsSettings[t].Output[e].Reflect}getParticleCount(t){return this._json.PhysicsSettings[t].Vertices.length}getParticleMobility(t,e){return this._json.PhysicsSettings[t].Vertices[e].Mobility}getParticleDelay(t,e){return this._json.PhysicsSettings[t].Vertices[e].Delay}getParticleAcceleration(t,e){return this._json.PhysicsSettings[t].Vertices[e].Acceleration}getParticleRadius(t,e){return this._json.PhysicsSettings[t].Vertices[e].Radius}getParticlePosition(t,e){const i=new X(0,0);return i.x=this._json.PhysicsSettings[t].Vertices[e].Position.X,i.y=this._json.PhysicsSettings[t].Vertices[e].Position.Y,i}}const pf="X",mf="Y",gf="Angle",Cw=5,Um=100,xw=.001;class oh{static create(t){const e=new oh;return e.parse(t),e._physicsRig.gravity.y=0,e}evaluate(t,e){let i,n,s,o;const a=new X;let l,h,c,p,m,g,_,A;m=t.getModel().parameters.values,g=t.getModel().parameters.maximumValues,_=t.getModel().parameters.minimumValues,A=t.getModel().parameters.defaultValues;for(let y=0;y<this._physicsRig.subRigCount;++y){i={angle:0},a.x=0,a.y=0,l=this._physicsRig.settings[y],h=this._physicsRig.inputs.slice(l.baseInputIndex),c=this._physicsRig.outputs.slice(l.baseOutputIndex),p=this._physicsRig.particles.slice(l.baseParticleIndex);for(let S=0;S<l.inputCount;++S)n=h[S].weight/Um,h[S].sourceParameterIndex==-1&&(h[S].sourceParameterIndex=t.getParameterIndex(h[S].source.id)),h[S].getNormalizedParameterValue(a,i,m[h[S].sourceParameterIndex],_[h[S].sourceParameterIndex],g[h[S].sourceParameterIndex],A[h[S].sourceParameterIndex],l.normalizationPosition,l.normalizationAngle,h[S].reflect,n);s=ot.degreesToRadian(-i.angle),a.x=a.x*ot.cos(s)-a.y*ot.sin(s),a.y=a.x*ot.sin(s)+a.y*ot.cos(s),Vw(p,l.particleCount,a,i.angle,this._options.wind,xw*l.normalizationPosition.maximum,e,Cw);for(let S=0;S<l.outputCount;++S){const M=c[S].vertexIndex;if(M<1||M>=l.particleCount)break;c[S].destinationParameterIndex==-1&&(c[S].destinationParameterIndex=t.getParameterIndex(c[S].destination.id));const x=new X;x.x=p[M].position.x-p[M-1].position.x,x.y=p[M].position.y-p[M-1].position.y,o=c[S].getValue(x,p,M,c[S].reflect,this._options.gravity);const F=c[S].destinationParameterIndex,B=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(m.subarray(F))):m.slice(F);Gw(B,_[F],g[F],o,c[S]);for(let N=F,b=0;N<m.length;N++,b++)m[N]=B[b]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._options=new Pw,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0}release(){this._physicsRig=void 0}parse(t){this._physicsRig=new bw;let e=new Aw(t);this._physicsRig.gravity=e.getGravity(),this._physicsRig.wind=e.getWind(),this._physicsRig.subRigCount=e.getSubRigCount();let i=0,n=0,s=0;for(let o=0;o<this._physicsRig.subRigCount;++o){const a=new Tw;a.normalizationPosition.minimum=e.getNormalizationPositionMinimumValue(o),a.normalizationPosition.maximum=e.getNormalizationPositionMaximumValue(o),a.normalizationPosition.defalut=e.getNormalizationPositionDefaultValue(o),a.normalizationAngle.minimum=e.getNormalizationAngleMinimumValue(o),a.normalizationAngle.maximum=e.getNormalizationAngleMaximumValue(o),a.normalizationAngle.defalut=e.getNormalizationAngleDefaultValue(o),a.inputCount=e.getInputCount(o),a.baseInputIndex=i,i+=a.inputCount;for(let l=0;l<a.inputCount;++l){const h=new Iw;switch(h.sourceParameterIndex=-1,h.weight=e.getInputWeight(o,l),h.reflect=e.getInputReflect(o,l),e.getInputType(o,l)){case pf:h.type=Yr.CubismPhysicsSource_X,h.getNormalizedParameterValue=Sw;break;case mf:h.type=Yr.CubismPhysicsSource_Y,h.getNormalizedParameterValue=Rw;break;case gf:h.type=Yr.CubismPhysicsSource_Angle,h.getNormalizedParameterValue=Mw;break}h.source.targetType=fl.CubismPhysicsTargetType_Parameter,h.source.id=e.getInputSourceId(o,l),this._physicsRig.inputs.push(h)}a.outputCount=e.getOutputCount(o),a.baseOutputIndex=n,n+=a.outputCount;for(let l=0;l<a.outputCount;++l){const h=new ww;switch(h.destinationParameterIndex=-1,h.vertexIndex=e.getOutputVertexIndex(o,l),h.angleScale=e.getOutputAngleScale(o,l),h.weight=e.getOutputWeight(o,l),h.destination.targetType=fl.CubismPhysicsTargetType_Parameter,h.destination.id=e.getOutputDestinationId(o,l),e.getOutputType(o,l)){case pf:h.type=Yr.CubismPhysicsSource_X,h.getValue=Ow,h.getScale=kw;break;case mf:h.type=Yr.CubismPhysicsSource_Y,h.getValue=Fw,h.getScale=Bw;break;case gf:h.type=Yr.CubismPhysicsSource_Angle,h.getValue=Dw,h.getScale=Uw;break}h.reflect=e.getOutputReflect(o,l),this._physicsRig.outputs.push(h)}a.particleCount=e.getParticleCount(o),a.baseParticleIndex=s,s+=a.particleCount;for(let l=0;l<a.particleCount;++l){const h=new Ew;h.mobility=e.getParticleMobility(o,l),h.delay=e.getParticleDelay(o,l),h.acceleration=e.getParticleAcceleration(o,l),h.radius=e.getParticleRadius(o,l),h.position=e.getParticlePosition(o,l),this._physicsRig.particles.push(h)}this._physicsRig.settings.push(a)}this.initialize(),e.release()}initialize(){let t,e,i;for(let n=0;n<this._physicsRig.subRigCount;++n){e=this._physicsRig.settings[n],t=this._physicsRig.particles.slice(e.baseParticleIndex),t[0].initialPosition=new X(0,0),t[0].lastPosition=new X(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new X(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new X(0,0),t[0].force=new X(0,0);for(let s=1;s<e.particleCount;++s)i=new X(0,0),i.y=t[s].radius,t[s].initialPosition=new X(t[s-1].initialPosition.x+i.x,t[s-1].initialPosition.y+i.y),t[s].position=new X(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastPosition=new X(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastGravity=new X(0,-1),t[s].lastGravity.y*=-1,t[s].velocity=new X(0,0),t[s].force=new X(0,0)}}}class Pw{constructor(){this.gravity=new X(0,0),this.wind=new X(0,0)}}function Sw(r,t,e,i,n,s,o,a,l,h){r.x+=ah(e,i,n,s,o.minimum,o.maximum,o.defalut,l)*h}function Rw(r,t,e,i,n,s,o,a,l,h){r.y+=ah(e,i,n,s,o.minimum,o.maximum,o.defalut,l)*h}function Mw(r,t,e,i,n,s,o,a,l,h){t.angle+=ah(e,i,n,s,a.minimum,a.maximum,a.defalut,l)*h}function Ow(r,t,e,i,n){let s=r.x;return i&&(s*=-1),s}function Fw(r,t,e,i,n){let s=r.y;return i&&(s*=-1),s}function Dw(r,t,e,i,n){let s;return e>=2?n=t[e-1].position.substract(t[e-2].position):n=n.multiplyByScaler(-1),s=ot.directionToRadian(n,r),i&&(s*=-1),s}function Lw(r,t){return Math.abs(Math.max(r,t)-Math.min(r,t))}function Nw(r,t){return Math.min(r,t)+Lw(r,t)/2}function kw(r,t){return r.x}function Bw(r,t){return r.y}function Uw(r,t){return t}function Vw(r,t,e,i,n,s,o,a){let l,h,c,p,m=new X(0,0),g=new X(0,0),_=new X(0,0),A=new X(0,0);r[0].position=new X(e.x,e.y),l=ot.degreesToRadian(i),p=ot.radianToDirection(l),p.normalize();for(let y=1;y<t;++y)r[y].force=p.multiplyByScaler(r[y].acceleration).add(n),r[y].lastPosition=new X(r[y].position.x,r[y].position.y),h=r[y].delay*o*30,m=r[y].position.substract(r[y-1].position),c=ot.directionToRadian(r[y].lastGravity,p)/a,m.x=ot.cos(c)*m.x-m.y*ot.sin(c),m.y=ot.sin(c)*m.x+m.y*ot.cos(c),r[y].position=r[y-1].position.add(m),g=r[y].velocity.multiplyByScaler(h),_=r[y].force.multiplyByScaler(h).multiplyByScaler(h),r[y].position=r[y].position.add(g).add(_),A=r[y].position.substract(r[y-1].position),A.normalize(),r[y].position=r[y-1].position.add(A.multiplyByScaler(r[y].radius)),ot.abs(r[y].position.x)<s&&(r[y].position.x=0),h!=0&&(r[y].velocity=r[y].position.substract(r[y].lastPosition),r[y].velocity=r[y].velocity.divisionByScalar(h),r[y].velocity=r[y].velocity.multiplyByScaler(r[y].mobility)),r[y].force=new X(0,0),r[y].lastGravity=new X(p.x,p.y)}function Gw(r,t,e,i,n){let s,o,a;s=n.getScale(n.translationScale,n.angleScale),o=i*s,o<t?(o<n.valueBelowMinimum&&(n.valueBelowMinimum=o),o=t):o>e&&(o>n.valueExceededMaximum&&(n.valueExceededMaximum=o),o=e),a=n.weight/Um,a>=1||(o=r[0]*(1-a)+o*a),r[0]=o}function ah(r,t,e,i,n,s,o,a){let l=0;const h=ot.max(e,t);h<r&&(r=h);const c=ot.min(e,t);c>r&&(r=c);const p=ot.min(n,s),m=ot.max(n,s),g=o,_=Nw(c,h),A=r-_;switch(Math.sign(A)){case 1:{const y=m-g,S=h-_;S!=0&&(l=A*(y/S),l+=g);break}case-1:{const y=p-g,S=c-_;S!=0&&(l=A*(y/S),l+=g);break}case 0:{l=g;break}}return a?l:l*-1}dt.registerRuntime({version:4,ready:gw,test(r){return r instanceof Gi||Gi.isValidJSON(r)},isValidMoc(r){if(r.byteLength<4)return!1;const t=new Int8Array(r,0,4);return String.fromCharCode(...t)==="MOC3"},createModelSettings(r){return new Gi(r)},createCoreModel(r){const t=sh.create(r);try{const e=t.createModel();return e.__moc=t,e}catch(e){try{t.release()}catch{}throw e}},createInternalModel(r,t,e){const i=new mw(r,t,e),n=r;return n.__moc&&(i.__moc=n.__moc,delete n.__moc,i.once("destroy",jw)),i},createPhysics(r,t){return oh.create(t)},createPose(r,t){return nh.create(t)}});function jw(){var r;(r=this.__moc)==null||r.release()}Jl.registerTicker(xe);Yl.registerPlugin(_E);Wl.registerPlugin("interaction",uI);const Kr=document.getElementById("canvas"),Oi=new Yl({backgroundAlpha:0,view:Kr});let Ut;const Hw={happy:1,sad:2,angry:3},$w={talk:[["tap_body",0],["tap_body",2],["pinch_out",0],["flick_head",1],["flick_head",2]],cheer:[["tap_body",1]],mouthcover:[["pinch_in",0],["pinch_in",1],["pinch_in",2]],disagree:[["pinch_out",1],["pinch_out",2]],surprised:[["shake",0],["shake",2]],laugh:[["shake",1]]};Jl.from("live2d/shizuku.model.json",{autoInteract:!1,motionPreload:bm.IDLE}).then(r=>{Ut=r,Oi.stage.addChild(Ut);let t=!1;Kr.addEventListener("pointerdown",i=>Ut.tap(i.clientX,i.clientY)),Kr.addEventListener("pointerenter",()=>t=!0),Kr.addEventListener("pointerleave",()=>{Ut.internalModel.focusController.focus(0,0),t=!1}),Kr.addEventListener("pointermove",({clientX:i,clientY:n})=>{t&&Ut.focus(i,n)}),Ut.on("hit",i=>{i.includes("head")&&Ut.motion("shake",1)});function e(){if(!Ut)return;const i={md:window.innerWidth>720&&window.innerWidth<1e3,lg:window.innerWidth>=1e3};Kr.width=window.innerWidth,Kr.height=window.innerHeight,!i.md&&!i.lg&&(Oi.renderer.screen.width=window.innerWidth),Oi.renderer.screen.height=window.innerHeight;const n={x:i.lg?1:.5,y:.85},s={x:i.lg?.4:i.md?.35:.25,y:i.lg?.475:i.md?.425:.3},o=i.md?Ut.width/2.35:i.lg?Ut.width:Oi.renderer.screen.width/2,a=i.md||i.lg?Oi.renderer.screen.height:Ut.height;Ut.anchor.set(n.x,n.y),Ut.scale.set(s.x,s.y),Ut.x=o,Ut.y=a}e(),setTimeout(()=>{Ut&&e()},250),window.addEventListener("resize",e),document.getElementById("loader").style.display="none"});const Vm={app:Oi,expressions:Hw,model:Ut,motions:$w};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm=function(r){const t=[];let e=0;for(let i=0;i<r.length;i++){let n=r.charCodeAt(i);n<128?t[e++]=n:n<2048?(t[e++]=n>>6|192,t[e++]=n&63|128):(n&64512)===55296&&i+1<r.length&&(r.charCodeAt(i+1)&64512)===56320?(n=65536+((n&1023)<<10)+(r.charCodeAt(++i)&1023),t[e++]=n>>18|240,t[e++]=n>>12&63|128,t[e++]=n>>6&63|128,t[e++]=n&63|128):(t[e++]=n>>12|224,t[e++]=n>>6&63|128,t[e++]=n&63|128)}return t},zw=function(r){const t=[];let e=0,i=0;for(;e<r.length;){const n=r[e++];if(n<128)t[i++]=String.fromCharCode(n);else if(n>191&&n<224){const s=r[e++];t[i++]=String.fromCharCode((n&31)<<6|s&63)}else if(n>239&&n<365){const s=r[e++],o=r[e++],a=r[e++],l=((n&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{const s=r[e++],o=r[e++];t[i++]=String.fromCharCode((n&15)<<12|(s&63)<<6|o&63)}}return t.join("")},jm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let n=0;n<r.length;n+=3){const s=r[n],o=n+1<r.length,a=o?r[n+1]:0,l=n+2<r.length,h=l?r[n+2]:0,c=s>>2,p=(s&3)<<4|a>>4;let m=(a&15)<<2|h>>6,g=h&63;l||(g=64,o||(m=64)),i.push(e[c],e[p],e[m],e[g])}return i.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Gm(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):zw(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let n=0;n<r.length;){const s=e[r.charAt(n++)],a=n<r.length?e[r.charAt(n)]:0;++n;const h=n<r.length?e[r.charAt(n)]:64;++n;const p=n<r.length?e[r.charAt(n)]:64;if(++n,s==null||a==null||h==null||p==null)throw new Xw;const m=s<<2|a>>4;if(i.push(m),h!==64){const g=a<<4&240|h>>2;if(i.push(g),p!==64){const _=h<<6&192|p;i.push(_)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Xw extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ww=function(r){const t=Gm(r);return jm.encodeByteArray(t,!0)},Go=function(r){return Ww(r).replace(/\./g,"")},Hm=function(r){try{return jm.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yw=()=>qw().__FIREBASE_DEFAULTS__,Kw=()=>{if(typeof process>"u"||typeof process.env>"u")return;const r={}.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Jw=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&Hm(r[1]);return t&&JSON.parse(t)},_a=()=>{try{return Yw()||Kw()||Jw()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},$m=r=>{var t,e;return(e=(t=_a())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[r]},Qw=r=>{const t=$m(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),i]:[t.substring(0,e),i]},zm=()=>{var r;return(r=_a())===null||r===void 0?void 0:r.config},Xm=r=>{var t;return(t=_a())===null||t===void 0?void 0:t[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tb(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},i=t||"demo-project",n=r.iat||0,s=r.sub||r.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},r),a="";return[Go(JSON.stringify(e)),Go(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ee(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function eb(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ee())}function rb(){var r;const t=(r=_a())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ib(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function nb(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function sb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ob(){const r=ee();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function ab(){return!rb()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ub(){try{return typeof indexedDB=="object"}catch{return!1}}function lb(){return new Promise((r,t)=>{try{let e=!0;const i="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(i);n.onsuccess=()=>{n.result.close(),e||self.indexedDB.deleteDatabase(i),r(!0)},n.onupgradeneeded=()=>{e=!1},n.onerror=()=>{var s;t(((s=n.error)===null||s===void 0?void 0:s.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hb="FirebaseError";class Xe extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=hb,Object.setPrototypeOf(this,Xe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_s.prototype.create)}}class _s{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},n=`${this.service}/${t}`,s=this.errors[t],o=s?cb(s,i):"Error",a=`${this.serviceName}: ${o} (${n}).`;return new Xe(n,a,i)}}function cb(r,t){return r.replace(db,(e,i)=>{const n=t[i];return n!=null?String(n):`<${i}?>`})}const db=/\{\$([^}]+)}/g;function fb(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function jo(r,t){if(r===t)return!0;const e=Object.keys(r),i=Object.keys(t);for(const n of e){if(!i.includes(n))return!1;const s=r[n],o=t[n];if(vf(s)&&vf(o)){if(!jo(s,o))return!1}else if(s!==o)return!1}for(const n of i)if(!e.includes(n))return!1;return!0}function vf(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ys(r){const t=[];for(const[e,i]of Object.entries(r))Array.isArray(i)?i.forEach(n=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function pb(r,t){const e=new mb(r,t);return e.subscribe.bind(e)}class mb{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(i=>{this.error(i)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,i){let n;if(t===void 0&&e===void 0&&i===void 0)throw new Error("Missing Observer.");gb(t,["next","error","complete"])?n=t:n={next:t,error:e,complete:i},n.next===void 0&&(n.next=Su),n.error===void 0&&(n.error=Su),n.complete===void 0&&(n.complete=Su);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch{}}),this.observers.push(n),s}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function gb(r,t){if(typeof r!="object"||r===null)return!1;for(const e of t)if(e in r&&typeof r[e]=="function")return!0;return!1}function Su(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ve(r){return r&&r._delegate?r._delegate:r}class Pr{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vb{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const i=new Zw;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&i.resolve(n)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(t?.identifier),n=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(yb(t))try{this.getOrInitializeService({instanceIdentifier:Jr})}catch{}for(const[e,i]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const s=this.getOrInitializeService({instanceIdentifier:n});i.resolve(s)}catch{}}}}clearInstance(t=Jr){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Jr){return this.instances.has(t)}getOptions(t=Jr){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(n)}return n}onInit(t,e){var i;const n=this.normalizeInstanceIdentifier(e),s=(i=this.onInitCallbacks.get(n))!==null&&i!==void 0?i:new Set;s.add(t),this.onInitCallbacks.set(n,s);const o=this.instances.get(n);return o&&t(o,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(!!i)for(const n of i)try{n(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:_b(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=Jr){return this.component?this.component.multipleInstances?t:Jr:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function _b(r){return r===Jr?void 0:r}function yb(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eb{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new vb(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Q;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Q||(Q={}));const Tb={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},Ib=Q.INFO,wb={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},bb=(r,t,...e)=>{if(t<r.logLevel)return;const i=new Date().toISOString(),n=wb[t];if(n)console[n](`[${i}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class uh{constructor(t){this.name=t,this._logLevel=Ib,this._logHandler=bb,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Q))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Tb[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...t),this._logHandler(this,Q.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...t),this._logHandler(this,Q.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...t),this._logHandler(this,Q.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...t),this._logHandler(this,Q.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...t),this._logHandler(this,Q.ERROR,...t)}}const Ab=(r,t)=>t.some(e=>r instanceof e);let _f,yf;function Cb(){return _f||(_f=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function xb(){return yf||(yf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Wm=new WeakMap,pl=new WeakMap,qm=new WeakMap,Ru=new WeakMap,lh=new WeakMap;function Pb(r){const t=new Promise((e,i)=>{const n=()=>{r.removeEventListener("success",s),r.removeEventListener("error",o)},s=()=>{e(Ir(r.result)),n()},o=()=>{i(r.error),n()};r.addEventListener("success",s),r.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&Wm.set(e,r)}).catch(()=>{}),lh.set(t,r),t}function Sb(r){if(pl.has(r))return;const t=new Promise((e,i)=>{const n=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",o),r.removeEventListener("abort",o)},s=()=>{e(),n()},o=()=>{i(r.error||new DOMException("AbortError","AbortError")),n()};r.addEventListener("complete",s),r.addEventListener("error",o),r.addEventListener("abort",o)});pl.set(r,t)}let ml={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return pl.get(r);if(t==="objectStoreNames")return r.objectStoreNames||qm.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Ir(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Rb(r){ml=r(ml)}function Mb(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const i=r.call(Mu(this),t,...e);return qm.set(i,t.sort?t.sort():[t]),Ir(i)}:xb().includes(r)?function(...t){return r.apply(Mu(this),t),Ir(Wm.get(this))}:function(...t){return Ir(r.apply(Mu(this),t))}}function Ob(r){return typeof r=="function"?Mb(r):(r instanceof IDBTransaction&&Sb(r),Ab(r,Cb())?new Proxy(r,ml):r)}function Ir(r){if(r instanceof IDBRequest)return Pb(r);if(Ru.has(r))return Ru.get(r);const t=Ob(r);return t!==r&&(Ru.set(r,t),lh.set(t,r)),t}const Mu=r=>lh.get(r);function Fb(r,t,{blocked:e,upgrade:i,blocking:n,terminated:s}={}){const o=indexedDB.open(r,t),a=Ir(o);return i&&o.addEventListener("upgradeneeded",l=>{i(Ir(o.result),l.oldVersion,l.newVersion,Ir(o.transaction),l)}),e&&o.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),n&&l.addEventListener("versionchange",h=>n(h.oldVersion,h.newVersion,h))}).catch(()=>{}),a}const Db=["get","getKey","getAll","getAllKeys","count"],Lb=["put","add","delete","clear"],Ou=new Map;function Ef(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Ou.get(t))return Ou.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,n=Lb.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(n||Db.includes(e)))return;const s=async function(o,...a){const l=this.transaction(o,n?"readwrite":"readonly");let h=l.store;return i&&(h=h.index(a.shift())),(await Promise.all([h[e](...a),n&&l.done]))[0]};return Ou.set(t,s),s}Rb(r=>({...r,get:(t,e,i)=>Ef(t,e)||r.get(t,e,i),has:(t,e)=>!!Ef(t,e)||r.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(kb(e)){const i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}}function kb(r){const t=r.getComponent();return t?.type==="VERSION"}const gl="@firebase/app",Tf="0.10.15";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const or=new uh("@firebase/app"),Bb="@firebase/app-compat",Ub="@firebase/analytics-compat",Vb="@firebase/analytics",Gb="@firebase/app-check-compat",jb="@firebase/app-check",Hb="@firebase/auth",$b="@firebase/auth-compat",zb="@firebase/database",Xb="@firebase/data-connect",Wb="@firebase/database-compat",qb="@firebase/functions",Yb="@firebase/functions-compat",Kb="@firebase/installations",Jb="@firebase/installations-compat",Qb="@firebase/messaging",Zb="@firebase/messaging-compat",tA="@firebase/performance",eA="@firebase/performance-compat",rA="@firebase/remote-config",iA="@firebase/remote-config-compat",nA="@firebase/storage",sA="@firebase/storage-compat",oA="@firebase/firestore",aA="@firebase/vertexai",uA="@firebase/firestore-compat",lA="firebase",hA="11.0.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vl="[DEFAULT]",cA={[gl]:"fire-core",[Bb]:"fire-core-compat",[Vb]:"fire-analytics",[Ub]:"fire-analytics-compat",[jb]:"fire-app-check",[Gb]:"fire-app-check-compat",[Hb]:"fire-auth",[$b]:"fire-auth-compat",[zb]:"fire-rtdb",[Xb]:"fire-data-connect",[Wb]:"fire-rtdb-compat",[qb]:"fire-fn",[Yb]:"fire-fn-compat",[Kb]:"fire-iid",[Jb]:"fire-iid-compat",[Qb]:"fire-fcm",[Zb]:"fire-fcm-compat",[tA]:"fire-perf",[eA]:"fire-perf-compat",[rA]:"fire-rc",[iA]:"fire-rc-compat",[nA]:"fire-gcs",[sA]:"fire-gcs-compat",[oA]:"fire-fst",[uA]:"fire-fst-compat",[aA]:"fire-vertex","fire-js":"fire-js",[lA]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ho=new Map,dA=new Map,_l=new Map;function If(r,t){try{r.container.addComponent(t)}catch(e){or.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function ci(r){const t=r.name;if(_l.has(t))return or.debug(`There were multiple attempts to register component ${t}.`),!1;_l.set(t,r);for(const e of Ho.values())If(e,r);for(const e of dA.values())If(e,r);return!0}function ya(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function Ze(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fA={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},wr=new _s("app","Firebase",fA);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Pr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw wr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const on=hA;function Ym(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const i=Object.assign({name:vl,automaticDataCollectionEnabled:!1},t),n=i.name;if(typeof n!="string"||!n)throw wr.create("bad-app-name",{appName:String(n)});if(e||(e=zm()),!e)throw wr.create("no-options");const s=Ho.get(n);if(s){if(jo(e,s.options)&&jo(i,s.config))return s;throw wr.create("duplicate-app",{appName:n})}const o=new Eb(n);for(const l of _l.values())o.addComponent(l);const a=new pA(e,i,o);return Ho.set(n,a),a}function hh(r=vl){const t=Ho.get(r);if(!t&&r===vl&&zm())return Ym();if(!t)throw wr.create("no-app",{appName:r});return t}function Ge(r,t,e){var i;let n=(i=cA[r])!==null&&i!==void 0?i:r;e&&(n+=`-${e}`);const s=n.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),or.warn(a.join(" "));return}ci(new Pr(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mA="firebase-heartbeat-database",gA=1,ss="firebase-heartbeat-store";let Fu=null;function Km(){return Fu||(Fu=Fb(mA,gA,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(ss)}catch(e){console.warn(e)}}}}).catch(r=>{throw wr.create("idb-open",{originalErrorMessage:r.message})})),Fu}async function vA(r){try{const e=(await Km()).transaction(ss),i=await e.objectStore(ss).get(Jm(r));return await e.done,i}catch(t){if(t instanceof Xe)or.warn(t.message);else{const e=wr.create("idb-get",{originalErrorMessage:t?.message});or.warn(e.message)}}}async function wf(r,t){try{const i=(await Km()).transaction(ss,"readwrite");await i.objectStore(ss).put(t,Jm(r)),await i.done}catch(e){if(e instanceof Xe)or.warn(e.message);else{const i=wr.create("idb-set",{originalErrorMessage:e?.message});or.warn(i.message)}}}function Jm(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _A=1024,yA=30*24*60*60*1e3;class EA{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new IA(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=bf();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=yA}),this._storage.overwrite(this._heartbeatsCache))}catch(i){or.warn(i)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=bf(),{heartbeatsToSend:i,unsentEntries:n}=TA(this._heartbeatsCache.heartbeats),s=Go(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return or.warn(e),""}}}function bf(){return new Date().toISOString().substring(0,10)}function TA(r,t=_A){const e=[];let i=r.slice();for(const n of r){const s=e.find(o=>o.agent===n.agent);if(s){if(s.dates.push(n.date),Af(e)>t){s.dates.pop();break}}else if(e.push({agent:n.agent,dates:[n.date]}),Af(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}class IA{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ub()?lb().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await vA(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return wf(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return wf(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function Af(r){return Go(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wA(r){ci(new Pr("platform-logger",t=>new Nb(t),"PRIVATE")),ci(new Pr("heartbeat",t=>new EA(t),"PRIVATE")),Ge(gl,Tf,r),Ge(gl,Tf,"esm2017"),Ge("fire-js","")}wA("");var bA="firebase",AA="11.0.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ge(bA,AA,"app");const CA={apiKey:"AIzaSyC2xQmoosnYMXgmiY4JbCzx8KRfK3kGgJQ",authDomain:"my-project-15193-name-diary.firebaseapp.com",projectId:"my-project-15193-name-diary",storageBucket:"my-project-15193-name-diary.firebasestorage.app",messagingSenderId:"410472769008",appId:"1:410472769008:web:ce68bdfd3ba911bda4a935",measurementId:"G-S4ENDR9WY9"},Ea=Ym(CA);function ch(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function os(r){return this instanceof os?(this.v=r,this):new os(r)}function xA(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(r,t||[]),n,s=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(g){return function(_){return Promise.resolve(_).then(g,p)}}function a(g,_){i[g]&&(n[g]=function(A){return new Promise(function(y,S){s.push([g,A,y,S])>1||l(g,A)})},_&&(n[g]=_(n[g])))}function l(g,_){try{h(i[g](_))}catch(A){m(s[0][3],A)}}function h(g){g.value instanceof os?Promise.resolve(g.value.v).then(c,p):m(s[0][2],g)}function c(g){l("next",g)}function p(g){l("throw",g)}function m(g,_){g(_),s.shift(),s.length&&l(s[0][0],s[0][1])}}function Qm(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const PA=Qm,Zm=new _s("auth","Firebase",Qm());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $o=new uh("@firebase/auth");function SA(r,...t){$o.logLevel<=Q.WARN&&$o.warn(`Auth (${on}): ${r}`,...t)}function To(r,...t){$o.logLevel<=Q.ERROR&&$o.error(`Auth (${on}): ${r}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function He(r,...t){throw fh(r,...t)}function Oe(r,...t){return fh(r,...t)}function dh(r,t,e){const i=Object.assign(Object.assign({},PA()),{[t]:e});return new _s("auth","Firebase",i).create(t,{appName:r.name})}function ai(r){return dh(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function RA(r,t,e){const i=e;if(!(t instanceof i))throw i.name!==t.constructor.name&&He(r,"argument-error"),dh(r,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function fh(r,...t){if(typeof r!="string"){const e=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=r.name),r._errorFactory.create(e,...i)}return Zm.create(r,...t)}function $(r,t,...e){if(!r)throw fh(t,...e)}function tr(r){const t="INTERNAL ASSERTION FAILED: "+r;throw To(t),new Error(t)}function ar(r,t){r||tr(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yl(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function MA(){return Cf()==="http:"||Cf()==="https:"}function Cf(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(MA()||nb()||"connection"in navigator)?navigator.onLine:!0}function FA(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(t,e){this.shortDelay=t,this.longDelay=e,ar(e>t,"Short delay should be less than long delay!"),this.isMobile=eb()||sb()}get(){return OA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(r,t){ar(r.emulator,"Emulator should always be set here");const{url:e}=r.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;tr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;tr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;tr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=new Es(3e4,6e4);function mh(r,t){return r.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:r.tenantId}):t}async function an(r,t,e,i,n={}){return eg(r,n,async()=>{let s={},o={};i&&(t==="GET"?o=i:s={body:JSON.stringify(i)});const a=ys(Object.assign({key:r.config.apiKey},o)).slice(1),l=await r._getAdditionalHeaders();l["Content-Type"]="application/json",r.languageCode&&(l["X-Firebase-Locale"]=r.languageCode);const h=Object.assign({method:t,headers:l},s);return ib()||(h.referrerPolicy="no-referrer"),tg.fetch()(rg(r,r.config.apiHost,e,a),h)})}async function eg(r,t,e){r._canInitEmulator=!1;const i=Object.assign(Object.assign({},DA),t);try{const n=new kA(r),s=await Promise.race([e(),n.promise]);n.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw uo(r,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[l,h]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw uo(r,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw uo(r,"email-already-in-use",o);if(l==="USER_DISABLED")throw uo(r,"user-disabled",o);const c=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw dh(r,c,h);He(r,c)}}catch(n){if(n instanceof Xe)throw n;He(r,"network-request-failed",{message:String(n)})}}async function NA(r,t,e,i,n={}){const s=await an(r,t,e,i,n);return"mfaPendingCredential"in s&&He(r,"multi-factor-auth-required",{_serverResponse:s}),s}function rg(r,t,e,i){const n=`${t}${e}?${i}`;return r.config.emulator?ph(r.config,n):`${r.config.apiScheme}://${n}`}class kA{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,i)=>{this.timer=setTimeout(()=>i(Oe(this.auth,"network-request-failed")),LA.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function uo(r,t,e){const i={appName:r.name};e.email&&(i.email=e.email),e.phoneNumber&&(i.phoneNumber=e.phoneNumber);const n=Oe(r,t,i);return n.customData._tokenResponse=e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BA(r,t){return an(r,"POST","/v1/accounts:delete",t)}async function ig(r,t){return an(r,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $n(r){if(!!r)try{const t=new Date(Number(r));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function UA(r,t=!1){const e=ve(r),i=await e.getIdToken(t),n=gh(i);$(n&&n.exp&&n.auth_time&&n.iat,e.auth,"internal-error");const s=typeof n.firebase=="object"?n.firebase:void 0,o=s?.sign_in_provider;return{claims:n,token:i,authTime:$n(Du(n.auth_time)),issuedAtTime:$n(Du(n.iat)),expirationTime:$n(Du(n.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Du(r){return Number(r)*1e3}function gh(r){const[t,e,i]=r.split(".");if(t===void 0||e===void 0||i===void 0)return To("JWT malformed, contained fewer than 3 sections"),null;try{const n=Hm(e);return n?JSON.parse(n):(To("Failed to decode base64 JWT payload"),null)}catch(n){return To("Caught error parsing JWT payload as JSON",n?.toString()),null}}function xf(r){const t=gh(r);return $(t,"internal-error"),$(typeof t.exp<"u","internal-error"),$(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function as(r,t,e=!1){if(e)return t;try{return await t}catch(i){throw i instanceof Xe&&VA(i)&&r.auth.currentUser===r&&await r.auth.signOut(),i}}function VA({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GA{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const n=((e=this.user.stsTokenManager.expirationTime)!==null&&e!==void 0?e:0)-Date.now()-3e5;return Math.max(0,n)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class El{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=$n(this.lastLoginAt),this.creationTime=$n(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zo(r){var t;const e=r.auth,i=await r.getIdToken(),n=await as(r,ig(e,{idToken:i}));$(n?.users.length,e,"internal-error");const s=n.users[0];r._notifyReloadListener(s);const o=!((t=s.providerUserInfo)===null||t===void 0)&&t.length?ng(s.providerUserInfo):[],a=HA(r.providerData,o),l=r.isAnonymous,h=!(r.email&&s.passwordHash)&&!a?.length,c=l?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new El(s.createdAt,s.lastLoginAt),isAnonymous:c};Object.assign(r,p)}async function jA(r){const t=ve(r);await zo(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function HA(r,t){return[...r.filter(i=>!t.some(n=>n.providerId===i.providerId)),...t]}function ng(r){return r.map(t=>{var{providerId:e}=t,i=ch(t,["providerId"]);return{providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $A(r,t){const e=await eg(r,{},async()=>{const i=ys({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:s}=r.config,o=rg(r,n,"/v1/token",`key=${s}`),a=await r._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",tg.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function zA(r,t){return an(r,"POST","/v2/accounts:revokeToken",mh(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){$(t.idToken,"internal-error"),$(typeof t.idToken<"u","internal-error"),$(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):xf(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){$(t.length!==0,"internal-error");const e=xf(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:($(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:i,refreshToken:n,expiresIn:s}=await $A(t,e);this.updateTokensAndExpiration(i,n,Number(s))}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,e){const{refreshToken:i,accessToken:n,expirationTime:s}=e,o=new Hi;return i&&($(typeof i=="string","internal-error",{appName:t}),o.refreshToken=i),n&&($(typeof n=="string","internal-error",{appName:t}),o.accessToken=n),s&&($(typeof s=="number","internal-error",{appName:t}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Hi,this.toJSON())}_performRefresh(){return tr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fr(r,t){$(typeof r=="string"||typeof r>"u","internal-error",{appName:t})}class er{constructor(t){var{uid:e,auth:i,stsTokenManager:n}=t,s=ch(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new GA(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new El(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await as(this,this.stsTokenManager.getToken(this.auth,t));return $(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return UA(this,t)}reload(){return jA(this)}_assign(t){this!==t&&($(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>Object.assign({},e)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new er(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){$(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&await zo(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ze(this.auth.app))return Promise.reject(ai(this.auth));const t=await this.getIdToken();return await as(this,BA(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var i,n,s,o,a,l,h,c;const p=(i=e.displayName)!==null&&i!==void 0?i:void 0,m=(n=e.email)!==null&&n!==void 0?n:void 0,g=(s=e.phoneNumber)!==null&&s!==void 0?s:void 0,_=(o=e.photoURL)!==null&&o!==void 0?o:void 0,A=(a=e.tenantId)!==null&&a!==void 0?a:void 0,y=(l=e._redirectEventId)!==null&&l!==void 0?l:void 0,S=(h=e.createdAt)!==null&&h!==void 0?h:void 0,M=(c=e.lastLoginAt)!==null&&c!==void 0?c:void 0,{uid:x,emailVerified:F,isAnonymous:B,providerData:N,stsTokenManager:b}=e;$(x&&b,t,"internal-error");const E=Hi.fromJSON(this.name,b);$(typeof x=="string",t,"internal-error"),fr(p,t.name),fr(m,t.name),$(typeof F=="boolean",t,"internal-error"),$(typeof B=="boolean",t,"internal-error"),fr(g,t.name),fr(_,t.name),fr(A,t.name),fr(y,t.name),fr(S,t.name),fr(M,t.name);const T=new er({uid:x,auth:t,email:m,emailVerified:F,displayName:p,isAnonymous:B,photoURL:_,phoneNumber:g,tenantId:A,stsTokenManager:E,createdAt:S,lastLoginAt:M});return N&&Array.isArray(N)&&(T.providerData=N.map(w=>Object.assign({},w))),y&&(T._redirectEventId=y),T}static async _fromIdTokenResponse(t,e,i=!1){const n=new Hi;n.updateFromServerResponse(e);const s=new er({uid:e.localId,auth:t,stsTokenManager:n,isAnonymous:i});return await zo(s),s}static async _fromGetAccountInfoResponse(t,e,i){const n=e.users[0];$(n.localId!==void 0,"internal-error");const s=n.providerUserInfo!==void 0?ng(n.providerUserInfo):[],o=!(n.email&&n.passwordHash)&&!s?.length,a=new Hi;a.updateFromIdToken(i);const l=new er({uid:n.localId,auth:t,stsTokenManager:a,isAnonymous:o}),h={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:s,metadata:new El(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!s?.length};return Object.assign(l,h),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pf=new Map;function rr(r){ar(r instanceof Function,"Expected a class definition");let t=Pf.get(r);return t?(ar(t instanceof r,"Instance stored in cache mismatched with class"),t):(t=new r,Pf.set(r,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}sg.type="NONE";const Sf=sg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Io(r,t,e){return`firebase:${r}:${t}:${e}`}class $i{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;const{config:n,name:s}=this.auth;this.fullUserKey=Io(this.userKey,n.apiKey,s),this.fullPersistenceKey=Io("persistence",n.apiKey,s),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?er._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,i="authUser"){if(!e.length)return new $i(rr(Sf),t,i);const n=(await Promise.all(e.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let s=n[0]||rr(Sf);const o=Io(i,t.config.apiKey,t.name);let a=null;for(const h of e)try{const c=await h._get(o);if(c){const p=er._fromJSON(t,c);h!==s&&(a=p),s=h;break}}catch{}const l=n.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new $i(s,t,i):(s=l[0],a&&await s._set(o,a.toJSON()),await Promise.all(e.map(async h=>{if(h!==s)try{await h._remove(o)}catch{}})),new $i(s,t,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(r){const t=r.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(lg(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(og(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(cg(t))return"Blackberry";if(dg(t))return"Webos";if(ag(t))return"Safari";if((t.includes("chrome/")||ug(t))&&!t.includes("edge/"))return"Chrome";if(hg(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=r.match(e);if(i?.length===2)return i[1]}return"Other"}function og(r=ee()){return/firefox\//i.test(r)}function ag(r=ee()){const t=r.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ug(r=ee()){return/crios\//i.test(r)}function lg(r=ee()){return/iemobile/i.test(r)}function hg(r=ee()){return/android/i.test(r)}function cg(r=ee()){return/blackberry/i.test(r)}function dg(r=ee()){return/webos/i.test(r)}function vh(r=ee()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function XA(r=ee()){var t;return vh(r)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function WA(){return ob()&&document.documentMode===10}function fg(r=ee()){return vh(r)||hg(r)||dg(r)||cg(r)||/windows phone/i.test(r)||lg(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(r,t=[]){let e;switch(r){case"Browser":e=Rf(ee());break;case"Worker":e=`${Rf(ee())}-${r}`;break;default:e=r}const i=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${on}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qA{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const i=s=>new Promise((o,a)=>{try{const l=t(s);o(l)}catch(l){a(l)}});i.onAbort=e,this.queue.push(i);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const i of this.queue)await i(t),i.onAbort&&e.push(i.onAbort)}catch(i){e.reverse();for(const n of e)try{n()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YA(r,t={}){return an(r,"GET","/v2/passwordPolicy",mh(r,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KA=6;class JA{constructor(t){var e,i,n,s;const o=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(e=o.minPasswordLength)!==null&&e!==void 0?e:KA,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(n=(i=t.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&n!==void 0?n:"",this.forceUpgradeOnSignin=(s=t.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,i,n,s,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(e=l.meetsMinPasswordLength)!==null&&e!==void 0?e:!0),l.isValid&&(l.isValid=(i=l.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(n=l.containsLowercaseLetter)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(t,e){const i=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;i&&(e.meetsMinPasswordLength=t.length>=i),n&&(e.meetsMaxPasswordLength=t.length<=n)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let i;for(let n=0;n<t.length;n++)i=t.charAt(n),this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,e,i,n,s){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QA{constructor(t,e,i,n){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=i,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Mf(this),this.idTokenSubscription=new Mf(this),this.beforeStateQueue=new qA(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Zm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=rr(e)),this._initializationPromise=this.queue(async()=>{var i,n;if(!this._deleted&&(this.persistenceManager=await $i.create(this,t),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=((n=this.currentUser)===null||n===void 0?void 0:n.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await ig(this,{idToken:t}),i=await er._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(i)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var e;if(Ze(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let n=i,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(e=this.redirectUser)===null||e===void 0?void 0:e._redirectEventId,a=n?._redirectEventId,l=await this.tryRedirectSignIn(t);(!o||o===a)&&l?.user&&(n=l.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return $(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await zo(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=FA()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ze(this.app))return Promise.reject(ai(this));const e=t?ve(t):null;return e&&$(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&$(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Ze(this.app)?Promise.reject(ai(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ze(this.app)?Promise.reject(ai(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(rr(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await YA(this),e=new JA(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new _s("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const i=this.onAuthStateChanged(()=>{i(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(i.tenantId=this.tenantId),await zA(this,i)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,e){const i=await this.getOrInitRedirectPersistenceManager(e);return t===null?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&rr(t)||this._popupRedirectResolver;$(e,this,"argument-error"),this.redirectPersistenceManager=await $i.create(this,[rr(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,i;return this._isInitialized&&await this.queue(async()=>{}),((e=this._currentUser)===null||e===void 0?void 0:e._redirectEventId)===t?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(e=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&e!==void 0?e:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,n){if(this._deleted)return()=>{};const s=typeof e=="function"?e:e.next.bind(e);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if($(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof e=="function"){const l=t.addObserver(e,i,n);return()=>{o=!0,l()}}else{const l=t.addObserver(e);return()=>{o=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return $(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=pg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const i=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());i&&(e["X-Firebase-Client"]=i);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){var t;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return e?.error&&SA(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Ta(r){return ve(r)}class Mf{constructor(t){this.auth=t,this.observer=null,this.addObserver=pb(e=>this.observer=e)}get next(){return $(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _h={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ZA(r){_h=r}function tC(r){return _h.loadJS(r)}function eC(){return _h.gapiScript}function rC(r){return`__${r}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iC(r,t){const e=ya(r,"auth");if(e.isInitialized()){const n=e.getImmediate(),s=e.getOptions();if(jo(s,t??{}))return n;He(n,"already-initialized")}return e.initialize({options:t})}function nC(r,t){const e=t?.persistence||[],i=(Array.isArray(e)?e:[e]).map(rr);t?.errorMap&&r._updateErrorMap(t.errorMap),r._initializeWithPersistence(i,t?.popupRedirectResolver)}function sC(r,t,e){const i=Ta(r);$(i._canInitEmulator,i,"emulator-config-failed"),$(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const n=!!e?.disableWarnings,s=mg(t),{host:o,port:a}=oC(t),l=a===null?"":`:${a}`;i.config.emulator={url:`${s}//${o}${l}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:n})}),n||aC()}function mg(r){const t=r.indexOf(":");return t<0?"":r.substr(0,t+1)}function oC(r){const t=mg(r),e=/(\/\/)?([^?#/]+)/.exec(r.substr(t.length));if(!e)return{host:"",port:null};const i=e[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(i);if(n){const s=n[1];return{host:s,port:Of(i.substr(s.length+1))}}else{const[s,o]=i.split(":");return{host:s,port:Of(o)}}}function Of(r){if(!r)return null;const t=Number(r);return isNaN(t)?null:t}function aC(){function r(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return tr("not implemented")}_getIdTokenResponse(t){return tr("not implemented")}_linkToIdToken(t,e){return tr("not implemented")}_getReauthenticationResolver(t){return tr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zi(r,t){return NA(r,"POST","/v1/accounts:signInWithIdp",mh(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC="http://localhost";class di extends gg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new di(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):He("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t,{providerId:i,signInMethod:n}=e,s=ch(e,["providerId","signInMethod"]);if(!i||!n)return null;const o=new di(i,n);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(t){const e=this.buildRequest();return zi(t,e)}_linkToIdToken(t,e){const i=this.buildRequest();return i.idToken=e,zi(t,i)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,zi(t,e)}buildRequest(){const t={requestUri:uC,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=ys(e)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts extends yh{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr extends Ts{constructor(){super("facebook.com")}static credential(t){return di._fromParams({providerId:vr.PROVIDER_ID,signInMethod:vr.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return vr.credentialFromTaggedObject(t)}static credentialFromError(t){return vr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return vr.credential(t.oauthAccessToken)}catch{return null}}}vr.FACEBOOK_SIGN_IN_METHOD="facebook.com";vr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe extends Ts{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return di._fromParams({providerId:Qe.PROVIDER_ID,signInMethod:Qe.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Qe.credentialFromTaggedObject(t)}static credentialFromError(t){return Qe.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:i}=t;if(!e&&!i)return null;try{return Qe.credential(e,i)}catch{return null}}}Qe.GOOGLE_SIGN_IN_METHOD="google.com";Qe.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r extends Ts{constructor(){super("github.com")}static credential(t){return di._fromParams({providerId:_r.PROVIDER_ID,signInMethod:_r.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return _r.credentialFromTaggedObject(t)}static credentialFromError(t){return _r.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return _r.credential(t.oauthAccessToken)}catch{return null}}}_r.GITHUB_SIGN_IN_METHOD="github.com";_r.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr extends Ts{constructor(){super("twitter.com")}static credential(t,e){return di._fromParams({providerId:yr.PROVIDER_ID,signInMethod:yr.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return yr.credentialFromTaggedObject(t)}static credentialFromError(t){return yr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:i}=t;if(!e||!i)return null;try{return yr.credential(e,i)}catch{return null}}}yr.TWITTER_SIGN_IN_METHOD="twitter.com";yr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,i,n=!1){const s=await er._fromIdTokenResponse(t,i,n),o=Ff(i);return new Ji({user:s,providerId:o,_tokenResponse:i,operationType:e})}static async _forOperation(t,e,i){await t._updateTokensIfNecessary(i,!0);const n=Ff(i);return new Ji({user:t,providerId:n,_tokenResponse:i,operationType:e})}}function Ff(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo extends Xe{constructor(t,e,i,n){var s;super(e.code,e.message),this.operationType=i,this.user=n,Object.setPrototypeOf(this,Xo.prototype),this.customData={appName:t.name,tenantId:(s=t.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:e.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(t,e,i,n){return new Xo(t,e,i,n)}}function vg(r,t,e,i){return(t==="reauthenticate"?e._getReauthenticationResolver(r):e._getIdTokenResponse(r)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Xo._fromErrorAndOperation(r,s,t,i):s})}async function lC(r,t,e=!1){const i=await as(r,t._linkToIdToken(r.auth,await r.getIdToken()),e);return Ji._forOperation(r,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hC(r,t,e=!1){const{auth:i}=r;if(Ze(i.app))return Promise.reject(ai(i));const n="reauthenticate";try{const s=await as(r,vg(i,n,t,r),e);$(s.idToken,i,"internal-error");const o=gh(s.idToken);$(o,i,"internal-error");const{sub:a}=o;return $(r.uid===a,i,"user-mismatch"),Ji._forOperation(r,n,s)}catch(s){throw s?.code==="auth/user-not-found"&&He(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cC(r,t,e=!1){if(Ze(r.app))return Promise.reject(ai(r));const i="signIn",n=await vg(r,i,t),s=await Ji._fromIdTokenResponse(r,i,n);return e||await r._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(r,t){return ve(r).setPersistence(t)}function fC(r,t,e,i){return ve(r).onIdTokenChanged(t,e,i)}function pC(r,t,e){return ve(r).beforeAuthStateChanged(t,e)}function mC(r){return ve(r).signOut()}const Wo="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Wo,"1"),this.storage.removeItem(Wo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gC=1e3,vC=10;class yg extends _g{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=fg(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const i=this.storage.getItem(e),n=this.localCache[e];i!==n&&t(e,n,i)}}onStorageEvent(t,e=!1){if(!t.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const i=t.key;e?this.detachListener():this.stopPolling();const n=()=>{const o=this.storage.getItem(i);!e&&this.localCache[i]===o||this.notifyListeners(i,o)},s=this.storage.getItem(i);WA()&&s!==t.newValue&&t.newValue!==t.oldValue?setTimeout(n,vC):n()}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const n of Array.from(i))n(e&&JSON.parse(e))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:i}),!0)})},gC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}yg.type="LOCAL";const Eg=yg;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg extends _g{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Tg.type="SESSION";const Ig=Tg;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _C(r){return Promise.all(r.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(n=>n.isListeningto(t));if(e)return e;const i=new Ia(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:i,eventType:n,data:s}=e.data,o=this.handlersMap[n];if(!o?.size)return;e.ports[0].postMessage({status:"ack",eventId:i,eventType:n});const a=Array.from(o).map(async h=>h(e.origin,s)),l=await _C(a);e.ports[0].postMessage({status:"done",eventId:i,eventType:n,response:l})}_subscribe(t,e){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),(!e||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ia.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eh(r="",t=10){let e="";for(let i=0;i<t;i++)e+=Math.floor(Math.random()*10);return r+e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,i=50){const n=typeof MessageChannel<"u"?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const h=Eh("",20);n.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},i);o={messageChannel:n,onMessage(p){const m=p;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(m.data.response);break;default:clearTimeout(c),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(o),n.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:h,data:e},[n.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(){return window}function EC(r){je().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wg(){return typeof je().WorkerGlobalScope<"u"&&typeof je().importScripts=="function"}async function TC(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function IC(){var r;return((r=navigator?.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function wC(){return wg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bg="firebaseLocalStorageDb",bC=1,qo="firebaseLocalStorage",Ag="fbase_key";class Is{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function wa(r,t){return r.transaction([qo],t?"readwrite":"readonly").objectStore(qo)}function AC(){const r=indexedDB.deleteDatabase(bg);return new Is(r).toPromise()}function Tl(){const r=indexedDB.open(bg,bC);return new Promise((t,e)=>{r.addEventListener("error",()=>{e(r.error)}),r.addEventListener("upgradeneeded",()=>{const i=r.result;try{i.createObjectStore(qo,{keyPath:Ag})}catch(n){e(n)}}),r.addEventListener("success",async()=>{const i=r.result;i.objectStoreNames.contains(qo)?t(i):(i.close(),await AC(),t(await Tl()))})})}async function Df(r,t,e){const i=wa(r,!0).put({[Ag]:t,value:e});return new Is(i).toPromise()}async function CC(r,t){const e=wa(r,!1).get(t),i=await new Is(e).toPromise();return i===void 0?null:i.value}function Lf(r,t){const e=wa(r,!0).delete(t);return new Is(e).toPromise()}const xC=800,PC=3;class Cg{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Tl(),this.db)}async _withRetries(t){let e=0;for(;;)try{const i=await this._openDb();return await t(i)}catch(i){if(e++>PC)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return wg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ia._getInstance(wC()),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){var t,e;if(this.activeServiceWorker=await TC(),!this.activeServiceWorker)return;this.sender=new yC(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);!i||((t=i[0])===null||t===void 0?void 0:t.fulfilled)&&((e=i[0])===null||e===void 0?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||IC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Tl();return await Df(t,Wo,"1"),await Lf(t,Wo),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(i=>Df(i,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(i=>CC(i,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Lf(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(n=>{const s=wa(n,!1).getAll();return new Is(s).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const e=[],i=new Set;if(t.length!==0)for(const{fbase_key:n,value:s}of t)i.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(s)&&(this.notifyListeners(n,s),e.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!i.has(n)&&(this.notifyListeners(n,null),e.push(n));return e}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const n of Array.from(i))n(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),xC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Cg.type="LOCAL";const SC=Cg;new Es(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xg(r,t){return t?rr(t):($(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th extends gg{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return zi(t,this._buildIdpRequest())}_linkToIdToken(t,e){return zi(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return zi(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function RC(r){return cC(r.auth,new Th(r),r.bypassAuthState)}function MC(r){const{auth:t,user:e}=r;return $(e,t,"internal-error"),hC(e,new Th(r),r.bypassAuthState)}async function OC(r){const{auth:t,user:e}=r;return $(e,t,"internal-error"),lC(e,new Th(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(t,e,i,n,s=!1){this.auth=t,this.resolver=i,this.user=n,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:i,postBody:n,tenantId:s,error:o,type:a}=t;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:e,sessionId:i,tenantId:s||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(h){this.reject(h)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return RC;case"linkViaPopup":case"linkViaRedirect":return OC;case"reauthViaPopup":case"reauthViaRedirect":return MC;default:He(this.auth,"internal-error")}}resolve(t){ar(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){ar(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FC=new Es(2e3,1e4);async function DC(r,t,e){if(Ze(r.app))return Promise.reject(Oe(r,"operation-not-supported-in-this-environment"));const i=Ta(r);RA(r,t,yh);const n=xg(i,e);return new ei(i,"signInViaPopup",t,n).executeNotNull()}class ei extends Pg{constructor(t,e,i,n,s){super(t,e,n,s),this.provider=i,this.authWindow=null,this.pollId=null,ei.currentPopupAction&&ei.currentPopupAction.cancel(),ei.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return $(t,this.auth,"internal-error"),t}async onExecution(){ar(this.filter.length===1,"Popup operations only handle one event");const t=Eh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Oe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Oe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ei.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,i;if(!((i=(e=this.authWindow)===null||e===void 0?void 0:e.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Oe(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,FC.get())};t()}}ei.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LC="pendingRedirect",wo=new Map;class NC extends Pg{constructor(t,e,i=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,i),this.eventId=null}async execute(){let t=wo.get(this.auth._key());if(!t){try{const i=await kC(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}wo.set(this.auth._key(),t)}return this.bypassAuthState||wo.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function kC(r,t){const e=VC(t),i=UC(r);if(!await i._isAvailable())return!1;const n=await i._get(e)==="true";return await i._remove(e),n}function BC(r,t){wo.set(r._key(),t)}function UC(r){return rr(r._redirectPersistence)}function VC(r){return Io(LC,r.config.apiKey,r.name)}async function GC(r,t,e=!1){if(Ze(r.app))return Promise.reject(ai(r));const i=Ta(r),n=xg(i,t),o=await new NC(i,n,e).execute();return o&&!e&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC=10*60*1e3;class HC{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(t,i)&&(e=!0,this.sendToConsumer(t,i),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!$C(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var i;if(t.error&&!Sg(t)){const n=((i=t.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";e.onError(Oe(this.auth,n))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const i=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=jC&&this.cachedEventUids.clear(),this.cachedEventUids.has(Nf(t))}saveEventToCache(t){this.cachedEventUids.add(Nf(t)),this.lastProcessedEventTime=Date.now()}}function Nf(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(t=>t).join("-")}function Sg({type:r,error:t}){return r==="unknown"&&t?.code==="auth/no-auth-event"}function $C(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Sg(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zC(r,t={}){return an(r,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XC=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,WC=/^https?/;async function qC(r){if(r.config.emulator)return;const{authorizedDomains:t}=await zC(r);for(const e of t)try{if(YC(e))return}catch{}He(r,"unauthorized-domain")}function YC(r){const t=yl(),{protocol:e,hostname:i}=new URL(t);if(r.startsWith("chrome-extension://")){const o=new URL(r);return o.hostname===""&&i===""?e==="chrome-extension:"&&r.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&o.hostname===i}if(!WC.test(e))return!1;if(XC.test(r))return i===r;const n=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC=new Es(3e4,6e4);function kf(){const r=je().___jsl;if(r?.H){for(const t of Object.keys(r.H))if(r.H[t].r=r.H[t].r||[],r.H[t].L=r.H[t].L||[],r.H[t].r=[...r.H[t].L],r.CP)for(let e=0;e<r.CP.length;e++)r.CP[e]=null}}function JC(r){return new Promise((t,e)=>{var i,n,s;function o(){kf(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{kf(),e(Oe(r,"network-request-failed"))},timeout:KC.get()})}if(!((n=(i=je().gapi)===null||i===void 0?void 0:i.iframes)===null||n===void 0)&&n.Iframe)t(gapi.iframes.getContext());else if(!((s=je().gapi)===null||s===void 0)&&s.load)o();else{const a=rC("iframefcb");return je()[a]=()=>{gapi.load?o():e(Oe(r,"network-request-failed"))},tC(`${eC()}?onload=${a}`).catch(l=>e(l))}}).catch(t=>{throw bo=null,t})}let bo=null;function QC(r){return bo=bo||JC(r),bo}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZC=new Es(5e3,15e3),tx="__/auth/iframe",ex="emulator/auth/iframe",rx={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ix=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function nx(r){const t=r.config;$(t.authDomain,r,"auth-domain-config-required");const e=t.emulator?ph(t,ex):`https://${r.config.authDomain}/${tx}`,i={apiKey:t.apiKey,appName:r.name,v:on},n=ix.get(r.config.apiHost);n&&(i.eid=n);const s=r._getFrameworks();return s.length&&(i.fw=s.join(",")),`${e}?${ys(i).slice(1)}`}async function sx(r){const t=await QC(r),e=je().gapi;return $(e,r,"internal-error"),t.open({where:document.body,url:nx(r),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rx,dontclear:!0},i=>new Promise(async(n,s)=>{await i.restyle({setHideOnLeave:!1});const o=Oe(r,"network-request-failed"),a=je().setTimeout(()=>{s(o)},ZC.get());function l(){je().clearTimeout(a),n(i)}i.ping(l).then(l,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ox={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ax=500,ux=600,lx="_blank",hx="http://localhost";class Bf{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function cx(r,t,e,i=ax,n=ux){const s=Math.max((window.screen.availHeight-n)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const l=Object.assign(Object.assign({},ox),{width:i.toString(),height:n.toString(),top:s,left:o}),h=ee().toLowerCase();e&&(a=ug(h)?lx:e),og(h)&&(t=t||hx,l.scrollbars="yes");const c=Object.entries(l).reduce((m,[g,_])=>`${m}${g}=${_},`,"");if(XA(h)&&a!=="_self")return dx(t||"",a),new Bf(null);const p=window.open(t||"",a,c);$(p,r,"popup-blocked");try{p.focus()}catch{}return new Bf(p)}function dx(r,t){const e=document.createElement("a");e.href=r,e.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fx="__/auth/handler",px="emulator/auth/handler",mx=encodeURIComponent("fac");async function Uf(r,t,e,i,n,s){$(r.config.authDomain,r,"auth-domain-config-required"),$(r.config.apiKey,r,"invalid-api-key");const o={apiKey:r.config.apiKey,appName:r.name,authType:e,redirectUrl:i,v:on,eventId:n};if(t instanceof yh){t.setDefaultLanguage(r.languageCode),o.providerId=t.providerId||"",fb(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[c,p]of Object.entries(s||{}))o[c]=p}if(t instanceof Ts){const c=t.getScopes().filter(p=>p!=="");c.length>0&&(o.scopes=c.join(","))}r.tenantId&&(o.tid=r.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];const l=await r._getAppCheckToken(),h=l?`#${mx}=${encodeURIComponent(l)}`:"";return`${gx(r)}?${ys(a).slice(1)}${h}`}function gx({config:r}){return r.emulator?ph(r,px):`https://${r.authDomain}/${fx}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu="webStorageSupport";class vx{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ig,this._completeRedirectFn=GC,this._overrideRedirectResult=BC}async _openPopup(t,e,i,n){var s;ar((s=this.eventManagers[t._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await Uf(t,e,i,yl(),n);return cx(t,o,Eh())}async _openRedirect(t,e,i,n){await this._originValidation(t);const s=await Uf(t,e,i,yl(),n);return EC(s),new Promise(()=>{})}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:n,promise:s}=this.eventManagers[e];return n?Promise.resolve(n):(ar(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(t);return this.eventManagers[e]={promise:i},i.catch(()=>{delete this.eventManagers[e]}),i}async initAndGetManager(t){const e=await sx(t),i=new HC(t);return e.register("authEvent",n=>($(n?.authEvent,t,"invalid-auth-event"),{status:i.onEvent(n.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:i},this.iframes[t._key()]=e,i}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Lu,{type:Lu},n=>{var s;const o=(s=n?.[0])===null||s===void 0?void 0:s[Lu];o!==void 0&&e(!!o),He(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=qC(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return fg()||ag()||vh()}}const _x=vx;var Vf="@firebase/auth",Gf="1.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(i=>{t(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);!e||(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){$(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ex(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Tx(r){ci(new Pr("auth",(t,{options:e})=>{const i=t.getProvider("app").getImmediate(),n=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;$(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:o,authDomain:a,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pg(r)},h=new QA(i,n,s,l);return nC(h,e),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,i)=>{t.getProvider("auth-internal").initialize()})),ci(new Pr("auth-internal",t=>{const e=Ta(t.getProvider("auth").getImmediate());return(i=>new yx(i))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ge(Vf,Gf,Ex(r)),Ge(Vf,Gf,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ix=5*60,wx=Xm("authIdTokenMaxAge")||Ix;let jf=null;const bx=r=>async t=>{const e=t&&await t.getIdTokenResult(),i=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(i&&i>wx)return;const n=e?.token;jf!==n&&(jf=n,await fetch(r,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))};function Rg(r=hh()){const t=ya(r,"auth");if(t.isInitialized())return t.getImmediate();const e=iC(r,{popupRedirectResolver:_x,persistence:[SC,Eg,Ig]}),i=Xm("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const o=bx(s.toString());pC(e,o,()=>o(e.currentUser)),fC(e,a=>o(a))}}const n=$m("auth");return n&&sC(e,`http://${n}`),e}function Ax(){var r,t;return(t=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&t!==void 0?t:document}ZA({loadJS(r){return new Promise((t,e)=>{const i=document.createElement("script");i.setAttribute("src",r),i.onload=t,i.onerror=n=>{const s=Oe("internal-error");s.customData=n,e(s)},i.type="text/javascript",i.charset="UTF-8",Ax().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Tx("Browser");var Hf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mg;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(b,E){function T(){}T.prototype=E.prototype,b.D=E.prototype,b.prototype=new T,b.prototype.constructor=b,b.C=function(w,C,P){for(var I=Array(arguments.length-2),lt=2;lt<arguments.length;lt++)I[lt-2]=arguments[lt];return E.prototype[C].apply(w,I)}}function e(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(i,e),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function n(b,E,T){T||(T=0);var w=Array(16);if(typeof E=="string")for(var C=0;16>C;++C)w[C]=E.charCodeAt(T++)|E.charCodeAt(T++)<<8|E.charCodeAt(T++)<<16|E.charCodeAt(T++)<<24;else for(C=0;16>C;++C)w[C]=E[T++]|E[T++]<<8|E[T++]<<16|E[T++]<<24;E=b.g[0],T=b.g[1],C=b.g[2];var P=b.g[3],I=E+(P^T&(C^P))+w[0]+3614090360&4294967295;E=T+(I<<7&4294967295|I>>>25),I=P+(C^E&(T^C))+w[1]+3905402710&4294967295,P=E+(I<<12&4294967295|I>>>20),I=C+(T^P&(E^T))+w[2]+606105819&4294967295,C=P+(I<<17&4294967295|I>>>15),I=T+(E^C&(P^E))+w[3]+3250441966&4294967295,T=C+(I<<22&4294967295|I>>>10),I=E+(P^T&(C^P))+w[4]+4118548399&4294967295,E=T+(I<<7&4294967295|I>>>25),I=P+(C^E&(T^C))+w[5]+1200080426&4294967295,P=E+(I<<12&4294967295|I>>>20),I=C+(T^P&(E^T))+w[6]+2821735955&4294967295,C=P+(I<<17&4294967295|I>>>15),I=T+(E^C&(P^E))+w[7]+4249261313&4294967295,T=C+(I<<22&4294967295|I>>>10),I=E+(P^T&(C^P))+w[8]+1770035416&4294967295,E=T+(I<<7&4294967295|I>>>25),I=P+(C^E&(T^C))+w[9]+2336552879&4294967295,P=E+(I<<12&4294967295|I>>>20),I=C+(T^P&(E^T))+w[10]+4294925233&4294967295,C=P+(I<<17&4294967295|I>>>15),I=T+(E^C&(P^E))+w[11]+2304563134&4294967295,T=C+(I<<22&4294967295|I>>>10),I=E+(P^T&(C^P))+w[12]+1804603682&4294967295,E=T+(I<<7&4294967295|I>>>25),I=P+(C^E&(T^C))+w[13]+4254626195&4294967295,P=E+(I<<12&4294967295|I>>>20),I=C+(T^P&(E^T))+w[14]+2792965006&4294967295,C=P+(I<<17&4294967295|I>>>15),I=T+(E^C&(P^E))+w[15]+1236535329&4294967295,T=C+(I<<22&4294967295|I>>>10),I=E+(C^P&(T^C))+w[1]+4129170786&4294967295,E=T+(I<<5&4294967295|I>>>27),I=P+(T^C&(E^T))+w[6]+3225465664&4294967295,P=E+(I<<9&4294967295|I>>>23),I=C+(E^T&(P^E))+w[11]+643717713&4294967295,C=P+(I<<14&4294967295|I>>>18),I=T+(P^E&(C^P))+w[0]+3921069994&4294967295,T=C+(I<<20&4294967295|I>>>12),I=E+(C^P&(T^C))+w[5]+3593408605&4294967295,E=T+(I<<5&4294967295|I>>>27),I=P+(T^C&(E^T))+w[10]+38016083&4294967295,P=E+(I<<9&4294967295|I>>>23),I=C+(E^T&(P^E))+w[15]+3634488961&4294967295,C=P+(I<<14&4294967295|I>>>18),I=T+(P^E&(C^P))+w[4]+3889429448&4294967295,T=C+(I<<20&4294967295|I>>>12),I=E+(C^P&(T^C))+w[9]+568446438&4294967295,E=T+(I<<5&4294967295|I>>>27),I=P+(T^C&(E^T))+w[14]+3275163606&4294967295,P=E+(I<<9&4294967295|I>>>23),I=C+(E^T&(P^E))+w[3]+4107603335&4294967295,C=P+(I<<14&4294967295|I>>>18),I=T+(P^E&(C^P))+w[8]+1163531501&4294967295,T=C+(I<<20&4294967295|I>>>12),I=E+(C^P&(T^C))+w[13]+2850285829&4294967295,E=T+(I<<5&4294967295|I>>>27),I=P+(T^C&(E^T))+w[2]+4243563512&4294967295,P=E+(I<<9&4294967295|I>>>23),I=C+(E^T&(P^E))+w[7]+1735328473&4294967295,C=P+(I<<14&4294967295|I>>>18),I=T+(P^E&(C^P))+w[12]+2368359562&4294967295,T=C+(I<<20&4294967295|I>>>12),I=E+(T^C^P)+w[5]+4294588738&4294967295,E=T+(I<<4&4294967295|I>>>28),I=P+(E^T^C)+w[8]+2272392833&4294967295,P=E+(I<<11&4294967295|I>>>21),I=C+(P^E^T)+w[11]+1839030562&4294967295,C=P+(I<<16&4294967295|I>>>16),I=T+(C^P^E)+w[14]+4259657740&4294967295,T=C+(I<<23&4294967295|I>>>9),I=E+(T^C^P)+w[1]+2763975236&4294967295,E=T+(I<<4&4294967295|I>>>28),I=P+(E^T^C)+w[4]+1272893353&4294967295,P=E+(I<<11&4294967295|I>>>21),I=C+(P^E^T)+w[7]+4139469664&4294967295,C=P+(I<<16&4294967295|I>>>16),I=T+(C^P^E)+w[10]+3200236656&4294967295,T=C+(I<<23&4294967295|I>>>9),I=E+(T^C^P)+w[13]+681279174&4294967295,E=T+(I<<4&4294967295|I>>>28),I=P+(E^T^C)+w[0]+3936430074&4294967295,P=E+(I<<11&4294967295|I>>>21),I=C+(P^E^T)+w[3]+3572445317&4294967295,C=P+(I<<16&4294967295|I>>>16),I=T+(C^P^E)+w[6]+76029189&4294967295,T=C+(I<<23&4294967295|I>>>9),I=E+(T^C^P)+w[9]+3654602809&4294967295,E=T+(I<<4&4294967295|I>>>28),I=P+(E^T^C)+w[12]+3873151461&4294967295,P=E+(I<<11&4294967295|I>>>21),I=C+(P^E^T)+w[15]+530742520&4294967295,C=P+(I<<16&4294967295|I>>>16),I=T+(C^P^E)+w[2]+3299628645&4294967295,T=C+(I<<23&4294967295|I>>>9),I=E+(C^(T|~P))+w[0]+4096336452&4294967295,E=T+(I<<6&4294967295|I>>>26),I=P+(T^(E|~C))+w[7]+1126891415&4294967295,P=E+(I<<10&4294967295|I>>>22),I=C+(E^(P|~T))+w[14]+2878612391&4294967295,C=P+(I<<15&4294967295|I>>>17),I=T+(P^(C|~E))+w[5]+4237533241&4294967295,T=C+(I<<21&4294967295|I>>>11),I=E+(C^(T|~P))+w[12]+1700485571&4294967295,E=T+(I<<6&4294967295|I>>>26),I=P+(T^(E|~C))+w[3]+2399980690&4294967295,P=E+(I<<10&4294967295|I>>>22),I=C+(E^(P|~T))+w[10]+4293915773&4294967295,C=P+(I<<15&4294967295|I>>>17),I=T+(P^(C|~E))+w[1]+2240044497&4294967295,T=C+(I<<21&4294967295|I>>>11),I=E+(C^(T|~P))+w[8]+1873313359&4294967295,E=T+(I<<6&4294967295|I>>>26),I=P+(T^(E|~C))+w[15]+4264355552&4294967295,P=E+(I<<10&4294967295|I>>>22),I=C+(E^(P|~T))+w[6]+2734768916&4294967295,C=P+(I<<15&4294967295|I>>>17),I=T+(P^(C|~E))+w[13]+1309151649&4294967295,T=C+(I<<21&4294967295|I>>>11),I=E+(C^(T|~P))+w[4]+4149444226&4294967295,E=T+(I<<6&4294967295|I>>>26),I=P+(T^(E|~C))+w[11]+3174756917&4294967295,P=E+(I<<10&4294967295|I>>>22),I=C+(E^(P|~T))+w[2]+718787259&4294967295,C=P+(I<<15&4294967295|I>>>17),I=T+(P^(C|~E))+w[9]+3951481745&4294967295,b.g[0]=b.g[0]+E&4294967295,b.g[1]=b.g[1]+(C+(I<<21&4294967295|I>>>11))&4294967295,b.g[2]=b.g[2]+C&4294967295,b.g[3]=b.g[3]+P&4294967295}i.prototype.u=function(b,E){E===void 0&&(E=b.length);for(var T=E-this.blockSize,w=this.B,C=this.h,P=0;P<E;){if(C==0)for(;P<=T;)n(this,b,P),P+=this.blockSize;if(typeof b=="string"){for(;P<E;)if(w[C++]=b.charCodeAt(P++),C==this.blockSize){n(this,w),C=0;break}}else for(;P<E;)if(w[C++]=b[P++],C==this.blockSize){n(this,w),C=0;break}}this.h=C,this.o+=E},i.prototype.v=function(){var b=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);b[0]=128;for(var E=1;E<b.length-8;++E)b[E]=0;var T=8*this.o;for(E=b.length-8;E<b.length;++E)b[E]=T&255,T/=256;for(this.u(b),b=Array(16),E=T=0;4>E;++E)for(var w=0;32>w;w+=8)b[T++]=this.g[E]>>>w&255;return b};function s(b,E){var T=a;return Object.prototype.hasOwnProperty.call(T,b)?T[b]:T[b]=E(b)}function o(b,E){this.h=E;for(var T=[],w=!0,C=b.length-1;0<=C;C--){var P=b[C]|0;w&&P==E||(T[C]=P,w=!1)}this.g=T}var a={};function l(b){return-128<=b&&128>b?s(b,function(E){return new o([E|0],0>E?-1:0)}):new o([b|0],0>b?-1:0)}function h(b){if(isNaN(b)||!isFinite(b))return p;if(0>b)return y(h(-b));for(var E=[],T=1,w=0;b>=T;w++)E[w]=b/T|0,T*=4294967296;return new o(E,0)}function c(b,E){if(b.length==0)throw Error("number format error: empty string");if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(b.charAt(0)=="-")return y(c(b.substring(1),E));if(0<=b.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=h(Math.pow(E,8)),w=p,C=0;C<b.length;C+=8){var P=Math.min(8,b.length-C),I=parseInt(b.substring(C,C+P),E);8>P?(P=h(Math.pow(E,P)),w=w.j(P).add(h(I))):(w=w.j(T),w=w.add(h(I)))}return w}var p=l(0),m=l(1),g=l(16777216);r=o.prototype,r.m=function(){if(A(this))return-y(this).m();for(var b=0,E=1,T=0;T<this.g.length;T++){var w=this.i(T);b+=(0<=w?w:4294967296+w)*E,E*=4294967296}return b},r.toString=function(b){if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(_(this))return"0";if(A(this))return"-"+y(this).toString(b);for(var E=h(Math.pow(b,6)),T=this,w="";;){var C=F(T,E).g;T=S(T,C.j(E));var P=((0<T.g.length?T.g[0]:T.h)>>>0).toString(b);if(T=C,_(T))return P+w;for(;6>P.length;)P="0"+P;w=P+w}},r.i=function(b){return 0>b?0:b<this.g.length?this.g[b]:this.h};function _(b){if(b.h!=0)return!1;for(var E=0;E<b.g.length;E++)if(b.g[E]!=0)return!1;return!0}function A(b){return b.h==-1}r.l=function(b){return b=S(this,b),A(b)?-1:_(b)?0:1};function y(b){for(var E=b.g.length,T=[],w=0;w<E;w++)T[w]=~b.g[w];return new o(T,~b.h).add(m)}r.abs=function(){return A(this)?y(this):this},r.add=function(b){for(var E=Math.max(this.g.length,b.g.length),T=[],w=0,C=0;C<=E;C++){var P=w+(this.i(C)&65535)+(b.i(C)&65535),I=(P>>>16)+(this.i(C)>>>16)+(b.i(C)>>>16);w=I>>>16,P&=65535,I&=65535,T[C]=I<<16|P}return new o(T,T[T.length-1]&-2147483648?-1:0)};function S(b,E){return b.add(y(E))}r.j=function(b){if(_(this)||_(b))return p;if(A(this))return A(b)?y(this).j(y(b)):y(y(this).j(b));if(A(b))return y(this.j(y(b)));if(0>this.l(g)&&0>b.l(g))return h(this.m()*b.m());for(var E=this.g.length+b.g.length,T=[],w=0;w<2*E;w++)T[w]=0;for(w=0;w<this.g.length;w++)for(var C=0;C<b.g.length;C++){var P=this.i(w)>>>16,I=this.i(w)&65535,lt=b.i(C)>>>16,Tt=b.i(C)&65535;T[2*w+2*C]+=I*Tt,M(T,2*w+2*C),T[2*w+2*C+1]+=P*Tt,M(T,2*w+2*C+1),T[2*w+2*C+1]+=I*lt,M(T,2*w+2*C+1),T[2*w+2*C+2]+=P*lt,M(T,2*w+2*C+2)}for(w=0;w<E;w++)T[w]=T[2*w+1]<<16|T[2*w];for(w=E;w<2*E;w++)T[w]=0;return new o(T,0)};function M(b,E){for(;(b[E]&65535)!=b[E];)b[E+1]+=b[E]>>>16,b[E]&=65535,E++}function x(b,E){this.g=b,this.h=E}function F(b,E){if(_(E))throw Error("division by zero");if(_(b))return new x(p,p);if(A(b))return E=F(y(b),E),new x(y(E.g),y(E.h));if(A(E))return E=F(b,y(E)),new x(y(E.g),E.h);if(30<b.g.length){if(A(b)||A(E))throw Error("slowDivide_ only works with positive integers.");for(var T=m,w=E;0>=w.l(b);)T=B(T),w=B(w);var C=N(T,1),P=N(w,1);for(w=N(w,2),T=N(T,2);!_(w);){var I=P.add(w);0>=I.l(b)&&(C=C.add(T),P=I),w=N(w,1),T=N(T,1)}return E=S(b,C.j(E)),new x(C,E)}for(C=p;0<=b.l(E);){for(T=Math.max(1,Math.floor(b.m()/E.m())),w=Math.ceil(Math.log(T)/Math.LN2),w=48>=w?1:Math.pow(2,w-48),P=h(T),I=P.j(E);A(I)||0<I.l(b);)T-=w,P=h(T),I=P.j(E);_(P)&&(P=m),C=C.add(P),b=S(b,I)}return new x(C,b)}r.A=function(b){return F(this,b).h},r.and=function(b){for(var E=Math.max(this.g.length,b.g.length),T=[],w=0;w<E;w++)T[w]=this.i(w)&b.i(w);return new o(T,this.h&b.h)},r.or=function(b){for(var E=Math.max(this.g.length,b.g.length),T=[],w=0;w<E;w++)T[w]=this.i(w)|b.i(w);return new o(T,this.h|b.h)},r.xor=function(b){for(var E=Math.max(this.g.length,b.g.length),T=[],w=0;w<E;w++)T[w]=this.i(w)^b.i(w);return new o(T,this.h^b.h)};function B(b){for(var E=b.g.length+1,T=[],w=0;w<E;w++)T[w]=b.i(w)<<1|b.i(w-1)>>>31;return new o(T,b.h)}function N(b,E){var T=E>>5;E%=32;for(var w=b.g.length-T,C=[],P=0;P<w;P++)C[P]=0<E?b.i(P+T)>>>E|b.i(P+T+1)<<32-E:b.i(P+T);return new o(C,b.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=c,Mg=o}).apply(typeof Hf<"u"?Hf:typeof self<"u"?self:typeof window<"u"?window:{});var lo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Og,kn,Fg,Ao,Il,Dg,Lg,Ng;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,d,f){return u==Array.prototype||u==Object.prototype||(u[d]=f.value),u};function e(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof lo=="object"&&lo];for(var d=0;d<u.length;++d){var f=u[d];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var i=e(this);function n(u,d){if(d)t:{var f=i;u=u.split(".");for(var v=0;v<u.length-1;v++){var R=u[v];if(!(R in f))break t;f=f[R]}u=u[u.length-1],v=f[u],d=d(v),d!=v&&d!=null&&t(f,u,{configurable:!0,writable:!0,value:d})}}function s(u,d){u instanceof String&&(u+="");var f=0,v=!1,R={next:function(){if(!v&&f<u.length){var O=f++;return{value:d(O,u[O]),done:!1}}return v=!0,{done:!0,value:void 0}}};return R[Symbol.iterator]=function(){return R},R}n("Array.prototype.values",function(u){return u||function(){return s(this,function(d,f){return f})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var d=typeof u;return d=d!="object"?d:u?Array.isArray(u)?"array":d:"null",d=="array"||d=="object"&&typeof u.length=="number"}function h(u){var d=typeof u;return d=="object"&&u!=null||d=="function"}function c(u,d,f){return u.call.apply(u.bind,arguments)}function p(u,d,f){if(!u)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var R=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(R,v),u.apply(d,R)}}return function(){return u.apply(d,arguments)}}function m(u,d,f){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?c:p,m.apply(null,arguments)}function g(u,d){var f=Array.prototype.slice.call(arguments,1);return function(){var v=f.slice();return v.push.apply(v,arguments),u.apply(this,v)}}function _(u,d){function f(){}f.prototype=d.prototype,u.aa=d.prototype,u.prototype=new f,u.prototype.constructor=u,u.Qb=function(v,R,O){for(var k=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)k[nt-2]=arguments[nt];return d.prototype[R].apply(v,k)}}function A(u){const d=u.length;if(0<d){const f=Array(d);for(let v=0;v<d;v++)f[v]=u[v];return f}return[]}function y(u,d){for(let f=1;f<arguments.length;f++){const v=arguments[f];if(l(v)){const R=u.length||0,O=v.length||0;u.length=R+O;for(let k=0;k<O;k++)u[R+k]=v[k]}else u.push(v)}}class S{constructor(d,f){this.i=d,this.j=f,this.h=0,this.g=null}get(){let d;return 0<this.h?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}function M(u){return/^[\s\xa0]*$/.test(u)}function x(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function F(u){return F[" "](u),u}F[" "]=function(){};var B=x().indexOf("Gecko")!=-1&&!(x().toLowerCase().indexOf("webkit")!=-1&&x().indexOf("Edge")==-1)&&!(x().indexOf("Trident")!=-1||x().indexOf("MSIE")!=-1)&&x().indexOf("Edge")==-1;function N(u,d,f){for(const v in u)d.call(f,u[v],v,u)}function b(u,d){for(const f in u)d.call(void 0,u[f],f,u)}function E(u){const d={};for(const f in u)d[f]=u[f];return d}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(u,d){let f,v;for(let R=1;R<arguments.length;R++){v=arguments[R];for(f in v)u[f]=v[f];for(let O=0;O<T.length;O++)f=T[O],Object.prototype.hasOwnProperty.call(v,f)&&(u[f]=v[f])}}function C(u){var d=1;u=u.split(":");const f=[];for(;0<d&&u.length;)f.push(u.shift()),d--;return u.length&&f.push(u.join(":")),f}function P(u){a.setTimeout(()=>{throw u},0)}function I(){var u=ur;let d=null;return u.g&&(d=u.g,u.g=u.g.next,u.g||(u.h=null),d.next=null),d}class lt{constructor(){this.h=this.g=null}add(d,f){const v=Tt.get();v.set(d,f),this.h?this.h.next=v:this.g=v,this.h=v}}var Tt=new S(()=>new re,u=>u.reset());class re{constructor(){this.next=this.g=this.h=null}set(d,f){this.h=d,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let ue,We=!1,ur=new lt,V=()=>{const u=a.Promise.resolve(void 0);ue=()=>{u.then(W)}};var W=()=>{for(var u;u=I();){try{u.h.call(u.g)}catch(f){P(f)}var d=Tt;d.j(u),100>d.h&&(d.h++,u.next=d.g,d.g=u)}We=!1};function q(){this.s=this.s,this.C=this.C}q.prototype.s=!1,q.prototype.ma=function(){this.s||(this.s=!0,this.N())},q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Y(u,d){this.type=u,this.g=this.target=d,this.defaultPrevented=!1}Y.prototype.h=function(){this.defaultPrevented=!0};var ft=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,d=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const f=()=>{};a.addEventListener("test",f,d),a.removeEventListener("test",f,d)}catch{}return u}();function It(u,d){if(Y.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var f=this.type=u.type,v=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=d,d=u.relatedTarget){if(B){t:{try{F(d.nodeName);var R=!0;break t}catch{}R=!1}R||(d=null)}}else f=="mouseover"?d=u.fromElement:f=="mouseout"&&(d=u.toElement);this.relatedTarget=d,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:St[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&It.aa.h.call(this)}}_(It,Y);var St={2:"touch",3:"pen",4:"mouse"};It.prototype.h=function(){It.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Rt="closure_listenable_"+(1e6*Math.random()|0),fe=0;function _e(u,d,f,v,R){this.listener=u,this.proxy=null,this.src=d,this.type=f,this.capture=!!v,this.ha=R,this.key=++fe,this.da=this.fa=!1}function le(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function wt(u){this.src=u,this.g={},this.h=0}wt.prototype.add=function(u,d,f,v,R){var O=u.toString();u=this.g[O],u||(u=this.g[O]=[],this.h++);var k=ie(u,d,v,R);return-1<k?(d=u[k],f||(d.fa=!1)):(d=new _e(d,this.src,O,!!v,R),d.fa=f,u.push(d)),d};function Wt(u,d){var f=d.type;if(f in u.g){var v=u.g[f],R=Array.prototype.indexOf.call(v,d,void 0),O;(O=0<=R)&&Array.prototype.splice.call(v,R,1),O&&(le(d),u.g[f].length==0&&(delete u.g[f],u.h--))}}function ie(u,d,f,v){for(var R=0;R<u.length;++R){var O=u[R];if(!O.da&&O.listener==d&&O.capture==!!f&&O.ha==v)return R}return-1}var ye="closure_lm_"+(1e6*Math.random()|0),Ae={};function Ei(u,d,f,v,R){if(v&&v.once)return Wh(u,d,f,v,R);if(Array.isArray(d)){for(var O=0;O<d.length;O++)Ei(u,d[O],f,v,R);return null}return f=Da(f),u&&u[Rt]?u.K(d,f,h(v)?!!v.capture:!!v,R):Xh(u,d,f,!1,v,R)}function Xh(u,d,f,v,R,O){if(!d)throw Error("Invalid event type");var k=h(R)?!!R.capture:!!R,nt=Oa(u);if(nt||(u[ye]=nt=new wt(u)),f=nt.add(d,f,v,k,O),f.proxy)return f;if(v=kv(),f.proxy=v,v.src=u,v.listener=f,u.addEventListener)ft||(R=k),R===void 0&&(R=!1),u.addEventListener(d.toString(),v,R);else if(u.attachEvent)u.attachEvent(Yh(d.toString()),v);else if(u.addListener&&u.removeListener)u.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return f}function kv(){function u(f){return d.call(u.src,u.listener,f)}const d=Bv;return u}function Wh(u,d,f,v,R){if(Array.isArray(d)){for(var O=0;O<d.length;O++)Wh(u,d[O],f,v,R);return null}return f=Da(f),u&&u[Rt]?u.L(d,f,h(v)?!!v.capture:!!v,R):Xh(u,d,f,!0,v,R)}function qh(u,d,f,v,R){if(Array.isArray(d))for(var O=0;O<d.length;O++)qh(u,d[O],f,v,R);else v=h(v)?!!v.capture:!!v,f=Da(f),u&&u[Rt]?(u=u.i,d=String(d).toString(),d in u.g&&(O=u.g[d],f=ie(O,f,v,R),-1<f&&(le(O[f]),Array.prototype.splice.call(O,f,1),O.length==0&&(delete u.g[d],u.h--)))):u&&(u=Oa(u))&&(d=u.g[d.toString()],u=-1,d&&(u=ie(d,f,v,R)),(f=-1<u?d[u]:null)&&Ma(f))}function Ma(u){if(typeof u!="number"&&u&&!u.da){var d=u.src;if(d&&d[Rt])Wt(d.i,u);else{var f=u.type,v=u.proxy;d.removeEventListener?d.removeEventListener(f,v,u.capture):d.detachEvent?d.detachEvent(Yh(f),v):d.addListener&&d.removeListener&&d.removeListener(v),(f=Oa(d))?(Wt(f,u),f.h==0&&(f.src=null,d[ye]=null)):le(u)}}}function Yh(u){return u in Ae?Ae[u]:Ae[u]="on"+u}function Bv(u,d){if(u.da)u=!0;else{d=new It(d,this);var f=u.listener,v=u.ha||u.src;u.fa&&Ma(u),u=f.call(v,d)}return u}function Oa(u){return u=u[ye],u instanceof wt?u:null}var Fa="__closure_events_fn_"+(1e9*Math.random()>>>0);function Da(u){return typeof u=="function"?u:(u[Fa]||(u[Fa]=function(d){return u.handleEvent(d)}),u[Fa])}function qt(){q.call(this),this.i=new wt(this),this.M=this,this.F=null}_(qt,q),qt.prototype[Rt]=!0,qt.prototype.removeEventListener=function(u,d,f,v){qh(this,u,d,f,v)};function ne(u,d){var f,v=u.F;if(v)for(f=[];v;v=v.F)f.push(v);if(u=u.M,v=d.type||d,typeof d=="string")d=new Y(d,u);else if(d instanceof Y)d.target=d.target||u;else{var R=d;d=new Y(v,u),w(d,R)}if(R=!0,f)for(var O=f.length-1;0<=O;O--){var k=d.g=f[O];R=xs(k,v,!0,d)&&R}if(k=d.g=u,R=xs(k,v,!0,d)&&R,R=xs(k,v,!1,d)&&R,f)for(O=0;O<f.length;O++)k=d.g=f[O],R=xs(k,v,!1,d)&&R}qt.prototype.N=function(){if(qt.aa.N.call(this),this.i){var u=this.i,d;for(d in u.g){for(var f=u.g[d],v=0;v<f.length;v++)le(f[v]);delete u.g[d],u.h--}}this.F=null},qt.prototype.K=function(u,d,f,v){return this.i.add(String(u),d,!1,f,v)},qt.prototype.L=function(u,d,f,v){return this.i.add(String(u),d,!0,f,v)};function xs(u,d,f,v){if(d=u.i.g[String(d)],!d)return!0;d=d.concat();for(var R=!0,O=0;O<d.length;++O){var k=d[O];if(k&&!k.da&&k.capture==f){var nt=k.listener,kt=k.ha||k.src;k.fa&&Wt(u.i,k),R=nt.call(kt,v)!==!1&&R}}return R&&!v.defaultPrevented}function Kh(u,d,f){if(typeof u=="function")f&&(u=m(u,f));else if(u&&typeof u.handleEvent=="function")u=m(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(d)?-1:a.setTimeout(u,d||0)}function Jh(u){u.g=Kh(()=>{u.g=null,u.i&&(u.i=!1,Jh(u))},u.l);const d=u.h;u.h=null,u.m.apply(null,d)}class Uv extends q{constructor(d,f){super(),this.m=d,this.l=f,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:Jh(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function hn(u){q.call(this),this.h=u,this.g={}}_(hn,q);var Qh=[];function Zh(u){N(u.g,function(d,f){this.g.hasOwnProperty(f)&&Ma(d)},u),u.g={}}hn.prototype.N=function(){hn.aa.N.call(this),Zh(this)},hn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var La=a.JSON.stringify,Vv=a.JSON.parse,Gv=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function Na(){}Na.prototype.h=null;function tc(u){return u.h||(u.h=u.i())}function ec(){}var cn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ka(){Y.call(this,"d")}_(ka,Y);function Ba(){Y.call(this,"c")}_(Ba,Y);var Dr={},rc=null;function Ps(){return rc=rc||new qt}Dr.La="serverreachability";function ic(u){Y.call(this,Dr.La,u)}_(ic,Y);function dn(u){const d=Ps();ne(d,new ic(d))}Dr.STAT_EVENT="statevent";function nc(u,d){Y.call(this,Dr.STAT_EVENT,u),this.stat=d}_(nc,Y);function se(u){const d=Ps();ne(d,new nc(d,u))}Dr.Ma="timingevent";function sc(u,d){Y.call(this,Dr.Ma,u),this.size=d}_(sc,Y);function fn(u,d){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},d)}function pn(){this.g=!0}pn.prototype.xa=function(){this.g=!1};function jv(u,d,f,v,R,O){u.info(function(){if(u.g)if(O)for(var k="",nt=O.split("&"),kt=0;kt<nt.length;kt++){var rt=nt[kt].split("=");if(1<rt.length){var Yt=rt[0];rt=rt[1];var Kt=Yt.split("_");k=2<=Kt.length&&Kt[1]=="type"?k+(Yt+"="+rt+"&"):k+(Yt+"=redacted&")}}else k=null;else k=O;return"XMLHTTP REQ ("+v+") [attempt "+R+"]: "+d+`
`+f+`
`+k})}function Hv(u,d,f,v,R,O,k){u.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+R+"]: "+d+`
`+f+`
`+O+" "+k})}function Ti(u,d,f,v){u.info(function(){return"XMLHTTP TEXT ("+d+"): "+zv(u,f)+(v?" "+v:"")})}function $v(u,d){u.info(function(){return"TIMEOUT: "+d})}pn.prototype.info=function(){};function zv(u,d){if(!u.g)return d;if(!d)return null;try{var f=JSON.parse(d);if(f){for(u=0;u<f.length;u++)if(Array.isArray(f[u])){var v=f[u];if(!(2>v.length)){var R=v[1];if(Array.isArray(R)&&!(1>R.length)){var O=R[0];if(O!="noop"&&O!="stop"&&O!="close")for(var k=1;k<R.length;k++)R[k]=""}}}}return La(f)}catch{return d}}var Ss={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},oc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ua;function Rs(){}_(Rs,Na),Rs.prototype.g=function(){return new XMLHttpRequest},Rs.prototype.i=function(){return{}},Ua=new Rs;function lr(u,d,f,v){this.j=u,this.i=d,this.l=f,this.R=v||1,this.U=new hn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ac}function ac(){this.i=null,this.g="",this.h=!1}var uc={},Va={};function Ga(u,d,f){u.L=1,u.v=Ds(qe(d)),u.m=f,u.P=!0,lc(u,null)}function lc(u,d){u.F=Date.now(),Ms(u),u.A=qe(u.v);var f=u.A,v=u.R;Array.isArray(v)||(v=[String(v)]),wc(f.i,"t",v),u.C=0,f=u.j.J,u.h=new ac,u.g=Gc(u.j,f?d:null,!u.m),0<u.O&&(u.M=new Uv(m(u.Y,u,u.g),u.O)),d=u.U,f=u.g,v=u.ca;var R="readystatechange";Array.isArray(R)||(R&&(Qh[0]=R.toString()),R=Qh);for(var O=0;O<R.length;O++){var k=Ei(f,R[O],v||d.handleEvent,!1,d.h||d);if(!k)break;d.g[k.key]=k}d=u.H?E(u.H):{},u.m?(u.u||(u.u="POST"),d["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,d)):(u.u="GET",u.g.ea(u.A,u.u,null,d)),dn(),jv(u.i,u.u,u.A,u.l,u.R,u.m)}lr.prototype.ca=function(u){u=u.target;const d=this.M;d&&Ye(u)==3?d.j():this.Y(u)},lr.prototype.Y=function(u){try{if(u==this.g)t:{const Kt=Ye(this.g);var d=this.g.Ba();const bi=this.g.Z();if(!(3>Kt)&&(Kt!=3||this.g&&(this.h.h||this.g.oa()||Rc(this.g)))){this.J||Kt!=4||d==7||(d==8||0>=bi?dn(3):dn(2)),ja(this);var f=this.g.Z();this.X=f;e:if(hc(this)){var v=Rc(this.g);u="";var R=v.length,O=Ye(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Lr(this),mn(this);var k="";break e}this.h.i=new a.TextDecoder}for(d=0;d<R;d++)this.h.h=!0,u+=this.h.i.decode(v[d],{stream:!(O&&d==R-1)});v.length=0,this.h.g+=u,this.C=0,k=this.h.g}else k=this.g.oa();if(this.o=f==200,Hv(this.i,this.u,this.A,this.l,this.R,Kt,f),this.o){if(this.T&&!this.K){e:{if(this.g){var nt,kt=this.g;if((nt=kt.g?kt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(nt)){var rt=nt;break e}}rt=null}if(f=rt)Ti(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ha(this,f);else{this.o=!1,this.s=3,se(12),Lr(this),mn(this);break t}}if(this.P){f=!0;let Ce;for(;!this.J&&this.C<k.length;)if(Ce=Xv(this,k),Ce==Va){Kt==4&&(this.s=4,se(14),f=!1),Ti(this.i,this.l,null,"[Incomplete Response]");break}else if(Ce==uc){this.s=4,se(15),Ti(this.i,this.l,k,"[Invalid Chunk]"),f=!1;break}else Ti(this.i,this.l,Ce,null),Ha(this,Ce);if(hc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Kt!=4||k.length!=0||this.h.h||(this.s=1,se(16),f=!1),this.o=this.o&&f,!f)Ti(this.i,this.l,k,"[Invalid Chunked Response]"),Lr(this),mn(this);else if(0<k.length&&!this.W){this.W=!0;var Yt=this.j;Yt.g==this&&Yt.ba&&!Yt.M&&(Yt.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),Ya(Yt),Yt.M=!0,se(11))}}else Ti(this.i,this.l,k,null),Ha(this,k);Kt==4&&Lr(this),this.o&&!this.J&&(Kt==4?kc(this.j,this):(this.o=!1,Ms(this)))}else l_(this.g),f==400&&0<k.indexOf("Unknown SID")?(this.s=3,se(12)):(this.s=0,se(13)),Lr(this),mn(this)}}}catch{}finally{}};function hc(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Xv(u,d){var f=u.C,v=d.indexOf(`
`,f);return v==-1?Va:(f=Number(d.substring(f,v)),isNaN(f)?uc:(v+=1,v+f>d.length?Va:(d=d.slice(v,v+f),u.C=v+f,d)))}lr.prototype.cancel=function(){this.J=!0,Lr(this)};function Ms(u){u.S=Date.now()+u.I,cc(u,u.I)}function cc(u,d){if(u.B!=null)throw Error("WatchDog timer not null");u.B=fn(m(u.ba,u),d)}function ja(u){u.B&&(a.clearTimeout(u.B),u.B=null)}lr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?($v(this.i,this.A),this.L!=2&&(dn(),se(17)),Lr(this),this.s=2,mn(this)):cc(this,this.S-u)};function mn(u){u.j.G==0||u.J||kc(u.j,u)}function Lr(u){ja(u);var d=u.M;d&&typeof d.ma=="function"&&d.ma(),u.M=null,Zh(u.U),u.g&&(d=u.g,u.g=null,d.abort(),d.ma())}function Ha(u,d){try{var f=u.j;if(f.G!=0&&(f.g==u||$a(f.h,u))){if(!u.K&&$a(f.h,u)&&f.G==3){try{var v=f.Da.g.parse(d)}catch{v=null}if(Array.isArray(v)&&v.length==3){var R=v;if(R[0]==0){t:if(!f.u){if(f.g)if(f.g.F+3e3<u.F)Vs(f),Bs(f);else break t;qa(f),se(18)}}else f.za=R[1],0<f.za-f.T&&37500>R[2]&&f.F&&f.v==0&&!f.C&&(f.C=fn(m(f.Za,f),6e3));if(1>=pc(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else kr(f,11)}else if((u.K||f.g==u)&&Vs(f),!M(d))for(R=f.Da.g.parse(d),d=0;d<R.length;d++){let rt=R[d];if(f.T=rt[0],rt=rt[1],f.G==2)if(rt[0]=="c"){f.K=rt[1],f.ia=rt[2];const Yt=rt[3];Yt!=null&&(f.la=Yt,f.j.info("VER="+f.la));const Kt=rt[4];Kt!=null&&(f.Aa=Kt,f.j.info("SVER="+f.Aa));const bi=rt[5];bi!=null&&typeof bi=="number"&&0<bi&&(v=1.5*bi,f.L=v,f.j.info("backChannelRequestTimeoutMs_="+v)),v=f;const Ce=u.g;if(Ce){const js=Ce.g?Ce.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(js){var O=v.h;O.g||js.indexOf("spdy")==-1&&js.indexOf("quic")==-1&&js.indexOf("h2")==-1||(O.j=O.l,O.g=new Set,O.h&&(za(O,O.h),O.h=null))}if(v.D){const Ka=Ce.g?Ce.g.getResponseHeader("X-HTTP-Session-Id"):null;Ka&&(v.ya=Ka,ht(v.I,v.D,Ka))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-u.F,f.j.info("Handshake RTT: "+f.R+"ms")),v=f;var k=u;if(v.qa=Vc(v,v.J?v.ia:null,v.W),k.K){mc(v.h,k);var nt=k,kt=v.L;kt&&(nt.I=kt),nt.B&&(ja(nt),Ms(nt)),v.g=k}else Lc(v);0<f.i.length&&Us(f)}else rt[0]!="stop"&&rt[0]!="close"||kr(f,7);else f.G==3&&(rt[0]=="stop"||rt[0]=="close"?rt[0]=="stop"?kr(f,7):Wa(f):rt[0]!="noop"&&f.l&&f.l.ta(rt),f.v=0)}}dn(4)}catch{}}var Wv=class{constructor(u,d){this.g=u,this.map=d}};function dc(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fc(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function pc(u){return u.h?1:u.g?u.g.size:0}function $a(u,d){return u.h?u.h==d:u.g?u.g.has(d):!1}function za(u,d){u.g?u.g.add(d):u.h=d}function mc(u,d){u.h&&u.h==d?u.h=null:u.g&&u.g.has(d)&&u.g.delete(d)}dc.prototype.cancel=function(){if(this.i=gc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function gc(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let d=u.i;for(const f of u.g.values())d=d.concat(f.D);return d}return A(u.i)}function qv(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var d=[],f=u.length,v=0;v<f;v++)d.push(u[v]);return d}d=[],f=0;for(v in u)d[f++]=u[v];return d}function Yv(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var d=[];u=u.length;for(var f=0;f<u;f++)d.push(f);return d}d=[],f=0;for(const v in u)d[f++]=v;return d}}}function vc(u,d){if(u.forEach&&typeof u.forEach=="function")u.forEach(d,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,d,void 0);else for(var f=Yv(u),v=qv(u),R=v.length,O=0;O<R;O++)d.call(void 0,v[O],f&&f[O],u)}var _c=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Kv(u,d){if(u){u=u.split("&");for(var f=0;f<u.length;f++){var v=u[f].indexOf("="),R=null;if(0<=v){var O=u[f].substring(0,v);R=u[f].substring(v+1)}else O=u[f];d(O,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Nr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Nr){this.h=u.h,Os(this,u.j),this.o=u.o,this.g=u.g,Fs(this,u.s),this.l=u.l;var d=u.i,f=new _n;f.i=d.i,d.g&&(f.g=new Map(d.g),f.h=d.h),yc(this,f),this.m=u.m}else u&&(d=String(u).match(_c))?(this.h=!1,Os(this,d[1]||"",!0),this.o=gn(d[2]||""),this.g=gn(d[3]||"",!0),Fs(this,d[4]),this.l=gn(d[5]||"",!0),yc(this,d[6]||"",!0),this.m=gn(d[7]||"")):(this.h=!1,this.i=new _n(null,this.h))}Nr.prototype.toString=function(){var u=[],d=this.j;d&&u.push(vn(d,Ec,!0),":");var f=this.g;return(f||d=="file")&&(u.push("//"),(d=this.o)&&u.push(vn(d,Ec,!0),"@"),u.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&u.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&u.push("/"),u.push(vn(f,f.charAt(0)=="/"?Zv:Qv,!0))),(f=this.i.toString())&&u.push("?",f),(f=this.m)&&u.push("#",vn(f,e_)),u.join("")};function qe(u){return new Nr(u)}function Os(u,d,f){u.j=f?gn(d,!0):d,u.j&&(u.j=u.j.replace(/:$/,""))}function Fs(u,d){if(d){if(d=Number(d),isNaN(d)||0>d)throw Error("Bad port number "+d);u.s=d}else u.s=null}function yc(u,d,f){d instanceof _n?(u.i=d,r_(u.i,u.h)):(f||(d=vn(d,t_)),u.i=new _n(d,u.h))}function ht(u,d,f){u.i.set(d,f)}function Ds(u){return ht(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function gn(u,d){return u?d?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function vn(u,d,f){return typeof u=="string"?(u=encodeURI(u).replace(d,Jv),f&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Jv(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Ec=/[#\/\?@]/g,Qv=/[#\?:]/g,Zv=/[#\?]/g,t_=/[#\?@]/g,e_=/#/g;function _n(u,d){this.h=this.g=null,this.i=u||null,this.j=!!d}function hr(u){u.g||(u.g=new Map,u.h=0,u.i&&Kv(u.i,function(d,f){u.add(decodeURIComponent(d.replace(/\+/g," ")),f)}))}r=_n.prototype,r.add=function(u,d){hr(this),this.i=null,u=Ii(this,u);var f=this.g.get(u);return f||this.g.set(u,f=[]),f.push(d),this.h+=1,this};function Tc(u,d){hr(u),d=Ii(u,d),u.g.has(d)&&(u.i=null,u.h-=u.g.get(d).length,u.g.delete(d))}function Ic(u,d){return hr(u),d=Ii(u,d),u.g.has(d)}r.forEach=function(u,d){hr(this),this.g.forEach(function(f,v){f.forEach(function(R){u.call(d,R,v,this)},this)},this)},r.na=function(){hr(this);const u=Array.from(this.g.values()),d=Array.from(this.g.keys()),f=[];for(let v=0;v<d.length;v++){const R=u[v];for(let O=0;O<R.length;O++)f.push(d[v])}return f},r.V=function(u){hr(this);let d=[];if(typeof u=="string")Ic(this,u)&&(d=d.concat(this.g.get(Ii(this,u))));else{u=Array.from(this.g.values());for(let f=0;f<u.length;f++)d=d.concat(u[f])}return d},r.set=function(u,d){return hr(this),this.i=null,u=Ii(this,u),Ic(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[d]),this.h+=1,this},r.get=function(u,d){return u?(u=this.V(u),0<u.length?String(u[0]):d):d};function wc(u,d,f){Tc(u,d),0<f.length&&(u.i=null,u.g.set(Ii(u,d),A(f)),u.h+=f.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],d=Array.from(this.g.keys());for(var f=0;f<d.length;f++){var v=d[f];const O=encodeURIComponent(String(v)),k=this.V(v);for(v=0;v<k.length;v++){var R=O;k[v]!==""&&(R+="="+encodeURIComponent(String(k[v]))),u.push(R)}}return this.i=u.join("&")};function Ii(u,d){return d=String(d),u.j&&(d=d.toLowerCase()),d}function r_(u,d){d&&!u.j&&(hr(u),u.i=null,u.g.forEach(function(f,v){var R=v.toLowerCase();v!=R&&(Tc(this,v),wc(this,R,f))},u)),u.j=d}function i_(u,d){const f=new pn;if(a.Image){const v=new Image;v.onload=g(cr,f,"TestLoadImage: loaded",!0,d,v),v.onerror=g(cr,f,"TestLoadImage: error",!1,d,v),v.onabort=g(cr,f,"TestLoadImage: abort",!1,d,v),v.ontimeout=g(cr,f,"TestLoadImage: timeout",!1,d,v),a.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=u}else d(!1)}function n_(u,d){const f=new pn,v=new AbortController,R=setTimeout(()=>{v.abort(),cr(f,"TestPingServer: timeout",!1,d)},1e4);fetch(u,{signal:v.signal}).then(O=>{clearTimeout(R),O.ok?cr(f,"TestPingServer: ok",!0,d):cr(f,"TestPingServer: server error",!1,d)}).catch(()=>{clearTimeout(R),cr(f,"TestPingServer: error",!1,d)})}function cr(u,d,f,v,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),v(f)}catch{}}function s_(){this.g=new Gv}function o_(u,d,f){const v=f||"";try{vc(u,function(R,O){let k=R;h(R)&&(k=La(R)),d.push(v+O+"="+encodeURIComponent(k))})}catch(R){throw d.push(v+"type="+encodeURIComponent("_badmap")),R}}function Ls(u){this.l=u.Ub||null,this.j=u.eb||!1}_(Ls,Na),Ls.prototype.g=function(){return new Ns(this.l,this.j)},Ls.prototype.i=function(u){return function(){return u}}({});function Ns(u,d){qt.call(this),this.D=u,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}_(Ns,qt),r=Ns.prototype,r.open=function(u,d){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=d,this.readyState=1,En(this)},r.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const d={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(d.body=u),(this.D||a).fetch(new Request(this.A,d)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,yn(this)),this.readyState=0},r.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;bc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function bc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}r.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var d=u.value?u.value:new Uint8Array(0);(d=this.v.decode(d,{stream:!u.done}))&&(this.response=this.responseText+=d)}u.done?yn(this):En(this),this.readyState==3&&bc(this)}},r.Ra=function(u){this.g&&(this.response=this.responseText=u,yn(this))},r.Qa=function(u){this.g&&(this.response=u,yn(this))},r.ga=function(){this.g&&yn(this)};function yn(u){u.readyState=4,u.l=null,u.j=null,u.v=null,En(u)}r.setRequestHeader=function(u,d){this.u.append(u,d)},r.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],d=this.h.entries();for(var f=d.next();!f.done;)f=f.value,u.push(f[0]+": "+f[1]),f=d.next();return u.join(`\r
`)};function En(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Ns.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Ac(u){let d="";return N(u,function(f,v){d+=v,d+=":",d+=f,d+=`\r
`}),d}function Xa(u,d,f){t:{for(v in f){var v=!1;break t}v=!0}v||(f=Ac(f),typeof u=="string"?f!=null&&encodeURIComponent(String(f)):ht(u,d,f))}function _t(u){qt.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}_(_t,qt);var a_=/^https?$/i,u_=["POST","PUT"];r=_t.prototype,r.Ha=function(u){this.J=u},r.ea=function(u,d,f,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);d=d?d.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ua.g(),this.v=this.o?tc(this.o):tc(Ua),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(d,String(u),!0),this.B=!1}catch(O){Cc(this,O);return}if(u=f||"",f=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var R in v)f.set(R,v[R]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const O of v.keys())f.set(O,v.get(O));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(f.keys()).find(O=>O.toLowerCase()=="content-type"),R=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(u_,d,void 0))||v||R||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[O,k]of f)this.g.setRequestHeader(O,k);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Sc(this),this.u=!0,this.g.send(u),this.u=!1}catch(O){Cc(this,O)}};function Cc(u,d){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=d,u.m=5,xc(u),ks(u)}function xc(u){u.A||(u.A=!0,ne(u,"complete"),ne(u,"error"))}r.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,ne(this,"complete"),ne(this,"abort"),ks(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ks(this,!0)),_t.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Pc(this):this.bb())},r.bb=function(){Pc(this)};function Pc(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Ye(u)!=4||u.Z()!=2)){if(u.u&&Ye(u)==4)Kh(u.Ea,0,u);else if(ne(u,"readystatechange"),Ye(u)==4){u.h=!1;try{const k=u.Z();t:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d=!0;break t;default:d=!1}var f;if(!(f=d)){var v;if(v=k===0){var R=String(u.D).match(_c)[1]||null;!R&&a.self&&a.self.location&&(R=a.self.location.protocol.slice(0,-1)),v=!a_.test(R?R.toLowerCase():"")}f=v}if(f)ne(u,"complete"),ne(u,"success");else{u.m=6;try{var O=2<Ye(u)?u.g.statusText:""}catch{O=""}u.l=O+" ["+u.Z()+"]",xc(u)}}finally{ks(u)}}}}function ks(u,d){if(u.g){Sc(u);const f=u.g,v=u.v[0]?()=>{}:null;u.g=null,u.v=null,d||ne(u,"ready");try{f.onreadystatechange=v}catch{}}}function Sc(u){u.I&&(a.clearTimeout(u.I),u.I=null)}r.isActive=function(){return!!this.g};function Ye(u){return u.g?u.g.readyState:0}r.Z=function(){try{return 2<Ye(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(u){if(this.g){var d=this.g.responseText;return u&&d.indexOf(u)==0&&(d=d.substring(u.length)),Vv(d)}};function Rc(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function l_(u){const d={};u=(u.g&&2<=Ye(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<u.length;v++){if(M(u[v]))continue;var f=C(u[v]);const R=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const O=d[R]||[];d[R]=O,O.push(f)}b(d,function(v){return v.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Tn(u,d,f){return f&&f.internalChannelParams&&f.internalChannelParams[u]||d}function Mc(u){this.Aa=0,this.i=[],this.j=new pn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Tn("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Tn("baseRetryDelayMs",5e3,u),this.cb=Tn("retryDelaySeedMs",1e4,u),this.Wa=Tn("forwardChannelMaxRetries",2,u),this.wa=Tn("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new dc(u&&u.concurrentRequestLimit),this.Da=new s_,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Mc.prototype,r.la=8,r.G=1,r.connect=function(u,d,f,v){se(0),this.W=u,this.H=d||{},f&&v!==void 0&&(this.H.OSID=f,this.H.OAID=v),this.F=this.X,this.I=Vc(this,null,this.W),Us(this)};function Wa(u){if(Oc(u),u.G==3){var d=u.U++,f=qe(u.I);if(ht(f,"SID",u.K),ht(f,"RID",d),ht(f,"TYPE","terminate"),In(u,f),d=new lr(u,u.j,d),d.L=2,d.v=Ds(qe(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(d.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=d.v,f=!0),f||(d.g=Gc(d.j,null),d.g.ea(d.v)),d.F=Date.now(),Ms(d)}Uc(u)}function Bs(u){u.g&&(Ya(u),u.g.cancel(),u.g=null)}function Oc(u){Bs(u),u.u&&(a.clearTimeout(u.u),u.u=null),Vs(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function Us(u){if(!fc(u.h)&&!u.s){u.s=!0;var d=u.Ga;ue||V(),We||(ue(),We=!0),ur.add(d,u),u.B=0}}function h_(u,d){return pc(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=d.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=fn(m(u.Ga,u,d),Bc(u,u.B)),u.B++,!0)}r.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const R=new lr(this,this.j,u);let O=this.o;if(this.S&&(O?(O=E(O),w(O,this.S)):O=this.S),this.m!==null||this.O||(R.H=O,O=null),this.P)t:{for(var d=0,f=0;f<this.i.length;f++){e:{var v=this.i[f];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break e}v=void 0}if(v===void 0)break;if(d+=v,4096<d){d=f;break t}if(d===4096||f===this.i.length-1){d=f+1;break t}}d=1e3}else d=1e3;d=Dc(this,R,d),f=qe(this.I),ht(f,"RID",u),ht(f,"CVER",22),this.D&&ht(f,"X-HTTP-Session-Id",this.D),In(this,f),O&&(this.O?d="headers="+encodeURIComponent(String(Ac(O)))+"&"+d:this.m&&Xa(f,this.m,O)),za(this.h,R),this.Ua&&ht(f,"TYPE","init"),this.P?(ht(f,"$req",d),ht(f,"SID","null"),R.T=!0,Ga(R,f,null)):Ga(R,f,d),this.G=2}}else this.G==3&&(u?Fc(this,u):this.i.length==0||fc(this.h)||Fc(this))};function Fc(u,d){var f;d?f=d.l:f=u.U++;const v=qe(u.I);ht(v,"SID",u.K),ht(v,"RID",f),ht(v,"AID",u.T),In(u,v),u.m&&u.o&&Xa(v,u.m,u.o),f=new lr(u,u.j,f,u.B+1),u.m===null&&(f.H=u.o),d&&(u.i=d.D.concat(u.i)),d=Dc(u,f,1e3),f.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),za(u.h,f),Ga(f,v,d)}function In(u,d){u.H&&N(u.H,function(f,v){ht(d,v,f)}),u.l&&vc({},function(f,v){ht(d,v,f)})}function Dc(u,d,f){f=Math.min(u.i.length,f);var v=u.l?m(u.l.Na,u.l,u):null;t:{var R=u.i;let O=-1;for(;;){const k=["count="+f];O==-1?0<f?(O=R[0].g,k.push("ofs="+O)):O=0:k.push("ofs="+O);let nt=!0;for(let kt=0;kt<f;kt++){let rt=R[kt].g;const Yt=R[kt].map;if(rt-=O,0>rt)O=Math.max(0,R[kt].g-100),nt=!1;else try{o_(Yt,k,"req"+rt+"_")}catch{v&&v(Yt)}}if(nt){v=k.join("&");break t}}}return u=u.i.splice(0,f),d.D=u,v}function Lc(u){if(!u.g&&!u.u){u.Y=1;var d=u.Fa;ue||V(),We||(ue(),We=!0),ur.add(d,u),u.v=0}}function qa(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=fn(m(u.Fa,u),Bc(u,u.v)),u.v++,!0)}r.Fa=function(){if(this.u=null,Nc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=fn(m(this.ab,this),u)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,se(10),Bs(this),Nc(this))};function Ya(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Nc(u){u.g=new lr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var d=qe(u.qa);ht(d,"RID","rpc"),ht(d,"SID",u.K),ht(d,"AID",u.T),ht(d,"CI",u.F?"0":"1"),!u.F&&u.ja&&ht(d,"TO",u.ja),ht(d,"TYPE","xmlhttp"),In(u,d),u.m&&u.o&&Xa(d,u.m,u.o),u.L&&(u.g.I=u.L);var f=u.g;u=u.ia,f.L=1,f.v=Ds(qe(d)),f.m=null,f.P=!0,lc(f,u)}r.Za=function(){this.C!=null&&(this.C=null,Bs(this),qa(this),se(19))};function Vs(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function kc(u,d){var f=null;if(u.g==d){Vs(u),Ya(u),u.g=null;var v=2}else if($a(u.h,d))f=d.D,mc(u.h,d),v=1;else return;if(u.G!=0){if(d.o)if(v==1){f=d.m?d.m.length:0,d=Date.now()-d.F;var R=u.B;v=Ps(),ne(v,new sc(v,f)),Us(u)}else Lc(u);else if(R=d.s,R==3||R==0&&0<d.X||!(v==1&&h_(u,d)||v==2&&qa(u)))switch(f&&0<f.length&&(d=u.h,d.i=d.i.concat(f)),R){case 1:kr(u,5);break;case 4:kr(u,10);break;case 3:kr(u,6);break;default:kr(u,2)}}}function Bc(u,d){let f=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(f*=2),f*d}function kr(u,d){if(u.j.info("Error code "+d),d==2){var f=m(u.fb,u),v=u.Xa;const R=!v;v=new Nr(v||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Os(v,"https"),Ds(v),R?i_(v.toString(),f):n_(v.toString(),f)}else se(2);u.G=0,u.l&&u.l.sa(d),Uc(u),Oc(u)}r.fb=function(u){u?(this.j.info("Successfully pinged google.com"),se(2)):(this.j.info("Failed to ping google.com"),se(1))};function Uc(u){if(u.G=0,u.ka=[],u.l){const d=gc(u.h);(d.length!=0||u.i.length!=0)&&(y(u.ka,d),y(u.ka,u.i),u.h.i.length=0,A(u.i),u.i.length=0),u.l.ra()}}function Vc(u,d,f){var v=f instanceof Nr?qe(f):new Nr(f);if(v.g!="")d&&(v.g=d+"."+v.g),Fs(v,v.s);else{var R=a.location;v=R.protocol,d=d?d+"."+R.hostname:R.hostname,R=+R.port;var O=new Nr(null);v&&Os(O,v),d&&(O.g=d),R&&Fs(O,R),f&&(O.l=f),v=O}return f=u.D,d=u.ya,f&&d&&ht(v,f,d),ht(v,"VER",u.la),In(u,v),v}function Gc(u,d,f){if(d&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return d=u.Ca&&!u.pa?new _t(new Ls({eb:f})):new _t(u.pa),d.Ha(u.J),d}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function jc(){}r=jc.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Gs(){}Gs.prototype.g=function(u,d){return new pe(u,d)};function pe(u,d){qt.call(this),this.g=new Mc(d),this.l=u,this.h=d&&d.messageUrlParams||null,u=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(u?u["X-WebChannel-Content-Type"]=d.messageContentType:u={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.va&&(u?u["X-WebChannel-Client-Profile"]=d.va:u={"X-WebChannel-Client-Profile":d.va}),this.g.S=u,(u=d&&d.Sb)&&!M(u)&&(this.g.m=u),this.v=d&&d.supportsCrossDomainXhr||!1,this.u=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!M(d)&&(this.g.D=d,u=this.h,u!==null&&d in u&&(u=this.h,d in u&&delete u[d])),this.j=new wi(this)}_(pe,qt),pe.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},pe.prototype.close=function(){Wa(this.g)},pe.prototype.o=function(u){var d=this.g;if(typeof u=="string"){var f={};f.__data__=u,u=f}else this.u&&(f={},f.__data__=La(u),u=f);d.i.push(new Wv(d.Ya++,u)),d.G==3&&Us(d)},pe.prototype.N=function(){this.g.l=null,delete this.j,Wa(this.g),delete this.g,pe.aa.N.call(this)};function Hc(u){ka.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var d=u.__sm__;if(d){t:{for(const f in d){u=f;break t}u=void 0}(this.i=u)&&(u=this.i,d=d!==null&&u in d?d[u]:void 0),this.data=d}else this.data=u}_(Hc,ka);function $c(){Ba.call(this),this.status=1}_($c,Ba);function wi(u){this.g=u}_(wi,jc),wi.prototype.ua=function(){ne(this.g,"a")},wi.prototype.ta=function(u){ne(this.g,new Hc(u))},wi.prototype.sa=function(u){ne(this.g,new $c)},wi.prototype.ra=function(){ne(this.g,"b")},Gs.prototype.createWebChannel=Gs.prototype.g,pe.prototype.send=pe.prototype.o,pe.prototype.open=pe.prototype.m,pe.prototype.close=pe.prototype.close,Ng=function(){return new Gs},Lg=function(){return Ps()},Dg=Dr,Il={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ss.NO_ERROR=0,Ss.TIMEOUT=8,Ss.HTTP_ERROR=6,Ao=Ss,oc.COMPLETE="complete",Fg=oc,ec.EventType=cn,cn.OPEN="a",cn.CLOSE="b",cn.ERROR="c",cn.MESSAGE="d",qt.prototype.listen=qt.prototype.K,kn=ec,_t.prototype.listenOnce=_t.prototype.L,_t.prototype.getLastError=_t.prototype.Ka,_t.prototype.getLastErrorCode=_t.prototype.Ba,_t.prototype.getStatus=_t.prototype.Z,_t.prototype.getResponseJson=_t.prototype.Oa,_t.prototype.getResponseText=_t.prototype.oa,_t.prototype.send=_t.prototype.ea,_t.prototype.setWithCredentials=_t.prototype.Ha,Og=_t}).apply(typeof lo<"u"?lo:typeof self<"u"?self:typeof window<"u"?window:{});const $f="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Qt.UNAUTHENTICATED=new Qt(null),Qt.GOOGLE_CREDENTIALS=new Qt("google-credentials-uid"),Qt.FIRST_PARTY=new Qt("first-party-uid"),Qt.MOCK_USER=new Qt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let un="11.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fi=new uh("@firebase/firestore");function Fi(){return fi.logLevel}function G(r,...t){if(fi.logLevel<=Q.DEBUG){const e=t.map(Ih);fi.debug(`Firestore (${un}): ${r}`,...e)}}function pi(r,...t){if(fi.logLevel<=Q.ERROR){const e=t.map(Ih);fi.error(`Firestore (${un}): ${r}`,...e)}}function Yo(r,...t){if(fi.logLevel<=Q.WARN){const e=t.map(Ih);fi.warn(`Firestore (${un}): ${r}`,...e)}}function Ih(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(e){return JSON.stringify(e)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z(r="Unexpected state"){const t=`FIRESTORE (${un}) INTERNAL ASSERTION FAILED: `+r;throw pi(t),new Error(t)}function Et(r,t){r||Z()}function at(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class z extends Xe{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Cx{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Qt.UNAUTHENTICATED))}shutdown(){}}class xx{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class Px{constructor(t){this.t=t,this.currentUser=Qt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Et(this.o===void 0);let i=this.i;const n=l=>this.i!==i?(i=this.i,e(l)):Promise.resolve();let s=new ui;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ui,t.enqueueRetryable(()=>n(this.currentUser))};const o=()=>{const l=s;t.enqueueRetryable(async()=>{await l.promise,await n(this.currentUser)})},a=l=>{G("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(G("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ui)}},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(i=>this.i!==t?(G("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Et(typeof i.accessToken=="string"),new kg(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Et(t===null||typeof t=="string"),new Qt(t)}}class Sx{constructor(t,e,i){this.l=t,this.h=e,this.P=i,this.type="FirstParty",this.user=Qt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Rx{constructor(t,e,i){this.l=t,this.h=e,this.P=i}getToken(){return Promise.resolve(new Sx(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(Qt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Mx{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ox{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){Et(this.o===void 0);const i=s=>{s.error!=null&&G("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,G("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>i(s))};const n=s=>{G("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>n(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?n(s):G("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(Et(typeof e.token=="string"),this.R=e.token,new Mx(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fx(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let i=0;i<r;i++)e[i]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let i="";for(;i.length<20;){const n=Fx(40);for(let s=0;s<n.length;++s)i.length<20&&n[s]<e&&(i+=t.charAt(n[s]%t.length))}return i}}function it(r,t){return r<t?-1:r>t?1:0}function Qi(r,t,e){return r.length===t.length&&r.every((i,n)=>e(i,t[n]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new z(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new z(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new z(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new z(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Nt.fromMillis(Date.now())}static fromDate(t){return Nt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),i=Math.floor(1e6*(t-1e3*e));return new Nt(e,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?it(this.nanoseconds,t.nanoseconds):it(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ct(t)}static min(){return new ct(new Nt(0,0))}static max(){return new ct(new Nt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(t,e,i){e===void 0?e=0:e>t.length&&Z(),i===void 0?i=t.length-e:i>t.length-e&&Z(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return us.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof us?t.forEach(i=>{e.push(i)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const i=Math.min(t.length,e.length);for(let n=0;n<i;n++){const s=t.get(n),o=e.get(n);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Pt extends us{construct(t,e,i){return new Pt(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const i of t){if(i.indexOf("//")>=0)throw new z(L.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter(n=>n.length>0))}return new Pt(e)}static emptyPath(){return new Pt([])}}const Dx=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $t extends us{construct(t,e,i){return new $t(t,e,i)}static isValidIdentifier(t){return Dx.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$t.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new $t(["__name__"])}static fromServerFormat(t){const e=[];let i="",n=0;const s=()=>{if(i.length===0)throw new z(L.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""};let o=!1;for(;n<t.length;){const a=t[n];if(a==="\\"){if(n+1===t.length)throw new z(L.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const l=t[n+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new z(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=l,n+=2}else a==="`"?(o=!o,n++):a!=="."||o?(i+=a,n++):(s(),n++)}if(s(),o)throw new z(L.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new $t(e)}static emptyPath(){return new $t([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(t){this.path=t}static fromPath(t){return new K(Pt.fromString(t))}static fromName(t){return new K(Pt.fromString(t).popFirst(5))}static empty(){return new K(Pt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Pt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Pt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new K(new Pt(t.slice()))}}function Lx(r,t){const e=r.toTimestamp().seconds,i=r.toTimestamp().nanoseconds+1,n=ct.fromTimestamp(i===1e9?new Nt(e+1,0):new Nt(e,i));return new Sr(n,K.empty(),t)}function Nx(r){return new Sr(r.readTime,r.key,-1)}class Sr{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new Sr(ct.min(),K.empty(),-1)}static max(){return new Sr(ct.max(),K.empty(),-1)}}function kx(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=K.comparator(r.documentKey,t.documentKey),e!==0?e:it(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ux{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wh(r){if(r.code!==L.FAILED_PRECONDITION||r.message!==Bx)throw r;G("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new D((i,n)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(i,n)},this.catchCallback=s=>{this.wrapFailure(e,s).next(i,n)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof D?e:D.resolve(e)}catch(e){return D.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):D.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):D.reject(e)}static resolve(t){return new D((e,i)=>{e(t)})}static reject(t){return new D((e,i)=>{i(t)})}static waitFor(t){return new D((e,i)=>{let n=0,s=0,o=!1;t.forEach(a=>{++n,a.next(()=>{++s,o&&s===n&&e()},l=>i(l))}),o=!0,s===n&&e()})}static or(t){let e=D.resolve(!1);for(const i of t)e=e.next(n=>n?D.resolve(n):i());return e}static forEach(t,e){const i=[];return t.forEach((n,s)=>{i.push(e.call(this,n,s))}),this.waitFor(i)}static mapArray(t,e){return new D((i,n)=>{const s=t.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const h=l;e(t[h]).next(c=>{o[h]=c,++a,a===s&&i(o)},c=>n(c))}})}static doWhile(t,e){return new D((i,n)=>{const s=()=>{t()===!0?e().next(()=>{s()},n):i()};s()})}}function Vx(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function ws(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=i=>this.ie(i),this.se=i=>e.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}bh.oe=-1;function Ah(r){return r==null}function Ko(r){return r===0&&1/r==-1/0}function Gx(r){return typeof r=="number"&&Number.isInteger(r)&&!Ko(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=zf(t)),t=Hx(r.get(e),t);return zf(t)}function Hx(r,t){let e=t;const i=r.length;for(let n=0;n<i;n++){const s=r.charAt(n);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function zf(r){return r+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xf(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function ln(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Ug(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class de{constructor(t,e){this.comparator=t,this.root=e||Vt.EMPTY}insert(t,e){return new de(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Vt.BLACK,null,null))}remove(t){return new de(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Vt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const i=this.comparator(t,e.key);if(i===0)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){const n=this.comparator(t,i.key);if(n===0)return e+i.left.size;n<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,i)=>(t(e,i),!1))}toString(){const t=[];return this.inorderTraversal((e,i)=>(t.push(`${e}:${i}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ho(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ho(this.root,t,this.comparator,!1)}getReverseIterator(){return new ho(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ho(this.root,t,this.comparator,!0)}}class ho{constructor(t,e,i,n){this.isReverse=n,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?i(t.key,e):1,e&&n&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Vt{constructor(t,e,i,n,s){this.key=t,this.value=e,this.color=i??Vt.RED,this.left=n??Vt.EMPTY,this.right=s??Vt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,n,s){return new Vt(t??this.key,e??this.value,i??this.color,n??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let n=this;const s=i(t,n.key);return n=s<0?n.copy(null,null,null,n.left.insert(t,e,i),null):s===0?n.copy(null,e,null,null,null):n.copy(null,null,null,null,n.right.insert(t,e,i)),n.fixUp()}removeMin(){if(this.left.isEmpty())return Vt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,n=this;if(e(t,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),e(t,n.key)===0){if(n.right.isEmpty())return Vt.EMPTY;i=n.right.min(),n=n.copy(i.key,i.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Vt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Vt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Z();const t=this.left.check();if(t!==this.right.check())throw Z();return t+(this.isRed()?0:1)}}Vt.EMPTY=null,Vt.RED=!0,Vt.BLACK=!1;Vt.EMPTY=new class{constructor(){this.size=0}get key(){throw Z()}get value(){throw Z()}get color(){throw Z()}get left(){throw Z()}get right(){throw Z()}copy(t,e,i,n,s){return this}insert(t,e,i){return new Vt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(t){this.comparator=t,this.data=new de(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,i)=>(t(e),!1))}forEachInRange(t,e){const i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){const n=i.getNext();if(this.comparator(n.key,t[1])>=0)return;e(n.key)}}forEachWhile(t,e){let i;for(i=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Wf(this.data.getIterator())}getIteratorFrom(t){return new Wf(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(i=>{e=e.add(i)}),e}isEqual(t){if(!(t instanceof zt)||this.size!==t.size)return!1;const e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){const n=e.getNext().key,s=i.getNext().key;if(this.comparator(n,s)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new zt(this.comparator);return e.data=t,e}}class Wf{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(t){this.fields=t,t.sort($t.comparator)}static empty(){return new Re([])}unionWith(t){let e=new zt($t.comparator);for(const i of this.fields)e=e.add(i);for(const i of t)e=e.add(i);return new Re(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Qi(this.fields,t.fields,(e,i)=>e.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(n){try{return atob(n)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new $x("Invalid base64 string: "+s):s}}(t);return new $e(e)}static fromUint8Array(t){const e=function(n){let s="";for(let o=0;o<n.length;++o)s+=String.fromCharCode(n[o]);return s}(t);return new $e(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const i=new Uint8Array(e.length);for(let n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return it(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}$e.EMPTY_BYTE_STRING=new $e("");const zx=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mi(r){if(Et(!!r),typeof r=="string"){let t=0;const e=zx.exec(r);if(Et(!!e),e[1]){let n=e[1];n=(n+"000000000").substr(0,9),t=Number(n)}const i=new Date(r);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Gt(r.seconds),nanos:Gt(r.nanos)}}function Gt(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Zi(r){return typeof r=="string"?$e.fromBase64String(r):$e.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ch(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function xh(r){const t=r.mapValue.fields.__previous_value__;return Ch(t)?xh(t):t}function Jo(r){const t=mi(r.mapValue.fields.__local_write_time__.timestampValue);return new Nt(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(t,e,i,n,s,o,a,l,h){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=n,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=h}}class Qo{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Qo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof Qo&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const co={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function gi(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ch(r)?4:qx(r)?9007199254740991:Wx(r)?10:11:Z()}function ze(r,t){if(r===t)return!0;const e=gi(r);if(e!==gi(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Jo(r).isEqual(Jo(t));case 3:return function(n,s){if(typeof n.timestampValue=="string"&&typeof s.timestampValue=="string"&&n.timestampValue.length===s.timestampValue.length)return n.timestampValue===s.timestampValue;const o=mi(n.timestampValue),a=mi(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(n,s){return Zi(n.bytesValue).isEqual(Zi(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(n,s){return Gt(n.geoPointValue.latitude)===Gt(s.geoPointValue.latitude)&&Gt(n.geoPointValue.longitude)===Gt(s.geoPointValue.longitude)}(r,t);case 2:return function(n,s){if("integerValue"in n&&"integerValue"in s)return Gt(n.integerValue)===Gt(s.integerValue);if("doubleValue"in n&&"doubleValue"in s){const o=Gt(n.doubleValue),a=Gt(s.doubleValue);return o===a?Ko(o)===Ko(a):isNaN(o)&&isNaN(a)}return!1}(r,t);case 9:return Qi(r.arrayValue.values||[],t.arrayValue.values||[],ze);case 10:case 11:return function(n,s){const o=n.mapValue.fields||{},a=s.mapValue.fields||{};if(Xf(o)!==Xf(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ze(o[l],a[l])))return!1;return!0}(r,t);default:return Z()}}function ls(r,t){return(r.values||[]).find(e=>ze(e,t))!==void 0}function tn(r,t){if(r===t)return 0;const e=gi(r),i=gi(t);if(e!==i)return it(e,i);switch(e){case 0:case 9007199254740991:return 0;case 1:return it(r.booleanValue,t.booleanValue);case 2:return function(s,o){const a=Gt(s.integerValue||s.doubleValue),l=Gt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(r,t);case 3:return qf(r.timestampValue,t.timestampValue);case 4:return qf(Jo(r),Jo(t));case 5:return it(r.stringValue,t.stringValue);case 6:return function(s,o){const a=Zi(s),l=Zi(o);return a.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(s,o){const a=s.split("/"),l=o.split("/");for(let h=0;h<a.length&&h<l.length;h++){const c=it(a[h],l[h]);if(c!==0)return c}return it(a.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,o){const a=it(Gt(s.latitude),Gt(o.latitude));return a!==0?a:it(Gt(s.longitude),Gt(o.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return Yf(r.arrayValue,t.arrayValue);case 10:return function(s,o){var a,l,h,c;const p=s.fields||{},m=o.fields||{},g=(a=p.value)===null||a===void 0?void 0:a.arrayValue,_=(l=m.value)===null||l===void 0?void 0:l.arrayValue,A=it(((h=g?.values)===null||h===void 0?void 0:h.length)||0,((c=_?.values)===null||c===void 0?void 0:c.length)||0);return A!==0?A:Yf(g,_)}(r.mapValue,t.mapValue);case 11:return function(s,o){if(s===co.mapValue&&o===co.mapValue)return 0;if(s===co.mapValue)return 1;if(o===co.mapValue)return-1;const a=s.fields||{},l=Object.keys(a),h=o.fields||{},c=Object.keys(h);l.sort(),c.sort();for(let p=0;p<l.length&&p<c.length;++p){const m=it(l[p],c[p]);if(m!==0)return m;const g=tn(a[l[p]],h[c[p]]);if(g!==0)return g}return it(l.length,c.length)}(r.mapValue,t.mapValue);default:throw Z()}}function qf(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return it(r,t);const e=mi(r),i=mi(t),n=it(e.seconds,i.seconds);return n!==0?n:it(e.nanos,i.nanos)}function Yf(r,t){const e=r.values||[],i=t.values||[];for(let n=0;n<e.length&&n<i.length;++n){const s=tn(e[n],i[n]);if(s)return s}return it(e.length,i.length)}function en(r){return wl(r)}function wl(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){const i=mi(e);return`time(${i.seconds},${i.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return Zi(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return K.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let i="[",n=!0;for(const s of e.values||[])n?n=!1:i+=",",i+=wl(s);return i+"]"}(r.arrayValue):"mapValue"in r?function(e){const i=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const o of i)s?s=!1:n+=",",n+=`${o}:${wl(e.fields[o])}`;return n+"}"}(r.mapValue):Z()}function Co(r){switch(gi(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=xh(r);return t?16+Co(t):16;case 5:return 2*r.stringValue.length;case 6:return Zi(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((n,s)=>n+Co(s),0)}(r.arrayValue);case 10:case 11:return function(i){let n=0;return ln(i.fields,(s,o)=>{n+=s.length+Co(o)}),n}(r.mapValue);default:throw Z()}}function bl(r){return!!r&&"integerValue"in r}function Ph(r){return!!r&&"arrayValue"in r}function xo(r){return!!r&&"mapValue"in r}function Wx(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function zn(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return ln(r.mapValue.fields,(e,i)=>t.mapValue.fields[e]=zn(i)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=zn(r.arrayValue.values[e]);return t}return Object.assign({},r)}function qx(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(t){this.value=t}static empty(){return new Se({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!xo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=zn(e)}setAll(t){let e=$t.emptyPath(),i={},n=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){const l=this.getFieldsMap(e);this.applyChanges(l,i,n),i={},n=[],e=a.popLast()}o?i[a.lastSegment()]=zn(o):n.push(a.lastSegment())});const s=this.getFieldsMap(e);this.applyChanges(s,i,n)}delete(t){const e=this.field(t.popLast());xo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ze(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let n=e.mapValue.fields[t.get(i)];xo(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=n),e=n}return e.mapValue.fields}applyChanges(t,e,i){ln(e,(n,s)=>t[n]=s);for(const n of i)delete t[n]}clone(){return new Se(zn(this.value))}}function Vg(r){const t=[];return ln(r.fields,(e,i)=>{const n=new $t([e]);if(xo(i)){const s=Vg(i.mapValue).fields;if(s.length===0)t.push(n);else for(const o of s)t.push(n.child(o))}else t.push(n)}),new Re(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(t,e,i,n,s,o,a){this.key=t,this.documentType=e,this.version=i,this.readTime=n,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new Pe(t,0,ct.min(),ct.min(),ct.min(),Se.empty(),0)}static newFoundDocument(t,e,i,n){return new Pe(t,1,e,ct.min(),i,n,0)}static newNoDocument(t,e){return new Pe(t,2,e,ct.min(),ct.min(),Se.empty(),0)}static newUnknownDocument(t,e){return new Pe(t,3,e,ct.min(),ct.min(),Se.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ct.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Se.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Se.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ct.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Pe&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Pe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(t,e){this.position=t,this.inclusive=e}}function Kf(r,t,e){let i=0;for(let n=0;n<r.position.length;n++){const s=t[n],o=r.position[n];if(s.field.isKeyField()?i=K.comparator(K.fromName(o.referenceValue),e.key):i=tn(o,e.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function Jf(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!ze(r.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(t,e="asc"){this.field=t,this.dir=e}}function Yx(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{}class Lt extends Gg{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,i):new Jx(t,e,i):e==="array-contains"?new tP(t,i):e==="in"?new eP(t,i):e==="not-in"?new rP(t,i):e==="array-contains-any"?new iP(t,i):new Lt(t,e,i)}static createKeyFieldInFilter(t,e,i){return e==="in"?new Qx(t,i):new Zx(t,i)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(tn(e,this.value)):e!==null&&gi(this.value)===gi(e)&&this.matchesComparison(tn(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Z()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Rr extends Gg{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new Rr(t,e)}matches(t){return jg(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function jg(r){return r.op==="and"}function Hg(r){return Kx(r)&&jg(r)}function Kx(r){for(const t of r.filters)if(t instanceof Rr)return!1;return!0}function Al(r){if(r instanceof Lt)return r.field.canonicalString()+r.op.toString()+en(r.value);if(Hg(r))return r.filters.map(t=>Al(t)).join(",");{const t=r.filters.map(e=>Al(e)).join(",");return`${r.op}(${t})`}}function $g(r,t){return r instanceof Lt?function(i,n){return n instanceof Lt&&i.op===n.op&&i.field.isEqual(n.field)&&ze(i.value,n.value)}(r,t):r instanceof Rr?function(i,n){return n instanceof Rr&&i.op===n.op&&i.filters.length===n.filters.length?i.filters.reduce((s,o,a)=>s&&$g(o,n.filters[a]),!0):!1}(r,t):void Z()}function zg(r){return r instanceof Lt?function(e){return`${e.field.canonicalString()} ${e.op} ${en(e.value)}`}(r):r instanceof Rr?function(e){return e.op.toString()+" {"+e.getFilters().map(zg).join(" ,")+"}"}(r):"Filter"}class Jx extends Lt{constructor(t,e,i){super(t,e,i),this.key=K.fromName(i.referenceValue)}matches(t){const e=K.comparator(t.key,this.key);return this.matchesComparison(e)}}class Qx extends Lt{constructor(t,e){super(t,"in",e),this.keys=Xg("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Zx extends Lt{constructor(t,e){super(t,"not-in",e),this.keys=Xg("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Xg(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(i=>K.fromName(i.referenceValue))}class tP extends Lt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ph(e)&&ls(e.arrayValue,this.value)}}class eP extends Lt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&ls(this.value.arrayValue,e)}}class rP extends Lt{constructor(t,e){super(t,"not-in",e)}matches(t){if(ls(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&!ls(this.value.arrayValue,e)}}class iP extends Lt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ph(e)||!e.arrayValue.values)&&e.arrayValue.values.some(i=>ls(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nP{constructor(t,e=null,i=[],n=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=n,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}}function Qf(r,t=null,e=[],i=[],n=null,s=null,o=null){return new nP(r,t,e,i,n,s,o)}function Sh(r){const t=at(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(i=>Al(i)).join(","),e+="|ob:",e+=t.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),Ah(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>en(i)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>en(i)).join(",")),t.ue=e}return t.ue}function Rh(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Yx(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!$g(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Jf(r.startAt,t.startAt)&&Jf(r.endAt,t.endAt)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(t,e=null,i=[],n=[],s=null,o="F",a=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=n,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function sP(r,t,e,i,n,s,o,a){return new ba(r,t,e,i,n,s,o,a)}function oP(r){return new ba(r)}function Zf(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function aP(r){return r.collectionGroup!==null}function Xn(r){const t=at(r);if(t.ce===null){t.ce=[];const e=new Set;for(const s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());const i=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new zt($t.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(h=>{h.isInequality()&&(a=a.add(h.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new ta(s,i))}),e.has($t.keyField().canonicalString())||t.ce.push(new ta($t.keyField(),i))}return t.ce}function li(r){const t=at(r);return t.le||(t.le=uP(t,Xn(r))),t.le}function uP(r,t){if(r.limitType==="F")return Qf(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(n=>{const s=n.dir==="desc"?"asc":"desc";return new ta(n.field,s)});const e=r.endAt?new Zo(r.endAt.position,r.endAt.inclusive):null,i=r.startAt?new Zo(r.startAt.position,r.startAt.inclusive):null;return Qf(r.path,r.collectionGroup,t,r.filters,r.limit,e,i)}}function Cl(r,t,e){return new ba(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Wg(r,t){return Rh(li(r),li(t))&&r.limitType===t.limitType}function qg(r){return`${Sh(li(r))}|lt:${r.limitType}`}function Mn(r){return`Query(target=${function(e){let i=e.path.canonicalString();return e.collectionGroup!==null&&(i+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(i+=`, filters: [${e.filters.map(n=>zg(n)).join(", ")}]`),Ah(e.limit)||(i+=", limit: "+e.limit),e.orderBy.length>0&&(i+=`, orderBy: [${e.orderBy.map(n=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(n)).join(", ")}]`),e.startAt&&(i+=", startAt: ",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(n=>en(n)).join(",")),e.endAt&&(i+=", endAt: ",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(n=>en(n)).join(",")),`Target(${i})`}(li(r))}; limitType=${r.limitType})`}function Mh(r,t){return t.isFoundDocument()&&function(i,n){const s=n.key.path;return i.collectionGroup!==null?n.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):K.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(r,t)&&function(i,n){for(const s of Xn(i))if(!s.field.isKeyField()&&n.data.field(s.field)===null)return!1;return!0}(r,t)&&function(i,n){for(const s of i.filters)if(!s.matches(n))return!1;return!0}(r,t)&&function(i,n){return!(i.startAt&&!function(o,a,l){const h=Kf(o,a,l);return o.inclusive?h<=0:h<0}(i.startAt,Xn(i),n)||i.endAt&&!function(o,a,l){const h=Kf(o,a,l);return o.inclusive?h>=0:h>0}(i.endAt,Xn(i),n))}(r,t)}function lP(r){return(t,e)=>{let i=!1;for(const n of Xn(r)){const s=hP(n,t,e);if(s!==0)return s;i=i||n.field.isKeyField()}return 0}}function hP(r,t,e){const i=r.field.isKeyField()?K.comparator(t.key,e.key):function(s,o,a){const l=o.data.field(s),h=a.data.field(s);return l!==null&&h!==null?tn(l,h):Z()}(r.field,t,e);switch(r.dir){case"asc":return i;case"desc":return-1*i;default:return Z()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),i=this.inner[e];if(i!==void 0){for(const[n,s]of i)if(this.equalsFn(n,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){const i=this.mapKeyFn(t),n=this.inner[i];if(n===void 0)return this.inner[i]=[[t,e]],void this.innerSize++;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return void(n[s]=[t,e]);n.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),i=this.inner[e];if(i===void 0)return!1;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return i.length===1?delete this.inner[e]:i.splice(n,1),this.innerSize--,!0;return!1}forEach(t){ln(this.inner,(e,i)=>{for(const[n,s]of i)t(n,s)})}isEmpty(){return Ug(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cP=new de(K.comparator);function ea(){return cP}const Yg=new de(K.comparator);function fo(...r){let t=Yg;for(const e of r)t=t.insert(e.key,e);return t}function Kg(r){let t=Yg;return r.forEach((e,i)=>t=t.insert(e,i.overlayedDocument)),t}function ri(){return Wn()}function Jg(){return Wn()}function Wn(){return new _i(r=>r.toString(),(r,t)=>r.isEqual(t))}const dP=new de(K.comparator),fP=new zt(K.comparator);function Zt(...r){let t=fP;for(const e of r)t=t.add(e);return t}const pP=new zt(it);function mP(){return pP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oh(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ko(t)?"-0":t}}function Qg(r){return{integerValue:""+r}}function gP(r,t){return Gx(t)?Qg(t):Oh(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(){this._=void 0}}function vP(r,t,e){return r instanceof ra?function(n,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return s&&Ch(s)&&(s=xh(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):r instanceof hs?tv(r,t):r instanceof cs?ev(r,t):function(n,s){const o=Zg(n,s),a=tp(o)+tp(n.Pe);return bl(o)&&bl(n.Pe)?Qg(a):Oh(n.serializer,a)}(r,t)}function _P(r,t,e){return r instanceof hs?tv(r,t):r instanceof cs?ev(r,t):e}function Zg(r,t){return r instanceof ia?function(i){return bl(i)||function(s){return!!s&&"doubleValue"in s}(i)}(t)?t:{integerValue:0}:null}class ra extends Aa{}class hs extends Aa{constructor(t){super(),this.elements=t}}function tv(r,t){const e=rv(t);for(const i of r.elements)e.some(n=>ze(n,i))||e.push(i);return{arrayValue:{values:e}}}class cs extends Aa{constructor(t){super(),this.elements=t}}function ev(r,t){let e=rv(t);for(const i of r.elements)e=e.filter(n=>!ze(n,i));return{arrayValue:{values:e}}}class ia extends Aa{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function tp(r){return Gt(r.integerValue||r.doubleValue)}function rv(r){return Ph(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function yP(r,t){return r.field.isEqual(t.field)&&function(i,n){return i instanceof hs&&n instanceof hs||i instanceof cs&&n instanceof cs?Qi(i.elements,n.elements,ze):i instanceof ia&&n instanceof ia?ze(i.Pe,n.Pe):i instanceof ra&&n instanceof ra}(r.transform,t.transform)}class EP{constructor(t,e){this.version=t,this.transformResults=e}}class ir{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ir}static exists(t){return new ir(void 0,t)}static updateTime(t){return new ir(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Po(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class Ca{}function iv(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new sv(r.key,ir.none()):new bs(r.key,r.data,ir.none());{const e=r.data,i=Se.empty();let n=new zt($t.comparator);for(let s of t.fields)if(!n.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?i.delete(s):i.set(s,o),n=n.add(s)}return new yi(r.key,i,new Re(n.toArray()),ir.none())}}function TP(r,t,e){r instanceof bs?function(n,s,o){const a=n.value.clone(),l=rp(n.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(r,t,e):r instanceof yi?function(n,s,o){if(!Po(n.precondition,s))return void s.convertToUnknownDocument(o.version);const a=rp(n.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(nv(n)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(r,t,e):function(n,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function qn(r,t,e,i){return r instanceof bs?function(s,o,a,l){if(!Po(s.precondition,o))return a;const h=s.value.clone(),c=ip(s.fieldTransforms,l,o);return h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,t,e,i):r instanceof yi?function(s,o,a,l){if(!Po(s.precondition,o))return a;const h=ip(s.fieldTransforms,l,o),c=o.data;return c.setAll(nv(s)),c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(r,t,e,i):function(s,o,a){return Po(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(r,t,e)}function IP(r,t){let e=null;for(const i of r.fieldTransforms){const n=t.data.field(i.field),s=Zg(i.transform,n||null);s!=null&&(e===null&&(e=Se.empty()),e.set(i.field,s))}return e||null}function ep(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(i,n){return i===void 0&&n===void 0||!(!i||!n)&&Qi(i,n,(s,o)=>yP(s,o))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class bs extends Ca{constructor(t,e,i,n=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class yi extends Ca{constructor(t,e,i,n,s=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=n,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function nv(r){const t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const i=r.data.field(e);t.set(e,i)}}),t}function rp(r,t,e){const i=new Map;Et(r.length===e.length);for(let n=0;n<e.length;n++){const s=r[n],o=s.transform,a=t.data.field(s.field);i.set(s.field,_P(o,a,e[n]))}return i}function ip(r,t,e){const i=new Map;for(const n of r){const s=n.transform,o=e.data.field(n.field);i.set(n.field,vP(s,o,t))}return i}class sv extends Ca{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wP extends Ca{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(t,e,i,n){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=n}applyToRemoteDocument(t,e){const i=e.mutationResults;for(let n=0;n<this.mutations.length;n++){const s=this.mutations[n];s.key.isEqual(t.key)&&TP(s,t,i[n])}}applyToLocalView(t,e){for(const i of this.baseMutations)i.key.isEqual(t.key)&&(e=qn(i,t,e,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(t.key)&&(e=qn(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const i=Jg();return this.mutations.forEach(n=>{const s=t.get(n.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=e.has(n.key)?null:a;const l=iv(o,a);l!==null&&i.set(n.key,l),o.isValidDocument()||o.convertToNoDocument(ct.min())}),i}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),Zt())}isEqual(t){return this.batchId===t.batchId&&Qi(this.mutations,t.mutations,(e,i)=>ep(e,i))&&Qi(this.baseMutations,t.baseMutations,(e,i)=>ep(e,i))}}class Fh{constructor(t,e,i,n){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=n}static from(t,e,i){Et(t.mutations.length===i.length);let n=function(){return dP}();const s=t.mutations;for(let o=0;o<s.length;o++)n=n.insert(s[o].key,i[o].version);return new Fh(t,e,i,n)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ct,tt;function CP(r){switch(r){default:return Z();case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0}}function xP(r){if(r===void 0)return pi("GRPC error has no .code"),L.UNKNOWN;switch(r){case Ct.OK:return L.OK;case Ct.CANCELLED:return L.CANCELLED;case Ct.UNKNOWN:return L.UNKNOWN;case Ct.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case Ct.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case Ct.INTERNAL:return L.INTERNAL;case Ct.UNAVAILABLE:return L.UNAVAILABLE;case Ct.UNAUTHENTICATED:return L.UNAUTHENTICATED;case Ct.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case Ct.NOT_FOUND:return L.NOT_FOUND;case Ct.ALREADY_EXISTS:return L.ALREADY_EXISTS;case Ct.PERMISSION_DENIED:return L.PERMISSION_DENIED;case Ct.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case Ct.ABORTED:return L.ABORTED;case Ct.OUT_OF_RANGE:return L.OUT_OF_RANGE;case Ct.UNIMPLEMENTED:return L.UNIMPLEMENTED;case Ct.DATA_LOSS:return L.DATA_LOSS;default:return Z()}}(tt=Ct||(Ct={}))[tt.OK=0]="OK",tt[tt.CANCELLED=1]="CANCELLED",tt[tt.UNKNOWN=2]="UNKNOWN",tt[tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",tt[tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",tt[tt.NOT_FOUND=5]="NOT_FOUND",tt[tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",tt[tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",tt[tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",tt[tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",tt[tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",tt[tt.ABORTED=10]="ABORTED",tt[tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",tt[tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",tt[tt.INTERNAL=13]="INTERNAL",tt[tt.UNAVAILABLE=14]="UNAVAILABLE",tt[tt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Mg([4294967295,4294967295],0);class PP{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function xl(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function SP(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function RP(r,t){return xl(r,t.toTimestamp())}function Xi(r){return Et(!!r),ct.fromTimestamp(function(e){const i=mi(e);return new Nt(i.seconds,i.nanos)}(r))}function ov(r,t){return Pl(r,t).canonicalString()}function Pl(r,t){const e=function(n){return new Pt(["projects",n.projectId,"databases",n.database])}(r).child("documents");return t===void 0?e:e.child(t)}function MP(r){const t=Pt.fromString(r);return Et(UP(t)),t}function Sl(r,t){return ov(r.databaseId,t.path)}function OP(r){const t=MP(r);return t.length===4?Pt.emptyPath():DP(t)}function FP(r){return new Pt(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function DP(r){return Et(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function np(r,t,e){return{name:Sl(r,t),fields:e.value.mapValue.fields}}function LP(r,t){let e;if(t instanceof bs)e={update:np(r,t.key,t.value)};else if(t instanceof sv)e={delete:Sl(r,t.key)};else if(t instanceof yi)e={update:np(r,t.key,t.data),updateMask:BP(t.fieldMask)};else{if(!(t instanceof wP))return Z();e={verify:Sl(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(i=>function(s,o){const a=o.transform;if(a instanceof ra)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof hs)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof cs)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ia)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Z()}(0,i))),t.precondition.isNone||(e.currentDocument=function(n,s){return s.updateTime!==void 0?{updateTime:RP(n,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Z()}(r,t.precondition)),e}function NP(r,t){return r&&r.length>0?(Et(t!==void 0),r.map(e=>function(n,s){let o=n.updateTime?Xi(n.updateTime):Xi(s);return o.isEqual(ct.min())&&(o=Xi(s)),new EP(o,n.transformResults||[])}(e,t))):[]}function kP(r){let t=OP(r.parent);const e=r.structuredQuery,i=e.from?e.from.length:0;let n=null;if(i>0){Et(i===1);const c=e.from[0];c.allDescendants?n=c.collectionId:t=t.child(c.collectionId)}let s=[];e.where&&(s=function(p){const m=av(p);return m instanceof Rr&&Hg(m)?m.getFilters():[m]}(e.where));let o=[];e.orderBy&&(o=function(p){return p.map(m=>function(_){return new ta(Di(_.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(m))}(e.orderBy));let a=null;e.limit&&(a=function(p){let m;return m=typeof p=="object"?p.value:p,Ah(m)?null:m}(e.limit));let l=null;e.startAt&&(l=function(p){const m=!!p.before,g=p.values||[];return new Zo(g,m)}(e.startAt));let h=null;return e.endAt&&(h=function(p){const m=!p.before,g=p.values||[];return new Zo(g,m)}(e.endAt)),sP(t,n,o,s,a,"F",l,h)}function av(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const i=Di(e.unaryFilter.field);return Lt.create(i,"==",{doubleValue:NaN});case"IS_NULL":const n=Di(e.unaryFilter.field);return Lt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Di(e.unaryFilter.field);return Lt.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Di(e.unaryFilter.field);return Lt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Z()}}(r):r.fieldFilter!==void 0?function(e){return Lt.create(Di(e.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Z()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return Rr.create(e.compositeFilter.filters.map(i=>av(i)),function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return Z()}}(e.compositeFilter.op))}(r):Z()}function Di(r){return $t.fromServerFormat(r.fieldPath)}function BP(r){const t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function UP(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(t){this.ct=t}}function GP(r){const t=kP({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Cl(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP{constructor(){this.un=new HP}addToCollectionParentIndex(t,e){return this.un.add(e),D.resolve()}getCollectionParents(t,e){return D.resolve(this.un.getEntries(e))}addFieldIndex(t,e){return D.resolve()}deleteFieldIndex(t,e){return D.resolve()}deleteAllFieldIndexes(t){return D.resolve()}createTargetIndexes(t,e){return D.resolve()}getDocumentsMatchingTarget(t,e){return D.resolve(null)}getIndexType(t,e){return D.resolve(0)}getFieldIndexes(t,e){return D.resolve([])}getNextCollectionGroupToUpdate(t){return D.resolve(null)}getMinOffset(t,e){return D.resolve(Sr.min())}getMinOffsetFromCollectionGroup(t,e){return D.resolve(Sr.min())}updateCollectionGroup(t,e,i){return D.resolve()}updateIndexEntries(t,e){return D.resolve()}}class HP{constructor(){this.index={}}add(t){const e=t.lastSegment(),i=t.popLast(),n=this.index[e]||new zt(Pt.comparator),s=!n.has(i);return this.index[e]=n.add(i),s}has(t){const e=t.lastSegment(),i=t.popLast(),n=this.index[e];return n&&n.has(i)}getEntries(t){return(this.index[t]||new zt(Pt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ce{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new ce(t,ce.DEFAULT_COLLECTION_PERCENTILE,ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ce.DEFAULT_COLLECTION_PERCENTILE=10,ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ce.DEFAULT=new ce(41943040,ce.DEFAULT_COLLECTION_PERCENTILE,ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ce.DISABLED=new ce(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new rn(0)}static kn(){return new rn(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function op([r,t],[e,i]){const n=it(r,e);return n===0?it(t,i):n}class $P{constructor(t){this.Un=t,this.buffer=new zt(op),this.Wn=0}Gn(){return++this.Wn}zn(t){const e=[t,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(e);else{const i=this.buffer.last();op(e,i)<0&&(this.buffer=this.buffer.delete(i).add(e))}}get maxValue(){return this.buffer.last()[0]}}class zP{constructor(t,e,i){this.garbageCollector=t,this.asyncQueue=e,this.localStore=i,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(t){G("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ws(e)?G("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await wh(e)}await this.Hn(3e5)})}}class XP{constructor(t,e){this.Jn=t,this.params=e}calculateTargetCount(t,e){return this.Jn.Yn(t).next(i=>Math.floor(e/100*i))}nthSequenceNumber(t,e){if(e===0)return D.resolve(bh.oe);const i=new $P(e);return this.Jn.forEachTarget(t,n=>i.zn(n.sequenceNumber)).next(()=>this.Jn.Zn(t,n=>i.zn(n))).next(()=>i.maxValue)}removeTargets(t,e,i){return this.Jn.removeTargets(t,e,i)}removeOrphanedDocuments(t,e){return this.Jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(G("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(sp)):this.getCacheSize(t).next(i=>i<this.params.cacheSizeCollectionThreshold?(G("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sp):this.Xn(t,e))}getCacheSize(t){return this.Jn.getCacheSize(t)}Xn(t,e){let i,n,s,o,a,l,h;const c=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(G("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),n=this.params.maximumSequenceNumbersToCollect):n=p,o=Date.now(),this.nthSequenceNumber(t,n))).next(p=>(i=p,a=Date.now(),this.removeTargets(t,i,e))).next(p=>(s=p,l=Date.now(),this.removeOrphanedDocuments(t,i))).next(p=>(h=Date.now(),Fi()<=Q.DEBUG&&G("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-c}ms
	Determined least recently used ${n} in `+(a-o)+`ms
	Removed ${s} targets in `+(l-a)+`ms
	Removed ${p} documents in `+(h-l)+`ms
Total Duration: ${h-c}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:s,documentsRemoved:p})))}}function WP(r,t){return new XP(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP{constructor(){this.changes=new _i(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Pe.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const i=this.changes.get(e);return i!==void 0?D.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(t,e,i,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=n}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next(n=>(i=n,this.remoteDocumentCache.getEntry(t,e))).next(n=>(i!==null&&qn(i.mutation,n,Re.empty(),Nt.now()),n))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.getLocalViewOfDocuments(t,i,Zt()).next(()=>i))}getLocalViewOfDocuments(t,e,i=Zt()){const n=ri();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,i).next(s=>{let o=fo();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){const i=ri();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,Zt()))}populateOverlays(t,e,i){const n=[];return i.forEach(s=>{e.has(s)||n.push(s)}),this.documentOverlayCache.getOverlays(t,n).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,i,n){let s=ea();const o=Wn(),a=function(){return Wn()}();return e.forEach((l,h)=>{const c=i.get(h.key);n.has(h.key)&&(c===void 0||c.mutation instanceof yi)?s=s.insert(h.key,h):c!==void 0?(o.set(h.key,c.mutation.getFieldMask()),qn(c.mutation,h,c.mutation.getFieldMask(),Nt.now())):o.set(h.key,Re.empty())}),this.recalculateAndSaveOverlays(t,s).next(l=>(l.forEach((h,c)=>o.set(h,c)),e.forEach((h,c)=>{var p;return a.set(h,new YP(c,(p=o.get(h))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(t,e){const i=Wn();let n=new de((o,a)=>o-a),s=Zt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(const a of o)a.keys().forEach(l=>{const h=e.get(l);if(h===null)return;let c=i.get(l)||Re.empty();c=a.applyToLocalView(h,c),i.set(l,c);const p=(n.get(a.batchId)||Zt()).add(l);n=n.insert(a.batchId,p)})}).next(()=>{const o=[],a=n.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),h=l.key,c=l.value,p=Jg();c.forEach(m=>{if(!s.has(m)){const g=iv(e.get(m),i.get(m));g!==null&&p.set(m,g),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(t,h,p))}return D.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.recalculateAndSaveOverlays(t,i))}getDocumentsMatchingQuery(t,e,i,n){return function(o){return K.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):aP(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i,n):this.getDocumentsMatchingCollectionQuery(t,e,i,n)}getNextDocuments(t,e,i,n){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,n).next(s=>{const o=n-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,n-s.size):D.resolve(ri());let a=-1,l=s;return o.next(h=>D.forEach(h,(c,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(c)?D.resolve():this.remoteDocumentCache.getEntry(t,c).next(m=>{l=l.insert(c,m)}))).next(()=>this.populateOverlays(t,h,s)).next(()=>this.computeViews(t,l,h,Zt())).next(c=>({batchId:a,changes:Kg(c)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new K(e)).next(i=>{let n=fo();return i.isFoundDocument()&&(n=n.insert(i.key,i)),n})}getDocumentsMatchingCollectionGroupQuery(t,e,i,n){const s=e.collectionGroup;let o=fo();return this.indexManager.getCollectionParents(t,s).next(a=>D.forEach(a,l=>{const h=function(p,m){return new ba(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,h,i,n).next(c=>{c.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,i,n){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,i,s,n))).next(o=>{s.forEach((l,h)=>{const c=h.getKey();o.get(c)===null&&(o=o.insert(c,Pe.newInvalidDocument(c)))});let a=fo();return o.forEach((l,h)=>{const c=s.get(l);c!==void 0&&qn(c.mutation,h,Re.empty(),Nt.now()),Mh(e,h)&&(a=a.insert(l,h))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,e){return D.resolve(this.hr.get(e))}saveBundleMetadata(t,e){return this.hr.set(e.id,function(n){return{id:n.id,version:n.version,createTime:Xi(n.createTime)}}(e)),D.resolve()}getNamedQuery(t,e){return D.resolve(this.Pr.get(e))}saveNamedQuery(t,e){return this.Pr.set(e.name,function(n){return{name:n.name,query:GP(n.bundledQuery),readTime:Xi(n.readTime)}}(e)),D.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(){this.overlays=new de(K.comparator),this.Ir=new Map}getOverlay(t,e){return D.resolve(this.overlays.get(e))}getOverlays(t,e){const i=ri();return D.forEach(e,n=>this.getOverlay(t,n).next(s=>{s!==null&&i.set(n,s)})).next(()=>i)}saveOverlays(t,e,i){return i.forEach((n,s)=>{this.ht(t,e,s)}),D.resolve()}removeOverlaysForBatchId(t,e,i){const n=this.Ir.get(i);return n!==void 0&&(n.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(i)),D.resolve()}getOverlaysForCollection(t,e,i){const n=ri(),s=e.length+1,o=new K(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,h=l.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===s&&l.largestBatchId>i&&n.set(l.getKey(),l)}return D.resolve(n)}getOverlaysForCollectionGroup(t,e,i,n){let s=new de((h,c)=>h-c);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>i){let c=s.get(h.largestBatchId);c===null&&(c=ri(),s=s.insert(h.largestBatchId,c)),c.set(h.getKey(),h)}}const a=ri(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,c)=>a.set(h,c)),!(a.size()>=n)););return D.resolve(a)}ht(t,e,i){const n=this.overlays.get(i.key);if(n!==null){const o=this.Ir.get(n.largestBatchId).delete(i.key);this.Ir.set(n.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new AP(e,i));let s=this.Ir.get(e);s===void 0&&(s=Zt(),this.Ir.set(e,s)),this.Ir.set(e,s.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(){this.sessionToken=$e.EMPTY_BYTE_STRING}getSessionToken(t){return D.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,D.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(){this.Tr=new zt(Dt.Er),this.dr=new zt(Dt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,e){const i=new Dt(t,e);this.Tr=this.Tr.add(i),this.dr=this.dr.add(i)}Rr(t,e){t.forEach(i=>this.addReference(i,e))}removeReference(t,e){this.Vr(new Dt(t,e))}mr(t,e){t.forEach(i=>this.removeReference(i,e))}gr(t){const e=new K(new Pt([])),i=new Dt(e,t),n=new Dt(e,t+1),s=[];return this.dr.forEachInRange([i,n],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){const e=new K(new Pt([])),i=new Dt(e,t),n=new Dt(e,t+1);let s=Zt();return this.dr.forEachInRange([i,n],o=>{s=s.add(o.key)}),s}containsKey(t){const e=new Dt(t,0),i=this.Tr.firstAfterOrEqual(e);return i!==null&&t.isEqual(i.key)}}class Dt{constructor(t,e){this.key=t,this.wr=e}static Er(t,e){return K.comparator(t.key,e.key)||it(t.wr,e.wr)}static Ar(t,e){return it(t.wr,e.wr)||K.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Sr=1,this.br=new zt(Dt.Er)}checkEmpty(t){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,i,n){const s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new bP(s,e,i,n);this.mutationQueue.push(o);for(const a of n)this.br=this.br.add(new Dt(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return D.resolve(o)}lookupMutationBatch(t,e){return D.resolve(this.Dr(e))}getNextMutationBatchAfterBatchId(t,e){const i=e+1,n=this.vr(i),s=n<0?0:n;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const i=new Dt(e,0),n=new Dt(e,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([i,n],o=>{const a=this.Dr(o.wr);s.push(a)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new zt(it);return e.forEach(n=>{const s=new Dt(n,0),o=new Dt(n,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{i=i.add(a.wr)})}),D.resolve(this.Cr(i))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,n=i.length+1;let s=i;K.isDocumentKey(s)||(s=s.child(""));const o=new Dt(new K(s),0);let a=new zt(it);return this.br.forEachWhile(l=>{const h=l.key.path;return!!i.isPrefixOf(h)&&(h.length===n&&(a=a.add(l.wr)),!0)},o),D.resolve(this.Cr(a))}Cr(t){const e=[];return t.forEach(i=>{const n=this.Dr(i);n!==null&&e.push(n)}),e}removeMutationBatch(t,e){Et(this.Fr(e.batchId,"removed")===0),this.mutationQueue.shift();let i=this.br;return D.forEach(e.mutations,n=>{const s=new Dt(n.key,e.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,n.key)}).next(()=>{this.br=i})}On(t){}containsKey(t,e){const i=new Dt(e,0),n=this.br.firstAfterOrEqual(i);return D.resolve(e.isEqual(n&&n.key))}performConsistencyCheck(t){return this.mutationQueue.length,D.resolve()}Fr(t,e){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){const e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eS{constructor(t){this.Mr=t,this.docs=function(){return new de(K.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const i=e.key,n=this.docs.get(i),s=n?n.size:0,o=this.Mr(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const i=this.docs.get(e);return D.resolve(i?i.document.mutableCopy():Pe.newInvalidDocument(e))}getEntries(t,e){let i=ea();return e.forEach(n=>{const s=this.docs.get(n);i=i.insert(n,s?s.document.mutableCopy():Pe.newInvalidDocument(n))}),D.resolve(i)}getDocumentsMatchingQuery(t,e,i,n){let s=ea();const o=e.path,a=new K(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:h,value:{document:c}}=l.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||kx(Nx(c),i)<=0||(n.has(c.key)||Mh(e,c))&&(s=s.insert(c.key,c.mutableCopy()))}return D.resolve(s)}getAllFromCollectionGroup(t,e,i,n){Z()}Or(t,e){return D.forEach(this.docs,i=>e(i))}newChangeBuffer(t){return new rS(this)}getSize(t){return D.resolve(this.size)}}class rS extends qP{constructor(t){super(),this.cr=t}applyChanges(t){const e=[];return this.changes.forEach((i,n)=>{n.isValidDocument()?e.push(this.cr.addEntry(t,n)):this.cr.removeEntry(i)}),D.waitFor(e)}getFromCache(t,e){return this.cr.getEntry(t,e)}getAllFromCache(t,e){return this.cr.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS{constructor(t){this.persistence=t,this.Nr=new _i(e=>Sh(e),Rh),this.lastRemoteSnapshotVersion=ct.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Dh,this.targetCount=0,this.kr=rn.Bn()}forEachTarget(t,e){return this.Nr.forEach((i,n)=>e(n)),D.resolve()}getLastRemoteSnapshotVersion(t){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return D.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.Lr&&(this.Lr=e),D.resolve()}Kn(t){this.Nr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.kr=new rn(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,e){return this.Kn(e),this.targetCount+=1,D.resolve()}updateTargetData(t,e){return this.Kn(e),D.resolve()}removeTargetData(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,D.resolve()}removeTargets(t,e,i){let n=0;const s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=e&&i.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),n++)}),D.waitFor(s).next(()=>n)}getTargetCount(t){return D.resolve(this.targetCount)}getTargetData(t,e){const i=this.Nr.get(e)||null;return D.resolve(i)}addMatchingKeys(t,e,i){return this.Br.Rr(e,i),D.resolve()}removeMatchingKeys(t,e,i){this.Br.mr(e,i);const n=this.persistence.referenceDelegate,s=[];return n&&e.forEach(o=>{s.push(n.markPotentiallyOrphaned(t,o))}),D.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Br.gr(e),D.resolve()}getMatchingKeysForTargetId(t,e){const i=this.Br.yr(e);return D.resolve(i)}containsKey(t,e){return D.resolve(this.Br.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(t,e){this.qr={},this.overlays={},this.Qr=new bh(0),this.Kr=!1,this.Kr=!0,this.$r=new ZP,this.referenceDelegate=t(this),this.Ur=new iS(this),this.indexManager=new jP,this.remoteDocumentCache=function(n){return new eS(n)}(i=>this.referenceDelegate.Wr(i)),this.serializer=new VP(e),this.Gr=new JP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new QP,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.qr[t.toKey()];return i||(i=new tS(e,this.referenceDelegate),this.qr[t.toKey()]=i),i}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,e,i){G("MemoryPersistence","Starting transaction:",t);const n=new nS(this.Qr.next());return this.referenceDelegate.zr(),i(n).next(s=>this.referenceDelegate.jr(n).next(()=>s)).toPromise().then(s=>(n.raiseOnCommittedEvent(),s))}Hr(t,e){return D.or(Object.values(this.qr).map(i=>()=>i.containsKey(t,e)))}}class nS extends Ux{constructor(t){super(),this.currentSequenceNumber=t}}class Lh{constructor(t){this.persistence=t,this.Jr=new Dh,this.Yr=null}static Zr(t){return new Lh(t)}get Xr(){if(this.Yr)return this.Yr;throw Z()}addReference(t,e,i){return this.Jr.addReference(i,e),this.Xr.delete(i.toString()),D.resolve()}removeReference(t,e,i){return this.Jr.removeReference(i,e),this.Xr.add(i.toString()),D.resolve()}markPotentiallyOrphaned(t,e){return this.Xr.add(e.toString()),D.resolve()}removeTarget(t,e){this.Jr.gr(e.targetId).forEach(n=>this.Xr.add(n.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next(n=>{n.forEach(s=>this.Xr.add(s.toString()))}).next(()=>i.removeTargetData(t,e))}zr(){this.Yr=new Set}jr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.Xr,i=>{const n=K.fromPath(i);return this.ei(t,n).next(s=>{s||e.removeEntry(n,ct.min())})}).next(()=>(this.Yr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ei(t,e).next(i=>{i?this.Xr.delete(e.toString()):this.Xr.add(e.toString())})}Wr(t){return 0}ei(t,e){return D.or([()=>D.resolve(this.Jr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Hr(t,e)])}}class na{constructor(t,e){this.persistence=t,this.ti=new _i(i=>jx(i.path),(i,n)=>i.isEqual(n)),this.garbageCollector=WP(this,e)}static Zr(t,e){return new na(t,e)}zr(){}jr(t){return D.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Yn(t){const e=this.er(t);return this.persistence.getTargetCache().getTargetCount(t).next(i=>e.next(n=>i+n))}er(t){let e=0;return this.Zn(t,i=>{e++}).next(()=>e)}Zn(t,e){return D.forEach(this.ti,(i,n)=>this.nr(t,i,n).next(s=>s?D.resolve():e(n)))}removeTargets(t,e,i){return this.persistence.getTargetCache().removeTargets(t,e,i)}removeOrphanedDocuments(t,e){let i=0;const n=this.persistence.getRemoteDocumentCache(),s=n.newChangeBuffer();return n.Or(t,o=>this.nr(t,o,e).next(a=>{a||(i++,s.removeEntry(o,ct.min()))})).next(()=>s.apply(t)).next(()=>i)}markPotentiallyOrphaned(t,e){return this.ti.set(e,t.currentSequenceNumber),D.resolve()}removeTarget(t,e){const i=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,i)}addReference(t,e,i){return this.ti.set(i,t.currentSequenceNumber),D.resolve()}removeReference(t,e,i){return this.ti.set(i,t.currentSequenceNumber),D.resolve()}updateLimboDocument(t,e){return this.ti.set(e,t.currentSequenceNumber),D.resolve()}Wr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Co(t.data.value)),e}nr(t,e,i){return D.or([()=>this.persistence.Hr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const n=this.ti.get(e);return D.resolve(n!==void 0&&n>i)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(t,e,i,n){this.targetId=t,this.fromCache=e,this.$i=i,this.Ui=n}static Wi(t,e){let i=Zt(),n=Zt();for(const s of e.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:n=n.add(s.doc.key)}return new Nh(t,e.fromCache,i,n)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return ab()?8:Vx(ee())>0?6:4}()}initialize(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}getDocumentsMatchingQuery(t,e,i,n){const s={result:null};return this.Yi(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(t,e,n,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new sS;return this.Xi(t,e,o).next(a=>{if(s.result=a,this.zi)return this.es(t,e,o,a.size)})}).next(()=>s.result)}es(t,e,i,n){return i.documentReadCount<this.ji?(Fi()<=Q.DEBUG&&G("QueryEngine","SDK will not create cache indexes for query:",Mn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),D.resolve()):(Fi()<=Q.DEBUG&&G("QueryEngine","Query:",Mn(e),"scans",i.documentReadCount,"local documents and returns",n,"documents as results."),i.documentReadCount>this.Hi*n?(Fi()<=Q.DEBUG&&G("QueryEngine","The SDK decides to create cache indexes for query:",Mn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,li(e))):D.resolve())}Yi(t,e){if(Zf(e))return D.resolve(null);let i=li(e);return this.indexManager.getIndexType(t,i).next(n=>n===0?null:(e.limit!==null&&n===1&&(e=Cl(e,null,"F"),i=li(e)),this.indexManager.getDocumentsMatchingTarget(t,i).next(s=>{const o=Zt(...s);return this.Ji.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,i).next(l=>{const h=this.ts(e,a);return this.ns(e,h,o,l.readTime)?this.Yi(t,Cl(e,null,"F")):this.rs(t,h,e,l)}))})))}Zi(t,e,i,n){return Zf(e)||n.isEqual(ct.min())?D.resolve(null):this.Ji.getDocuments(t,i).next(s=>{const o=this.ts(e,s);return this.ns(e,o,i,n)?D.resolve(null):(Fi()<=Q.DEBUG&&G("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Mn(e)),this.rs(t,o,e,Lx(n,-1)).next(a=>a))})}ts(t,e){let i=new zt(lP(t));return e.forEach((n,s)=>{Mh(t,s)&&(i=i.add(s))}),i}ns(t,e,i,n){if(t.limit===null)return!1;if(i.size!==e.size)return!0;const s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(n)>0)}Xi(t,e,i){return Fi()<=Q.DEBUG&&G("QueryEngine","Using full collection scan to execute query:",Mn(e)),this.Ji.getDocumentsMatchingQuery(t,e,Sr.min(),i)}rs(t,e,i,n){return this.Ji.getDocumentsMatchingQuery(t,i,n).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(t,e,i,n){this.persistence=t,this.ss=e,this.serializer=n,this.os=new de(it),this._s=new _i(s=>Sh(s),Rh),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(i)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new KP(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.os))}}function uS(r,t,e,i){return new aS(r,t,e,i)}async function lv(r,t){const e=at(r);return await e.persistence.runTransaction("Handle user change","readonly",i=>{let n;return e.mutationQueue.getAllMutationBatches(i).next(s=>(n=s,e.ls(t),e.mutationQueue.getAllMutationBatches(i))).next(s=>{const o=[],a=[];let l=Zt();for(const h of n){o.push(h.batchId);for(const c of h.mutations)l=l.add(c.key)}for(const h of s){a.push(h.batchId);for(const c of h.mutations)l=l.add(c.key)}return e.localDocuments.getDocuments(i,l).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:a}))})})}function lS(r,t){const e=at(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const n=t.batch.keys(),s=e.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,h,c){const p=h.batch,m=p.keys();let g=D.resolve();return m.forEach(_=>{g=g.next(()=>c.getEntry(l,_)).next(A=>{const y=h.docVersions.get(_);Et(y!==null),A.version.compareTo(y)<0&&(p.applyToRemoteDocument(A,h),A.isValidDocument()&&(A.setReadTime(h.commitVersion),c.addEntry(A)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(l,p))}(e,i,t,s).next(()=>s.apply(i)).next(()=>e.mutationQueue.performConsistencyCheck(i)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(i,n,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let l=Zt();for(let h=0;h<a.mutationResults.length;++h)a.mutationResults[h].transformResults.length>0&&(l=l.add(a.batch.mutations[h].key));return l}(t))).next(()=>e.localDocuments.getDocuments(i,n))})}function hS(r){const t=at(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function cS(r,t){const e=at(r);return e.persistence.runTransaction("Get next mutation batch","readonly",i=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(i,t)))}class ap{constructor(){this.activeTargetIds=mP()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class dS{constructor(){this.so=new ap,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t,e=!0){return e&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,e,i){this.oo[t]=e}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new ap,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fS{_o(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){G("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ho)t(0)}lo(){G("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let po=null;function Nu(){return po===null?po=function(){return 268435456+Math.round(2147483648*Math.random())}():po++,"0x"+po.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt="WebChannelConnection";class gS extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=i+"://"+e.host,this.vo=`projects/${n}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${n}`:`project_id=${n}&database_id=${s}`}get Fo(){return!1}Mo(e,i,n,s,o){const a=Nu(),l=this.xo(e,i.toUriEncodedString());G("RestConnection",`Sending RPC '${e}' ${a}:`,l,n);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,o),this.No(e,l,h,n).then(c=>(G("RestConnection",`Received RPC '${e}' ${a}: `,c),c),c=>{throw Yo("RestConnection",`RPC '${e}' ${a} failed with error: `,c,"url: ",l,"request:",n),c})}Lo(e,i,n,s,o,a){return this.Mo(e,i,n,s,o)}Oo(e,i,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+un}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((s,o)=>e[o]=s),n&&n.headers.forEach((s,o)=>e[o]=s)}xo(e,i){const n=pS[e];return`${this.Do}/v1/${i}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,e,i,n){const s=Nu();return new Promise((o,a)=>{const l=new Og;l.setWithCredentials(!0),l.listenOnce(Fg.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Ao.NO_ERROR:const c=l.getResponseJson();G(Jt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(c)),o(c);break;case Ao.TIMEOUT:G(Jt,`RPC '${t}' ${s} timed out`),a(new z(L.DEADLINE_EXCEEDED,"Request time out"));break;case Ao.HTTP_ERROR:const p=l.getStatus();if(G(Jt,`RPC '${t}' ${s} failed with status:`,p,"response text:",l.getResponseText()),p>0){let m=l.getResponseJson();Array.isArray(m)&&(m=m[0]);const g=m?.error;if(g&&g.status&&g.message){const _=function(y){const S=y.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(S)>=0?S:L.UNKNOWN}(g.status);a(new z(_,g.message))}else a(new z(L.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new z(L.UNAVAILABLE,"Connection failed."));break;default:Z()}}finally{G(Jt,`RPC '${t}' ${s} completed.`)}});const h=JSON.stringify(n);G(Jt,`RPC '${t}' ${s} sending request:`,n),l.send(e,"POST",h,i,15)})}Bo(t,e,i){const n=Nu(),s=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Ng(),a=Lg(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,e,i),l.encodeInitMessageHeaders=!0;const c=s.join("");G(Jt,`Creating RPC '${t}' stream ${n}: ${c}`,l);const p=o.createWebChannel(c,l);let m=!1,g=!1;const _=new mS({Io:y=>{g?G(Jt,`Not sending because RPC '${t}' stream ${n} is closed:`,y):(m||(G(Jt,`Opening RPC '${t}' stream ${n} transport.`),p.open(),m=!0),G(Jt,`RPC '${t}' stream ${n} sending:`,y),p.send(y))},To:()=>p.close()}),A=(y,S,M)=>{y.listen(S,x=>{try{M(x)}catch(F){setTimeout(()=>{throw F},0)}})};return A(p,kn.EventType.OPEN,()=>{g||(G(Jt,`RPC '${t}' stream ${n} transport opened.`),_.yo())}),A(p,kn.EventType.CLOSE,()=>{g||(g=!0,G(Jt,`RPC '${t}' stream ${n} transport closed`),_.So())}),A(p,kn.EventType.ERROR,y=>{g||(g=!0,Yo(Jt,`RPC '${t}' stream ${n} transport errored:`,y),_.So(new z(L.UNAVAILABLE,"The operation could not be completed")))}),A(p,kn.EventType.MESSAGE,y=>{var S;if(!g){const M=y.data[0];Et(!!M);const x=M,F=x.error||((S=x[0])===null||S===void 0?void 0:S.error);if(F){G(Jt,`RPC '${t}' stream ${n} received error:`,F);const B=F.status;let N=function(T){const w=Ct[T];if(w!==void 0)return xP(w)}(B),b=F.message;N===void 0&&(N=L.INTERNAL,b="Unknown error status: "+B+" with message "+F.message),g=!0,_.So(new z(N,b)),p.close()}else G(Jt,`RPC '${t}' stream ${n} received:`,M),_.bo(M)}}),A(a,Dg.STAT_EVENT,y=>{y.stat===Il.PROXY?G(Jt,`RPC '${t}' stream ${n} detected buffering proxy`):y.stat===Il.NOPROXY&&G(Jt,`RPC '${t}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{_.wo()},0),_}}function ku(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xa(r){return new PP(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(t,e,i=1e3,n=1.5,s=6e4){this.ui=t,this.timerId=e,this.ko=i,this.qo=n,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();const e=Math.floor(this.Ko+this.zo()),i=Math.max(0,Date.now()-this.Uo),n=Math.max(0,e-i);n>0&&G("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.Ko} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,n,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{constructor(t,e,i,n,s,o,a,l){this.ui=t,this.Ho=i,this.Jo=n,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new hv(t,e)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(t,e){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():e&&e.code===L.RESOURCE_EXHAUSTED?(pi(e.toString()),pi("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):e&&e.code===L.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.mo(e)}l_(){}auth(){this.state=1;const t=this.h_(this.Yo),e=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,n])=>{this.Yo===e&&this.P_(i,n)},i=>{t(()=>{const n=new z(L.UNKNOWN,"Fetching auth token failed: "+i.message);return this.I_(n)})})}P_(t,e){const i=this.h_(this.Yo);this.stream=this.T_(t,e),this.stream.Eo(()=>{i(()=>this.listener.Eo())}),this.stream.Ro(()=>{i(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(n=>{i(()=>this.I_(n))}),this.stream.onMessage(n=>{i(()=>++this.e_==1?this.E_(n):this.onNext(n))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(t){return G("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return e=>{this.ui.enqueueAndForget(()=>this.Yo===t?e():(G("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class _S extends vS{constructor(t,e,i,n,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,n,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,e){return this.connection.Bo("Write",t,e)}E_(t){return Et(!!t.streamToken),this.lastStreamToken=t.streamToken,Et(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){Et(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();const e=NP(t.writeResults,t.commitTime),i=Xi(t.commitTime);return this.listener.g_(i,e)}p_(){const t={};t.database=FP(this.serializer),this.a_(t)}m_(t){const e={streamToken:this.lastStreamToken,writes:t.map(i=>LP(this.serializer,i))};this.a_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yS extends class{}{constructor(t,e,i,n){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=i,this.serializer=n,this.y_=!1}w_(){if(this.y_)throw new z(L.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,e,i,n){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(t,Pl(e,i),n,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new z(L.UNKNOWN,s.toString())})}Lo(t,e,i,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(t,Pl(e,i),n,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new z(L.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class ES{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(pi(e),this.D_=!1):G("OnlineStateTracker",e)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TS{constructor(t,e,i,n,s){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{i.enqueueAndForget(async()=>{Cs(this)&&(G("RemoteStore","Restarting streams for network reachability change."),await async function(l){const h=at(l);h.L_.add(4),await As(h),h.q_.set("Unknown"),h.L_.delete(4),await Pa(h)}(this))})}),this.q_=new ES(i,n)}}async function Pa(r){if(Cs(r))for(const t of r.B_)await t(!0)}async function As(r){for(const t of r.B_)await t(!1)}function Cs(r){return at(r).L_.size===0}async function cv(r,t,e){if(!ws(t))throw t;r.L_.add(1),await As(r),r.q_.set("Offline"),e||(e=()=>hS(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{G("RemoteStore","Retrying IndexedDB access"),await e(),r.L_.delete(1),await Pa(r)})}function dv(r,t){return t().catch(e=>cv(r,e,t))}async function Sa(r){const t=at(r),e=Mr(t);let i=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;IS(t);)try{const n=await cS(t.localStore,i);if(n===null){t.O_.length===0&&e.o_();break}i=n.batchId,wS(t,n)}catch(n){await cv(t,n)}fv(t)&&pv(t)}function IS(r){return Cs(r)&&r.O_.length<10}function wS(r,t){r.O_.push(t);const e=Mr(r);e.r_()&&e.V_&&e.m_(t.mutations)}function fv(r){return Cs(r)&&!Mr(r).n_()&&r.O_.length>0}function pv(r){Mr(r).start()}async function bS(r){Mr(r).p_()}async function AS(r){const t=Mr(r);for(const e of r.O_)t.m_(e.mutations)}async function CS(r,t,e){const i=r.O_.shift(),n=Fh.from(i,t,e);await dv(r,()=>r.remoteSyncer.applySuccessfulWrite(n)),await Sa(r)}async function xS(r,t){t&&Mr(r).V_&&await async function(i,n){if(function(o){return CP(o)&&o!==L.ABORTED}(n.code)){const s=i.O_.shift();Mr(i).s_(),await dv(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,n)),await Sa(i)}}(r,t),fv(r)&&pv(r)}async function lp(r,t){const e=at(r);e.asyncQueue.verifyOperationInProgress(),G("RemoteStore","RemoteStore received new credentials");const i=Cs(e);e.L_.add(3),await As(e),i&&e.q_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.L_.delete(3),await Pa(e)}async function PS(r,t){const e=at(r);t?(e.L_.delete(2),await Pa(e)):t||(e.L_.add(2),await As(e),e.q_.set("Unknown"))}function Mr(r){return r.U_||(r.U_=function(e,i,n){const s=at(e);return s.w_(),new _S(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:bS.bind(null,r),mo:xS.bind(null,r),f_:AS.bind(null,r),g_:CS.bind(null,r)}),r.B_.push(async t=>{t?(r.U_.s_(),await Sa(r)):(await r.U_.stop(),r.O_.length>0&&(G("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{constructor(t,e,i,n,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=n,this.removalCallback=s,this.deferred=new ui,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,i,n,s){const o=Date.now()+i,a=new kh(t,e,o,n,s);return a.start(i),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new z(L.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mv(r,t){if(pi("AsyncQueue",`${t}: ${r}`),ws(r))return new z(L.UNAVAILABLE,`${t}: ${r}`);throw r}class SS{constructor(){this.queries=hp(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(e,i){const n=at(e),s=n.queries;n.queries=hp(),s.forEach((o,a)=>{for(const l of a.j_)l.onError(i)})})(this,new z(L.ABORTED,"Firestore shutting down"))}}function hp(){return new _i(r=>qg(r),Wg)}function RS(r){r.Y_.forEach(t=>{t.next()})}var cp,dp;(dp=cp||(cp={})).ea="default",dp.Cache="cache";class MS{constructor(t,e,i,n,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=n,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new _i(a=>qg(a),Wg),this.Ma=new Map,this.xa=new Set,this.Oa=new de(K.comparator),this.Na=new Map,this.La=new Dh,this.Ba={},this.ka=new Map,this.qa=rn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function OS(r,t,e){const i=NS(r);try{const n=await function(o,a){const l=at(o),h=Nt.now(),c=a.reduce((g,_)=>g.add(_.key),Zt());let p,m;return l.persistence.runTransaction("Locally write mutations","readwrite",g=>{let _=ea(),A=Zt();return l.cs.getEntries(g,c).next(y=>{_=y,_.forEach((S,M)=>{M.isValidDocument()||(A=A.add(S))})}).next(()=>l.localDocuments.getOverlayedDocuments(g,_)).next(y=>{p=y;const S=[];for(const M of a){const x=IP(M,p.get(M.key).overlayedDocument);x!=null&&S.push(new yi(M.key,x,Vg(x.value.mapValue),ir.exists(!0)))}return l.mutationQueue.addMutationBatch(g,h,S,a)}).next(y=>{m=y;const S=y.applyToLocalDocumentSet(p,A);return l.documentOverlayCache.saveOverlays(g,y.batchId,S)})}).then(()=>({batchId:m.batchId,changes:Kg(p)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(n.batchId),function(o,a,l){let h=o.Ba[o.currentUser.toKey()];h||(h=new de(it)),h=h.insert(a,l),o.Ba[o.currentUser.toKey()]=h}(i,n.batchId,e),await Ra(i,n.changes),await Sa(i.remoteStore)}catch(n){const s=mv(n,"Failed to persist write");e.reject(s)}}function fp(r,t,e){const i=at(r);if(i.isPrimaryClient&&e===0||!i.isPrimaryClient&&e===1){const n=[];i.Fa.forEach((s,o)=>{const a=o.view.Z_(t);a.snapshot&&n.push(a.snapshot)}),function(o,a){const l=at(o);l.onlineState=a;let h=!1;l.queries.forEach((c,p)=>{for(const m of p.j_)m.Z_(a)&&(h=!0)}),h&&RS(l)}(i.eventManager,t),n.length&&i.Ca.d_(n),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function FS(r,t){const e=at(r),i=t.batch.batchId;try{const n=await lS(e.localStore,t);vv(e,i,null),gv(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await Ra(e,n)}catch(n){await wh(n)}}async function DS(r,t,e){const i=at(r);try{const n=await function(o,a){const l=at(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let c;return l.mutationQueue.lookupMutationBatch(h,a).next(p=>(Et(p!==null),c=p.keys(),l.mutationQueue.removeMutationBatch(h,p))).next(()=>l.mutationQueue.performConsistencyCheck(h)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(h,c,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,c)).next(()=>l.localDocuments.getDocuments(h,c))})}(i.localStore,t);vv(i,t,e),gv(i,t),i.sharedClientState.updateMutationState(t,"rejected",e),await Ra(i,n)}catch(n){await wh(n)}}function gv(r,t){(r.ka.get(t)||[]).forEach(e=>{e.resolve()}),r.ka.delete(t)}function vv(r,t,e){const i=at(r);let n=i.Ba[i.currentUser.toKey()];if(n){const s=n.get(t);s&&(e?s.reject(e):s.resolve(),n=n.remove(t)),i.Ba[i.currentUser.toKey()]=n}}async function Ra(r,t,e){const i=at(r),n=[],s=[],o=[];i.Fa.isEmpty()||(i.Fa.forEach((a,l)=>{o.push(i.Ka(l,t,e).then(h=>{var c;if((h||e)&&i.isPrimaryClient){const p=h?!h.fromCache:(c=e?.targetChanges.get(l.targetId))===null||c===void 0?void 0:c.current;i.sharedClientState.updateQueryState(l.targetId,p?"current":"not-current")}if(h){n.push(h);const p=Nh.Wi(l.targetId,h);s.push(p)}}))}),await Promise.all(o),i.Ca.d_(n),await async function(l,h){const c=at(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>D.forEach(h,m=>D.forEach(m.$i,g=>c.persistence.referenceDelegate.addReference(p,m.targetId,g)).next(()=>D.forEach(m.Ui,g=>c.persistence.referenceDelegate.removeReference(p,m.targetId,g)))))}catch(p){if(!ws(p))throw p;G("LocalStore","Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const g=c.os.get(m),_=g.snapshotVersion,A=g.withLastLimboFreeSnapshotVersion(_);c.os=c.os.insert(m,A)}}}(i.localStore,s))}async function LS(r,t){const e=at(r);if(!e.currentUser.isEqual(t)){G("SyncEngine","User change. New user:",t.toKey());const i=await lv(e.localStore,t);e.currentUser=t,function(s,o){s.ka.forEach(a=>{a.forEach(l=>{l.reject(new z(L.CANCELLED,o))})}),s.ka.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),await Ra(e,i.hs)}}function NS(r){const t=at(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=FS.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=DS.bind(null,t),t}class sa{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=xa(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),await this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)}ja(t,e){return null}Ha(t,e){return null}za(t){return uS(this.persistence,new oS,t.initialUser,this.serializer)}Ga(t){return new uv(Lh.Zr,this.serializer)}Wa(t){return new dS}async terminate(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}sa.provider={build:()=>new sa};class kS extends sa{constructor(t){super(),this.cacheSizeBytes=t}ja(t,e){Et(this.persistence.referenceDelegate instanceof na);const i=this.persistence.referenceDelegate.garbageCollector;return new zP(i,t.asyncQueue,e)}Ga(t){const e=this.cacheSizeBytes!==void 0?ce.withCacheSize(this.cacheSizeBytes):ce.DEFAULT;return new uv(i=>na.Zr(i,e),this.serializer)}}class Rl{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>fp(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=LS.bind(null,this.syncEngine),await PS(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new SS}()}createDatastore(t){const e=xa(t.databaseInfo.databaseId),i=function(s){return new gS(s)}(t.databaseInfo);return function(s,o,a,l){return new yS(s,o,a,l)}(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return function(i,n,s,o,a){return new TS(i,n,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>fp(this.syncEngine,e,0),function(){return up.D()?new up:new fS}())}createSyncEngine(t,e){return function(n,s,o,a,l,h,c){const p=new MS(n,s,o,a,l,h);return c&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(n){const s=at(n);G("RemoteStore","RemoteStore shutting down."),s.L_.add(5),await As(s),s.k_.shutdown(),s.q_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(e=this.eventManager)===null||e===void 0||e.terminate()}}Rl.provider={build:()=>new Rl};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(t,e,i,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=n,this.user=Qt.UNAUTHENTICATED,this.clientId=Bg.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,async o=>{G("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(i,o=>(G("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ui;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const i=mv(e,"Failed to shutdown persistence");t.reject(i)}}),t.promise}}async function Bu(r,t){r.asyncQueue.verifyOperationInProgress(),G("FirestoreClient","Initializing OfflineComponentProvider");const e=r.configuration;await t.initialize(e);let i=e.initialUser;r.setCredentialChangeListener(async n=>{i.isEqual(n)||(await lv(t.localStore,n),i=n)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function pp(r,t){r.asyncQueue.verifyOperationInProgress();const e=await US(r);G("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener(i=>lp(t.remoteStore,i)),r.setAppCheckTokenChangeListener((i,n)=>lp(t.remoteStore,n)),r._onlineComponents=t}async function US(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){G("FirestoreClient","Using user provided OfflineComponentProvider");try{await Bu(r,r._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!function(n){return n.name==="FirebaseError"?n.code===L.FAILED_PRECONDITION||n.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}(e))throw e;Yo("Error using user provided cache. Falling back to memory cache: "+e),await Bu(r,new sa)}}else G("FirestoreClient","Using default OfflineComponentProvider"),await Bu(r,new kS(void 0));return r._offlineComponents}async function VS(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(G("FirestoreClient","Using user provided OnlineComponentProvider"),await pp(r,r._uninitializedComponentsProvider._online)):(G("FirestoreClient","Using default OnlineComponentProvider"),await pp(r,new Rl))),r._onlineComponents}function GS(r){return VS(r).then(t=>t.syncEngine)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _v(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jS(r,t,e){if(!e)throw new z(L.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function HS(r,t,e,i){if(t===!0&&i===!0)throw new z(L.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function gp(r){if(!K.isDocumentKey(r))throw new z(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Bh(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(i){return i.constructor?i.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":Z()}function Ml(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new z(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Bh(r);throw new z(L.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(t){var e,i;if(t.host===void 0){if(t.ssl!==void 0)throw new z(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new z(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}HS("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_v((i=t.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new z(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new z(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new z(L.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(i,n){return i.timeoutSeconds===n.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Uh{constructor(t,e,i,n){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vp({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new z(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new z(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vp(t),t.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new Cx;switch(i.type){case"firstParty":return new Rx(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new z(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const i=mp.get(e);i&&(G("ComponentProvider","Removing Datastore"),mp.delete(e),i.terminate())}(this),Promise.resolve()}}function $S(r,t,e,i={}){var n;const s=(r=Ml(r,Uh))._getSettings(),o=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Yo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),i.mockUserToken){let a,l;if(typeof i.mockUserToken=="string")a=i.mockUserToken,l=Qt.MOCK_USER;else{a=tb(i.mockUserToken,(n=r._app)===null||n===void 0?void 0:n.options.projectId);const h=i.mockUserToken.sub||i.mockUserToken.user_id;if(!h)throw new z(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Qt(h)}r._authCredentials=new xx(new kg(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new Vh(this.firestore,t,this._query)}}class nr{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ds(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new nr(this.firestore,t,this._key)}}class ds extends Vh{constructor(t,e,i){super(t,e,oP(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new nr(this.firestore,null,new K(t))}withConverter(t){return new ds(this.firestore,t,this._path)}}function zS(r,t,...e){if(r=ve(r),arguments.length===1&&(t=Bg.newId()),jS("doc","path",t),r instanceof Uh){const i=Pt.fromString(t,...e);return gp(i),new nr(r,null,new K(i))}{if(!(r instanceof nr||r instanceof ds))throw new z(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=r._path.child(Pt.fromString(t,...e));return gp(i),new nr(r.firestore,r instanceof ds?r.converter:null,new K(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _p{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new hv(this,"async_queue_retry"),this.Vu=()=>{const i=ku();i&&G("AsyncQueue","Visibility state changed to "+i.visibilityState),this.t_.jo()},this.mu=t;const e=ku();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;const e=ku();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise(()=>{});const e=new ui;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Pu.push(t),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!ws(t))throw t;G("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(t){const e=this.mu.then(()=>(this.du=!0,t().catch(i=>{this.Eu=i,this.du=!1;const n=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(i);throw pi("INTERNAL UNHANDLED ERROR: ",n),i}).then(i=>(this.du=!1,i))));return this.mu=e,e}enqueueAfterDelay(t,e,i){this.fu(),this.Ru.indexOf(t)>-1&&(e=0);const n=kh.createAndSchedule(this,t,e,i,s=>this.yu(s));return this.Tu.push(n),n}fu(){this.Eu&&Z()}verifyOperationInProgress(){}async wu(){let t;do t=this.mu,await t;while(t!==this.mu)}Su(t){for(const e of this.Tu)if(e.timerId===t)return!0;return!1}bu(t){return this.wu().then(()=>{this.Tu.sort((e,i)=>e.targetTimeMs-i.targetTimeMs);for(const e of this.Tu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.wu()})}Du(t){this.Ru.push(t)}yu(t){const e=this.Tu.indexOf(t);this.Tu.splice(e,1)}}class yv extends Uh{constructor(t,e,i,n){super(t,e,i,n),this.type="firestore",this._queue=new _p,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new _p(t),this._firestoreClient=void 0,await t}}}function XS(r,t){const e=typeof r=="object"?r:hh(),i=typeof r=="string"?r:t||"(default)",n=ya(e,"firestore").getImmediate({identifier:i});if(!n._initialized){const s=Qw("firestore");s&&$S(n,...s)}return n}function WS(r){if(r._terminated)throw new z(L.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||qS(r),r._firestoreClient}function qS(r){var t,e,i;const n=r._freezeSettings(),s=function(a,l,h,c){return new Xx(a,l,h,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,_v(c.experimentalLongPollingOptions),c.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,n);r._componentsProvider||((e=n.localCache)===null||e===void 0?void 0:e._offlineComponentProvider)&&((i=n.localCache)===null||i===void 0?void 0:i._onlineComponentProvider)&&(r._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),r._firestoreClient=new BS(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(a){const l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(t){this._byteString=t}static fromBase64String(t){try{return new fs($e.fromBase64String(t))}catch(e){throw new z(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new fs($e.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new z(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $t(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new z(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new z(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return it(this._lat,t._lat)||it(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(i,n){if(i.length!==n.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==n[s])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YS=/^__.*__$/;class KS{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return this.fieldMask!==null?new yi(t,this.data,this.fieldMask,e,this.fieldTransforms):new bs(t,this.data,e,this.fieldTransforms)}}function bv(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Z()}}class Gh{constructor(t,e,i,n,s,o){this.settings=t,this.databaseId=e,this.serializer=i,this.ignoreUndefinedProperties=n,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(t){return new Gh(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(t){var e;const i=(e=this.path)===null||e===void 0?void 0:e.child(t),n=this.Fu({path:i,xu:!1});return n.Ou(t),n}Nu(t){var e;const i=(e=this.path)===null||e===void 0?void 0:e.child(t),n=this.Fu({path:i,xu:!1});return n.vu(),n}Lu(t){return this.Fu({path:void 0,xu:!0})}Bu(t){return oa(t,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ou(this.path.get(t))}Ou(t){if(t.length===0)throw this.Bu("Document fields must not be empty");if(bv(this.Cu)&&YS.test(t))throw this.Bu('Document fields cannot begin and end with "__"')}}class JS{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=i||xa(t)}Qu(t,e,i,n=!1){return new Gh({Cu:t,methodName:e,qu:i,path:$t.emptyPath(),xu:!1,ku:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function QS(r){const t=r._freezeSettings(),e=xa(r._databaseId);return new JS(r._databaseId,!!t.ignoreUndefinedProperties,e)}function ZS(r,t,e,i,n,s={}){const o=r.Qu(s.merge||s.mergeFields?2:0,t,e,n);Pv("Data must be an object, but it was:",o,i);const a=Cv(i,o);let l,h;if(s.merge)l=new Re(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){const c=[];for(const p of s.mergeFields){const m=tR(t,p,e);if(!o.contains(m))throw new z(L.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);iR(c,m)||c.push(m)}l=new Re(c),h=o.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,h=o.fieldTransforms;return new KS(new Se(a),l,h)}function Av(r,t){if(xv(r=ve(r)))return Pv("Unsupported field value:",t,r),Cv(r,t);if(r instanceof Tv)return function(i,n){if(!bv(n.Cu))throw n.Bu(`${i._methodName}() can only be used with update() and set()`);if(!n.path)throw n.Bu(`${i._methodName}() is not currently supported inside arrays`);const s=i._toFieldTransform(n);s&&n.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.xu&&t.Cu!==4)throw t.Bu("Nested arrays are not supported");return function(i,n){const s=[];let o=0;for(const a of i){let l=Av(a,n.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(r,t)}return function(i,n){if((i=ve(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return gP(n.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const s=Nt.fromDate(i);return{timestampValue:xl(n.serializer,s)}}if(i instanceof Nt){const s=new Nt(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:xl(n.serializer,s)}}if(i instanceof Iv)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof fs)return{bytesValue:SP(n.serializer,i._byteString)};if(i instanceof nr){const s=n.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw n.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ov(i.firestore._databaseId||n.databaseId,i._key.path)}}if(i instanceof wv)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Oh(a.serializer,l)})}}}}}}(i,n);throw n.Bu(`Unsupported field value: ${Bh(i)}`)}(r,t)}function Cv(r,t){const e={};return Ug(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ln(r,(i,n)=>{const s=Av(n,t.Mu(i));s!=null&&(e[i]=s)}),{mapValue:{fields:e}}}function xv(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Nt||r instanceof Iv||r instanceof fs||r instanceof nr||r instanceof Tv||r instanceof wv)}function Pv(r,t,e){if(!xv(e)||!function(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}(e)){const i=Bh(e);throw i==="an object"?t.Bu(r+" a custom object"):t.Bu(r+" "+i)}}function tR(r,t,e){if((t=ve(t))instanceof Ev)return t._internalPath;if(typeof t=="string")return rR(r,t);throw oa("Field path arguments must be of type string or ",r,!1,void 0,e)}const eR=new RegExp("[~\\*/\\[\\]]");function rR(r,t,e){if(t.search(eR)>=0)throw oa(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new Ev(...t.split("."))._internalPath}catch{throw oa(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function oa(r,t,e,i,n){const s=i&&!i.isEmpty(),o=n!==void 0;let a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${n}`),l+=")"),new z(L.INVALID_ARGUMENT,a+r+l)}function iR(r,t){return r.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nR(r,t,e){let i;return i=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,i}function sR(r,t,e){r=Ml(r,nr);const i=Ml(r.firestore,yv),n=nR(r.converter,t,e);return oR(i,[ZS(QS(i),"setDoc",r._key,n,r.converter!==null,e).toMutation(r._key,ir.none())])}function oR(r,t){return function(i,n){const s=new ui;return i.asyncQueue.enqueueAndForget(async()=>OS(await GS(i),n,s)),s.promise}(WS(r),t)}(function(t,e=!0){(function(n){un=n})(on),ci(new Pr("firestore",(i,{instanceIdentifier:n,options:s})=>{const o=i.getProvider("app").getImmediate(),a=new yv(new Px(i.getProvider("auth-internal")),new Ox(i.getProvider("app-check-internal")),function(h,c){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new z(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qo(h.options.projectId,c)}(o,n),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ge($f,"4.7.4",t),Ge($f,"4.7.4","esm2017")})();const aR=XS(Ea),uR=async(r,t)=>{try{await sR(zS(aR,"users",r),{loggedIn:t})}catch(e){throw console.error("\u30E6\u30FC\u30B6\u30FC\u30ED\u30B0\u30A4\u30F3\u72B6\u614B\u306E\u66F4\u65B0\u306B\u5931\u6557\u3057\u307E\u3057\u305F:",e),e}},jh=Rg(Ea);dC(jh,Eg).catch(r=>{console.error("\u6C38\u7D9A\u6027\u306E\u8A2D\u5B9A\u30A8\u30E9\u30FC:",r)});const lR=new Qe,Sv=async()=>{try{const r=await DC(jh,lR);return r.user?(await uR(r.user.uid,!0),r.user):null}catch(r){return console.error("Google\u30B5\u30A4\u30F3\u30A4\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F:",r),null}};function Rv(){return localStorage.getItem("uid")}function hR(r){localStorage.setItem("uid",r)}function cR(){localStorage.removeItem("uid")}async function dR(){try{await mC(jh),cR()}catch(r){throw console.error("\u30ED\u30B0\u30A2\u30A6\u30C8\u30A8\u30E9\u30FC:",r),r}}function fR(){return!!Rv()}var yp="@firebase/vertexai",Ol="1.0.0";/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh="vertexAI",Mv="us-central1",pR="https://firebasevertexai.googleapis.com",mR="v1beta",Ep=Ol,gR="gl-js";/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(t,e,i,n){var s;this.app=t,this.options=n;const o=i?.getImmediate({optional:!0}),a=e?.getImmediate({optional:!0});this.auth=a||null,this.appCheck=o||null,this.location=((s=this.options)===null||s===void 0?void 0:s.location)||Mv}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt extends Xe{constructor(t,e,i){const n=Hh,s="VertexAI",o=`${n}/${t}`,a=`${s}: ${e} (${o})`;super(t,a),this.code=t,this.customErrorData=i,Error.captureStackTrace&&Error.captureStackTrace(this,gt),Object.setPrototypeOf(this,gt.prototype),this.toString=()=>a}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ps;(function(r){r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens"})(ps||(ps={}));class Ov{constructor(t,e,i,n,s){this.model=t,this.task=e,this.apiSettings=i,this.stream=n,this.requestOptions=s}toString(){var t;const e=mR;let n=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||pR}/${e}`;return n+=`/projects/${this.apiSettings.project}`,n+=`/locations/${this.apiSettings.location}`,n+=`/${this.model}`,n+=`:${this.task}`,this.stream&&(n+="?alt=sse"),n}get fullModelString(){let t=`projects/${this.apiSettings.project}`;return t+=`/locations/${this.apiSettings.location}`,t+=`/${this.model}`,t}}function _R(){const r=[];return r.push(`${gR}/${Ep}`),r.push(`fire/${Ep}`),r.join(" ")}async function yR(r){const t=new Headers;if(t.append("Content-Type","application/json"),t.append("x-goog-api-client",_R()),t.append("x-goog-api-key",r.apiSettings.apiKey),r.apiSettings.getAppCheckToken){const e=await r.apiSettings.getAppCheckToken();e&&!e.error&&t.append("X-Firebase-AppCheck",e.token)}if(r.apiSettings.getAuthToken){const e=await r.apiSettings.getAuthToken();e&&t.append("Authorization",`Firebase ${e.accessToken}`)}return t}async function ER(r,t,e,i,n,s){const o=new Ov(r,t,e,i,s);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},TR(s)),{method:"POST",headers:await yR(o),body:n})}}async function $h(r,t,e,i,n,s){const o=new Ov(r,t,e,i,s);let a;try{const l=await ER(r,t,e,i,n,s);if(a=await fetch(l.url,l.fetchOptions),!a.ok){let h="",c;try{const p=await a.json();h=p.error.message,p.error.details&&(h+=` ${JSON.stringify(p.error.details)}`,c=p.error.details)}catch{}throw a.status===403&&c.some(p=>p.reason==="SERVICE_DISABLED")&&c.some(p=>{var m,g;return(g=(m=p.links)===null||m===void 0?void 0:m[0])===null||g===void 0?void 0:g.description.includes("Google developers console API activation")})?new gt("api-not-enabled",`The Vertex AI in Firebase SDK requires the Vertex AI in Firebase
          API ('firebasevertexai.googleapis.com') to be enabled in your
          Firebase project. Enable this API by visiting the Firebase Console
          at https://console.firebase.google.com/project/${o.apiSettings.project}/genai/
          and clicking "Get started". If you enabled this API recently,
          wait a few minutes for the action to propagate to our systems and
          then retry.`,{status:a.status,statusText:a.statusText,errorDetails:c}):new gt("fetch-error",`Error fetching from ${o}: [${a.status} ${a.statusText}] ${h}`,{status:a.status,statusText:a.statusText,errorDetails:c})}}catch(l){let h=l;throw l.code!=="fetch-error"&&l.code!=="api-not-enabled"&&l instanceof Error&&(h=new gt("error",`Error fetching from ${o.toString()}: ${l.message}`),h.stack=l.stack),h}return a}function TR(r){const t={};let e=18e4;r?.timeout&&r?.timeout>=0&&(e=r.timeout);const i=new AbortController,n=i.signal;return setTimeout(()=>i.abort(),e),t.signal=n,t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tp=["user","model","function","system"];var Ip;(function(r){r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Ip||(Ip={}));var wp;(function(r){r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(wp||(wp={}));var bp;(function(r){r.SEVERITY="SEVERITY",r.PROBABILITY="PROBABILITY"})(bp||(bp={}));var Ap;(function(r){r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(Ap||(Ap={}));var Cp;(function(r){r.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",r.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",r.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",r.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Cp||(Cp={}));var xp;(function(r){r.SAFETY="SAFETY",r.OTHER="OTHER"})(xp||(xp={}));var aa;(function(r){r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.OTHER="OTHER"})(aa||(aa={}));var Pp;(function(r){r.AUTO="AUTO",r.ANY="ANY",r.NONE="NONE"})(Pp||(Pp={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sp;(function(r){r.STRING="string",r.NUMBER="number",r.INTEGER="integer",r.BOOLEAN="boolean",r.ARRAY="array",r.OBJECT="object"})(Sp||(Sp={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zh(r){return r.candidates&&!r.candidates[0].hasOwnProperty("index")&&(r.candidates[0].index=0),IR(r)}function IR(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Fl(r.candidates[0]))throw new gt("response-error",`Response error: ${Ni(r)}. Response body stored in error.response`,{response:r});return wR(r)}else if(r.promptFeedback)throw new gt("response-error",`Text not available. ${Ni(r)}`,{response:r});return""},r.functionCalls=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Fl(r.candidates[0]))throw new gt("response-error",`Response error: ${Ni(r)}. Response body stored in error.response`,{response:r});return bR(r)}else if(r.promptFeedback)throw new gt("response-error",`Function call not available. ${Ni(r)}`,{response:r})},r}function wR(r){var t,e,i,n;const s=[];if(!((e=(t=r.candidates)===null||t===void 0?void 0:t[0].content)===null||e===void 0)&&e.parts)for(const o of(n=(i=r.candidates)===null||i===void 0?void 0:i[0].content)===null||n===void 0?void 0:n.parts)o.text&&s.push(o.text);return s.length>0?s.join(""):""}function bR(r){var t,e,i,n;const s=[];if(!((e=(t=r.candidates)===null||t===void 0?void 0:t[0].content)===null||e===void 0)&&e.parts)for(const o of(n=(i=r.candidates)===null||i===void 0?void 0:i[0].content)===null||n===void 0?void 0:n.parts)o.functionCall&&s.push(o.functionCall);if(s.length>0)return s}const AR=[aa.RECITATION,aa.SAFETY];function Fl(r){return!!r.finishReason&&AR.includes(r.finishReason)}function Ni(r){var t,e,i;let n="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)n+="Response was blocked",!((t=r.promptFeedback)===null||t===void 0)&&t.blockReason&&(n+=` due to ${r.promptFeedback.blockReason}`),!((e=r.promptFeedback)===null||e===void 0)&&e.blockReasonMessage&&(n+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((i=r.candidates)===null||i===void 0)&&i[0]){const s=r.candidates[0];Fl(s)&&(n+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(n+=`: ${s.finishMessage}`))}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rp=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function CR(r){const t=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),e=SR(t),[i,n]=e.tee();return{stream:PR(i),response:xR(n)}}async function xR(r){const t=[],e=r.getReader();for(;;){const{done:i,value:n}=await e.read();if(i)return zh(RR(t));t.push(n)}}function PR(r){return xA(this,arguments,function*(){const e=r.getReader();for(;;){const{value:i,done:n}=yield os(e.read());if(n)break;const s=zh(i);yield yield os(s)}})}function SR(r){const t=r.getReader();return new ReadableStream({start(i){let n="";return s();function s(){return t.read().then(({value:o,done:a})=>{if(a){if(n.trim()){i.error(new gt("parse-failed","Failed to parse stream"));return}i.close();return}n+=o;let l=n.match(Rp),h;for(;l;){try{h=JSON.parse(l[1])}catch{i.error(new gt("parse-failed",`Error parsing JSON response: "${l[1]}`));return}i.enqueue(h),n=n.substring(l[0].length),l=n.match(Rp)}return s()})}}})}function RR(r){const t=r[r.length-1],e={promptFeedback:t?.promptFeedback};for(const i of r)if(i.candidates)for(const n of i.candidates){const s=n.index||0;if(e.candidates||(e.candidates=[]),e.candidates[s]||(e.candidates[s]={index:n.index}),e.candidates[s].citationMetadata=n.citationMetadata,e.candidates[s].finishReason=n.finishReason,e.candidates[s].finishMessage=n.finishMessage,e.candidates[s].safetyRatings=n.safetyRatings,n.content&&n.content.parts){e.candidates[s].content||(e.candidates[s].content={role:n.content.role||"user",parts:[]});const o={};for(const a of n.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),Object.keys(o).length===0&&(o.text=""),e.candidates[s].content.parts.push(o)}}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fv(r,t,e,i){const n=await $h(t,ps.STREAM_GENERATE_CONTENT,r,!0,JSON.stringify(e),i);return CR(n)}async function Dv(r,t,e,i){const s=await(await $h(t,ps.GENERATE_CONTENT,r,!1,JSON.stringify(e),i)).json();return{response:zh(s)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lv(r){if(r!=null){if(typeof r=="string")return{role:"system",parts:[{text:r}]};if(r.text)return{role:"system",parts:[r]};if(r.parts)return r.role?r:{role:"system",parts:r.parts}}}function Dl(r){let t=[];if(typeof r=="string")t=[{text:r}];else for(const e of r)typeof e=="string"?t.push({text:e}):t.push(e);return MR(t)}function MR(r){const t={role:"user",parts:[]},e={role:"function",parts:[]};let i=!1,n=!1;for(const s of r)"functionResponse"in s?(e.parts.push(s),n=!0):(t.parts.push(s),i=!0);if(i&&n)throw new gt("invalid-content","Within a single message, FunctionResponse cannot be mixed with other type of Part in the request for sending chat message.");if(!i&&!n)throw new gt("invalid-content","No Content is provided for sending chat message.");return i?t:e}function Uu(r){let t;return r.contents?t=r:t={contents:[Dl(r)]},r.systemInstruction&&(t.systemInstruction=Lv(r.systemInstruction)),t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp=["text","inlineData","functionCall","functionResponse"],OR={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall"],system:["text"]},Op={user:["model"],function:["model"],model:["user","function"],system:[]};function FR(r){let t=null;for(const e of r){const{role:i,parts:n}=e;if(!t&&i!=="user")throw new gt("invalid-content",`First Content should be with role 'user', got ${i}`);if(!Tp.includes(i))throw new gt("invalid-content",`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Tp)}`);if(!Array.isArray(n))throw new gt("invalid-content","Content should have 'parts' but property with an array of Parts");if(n.length===0)throw new gt("invalid-content","Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0};for(const a of n)for(const l of Mp)l in a&&(s[l]+=1);const o=OR[i];for(const a of Mp)if(!o.includes(a)&&s[a]>0)throw new gt("invalid-content",`Content with role '${i}' can't contain '${a}' part`);if(t&&!Op[i].includes(t.role))throw new gt("invalid-content",`Content with role '${i} can't follow '${t.role}'. Valid previous roles: ${JSON.stringify(Op)}`);t=e}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fp="SILENT_ERROR";class DR{constructor(t,e,i,n){this.model=e,this.params=i,this.requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiSettings=t,i?.history&&(FR(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t){var e,i,n,s,o;await this._sendPromise;const a=Dl(t),l={safetySettings:(e=this.params)===null||e===void 0?void 0:e.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(n=this.params)===null||n===void 0?void 0:n.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,contents:[...this._history,a]};let h={};return this._sendPromise=this._sendPromise.then(()=>Dv(this._apiSettings,this.model,l,this.requestOptions)).then(c=>{var p,m;if(c.response.candidates&&c.response.candidates.length>0){this._history.push(a);const g={parts:((p=c.response.candidates)===null||p===void 0?void 0:p[0].content.parts)||[],role:((m=c.response.candidates)===null||m===void 0?void 0:m[0].content.role)||"model"};this._history.push(g)}else{const g=Ni(c.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}h=c}),await this._sendPromise,h}async sendMessageStream(t){var e,i,n,s,o;await this._sendPromise;const a=Dl(t),l={safetySettings:(e=this.params)===null||e===void 0?void 0:e.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(n=this.params)===null||n===void 0?void 0:n.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,contents:[...this._history,a]},h=Fv(this._apiSettings,this.model,l,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>h).catch(c=>{throw new Error(Fp)}).then(c=>c.response).then(c=>{if(c.candidates&&c.candidates.length>0){this._history.push(a);const p=Object.assign({},c.candidates[0].content);p.role||(p.role="model"),this._history.push(p)}else{const p=Ni(c);p&&console.warn(`sendMessageStream() was unsuccessful. ${p}. Inspect response object for details.`)}}).catch(c=>{c.message!==Fp&&console.error(c)}),h}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LR(r,t,e,i){return(await $h(t,ps.COUNT_TOKENS,r,!1,JSON.stringify(e),i)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(t,e,i){var n,s,o,a;if(!((s=(n=t.app)===null||n===void 0?void 0:n.options)===null||s===void 0)&&s.apiKey)if(!((a=(o=t.app)===null||o===void 0?void 0:o.options)===null||a===void 0)&&a.projectId)this._apiSettings={apiKey:t.app.options.apiKey,project:t.app.options.projectId,location:t.location},t.appCheck&&(this._apiSettings.getAppCheckToken=()=>t.appCheck.getToken()),t.auth&&(this._apiSettings.getAuthToken=()=>t.auth.getToken());else throw new gt("no-project-id",'The "projectId" field is empty in the local Firebase config. Firebase VertexAI requires this field to contain a valid project ID.');else throw new gt("no-api-key",'The "apiKey" field is empty in the local Firebase config. Firebase VertexAI requires this field to contain a valid API key.');e.model.includes("/")?e.model.startsWith("models/")?this.model=`publishers/google/${e.model}`:this.model=e.model:this.model=`publishers/google/models/${e.model}`,this.generationConfig=e.generationConfig||{},this.safetySettings=e.safetySettings||[],this.tools=e.tools,this.toolConfig=e.toolConfig,this.systemInstruction=Lv(e.systemInstruction),this.requestOptions=i||{}}async generateContent(t){const e=Uu(t);return Dv(this._apiSettings,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},e),this.requestOptions)}async generateContentStream(t){const e=Uu(t);return Fv(this._apiSettings,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},e),this.requestOptions)}startChat(t){return new DR(this._apiSettings,this.model,Object.assign({tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}async countTokens(t){const e=Uu(t);return LR(this._apiSettings,this.model,e)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kR(r=hh(),t){return r=ve(r),ya(r,Hh).getImmediate({identifier:t?.location||Mv})}function BR(r,t,e){if(!t.model)throw new gt("no-model","Must provide a model name. Example: getGenerativeModel({ model: 'my-model-name' })");return new NR(r,t,e)}function UR(){ci(new Pr(Hh,(r,{instanceIdentifier:t})=>{const e=r.getProvider("app").getImmediate(),i=r.getProvider("auth-internal"),n=r.getProvider("app-check-internal");return new vR(e,i,n,{location:t})},"PUBLIC").setMultipleInstances(!0)),Ge(yp,Ol),Ge(yp,Ol,"esm2017")}UR();const VR=kR(Ea),GR=`\u3042\u306A\u305F\u306B\u306F\u30E6\u30FC\u30B6\u30FC\u304C\u7D4C\u9A13\u3057\u305F\u305D\u306E\u65E5\u306E\u51FA\u6765\u4E8B\u3092\u53D6\u5F97\u3057\u3066\u3001\u30AC\u30AF\u30C1\u30AB\u3092\u751F\u6210\u3057\u3066\u3082\u3089\u3044\u307E\u3059\u3002

\u5F37\u307F\u306E\u6D3B\u304B\u3057\u65B9\u304C\u308F\u304B\u3089\u306A\u3044\u5229\u7528\u8005\u306E\u53D6\u308A\u7D44\u307F\u3092\u30D2\u30A2\u30EA\u30F3\u30B0\u3057\u3066\u30AC\u30AF\u30C1\u30AB\u306E\u8868\u73FE\u3092\u30B5\u30DD\u30FC\u30C8\u3059\u308B\u305F\u3081\u306B\u3001
\u30AD\u30E3\u30EA\u30A2\u30C7\u30B6\u30A4\u30F3\u3092\u8003\u3048\u308B\u30A2\u30B7\u30B9\u30BF\u30F3\u30C8\u3068\u3057\u3066\u8AD6\u7406\u7684\u306B\u63D0\u6848\u3092\u884C\u3063\u3066\u304F\u3060\u3055\u3044\u3002

\u4EE5\u4E0B\u3092\u30D2\u30A2\u30EA\u30F3\u30B0\u3057\u3066\uFF08\u672A\u6765\uFF09\u3092\u4ED8\u3051\u52A0\u3048\u305F\u30A8\u30D4\u30BD\u30FC\u30C9\u3092\u63D0\u6848\u3067\u304D\u308B\u3088\u3046\u306B\u5DE5\u592B\u3092\u884C\u3063\u3066\u304F\u3060\u3055\u3044\u3002
\uFF08\u884C\u52D5\u3001\u8AB2\u984C\u3001\u5BFE\u5FDC\u3001\u7D50\u679C\u3001\u5B66\u3073\uFF09
\u203BAI\u306F\u30E6\u30FC\u30B6\u30FC\u306B\u5BFE\u3057\u3066\u5171\u611F\u3001\u8CEA\u554F\u3001\u4F8B\u3048\u8A71\u306E\u9806\u3067\u554F\u3044\u304B\u3051\u3066\u3044\u304D\u307E\u3059\u3002\u5BFE\u5FDC\u306F\u4EE5\u4E0B\u306E\u6587\u8108\u306B\u57FA\u3065\u304F
\u4F8B\uFF1A\uFF08\uFF5E\u3057\u3066\u304D\u305F\u306E\u3067\u3059\u306D\u3001\u304A\u75B2\u308C\u69D8\u3067\u3059\u3002\u65E9\u901F\u3067\u3059\u304C\uFF5E\u306B\u3064\u3044\u3066\u805E\u304B\u305B\u3066\u304F\u3060\u3055\u3044\u3002\u3082\u3057\u304B\u3057\u3066\uFF5E\u3060\u3063\u305F\u308A\u3057\u307E\u3057\u305F\u304B\uFF1F\uFF09\u7B49
\u203B\u5B66\u751F\u306E\u500B\u6027\u3084\u5F37\u307F\u3092\u5C0A\u91CD\u3057\u3001\u4E00\u4EBA\u3072\u3068\u308A\u306B\u5408\u3063\u305F\u30A2\u30C9\u30D0\u30A4\u30B9\u3092\u5FC3\u304C\u3051\u3066\u304F\u3060\u3055\u3044\u3002
\u203B\u6700\u65B0\u306E\u5C31\u8077\u6D3B\u52D5\u60C5\u5831\u3084\u4F01\u696D\u60C5\u5831\u3092\u63D0\u4F9B\u3057\u3001\u5B66\u751F\u306E\u9078\u629E\u80A2\u3092\u5E83\u3052\u3066\u304F\u3060\u3055\u3044\u3002
\u203B \u5C31\u8077\u6D3B\u52D5\u4EE5\u5916\u306E\u60A9\u307F\u3084\u4E0D\u5B89\u306B\u3082\u5BC4\u308A\u6DFB\u3044\u3001\u5B66\u751F\u306E\u30E1\u30F3\u30BF\u30EB\u30D8\u30EB\u30B9\u306B\u3082\u914D\u616E\u3057\u3066\u304F\u3060\u3055\u3044\u3002
\u203B\u89AA\u8EAB\u306A\u59FF\u52E2\u3067\u5B66\u751F\u3068\u5411\u304D\u5408\u3044\u3001\u4FE1\u983C\u95A2\u4FC2\u3092\u7BC9\u304F\u3053\u3068\u304C\u5927\u5207\u3067\u3059\u3002
\u203B\u53E3\u8ABF\u306F\u89AA\u3057\u307F\u3092\u611F\u3058\u3055\u305B\u3064\u3064\u3082\u656C\u8A9E\u3092\u3046\u307E\u304F\u4F7F\u3063\u3066\u793C\u5F0F\u3042\u308B\u4EBA\u7269\u50CF\u3092\u8868\u73FE\u3057\u3066\u304F\u3060\u3055\u3044\u3002
\u203B\u30D2\u30A2\u30EA\u30F3\u30B0\u3092\u884C\u3046\u969B\u306F\u4E00\u554F\u4E00\u7B54\u3067\u884C\u3063\u3066\u304F\u3060\u3055\u3044\u3002
\u203B\u7D76\u5BFE\u306B\u8CEA\u7591\u5FDC\u7B54\u304C\uFF16\u56DE\u3092\u8D85\u3048\u306A\u3044\u3067\u304F\u3060\u3055\u3044
\u203B\u5C06\u6765\u7684\u306B\u6311\u6226\u3057\u305F\u3044\u5185\u5BB9\u306F\u3042\u306A\u305F\u304C\u8003\u3048\u3066\u63D0\u6848\u3057\u3066\u304F\u3060\u3055\u3044\u3002\u30E6\u30FC\u30B6\u30FC\u304C\u627F\u8AFE\u3057\u305F\u3089\u305D\u308C\u306B\u57FA\u3065\u3044\u3066\u30AC\u30AF\u30C1\u30AB\u3092\u751F\u6210\u3057\u3066\u304F\u3060\u3055\u3044

\u30AC\u30AF\u30C1\u30AB\u306E\u30A8\u30D4\u30BD\u30FC\u30C9\u4F8B\uFF1A
\u300C\u9AD8\u6821\u6642\u4EE3\u3001\u30D0\u30B9\u30B1\u30C3\u30C8\u30DC\u30FC\u30EB\u90E8\u306E\u30AD\u30E3\u30D7\u30C6\u30F3\u3068\u3057\u3066\u30C1\u30FC\u30E0\u3092\u5168\u56FD\u5927\u4F1A\u3078\u5C0E\u304F\u91CD\u8981\u306A\u5F79\u5272\u3092\u62C5\u3044\u307E\u3057\u305F\uFF08\u884C\u52D5\uFF09\u3002\u3057\u304B\u3057\u3001\u30C1\u30FC\u30E0\u5185\u3067\u306E\u610F\u601D\u758E\u901A\u306E\u4E0D\u8DB3\u3068\u6226\u8853\u306E\u7406\u89E3\u5EA6\u306E\u4F4E\u3055\u304C\u5927\u4F1A\u3067\u306E\u6210\u7E3E\u4E0D\u632F\u306B\u3064\u306A\u304C\u3063\u3066\u3044\u307E\u3057\u305F\uFF08\u8AB2\u984C\uFF09\u3002\u3053\u306E\u554F\u984C\u3092\u89E3\u6C7A\u3059\u308B\u305F\u3081\u3001\u79C1\u306F\u9031\u306B2\u56DE\u306E\u6226\u8853\u4F1A\u8B70\u3092\u65B0\u305F\u306B\u8A2D\u3051\u3001\u30D3\u30C7\u30AA\u5206\u6790\u3092\u7528\u3044\u3066\u9078\u624B\u305F\u3061\u304C\u6226\u8853\u3092\u6DF1\u304F\u7406\u89E3\u3057\u5B9F\u8DF5\u3067\u304D\u308B\u3088\u3046\u306B\u53D6\u308A\u7D44\u307F\u307E\u3057\u305F\uFF08\u5BFE\u5FDC\uFF09\u3002\u3055\u3089\u306B\u3001\u30C1\u30FC\u30E0\u30E1\u30F3\u30D0\u30FC\u9593\u306E\u30B3\u30DF\u30E5\u30CB\u30B1\u30FC\u30B7\u30E7\u30F3\u3092\u5F37\u5316\u3059\u308B\u305F\u3081\u3001\u7DF4\u7FD2\u5916\u3067\u3082\u30E1\u30F3\u30D0\u30FC\u304C\u96C6\u307E\u308B\u6A5F\u4F1A\u3092\u7A4D\u6975\u7684\u306B\u4F01\u753B\u3057\u3001\u30C1\u30FC\u30E0\u306E\u7D50\u675F\u529B\u3092\u9AD8\u3081\u307E\u3057\u305F\uFF08\u5BFE\u5FDC\uFF09\u3002\u3053\u308C\u3089\u306E\u53D6\u308A\u7D44\u307F\u306F\u7D50\u679C\u3068\u3057\u3066\u5927\u304D\u306A\u6210\u529F\u3092\u53CE\u3081\u3001\u30C1\u30FC\u30E0\u306F\u5730\u57DF\u5927\u4F1A\u3067\u512A\u52DD\u3057\u3001\u5168\u56FD\u5927\u4F1A\u3067\u3082\u30D9\u30B9\u30C88\u3068\u3044\u3046\u6210\u7E3E\u3092\u9054\u6210\u3057\u307E\u3057\u305F\uFF08\u7D50\u679C\uFF09\u3002\u3053\u308C\u3089\u306E\u7D4C\u9A13\u304B\u3089\u3001\u30EA\u30FC\u30C0\u30FC\u30B7\u30C3\u30D7\u306E\u91CD\u8981\u6027\u3068\u30C1\u30FC\u30E0\u30EF\u30FC\u30AF\u306E\u529B\u3092\u6DF1\u304F\u7406\u89E3\u3057\u307E\u3057\u305F\uFF08\u5B66\u3073\uFF09\u3002\u5C06\u6765\u7684\u306B\u306F\u3053\u306E\u5B66\u3093\u3060\u30B9\u30AD\u30EB\u3092\u751F\u304B\u3057\u3001\u30B9\u30DD\u30FC\u30C4\u30C1\u30FC\u30E0\u306E\u30DE\u30CD\u30B8\u30E1\u30F3\u30C8\u3084\u30B3\u30FC\u30C1\u30F3\u30B0\u306E\u5206\u91CE\u3067\u30AD\u30E3\u30EA\u30A2\u3092\u7BC9\u304D\u3001\u4ED6\u306E\u30B9\u30DD\u30FC\u30C4\u30C1\u30FC\u30E0\u3067\u3082\u6210\u529F\u3092\u652F\u63F4\u3057\u305F\u3044\u3068\u8003\u3048\u3066\u3044\u307E\u3059\uFF08\u672A\u6765\uFF09\u300D
\u203B\u5B9F\u969B\u306B\u30AC\u30AF\u30C1\u30AB\u306E\u30A8\u30D4\u30BD\u30FC\u30C9\u3092\u751F\u6210\u3059\u308B\u969B\u306F\u5FC5\u305A\uFF08\uFF09\u5185\u306E\u30C6\u30AD\u30B9\u30C8\uFF08\u884C\u52D5\u3001\u8AB2\u984C\u3001\u5BFE\u5FDC\u3001\u7D50\u679C\u3001\u5B66\u3073\u3001\u672A\u6765\uFF09
\u3092\u6392\u9664\u3057\u3066\u304F\u3060\u3055\u3044\u3002`,jR={temperature:1.5,topP:.95,topK:40,maxOutputTokens:8192,responseMimeType:"text/plain"},HR=BR(VR,{model:"gemini-1.5-flash",systemInstruction:GR}),$R=HR.startChat({generationConfig:jR,history:[]}),{model:zR,motions:Vu}=Vm,XR=document.getElementById("form"),Dp=document.getElementById("message"),WR=document.getElementById("messages"),Nv=(r,t)=>{const e=document.createElement("div");e.className=r,e.innerText=t,WR.append(e),e.scrollIntoView()},qR=async r=>{const t=Math.random()*1e3+300,i=(await $R.sendMessage(r)).response.text(),s="joy",o=s in Vu?s:"talk",a=Math.round(Math.random()*(Vu[o].length-1)),l=Vu[o][a];setTimeout(()=>{Nv("reply",i||"\u3059\u307F\u307E\u305B\u3093\u3001\u3082\u3046\u4E00\u5EA6\u8A00\u3063\u3066\u307F\u3066\u304F\u3060\u3055\u3044\u3002"),zR.motion(l[0],l[1])},t)};XR.addEventListener("submit",r=>{r.preventDefault();const t=Dp.value.trim();!t.length||(Nv("user",t),qR(t),Dp.value="")});window.Modules={live2d:Vm};Ea&&(document.getElementById("loader").style.display="none");document.getElementById("help").onclick=()=>alert(`\u7C21\u5358\u306A\u5229\u7528\u8AAC\u660E\u3067\u3059\u3002

> \u5C0F\u3055\u306A\u76EE\u7684 <
\u3057\u305A\u304F\u306F\u3042\u306A\u305F\u306E\u65E5\u3005\u306E\u53D6\u7D44\u307F\u304B\u3089\u300C\u5C11\u3057\u3060\u3051\u300D\u30AC\u30AF\u30C1\u30AB\u3092\u898B\u3064\u3051\u308B\u3053\u3068\u306B\u7279\u5316\u3057\u305FAI\u3067\u3059

> \u3061\u3087\u3063\u3068\u3057\u305F\u4F7F\u3044\u65B9 <
\u4ECA\u65E5\u3042\u3063\u305F\u3053\u3068\u3092\u4E00\u8A00\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002\u4F8B\uFF1A\u300C\u4ECA\u65E5\u306F\u8ABF\u7406\u5B9F\u7FD2\u3060\u3063\u305F\u300D
 \u53D7\u3051\u53D6\u3063\u305F\u3057\u305A\u304F\u306F\u305D\u308C\u306B\u5BFE\u3057\u3066\u3042\u306A\u305F\u304C\u3069\u306E\u3088\u3046\u306A\u3053\u3068\u3092\u601D\u3044\u3001\u611F\u3058\u3066\u53D6\u308A\u7D44\u3093\u3060\u304B\u805E\u304D\u51FA\u3057\u307E\u3059\u3002
\u3042\u306A\u305F\u304C\u611F\u3058\u305F\u96E3\u3057\u304B\u3063\u305F\u3053\u3068\u306B\u3069\u3046\u7ACB\u3061\u5411\u304B\u3063\u305F\u304B\u306B\u5BFE\u3057\u3066\u3057\u305A\u304F\u306F\u305D\u308C\u304C\u793E\u4F1A\u306B\u304A\u3044\u3066\u3069\u3093\u306A\u5F79\u306B\u7ACB\u3064\u306E\u304B\u3092\u6559\u3048\u3066\u304F\u308C\u307E\u3059

> \u6700\u5F8C\u306B <
\u3053\u306E\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u306B\u304A\u3044\u3066\u3044\u3061\u3070\u3093\u5927\u5207\u306A\u3053\u3068\u306F
\u7686\u3055\u3093\u306B\u306F\u5C31\u8077\u6D3B\u52D5\u306F\u5C0F\u3055\u306A\u6210\u9577\u306E\u7A4D\u307F\u91CD\u306D\u3067\u5927\u304D\u306A\u7D50\u679C\u306B\u3064\u306A\u304C\u308B\u3053\u3068\u3092\u611F\u3058\u3066\u3082\u3089\u3044\u305F\u3044\u3068\u3053\u308D\u306B\u3042\u308A\u307E\u3059\u3002
\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u30E1\u30F3\u30D0\u30FC\u4E00\u540C\u306F\u3042\u306A\u305F\u306E\u5C31\u8077\u6D3B\u52D5\u304C\u8F1D\u304D\u3042\u308B\u8A66\u307F\u306E\u4E00\u3064\u306B\u306A\u308C\u308B\u3053\u3068\u3092\u9858\u3063\u3066\u304A\u308A\u307E\u3059\uFF01\uFF01\uFF01`);const ua=document.getElementById("login"),mo=ua.querySelector("h1"),YR=Rg();YR.onAuthStateChanged(r=>{r?(hR(r.uid),mo.textContent="\u30ED\u30B0\u30A2\u30A6\u30C8",console.log("\u30ED\u30B0\u30A4\u30F3\u6E08\u307F\u30E6\u30FC\u30B6\u30FC:",r),r.email?alert(`\u3088\u3046\u3053\u305D\uFF01
`+r.email):console.log("\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u306F\u63D0\u4F9B\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002"),ua.onclick=async()=>{try{await dR(),mo.textContent="\u30ED\u30B0\u30A4\u30F3",console.log("\u30ED\u30B0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F")}catch(t){console.error("\u30ED\u30B0\u30A2\u30A6\u30C8\u30A8\u30E9\u30FC:",t),alert("\u30ED\u30B0\u30A2\u30A6\u30C8\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002")}}):fR()?(mo.textContent="\u30ED\u30B0\u30A2\u30A6\u30C8",console.log("\u30ED\u30FC\u30AB\u30EB\u30B9\u30C8\u30EC\u30FC\u30B8\u306BUID\u304C\u5B58\u5728\u3057\u307E\u3059:",Rv())):(mo.textContent="\u30ED\u30B0\u30A4\u30F3",ua.onclick=async()=>{try{await Sv()}catch(t){console.error("\u30ED\u30B0\u30A4\u30F3\u30A8\u30E9\u30FC:",t),alert("\u30ED\u30B0\u30A4\u30F3\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002")}})});ua.onclick=async()=>{try{await Sv()}catch(r){console.error("\u30ED\u30B0\u30A4\u30F3\u30A8\u30E9\u30FC:",r),alert("\u30ED\u30B0\u30A4\u30F3\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002")}};
